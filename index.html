<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="CineBrain - The Mind Behind Your Next Favorite. Discover movies, TV shows, and anime with AI-powered recommendations.">
    <meta name="keywords" content="movies, TV shows, anime, recommendations, streaming, entertainment">
    <meta name="author" content="CineBrain">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="CineBrain - The Mind Behind Your Next Favorite">
    <meta property="og:description" content="Discover your next favorite movie, TV show, or anime with AI-powered recommendations">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://cinebrain.vercel.app">
    <meta property="og:image" content="/assets/og-image.jpg">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="CineBrain - AI-Powered Entertainment Discovery">
    <meta name="twitter:description" content="Find your perfect movie, show, or anime">
    <meta name="twitter:image" content="/assets/twitter-card.jpg">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/assets/favicon.svg">
    <link rel="icon" type="image/png" href="/assets/favicon.png">
    
    <!-- Preconnect to External Domains -->
    <link rel="preconnect" href="https://backend-app-970m.onrender.com">
    <link rel="preconnect" href="https://image.tmdb.org">
    <link rel="preconnect" href="https://ui-avatars.com">
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/components.css">
    <link rel="stylesheet" href="/css/layouts.css">
    <link rel="stylesheet" href="/css/animations.css">
    <link rel="stylesheet" href="/css/responsive.css">
    <link rel="stylesheet" href="/css/theme.css">
    
    <title>CineBrain - The Mind Behind Your Next Favorite</title>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="position-fixed top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center bg-dark" style="z-index: 9999;">
        <div class="text-center">
            <div class="loading-spinner mb-3"></div>
            <h4 class="text-white mb-2">CineBrain</h4>
            <p class="text-muted">Loading your entertainment universe...</p>
        </div>
    </div>

    <!-- Fixed Topbar -->
    <div id="topbarContainer"></div>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Hero Section -->
        <section class="hero-section d-flex align-items-center">
            <div class="container">
                <div class="row align-items-center min-vh-75">
                    <div class="col-lg-6">
                        <div class="hero-content">
                            <h1 class="hero-title fade-in">
                                Discover Your Next
                                <span class="gradient-text">Obsession</span>
                            </h1>
                            <p class="hero-subtitle slide-up">
                                AI-powered recommendations for movies, TV shows, and anime tailored to your unique taste.
                                Join millions discovering their next favorite content.
                            </p>
                            <div class="hero-actions d-flex flex-wrap gap-3 scale-in">
                                <button class="btn btn-primary btn-lg px-4 py-3" onclick="startDiscovery()">
                                    <i class="fas fa-magic me-2"></i>
                                    Start Discovering
                                </button>
                                <button class="btn btn-outline-primary btn-lg px-4 py-3" onclick="exploreContent()">
                                    <i class="fas fa-compass me-2"></i>
                                    Explore Content
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="hero-media text-center">
                            <div id="heroCarousel" class="carousel slide" data-bs-ride="carousel">
                                <div class="carousel-inner rounded-3 shadow-lg">
                                    <!-- Carousel items will be populated with real trending content -->
                                </div>
                                <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev">
                                    <span class="carousel-control-prev-icon"></span>
                                </button>
                                <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next">
                                    <span class="carousel-control-next-icon"></span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Trending Section -->
        <section class="content-section py-5">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">Trending Now</h2>
                    <p class="section-subtitle">What everyone's watching this week</p>
                </div>
                <div id="trendingContent" class="lazy-section" data-section="trending" data-limit="20">
                    <!-- Trending content will be loaded dynamically -->
                </div>
            </div>
        </section>

        <!-- New Releases Section -->
        <section class="content-section py-5 bg-dark bg-opacity-50">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">New Releases</h2>
                    <p class="section-subtitle">Fresh content just for you</p>
                </div>
                <div id="newReleasesContent" class="lazy-section" data-section="new_releases" data-limit="16">
                    <!-- New releases will be loaded dynamically -->
                </div>
            </div>
        </section>

        <!-- Critics' Choice Section -->
        <section class="content-section py-5">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-award text-warning me-2"></i>
                        Critics' Choice
                    </h2>
                    <p class="section-subtitle">Handpicked by critics and loved by audiences</p>
                </div>
                <div id="criticsChoiceContent" class="lazy-section" data-section="critics_choice" data-limit="12">
                    <!-- Critics' choice will be loaded dynamically -->
                </div>
            </div>
        </section>

        <!-- Regional Favorites -->
        <section class="content-section py-5 bg-dark bg-opacity-50">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">Regional Favorites</h2>
                    <p class="section-subtitle">Discover content from different cultures</p>
                </div>
                
                <!-- Regional Tabs -->
                <ul class="nav nav-pills justify-content-center mb-4" id="regionalTabs">
                    <li class="nav-item">
                        <button class="nav-link active" data-language="hindi" onclick="loadRegionalContent('hindi')">
                            <i class="fas fa-film me-1"></i>Hindi
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" data-language="telugu" onclick="loadRegionalContent('telugu')">
                            <i class="fas fa-tv me-1"></i>Telugu
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" data-language="tamil" onclick="loadRegionalContent('tamil')">
                            <i class="fas fa-video me-1"></i>Tamil
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" data-language="english" onclick="loadRegionalContent('english')">
                            <i class="fas fa-globe me-1"></i>English
                        </button>
                    </li>
                </ul>
                
                <div id="regionalContent" class="row">
                    <!-- Regional content will be loaded dynamically -->
                </div>
            </div>
        </section>

        <!-- Anime Section -->
        <section class="content-section py-5">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-dragon text-warning me-2"></i>
                        Anime Universe
                    </h2>
                    <p class="section-subtitle">From action-packed adventures to heartfelt stories</p>
                </div>
                <div id="animeContent" class="lazy-section" data-section="anime" data-limit="16">
                    <!-- Anime content will be loaded dynamically -->
                </div>
            </div>
        </section>

        <!-- Personalized Recommendations (Authenticated Users) -->
        <section id="personalizedSection" class="content-section py-5 bg-dark bg-opacity-50 d-none">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-brain text-primary me-2"></i>
                        Just for You
                    </h2>
                    <p class="section-subtitle">AI-powered recommendations based on your taste</p>
                </div>
                <div id="personalizedContent" class="row">
                    <!-- Personalized content will be loaded for authenticated users -->
                </div>
            </div>
        </section>
    </main>

    <!-- Mobile Navigation -->
    <div id="mobileNavContainer"></div>

    <!-- Toast Container -->
    <div class="toast-container position-fixed top-0 end-0 p-3"></div>

    <!-- JavaScript Files -->
    <script src="/js/config.js"></script>
    <script src="/js/api.js"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/app.js"></script>
    
    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Page-specific JavaScript -->
    <script>
    (function() {
        let heroCarouselData = [];
        let currentRegionalLanguage = 'hindi';

        // Initialize homepage
        async function initHomepage() {
            try {
                await loadComponents();
                await loadHeroCarousel();
                await checkAuthenticationState();
                setupEventListeners();
                hideLoadingScreen();
            } catch (error) {
                console.error('Homepage initialization failed:', error);
                hideLoadingScreen();
            }
        }

        // Load reusable components
        async function loadComponents() {
            try {
                // Load topbar
                const topbarResponse = await fetch('/components/layout/topbar.html');
                const topbarHTML = await topbarResponse.text();
                document.getElementById('topbarContainer').innerHTML = topbarHTML;

                // Load mobile navigation
                const mobileNavResponse = await fetch('/components/layout/mobile-nav.html');
                const mobileNavHTML = await mobileNavResponse.text();
                document.getElementById('mobileNavContainer').innerHTML = mobileNavHTML;

                // Execute component scripts
                const scripts = document.querySelectorAll('#topbarContainer script, #mobileNavContainer script');
                scripts.forEach(script => {
                    const newScript = document.createElement('script');
                    newScript.textContent = script.textContent;
                    document.head.appendChild(newScript);
                });
            } catch (error) {
                console.error('Failed to load components:', error);
            }
        }

        // Load hero carousel with real trending content
        async function loadHeroCarousel() {
            try {
                const trendingData = await window.api.getRecommendations('trending', { limit: 5 });
                const carouselInner = document.querySelector('#heroCarousel .carousel-inner');
                
                if (trendingData.length > 0) {
                    heroCarouselData = trendingData;
                    const carouselHTML = trendingData.map((item, index) => `
                        <div class="carousel-item ${index === 0 ? 'active' : ''}" data-content-id="${item.id}">
                            <div class="position-relative">
                                <img src="${item.poster_path || '/assets/hero-placeholder.jpg'}" 
                                     class="d-block w-100" 
                                     style="height: 400px; object-fit: cover; border-radius: 1rem;"
                                     alt="${item.title}"
                                     onerror="this.src='/assets/hero-placeholder.jpg'">
                                <div class="carousel-caption d-none d-md-block">
                                    <h5 class="fw-bold">${item.title}</h5>
                                    <p class="mb-2">${item.overview ? item.overview.substring(0, 100) + '...' : ''}</p>
                                    <div class="d-flex justify-content-center gap-2">
                                        <button class="btn btn-primary" onclick="viewDetails(${item.id})">
                                            <i class="fas fa-info-circle me-1"></i>Details
                                        </button>
                                        ${item.youtube_trailer ? `
                                            <button class="btn btn-outline-light" onclick="playTrailer('${item.youtube_trailer}', '${item.title}')">
                                                <i class="fas fa-play me-1"></i>Trailer
                                            </button>
                                        ` : ''}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `).join('');
                    
                    carouselInner.innerHTML = carouselHTML;
                } else {
                    // Fallback hero content
                    carouselInner.innerHTML = `
                        <div class="carousel-item active">
                            <div class="d-flex align-items-center justify-content-center bg-gradient text-white" style="height: 400px; border-radius: 1rem;">
                                <div class="text-center">
                                    <h3>Welcome to CineBrain</h3>
                                    <p>Your AI-powered entertainment discovery platform</p>
                                </div>
                            </div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Failed to load hero carousel:', error);
            }
        }

        // Check authentication state and load personalized content
        async function checkAuthenticationState() {
            if (window.auth && window.auth.isAuthenticated()) {
                await loadPersonalizedContent();
                document.getElementById('personalizedSection').classList.remove('d-none');
            }
        }

        // Load personalized content for authenticated users
        async function loadPersonalizedContent() {
            try {
                const personalizedData = await window.api.getRecommendations('personalized', { limit: 12 });
                const container = document.getElementById('personalizedContent');
                
                if (personalizedData.length > 0) {
                    const contentHTML = await renderContentGrid(personalizedData);
                    container.innerHTML = contentHTML;
                } else {
                    // Fallback to trending for new users
                    const fallbackData = await window.api.getRecommendations('trending', { limit: 12 });
                    const contentHTML = await renderContentGrid(fallbackData);
                    container.innerHTML = contentHTML;
                }
            } catch (error) {
                console.error('Failed to load personalized content:', error);
            }
        }

        // Load regional content
        window.loadRegionalContent = async function(language) {
            currentRegionalLanguage = language;
            
            // Update active tab
            const tabs = document.querySelectorAll('#regionalTabs .nav-link');
            tabs.forEach(tab => {
                tab.classList.remove('active');
                if (tab.dataset.language === language) {
                    tab.classList.add('active');
                }
            });

            // Load content
            const container = document.getElementById('regionalContent');
            container.innerHTML = `
                <div class="col-12 text-center">
                    <div class="loading-spinner mx-auto mb-3"></div>
                    <p class="text-muted">Loading ${language} content...</p>
                </div>
            `;

            try {
                const regionalData = await window.api.getRecommendations('regional', { 
                    language: language, 
                    limit: 12 
                });
                
                if (regionalData.length > 0) {
                    const contentHTML = await renderContentGrid(regionalData);
                    container.innerHTML = contentHTML;
                } else {
                    container.innerHTML = `
                        <div class="col-12 text-center py-5">
                            <i class="fas fa-film text-muted mb-3" style="font-size: 3rem;"></i>
                            <h5 class="text-muted">No ${language} content available</h5>
                            <p class="text-muted">Check back later for more content</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error(`Failed to load ${language} content:`, error);
                container.innerHTML = `
                    <div class="col-12 text-center py-5">
                        <i class="fas fa-exclamation-triangle text-warning mb-3" style="font-size: 3rem;"></i>
                        <h5 class="text-muted">Failed to load content</h5>
                        <button class="btn btn-outline-primary" onclick="loadRegionalContent('${language}')">
                            <i class="fas fa-refresh me-1"></i>Try Again
                        </button>
                    </div>
                `;
            }
        };

        // Render content grid
        async function renderContentGrid(contentArray) {
            const cardTemplate = await fetch('/components/cards/content-card.html');
            const cardHTML = await cardTemplate.text();
            
            return contentArray.map(item => {
                let cardElement = cardHTML;
                
                // Replace placeholders with real data
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = cardElement;
                const card = tempDiv.querySelector('.content-card');
                
                if (window.populateContentCard) {
                    window.populateContentCard(card, item);
                }
                
                return `
                    <div class="col-6 col-md-4 col-lg-3 col-xl-2 mb-4">
                        ${card.outerHTML}
                    </div>
                `;
            }).join('');
        }

        // Setup event listeners
        function setupEventListeners() {
            // Hero carousel click
            const carousel = document.getElementById('heroCarousel');
            if (carousel) {
                carousel.addEventListener('click', function(e) {
                    const activeItem = this.querySelector('.carousel-item.active');
                    if (activeItem && e.target.closest('.carousel-item')) {
                        const contentId = activeItem.dataset.contentId;
                        if (contentId) {
                            viewDetails(contentId);
                        }
                    }
                });
            }

            // Intersection observer for lazy sections
            const lazySections = document.querySelectorAll('.lazy-section');
            if (window.app && window.app.intersectionObserver) {
                lazySections.forEach(section => {
                    window.app.intersectionObserver.observe(section);
                });
            }
        }

        // Global functions
        window.startDiscovery = function() {
            if (window.auth && window.auth.isAuthenticated()) {
                window.location.href = window.auth.getUserProfileUrl();
            } else {
                window.location.href = '/auth/register.html';
            }
        };

        window.exploreContent = function() {
            window.location.href = '/content/search.html';
        };

        window.viewDetails = function(contentId) {
            window.location.href = `/content/details.html?id=${contentId}`;
        };

        window.playTrailer = async function(trailerUrl, title) {
            if (window.openTrailerModal) {
                window.openTrailerModal({
                    title: title,
                    youtube_trailer: trailerUrl
                });
            } else {
                // Fallback: open in new tab
                window.open(trailerUrl, '_blank');
            }
        };

        // Hide loading screen
        function hideLoadingScreen() {
            const loadingScreen = document.getElementById('loadingScreen');
            if (loadingScreen) {
                loadingScreen.style.opacity = '0';
                setTimeout(() => {
                    loadingScreen.remove();
                    document.body.classList.add('app-loaded');
                }, 300);
            }
        }

        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initHomepage);
        } else {
            initHomepage();
        }

        // Load initial regional content
        setTimeout(() => {
            loadRegionalContent('hindi');
        }, 1000);
    })();
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CineScope - Discover Your Next Favorite Movie</title>
    <meta name="description" content="Discover trending movies, TV shows, and anime with personalized recommendations. Your ultimate entertainment companion.">
    <meta name="keywords" content="movies, tv shows, anime, recommendations, entertainment, streaming">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="CineScope - Discover Your Next Favorite Movie">
    <meta property="og:description" content="Discover trending movies, TV shows, and anime with personalized recommendations.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://cinescope.app">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/assets/favicon.ico">
    <link rel="apple-touch-icon" href="/assets/apple-touch-icon.png">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/components.css">
    <link rel="stylesheet" href="/css/responsive.css">
    
    <!-- Preconnect to improve performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://api.themoviedb.org">
    <link rel="preconnect" href="https://image.tmdb.org">
</head>
<body>
    <!-- Preloader -->
    <div id="preloader" class="preloader">
        <div class="flex flex-col items-center">
            <div class="loader"></div>
            <p class="mt-4 text-lg font-medium">Loading CineScope...</p>
        </div>
    </div>

    <!-- Header -->
    <div id="header-placeholder"></div>

    <!-- Hero Section -->
    <section class="hero">
        <img src="https://image.tmdb.org/t/p/w1920_and_h800_multi_faces/5P8SmMzSNYikXpxil6BYzJ16611.jpg" 
             alt="Hero Background" 
             class="hero-background"
             onerror="this.src='https://images.unsplash.com/photo-1489599613-87c87d1fe93c?w=1920&h=800&fit=crop'">
        <div class="hero-overlay"></div>
        <div class="hero-content animate-fadeInUp">
            <h1 class="hero-title">Discover Your Next Favorite</h1>
            <p class="hero-subtitle">
                Explore trending movies, TV shows, and anime with personalized recommendations 
                powered by advanced machine learning algorithms.
            </p>
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <a href="#trending" class="btn btn-primary btn-lg">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                    </svg>
                    Explore Trending
                </a>
                <a href="/categories/new-releases" class="btn btn-secondary btn-lg">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                    </svg>
                    New Releases
                </a>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <main class="container">
        <!-- Quick Stats -->
        <section class="section">
            <div class="grid grid-2 md:grid-4 gap-6">
                <div class="stats-card">
                    <div class="stats-value" id="totalMovies">0</div>
                    <div class="stats-label">Movies</div>
                </div>
                <div class="stats-card">
                    <div class="stats-value" id="totalTVShows">0</div>
                    <div class="stats-label">TV Shows</div>
                </div>
                <div class="stats-card">
                    <div class="stats-value" id="totalAnime">0</div>
                    <div class="stats-label">Anime</div>
                </div>
                <div class="stats-card">
                    <div class="stats-value" id="totalUsers">0</div>
                    <div class="stats-label">Active Users</div>
                </div>
            </div>
        </section>

        <!-- Featured Carousel -->
        <section class="section">
            <h2 class="section-title">Featured Content</h2>
            <div class="carousel" id="featuredCarousel">
                <div class="carousel-container" id="featuredCarouselContainer">
                    <!-- Carousel slides will be populated by JavaScript -->
                </div>
                <button class="carousel-controls carousel-prev" id="carouselPrev">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                </button>
                <button class="carousel-controls carousel-next" id="carouselNext">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                </button>
                <div class="carousel-indicators" id="carouselIndicators">
                    <!-- Indicators will be populated by JavaScript -->
                </div>
            </div>
        </section>

        <!-- Dynamic Content Sections -->
        <div id="homepage-content">
            <!-- Content sections will be populated by JavaScript -->
        </div>

        <!-- Categories Grid -->
        <section class="section">
            <h2 class="section-title">Browse by Category</h2>
            <div class="grid grid-2 md:grid-3 lg:grid-6 gap-4">
                <a href="/categories/trending" class="category-card card">
                    <div class="card-content text-center">
                        <div class="text-4xl mb-2">üî•</div>
                        <h3 class="font-semibold">Trending</h3>
                        <p class="text-sm text-gray-400">What's hot right now</p>
                    </div>
                </a>
                <a href="/categories/popular" class="category-card card">
                    <div class="card-content text-center">
                        <div class="text-4xl mb-2">‚≠ê</div>
                        <h3 class="font-semibold">Popular</h3>
                        <p class="text-sm text-gray-400">Fan favorites</p>
                    </div>
                </a>
                <a href="/categories/new-releases" class="category-card card">
                    <div class="card-content text-center">
                        <div class="text-4xl mb-2">üÜï</div>
                        <h3 class="font-semibold">New Releases</h3>
                        <p class="text-sm text-gray-400">Latest content</p>
                    </div>
                </a>
                <a href="/categories/critic-choices" class="category-card card">
                    <div class="card-content text-center">
                        <div class="text-4xl mb-2">üèÜ</div>
                        <h3 class="font-semibold">Critics' Choice</h3>
                        <p class="text-sm text-gray-400">Highly rated</p>
                    </div>
                </a>
                <a href="/categories/movies" class="category-card card">
                    <div class="card-content text-center">
                        <div class="text-4xl mb-2">üé¨</div>
                        <h3 class="font-semibold">Movies</h3>
                        <p class="text-sm text-gray-400">Cinema classics</p>
                    </div>
                </a>
                <a href="/categories/tv-shows" class="category-card card">
                    <div class="card-content text-center">
                        <div class="text-4xl mb-2">üì∫</div>
                        <h3 class="font-semibold">TV Shows</h3>
                        <p class="text-sm text-gray-400">Binge-worthy series</p>
                    </div>
                </a>
                <a href="/categories/anime" class="category-card card">
                    <div class="card-content text-center">
                        <div class="text-4xl mb-2">üéå</div>
                        <h3 class="font-semibold">Anime</h3>
                        <p class="text-sm text-gray-400">Japanese animation</p>
                    </div>
                </a>
                <a href="/languages/hindi" class="category-card card">
                    <div class="card-content text-center">
                        <div class="text-4xl mb-2">üáÆüá≥</div>
                        <h3 class="font-semibold">Bollywood</h3>
                        <p class="text-sm text-gray-400">Hindi cinema</p>
                    </div>
                </a>
            </div>
        </section>

        <!-- Language-based Recommendations -->
        <section class="section">
            <h2 class="section-title">Explore by Language</h2>
            <div class="tabs" id="languageTabs">
                <div class="tab-list">
                    <button class="tab-button active" data-tab="english">English</button>
                    <button class="tab-button" data-tab="hindi">Hindi</button>
                    <button class="tab-button" data-tab="telugu">Telugu</button>
                    <button class="tab-button" data-tab="tamil">Tamil</button>
                    <button class="tab-button" data-tab="kannada">Kannada</button>
                    <button class="tab-button" data-tab="malayalam">Malayalam</button>
                </div>
                <div class="tab-content">
                    <div class="tab-panel active" data-panel="english">
                        <div class="horizontal-scroll" id="englishContent">
                            <!-- Content will be loaded dynamically -->
                        </div>
                    </div>
                    <div class="tab-panel" data-panel="hindi">
                        <div class="horizontal-scroll" id="hindiContent">
                            <!-- Content will be loaded dynamically -->
                        </div>
                    </div>
                    <div class="tab-panel" data-panel="telugu">
                        <div class="horizontal-scroll" id="teluguContent">
                            <!-- Content will be loaded dynamically -->
                        </div>
                    </div>
                    <div class="tab-panel" data-panel="tamil">
                        <div class="horizontal-scroll" id="tamilContent">
                            <!-- Content will be loaded dynamically -->
                        </div>
                    </div>
                    <div class="tab-panel" data-panel="kannada">
                        <div class="horizontal-scroll" id="kannadaContent">
                            <!-- Content will be loaded dynamically -->
                        </div>
                    </div>
                    <div class="tab-panel" data-panel="malayalam">
                        <div class="horizontal-scroll" id="malayalamContent">
                            <!-- Content will be loaded dynamically -->
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Newsletter Signup -->
        <section class="section">
            <div class="card max-w-2xl mx-auto text-center">
                <div class="card-content">
                    <h2 class="text-2xl font-bold mb-4">Stay Updated</h2>
                    <p class="text-gray-400 mb-6">Get notified about new releases, trending content, and personalized recommendations.</p>
                    <form id="newsletterForm" class="flex flex-col sm:flex-row gap-4">
                        <input type="email" name="email" placeholder="Enter your email" class="form-input flex-1" required>
                        <button type="submit" class="btn btn-primary">Subscribe</button>
                    </form>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <div id="footer-placeholder"></div>

    <!-- Scripts -->
    <script src="/js/main.js"></script>
    <script>
        // Initialize homepage-specific functionality
        document.addEventListener('DOMContentLoaded', async () => {
            // Load header and footer
            try {
                const headerResponse = await fetch('/includes/header.html');
                const headerHTML = await headerResponse.text();
                document.getElementById('header-placeholder').innerHTML = headerHTML;
                
                const footerResponse = await fetch('/includes/footer.html');
                const footerHTML = await footerResponse.text();
                document.getElementById('footer-placeholder').innerHTML = footerHTML;
            } catch (error) {
                console.error('Error loading includes:', error);
            }

            // Initialize tabs
            UI.initTabs(document.getElementById('languageTabs'));

            // Load featured carousel
            await loadFeaturedCarousel();

            // Load language-based content
            await loadLanguageContent();

            // Load stats
            await loadStats();

            // Handle newsletter signup
            document.getElementById('newsletterForm').addEventListener('submit', handleNewsletterSignup);
        });

        // Load featured carousel content
        async function loadFeaturedCarousel() {
            try {
                const response = await api.getTrending('all', 5);
                const content = response.recommendations || [];
                
                if (content.length === 0) return;

                const container = document.getElementById('featuredCarouselContainer');
                const indicators = document.getElementById('carouselIndicators');
                
                // Create carousel slides
                container.innerHTML = content.map((item, index) => `
                    <div class="carousel-slide">
                        <div class="relative h-96 rounded-lg overflow-hidden">
                            <img src="${item.poster_path || Utils.getPlaceholderImage(800, 400)}" 
                                 alt="${Utils.sanitizeHTML(item.title)}" 
                                 class="w-full h-full object-cover">
                            <div class="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent"></div>
                            <div class="absolute bottom-0 left-0 p-6">
                                <h3 class="text-2xl font-bold mb-2">${Utils.sanitizeHTML(item.title)}</h3>
                                <p class="text-gray-300 mb-4">${Utils.truncateText(item.overview, 100)}</p>
                                <div class="flex items-center gap-4">
                                    <button onclick="Router.navigate('/details?id=${item.id}')" class="btn btn-primary">
                                        Watch Now
                                    </button>
                                    ${item.youtube_trailer ? `
                                        <a href="${item.youtube_trailer}" target="_blank" class="btn btn-secondary">
                                            Trailer
                                        </a>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');

                // Create indicators
                indicators.innerHTML = content.map((_, index) => `
                    <button class="carousel-indicator ${index === 0 ? 'active' : ''}" data-slide="${index}"></button>
                `).join('');

                // Initialize carousel functionality
                initCarousel();
                
            } catch (error) {
                console.error('Error loading featured carousel:', error);
            }
        }

        // Initialize carousel controls
        function initCarousel() {
            let currentSlide = 0;
            const slides = document.querySelectorAll('.carousel-slide');
            const indicators = document.querySelectorAll('.carousel-indicator');
            const container = document.getElementById('featuredCarouselContainer');
            
            if (slides.length === 0) return;

            function goToSlide(slideIndex) {
                currentSlide = slideIndex;
                container.style.transform = `translateX(-${currentSlide * 100}%)`;
                
                indicators.forEach((indicator, index) => {
                    indicator.classList.toggle('active', index === currentSlide);
                });
            }

            function nextSlide() {
                currentSlide = (currentSlide + 1) % slides.length;
                goToSlide(currentSlide);
            }

            function prevSlide() {
                currentSlide = currentSlide === 0 ? slides.length - 1 : currentSlide - 1;
                goToSlide(currentSlide);
            }

            // Event listeners
            document.getElementById('carouselNext').addEventListener('click', nextSlide);
            document.getElementById('carouselPrev').addEventListener('click', prevSlide);

            indicators.forEach((indicator, index) => {
                indicator.addEventListener('click', () => goToSlide(index));
            });

            // Auto-advance carousel
            let autoAdvance = setInterval(nextSlide, 5000);

            // Pause auto-advance on hover
            const carousel = document.getElementById('featuredCarousel');
            carousel.addEventListener('mouseenter', () => clearInterval(autoAdvance));
            carousel.addEventListener('mouseleave', () => {
                autoAdvance = setInterval(nextSlide, 5000);
            });
        }

        // Load language-based content
        async function loadLanguageContent() {
            const languages = ['english', 'hindi', 'telugu', 'tamil', 'kannada', 'malayalam'];
            
            for (const language of languages) {
                try {
                    const response = await api.getRegionalContent(language, 'movie', 10);
                    const content = response.recommendations || [];
                    
                    const container = document.getElementById(`${language}Content`);
                    if (container && content.length > 0) {
                        container.innerHTML = content.map(item => {
                            const card = UI.createMovieCard(item);
                            card.classList.add('horizontal-scroll-item');
                            return card.outerHTML;
                        }).join('');
                    }
                } catch (error) {
                    console.error(`Error loading ${language} content:`, error);
                }
            }

            // Initialize lazy loading for new images
            Utils.lazyLoadImages();
        }

        // Load stats
        async function loadStats() {
            // Animated counting function
            function animateCounter(element, target, duration = 2000) {
                const start = 0;
                const increment = target / (duration / 16);
                let current = start;

                const timer = setInterval(() => {
                    current += increment;
                    if (current >= target) {
                        current = target;
                        clearInterval(timer);
                    }
                    element.textContent = Math.floor(current).toLocaleString();
                }, 16);
            }

            // Sample stats (in production, these would come from the API)
            const stats = {
                totalMovies: 125000,
                totalTVShows: 85000,
                totalAnime: 15000,
                totalUsers: 50000
            };

            // Animate counters when they come into view
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const element = entry.target;
                        const key = element.id;
                        if (stats[key]) {
                            animateCounter(element, stats[key]);
                            observer.unobserve(element);
                        }
                    }
                });
            });

            Object.keys(stats).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    observer.observe(element);
                }
            });
        }

        // Handle newsletter signup
        async function handleNewsletterSignup(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const email = formData.get('email');

            if (!Utils.validateEmail(email)) {
                UI.showToast('Please enter a valid email address', 'error');
                return;
            }

            try {
                const submitBtn = e.target.querySelector('button[type="submit"]');
                submitBtn.disabled = true;
                submitBtn.textContent = 'Subscribing...';

                // Simulate API call (implement actual newsletter service)
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                UI.showToast('Successfully subscribed to newsletter!', 'success');
                e.target.reset();

            } catch (error) {
                UI.showToast('Failed to subscribe. Please try again.', 'error');
            } finally {
                const submitBtn = e.target.querySelector('button[type="submit"]');
                submitBtn.disabled = false;
                submitBtn.textContent = 'Subscribe';
            }
        }
    </script>
</body>
</html>
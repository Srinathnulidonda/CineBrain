<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CineBrain - The Mind Behind Your Next Favorite</title>

    <!-- Preload Critical Resources -->
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" as="style">
    <link rel="preload" href="https://cdn.tailwindcss.com" as="script">
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" as="style">

    <!-- DNS Prefetch -->
    <link rel="dns-prefetch" href="//backend-app-970m.onrender.com">
    <link rel="dns-prefetch" href="//image.tmdb.org">
    <link rel="dns-prefetch" href="//www.youtube.com">

    <!-- Meta Tags -->
    <meta name="description" content="CineBrain - Premium movie, TV series and anime recommendations powered by AI">
    <meta name="theme-color" content="#0a0a0b">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%233b82f6'%3E%3Cpath d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z'/%3E%3C/svg%3E">

    <!-- CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        :root {
            --cinema-black: #0a0a0b;
            --theater-dark: #141418;
            --velvet-dark: #1e1e23;
            --platinum-blue: #3b82f6;
            --royal-purple: #8b5cf6;
            --vip-gold: #f59e0b;
            --bs-primary: var(--platinum-blue);
            --bs-secondary: var(--royal-purple);
        }

        body {
            background: linear-gradient(135deg, var(--platinum-blue) 0%, var(--royal-purple) 50%, var(--velvet-dark) 100%);
            background-attachment: fixed;
            font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
            color: #f8f9fa;
            padding-top: 4rem;
            padding-bottom: 5rem;
        }

        @media (min-width: 768px) {
            body {
                padding-bottom: 1rem;
            }
        }

        .bg-cinema-black {
            background-color: var(--cinema-black);
        }

        .bg-theater-dark {
            background-color: var(--theater-dark);
        }

        .bg-velvet-dark {
            background-color: var(--velvet-dark);
        }

        .border-theater-dark {
            border-color: var(--theater-dark) !important;
        }

        .border-velvet-dark {
            border-color: var(--velvet-dark) !important;
        }

        .text-vip-gold {
            color: var(--vip-gold);
        }

        .content-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 0 30px rgba(139, 92, 246, 0.3);
        }

        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .line-clamp-3 {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .mobile-nav .nav-item {
            background: none;
            border: none;
            color: #9ca3af;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.5rem;
            transition: all 0.3s ease;
            border-radius: 0.5rem;
        }

        .mobile-nav .nav-item.active {
            color: var(--platinum-blue);
            background: rgba(59, 130, 246, 0.2);
        }

        .mobile-nav .nav-icon {
            font-size: 1.125rem;
            margin-bottom: 0.25rem;
        }

        .mobile-nav .nav-label {
            font-size: 0.75rem;
            line-height: 1;
        }

        .hero-section {
            background: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)), url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000"><defs><radialGradient id="a"><stop offset="0%" stop-color="%233b82f6"/><stop offset="100%" stop-color="%238b5cf6"/></radialGradient></defs><rect width="100%" height="100%" fill="url(%23a)"/></svg>');
            background-size: cover;
            background-position: center;
            min-height: 60vh;
        }

        .section-container {
            background: rgba(20, 20, 24, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            border: 1px solid var(--velvet-dark);
        }

        .horizontal-scroll {
            overflow-x: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--platinum-blue) var(--theater-dark);
        }

        .horizontal-scroll::-webkit-scrollbar {
            height: 6px;
        }

        .horizontal-scroll::-webkit-scrollbar-track {
            background: var(--theater-dark);
            border-radius: 3px;
        }

        .horizontal-scroll::-webkit-scrollbar-thumb {
            background: var(--platinum-blue);
            border-radius: 3px;
        }

        .loading-skeleton {
            background: linear-gradient(90deg, var(--theater-dark) 25%, var(--velvet-dark) 50%, var(--theater-dark) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }

        @keyframes shimmer {
            0% {
                background-position: -200% 0;
            }

            100% {
                background-position: 200% 0;
            }
        }

        .genre-chip {
            background: var(--theater-dark);
            color: #d1d5db;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
        }

        .genre-chip:hover {
            background: var(--platinum-blue);
            color: white;
        }

        .genre-chip.active {
            background: var(--platinum-blue);
            color: white;
        }

        .aspect-2-3 {
            aspect-ratio: 2/3;
        }

        .aspect-video {
            aspect-ratio: 16/9;
        }

        .backdrop-blur-sm {
            backdrop-filter: blur(4px);
        }

        @media (max-width: 768px) {
            .hero-section {
                min-height: 40vh;
            }

            .section-container {
                margin: 0.5rem;
            }
        }
    </style>
</head>

<body>
    <!-- Top Navigation -->
    <div id="topbar-container"></div>

    <!-- Main Content -->
    <main id="mainContent">
        <!-- Hero Section -->
        <section class="hero-section d-flex align-items-center justify-content-center text-center">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <h1 class="display-4 fw-bold text-white mb-3">Discover Your Next Favorite</h1>
                        <p class="lead text-gray-300 mb-4">Powered by AI, curated by experts, loved by millions</p>
                        <div class="d-flex gap-3 justify-content-center flex-wrap">
                            <button class="btn btn-primary btn-lg px-4" onclick="showSection('trending')">
                                <i class="fas fa-fire me-2"></i>Trending Now
                            </button>
                            <button class="btn btn-outline-light btn-lg px-4" onclick="showSection('search')">
                                <i class="fas fa-search me-2"></i>Explore
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Content Sections -->
        <div class="container-fluid px-3 py-4">
            <!-- Home Section -->
            <div id="homeSection" class="content-section">
                <!-- Trending Section -->
                <div class="section-container p-4 mb-4">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h2 class="h4 fw-bold text-white mb-0">
                            <i class="fas fa-fire text-danger me-2"></i>Trending Now
                        </h2>
                        <button class="btn btn-outline-primary btn-sm" onclick="loadMoreContent('trending')">
                            View All
                        </button>
                    </div>
                    <div id="trendingContent" class="row g-3">
                        <!-- Dynamic content -->
                    </div>
                </div>

                <!-- New Releases -->
                <div class="section-container p-4 mb-4">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h2 class="h4 fw-bold text-white mb-0">
                            <i class="fas fa-star text-vip-gold me-2"></i>New Releases
                        </h2>
                        <button class="btn btn-outline-primary btn-sm" onclick="loadMoreContent('new-releases')">
                            View All
                        </button>
                    </div>
                    <div id="newReleasesContent" class="row g-3">
                        <!-- Dynamic content -->
                    </div>
                </div>

                <!-- Critics Choice -->
                <div class="section-container p-4 mb-4">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h2 class="h4 fw-bold text-white mb-0">
                            <i class="fas fa-award text-vip-gold me-2"></i>Critics' Choice
                        </h2>
                        <button class="btn btn-outline-primary btn-sm" onclick="loadMoreContent('critics-choice')">
                            View All
                        </button>
                    </div>
                    <div id="criticsChoiceContent" class="row g-3">
                        <!-- Dynamic content -->
                    </div>
                </div>

                <!-- Regional Content -->
                <div class="section-container p-4 mb-4">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h2 class="h4 fw-bold text-white mb-0">
                            <i class="fas fa-globe text-info me-2"></i>Regional Favorites
                        </h2>
                        <div class="d-flex gap-2">
                            <select class="form-select form-select-sm bg-theater-dark text-white border-velvet-dark"
                                style="width: auto;" onchange="loadRegionalContent(this.value)">
                                <option value="hindi">Hindi</option>
                                <option value="english">English</option>
                                <option value="tamil">Tamil</option>
                                <option value="telugu">Telugu</option>
                                <option value="kannada">Kannada</option>
                                <option value="malayalam">Malayalam</option>
                            </select>
                        </div>
                    </div>
                    <div id="regionalContent" class="row g-3">
                        <!-- Dynamic content -->
                    </div>
                </div>

                <!-- Anime Section -->
                <div class="section-container p-4 mb-4">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h2 class="h4 fw-bold text-white mb-0">
                            <i class="fas fa-dragon text-royal-purple me-2"></i>Anime
                        </h2>
                        <button class="btn btn-outline-primary btn-sm" onclick="loadMoreContent('anime')">
                            View All
                        </button>
                    </div>
                    <div id="animeContent" class="row g-3">
                        <!-- Dynamic content -->
                    </div>
                </div>
            </div>

            <!-- Search Section -->
            <div id="searchSection" class="content-section d-none">
                <div class="section-container p-4">
                    <div class="mb-4">
                        <div class="d-flex gap-3 align-items-center mb-3">
                            <div class="flex-grow-1">
                                <div id="searchContainer"></div>
                            </div>
                            <button class="btn btn-outline-primary" data-bs-toggle="modal"
                                data-bs-target="#filterModal">
                                <i class="fas fa-filter me-2"></i>Filters
                            </button>
                        </div>
                    </div>
                    <div id="searchResults" class="row g-3">
                        <!-- Search results -->
                    </div>
                </div>
            </div>

            <!-- Watchlist Section -->
            <div id="watchlistSection" class="content-section d-none">
                <div class="section-container p-4">
                    <h2 class="h4 fw-bold text-white mb-4">
                        <i class="fas fa-bookmark me-2"></i>My Watchlist
                    </h2>
                    <div id="watchlistContent" class="row g-3">
                        <!-- Watchlist content -->
                    </div>
                </div>
            </div>

            <!-- Favorites Section -->
            <div id="favoritesSection" class="content-section d-none">
                <div class="section-container p-4">
                    <h2 class="h4 fw-bold text-white mb-4">
                        <i class="fas fa-heart me-2"></i>My Favorites
                    </h2>
                    <div id="favoritesContent" class="row g-3">
                        <!-- Favorites content -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Mobile Navigation -->
    <div id="mobile-nav-container"></div>

    <!-- Modals -->
    <div id="trailer-modal-container"></div>
    <div id="filter-modal-container"></div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay"
        class="position-fixed top-0 start-0 w-100 h-100 d-none align-items-center justify-content-center"
        style="background: rgba(10, 10, 11, 0.9); z-index: 9999;">
        <div class="text-center">
            <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;"></div>
            <div class="mt-3 text-white">Loading amazing content...</div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Global Variables
        const API_BASE = 'https://backend-app-970m.onrender.com/api';
        let currentFilters = {};
        let searchTimeout;

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js').then(registration => {
                console.log('ServiceWorker registered:', registration.scope);
            }).catch(error => {
                console.log('ServiceWorker registration failed:', error);
            });
        }

        // API Functions with Caching
        async function fetchWithCache(url, options = {}) {
            const cacheKey = `cache_${btoa(url)}`;
            const cached = localStorage.getItem(cacheKey);
            const cacheTime = localStorage.getItem(`${cacheKey}_time`);

            // Use cache if less than 5 minutes old
            if (cached && cacheTime && (Date.now() - parseInt(cacheTime)) < 300000) {
                return JSON.parse(cached);
            }

            try {
                const response = await fetch(url, {
                    ...options,
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    }
                });

                if (!response.ok) throw new Error(`HTTP ${response.status}`);

                const data = await response.json();

                // Cache successful responses
                localStorage.setItem(cacheKey, JSON.stringify(data));
                localStorage.setItem(`${cacheKey}_time`, Date.now().toString());

                return data;
            } catch (error) {
                console.error('API Error:', error);
                // Return cached data if available, even if old
                if (cached) return JSON.parse(cached);
                throw error;
            }
        }

        // Content Rendering Functions
        function createContentCard(content, size = 'standard') {
            const card = document.createElement('div');
            card.className = size === 'mini' ? 'col-auto' : 'col-lg-2 col-md-3 col-sm-4 col-6';

            const posterUrl = content.poster_path || 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 300 450" fill="%23374151"%3E%3Crect width="100%25" height="100%25"/%3E%3Ctext x="50%25" y="50%25" text-anchor="middle" fill="%23d1d5db" font-size="24"%3ENo Image%3C/text%3E%3C/svg%3E';
            const rating = content.rating ? content.rating.toFixed(1) : 'N/A';
            const year = content.release_date ? new Date(content.release_date).getFullYear() : '';
            const genres = content.genres || [];

            // Create fallback image URL
            const fallbackImage = 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 300 450" fill="%23374151"%3E%3Crect width="100%25" height="100%25"/%3E%3Ctext x="50%25" y="50%25" text-anchor="middle" fill="%23d1d5db" font-size="24"%3ENo Image%3C/text%3E%3C/svg%3E';

            card.innerHTML = `
        <div class="card bg-velvet-dark border-0 rounded-lg shadow-lg hover:shadow-xl transition-all duration-300 h-100 content-card" 
             data-content-id="${content.id}" onclick="openContentDetails(${content.id})">
            <div class="position-relative overflow-hidden rounded-t-lg">
                <img class="card-img-top aspect-2-3 object-cover hover:scale-105 transition-transform duration-300" 
                     src="${posterUrl}" 
                     alt="${content.title}" 
                     loading="lazy" 
                     onerror="this.src='${fallbackImage}'">
                <div class="position-absolute top-2 right-2">
                    <span class="bg-vip-gold text-cinema-black px-2 py-1 rounded-full text-xs font-bold">
                        <i class="fas fa-star me-1"></i>${rating}
                    </span>
                </div>
                <div class="position-absolute top-2 left-2">
                    <span class="badge ${getTypeBadgeClass(content.content_type)} text-xs font-semibold px-2 py-1 rounded-full">
                        ${content.content_type.toUpperCase()}
                    </span>
                </div>
            </div>
            <div class="card-body p-3">
                <h6 class="card-title text-white font-semibold text-sm line-clamp-2 mb-2">${content.title}</h6>
                <div class="text-xs text-gray-300 d-flex justify-content-between align-items-center mb-2">
                    <span>${year}</span>
                    <span>${content.content_type}</span>
                </div>
                <div class="d-flex flex-wrap gap-1 mb-2">
                    ${genres.slice(0, 2).map(genre => `<span class="genre-chip">${genre}</span>`).join('')}
                </div>
                <p class="card-text text-gray-400 text-xs line-clamp-2 mb-3">${content.overview || 'No description available'}</p>
                <div class="d-flex gap-2">
                    ${content.youtube_trailer ? `
                        <button class="btn btn-sm btn-outline-light flex-1" onclick="event.stopPropagation(); playTrailer('${content.youtube_trailer}', '${content.title}')">
                            <i class="fas fa-play me-1"></i>Trailer
                        </button>
                    ` : ''}
                    <button class="btn btn-sm btn-outline-primary" onclick="event.stopPropagation(); toggleWatchlist(${content.id})">
                        <i class="fas fa-bookmark"></i>
                    </button>
                </div>
            </div>
        </div>
    `;

            return card;
        }

        function getTypeBadgeClass(type) {
            const classes = {
                'movie': 'bg-primary',
                'tv': 'bg-success',
                'anime': 'bg-danger'
            };
            return classes[type] || 'bg-secondary';
        }

        function createLoadingSkeleton(count = 6) {
            const container = document.createElement('div');
            container.className = 'row g-3';

            for (let i = 0; i < count; i++) {
                const col = document.createElement('div');
                col.className = 'col-lg-2 col-md-3 col-sm-4 col-6';
                col.innerHTML = `
                    <div class="card bg-theater-dark border-0 h-100">
                        <div class="loading-skeleton aspect-[2/3] rounded-t-lg"></div>
                        <div class="card-body">
                            <div class="loading-skeleton rounded mb-2" style="height: 1rem;"></div>
                            <div class="loading-skeleton rounded mb-2" style="height: 0.75rem; width: 60%;"></div>
                            <div class="loading-skeleton rounded" style="height: 2rem;"></div>
                        </div>
                    </div>
                `;
                container.appendChild(col);
            }

            return container;
        }

        // Content Loading Functions
        async function loadTrendingContent() {
            const container = document.getElementById('trendingContent');
            container.innerHTML = '';
            container.appendChild(createLoadingSkeleton(6));

            try {
                const data = await fetchWithCache(`${API_BASE}/recommendations/trending?limit=12`);
                container.innerHTML = '';

                data.recommendations.forEach(content => {
                    container.appendChild(createContentCard(content));
                });
            } catch (error) {
                container.innerHTML = '<div class="col-12 text-center text-muted">Failed to load trending content</div>';
            }
        }

        async function loadNewReleases() {
            const container = document.getElementById('newReleasesContent');
            container.innerHTML = '';
            container.appendChild(createLoadingSkeleton(6));

            try {
                const data = await fetchWithCache(`${API_BASE}/recommendations/new-releases?limit=12`);
                container.innerHTML = '';

                data.recommendations.forEach(content => {
                    container.appendChild(createContentCard(content));
                });
            } catch (error) {
                container.innerHTML = '<div class="col-12 text-center text-muted">Failed to load new releases</div>';
            }
        }

        async function loadCriticsChoice() {
            const container = document.getElementById('criticsChoiceContent');
            container.innerHTML = '';
            container.appendChild(createLoadingSkeleton(6));

            try {
                const data = await fetchWithCache(`${API_BASE}/recommendations/critics-choice?limit=12`);
                container.innerHTML = '';

                data.recommendations.forEach(content => {
                    container.appendChild(createContentCard(content));
                });
            } catch (error) {
                container.innerHTML = '<div class="col-12 text-center text-muted">Failed to load critics choice</div>';
            }
        }

        async function loadRegionalContent(language = 'hindi') {
            const container = document.getElementById('regionalContent');
            container.innerHTML = '';
            container.appendChild(createLoadingSkeleton(6));

            try {
                const data = await fetchWithCache(`${API_BASE}/recommendations/regional/${language}?limit=12`);
                container.innerHTML = '';

                data.recommendations.forEach(content => {
                    container.appendChild(createContentCard(content));
                });
            } catch (error) {
                container.innerHTML = '<div class="col-12 text-center text-muted">Failed to load regional content</div>';
            }
        }

        async function loadAnimeContent() {
            const container = document.getElementById('animeContent');
            container.innerHTML = '';
            container.appendChild(createLoadingSkeleton(6));

            try {
                const data = await fetchWithCache(`${API_BASE}/recommendations/anime?limit=12`);
                container.innerHTML = '';

                data.recommendations.forEach(content => {
                    container.appendChild(createContentCard(content));
                });
            } catch (error) {
                container.innerHTML = '<div class="col-12 text-center text-muted">Failed to load anime content</div>';
            }
        }

        // Search Functions
        async function performSearch(query) {
            if (!query.trim()) return;

            const container = document.getElementById('searchResults');
            container.innerHTML = '';
            container.appendChild(createLoadingSkeleton(8));

            try {
                const data = await fetchWithCache(`${API_BASE}/search?query=${encodeURIComponent(query)}&type=multi`);
                container.innerHTML = '';

                if (data.results.length === 0) {
                    container.innerHTML = '<div class="col-12 text-center text-muted">No results found</div>';
                } else {
                    data.results.forEach(content => {
                        container.appendChild(createContentCard(content));
                    });
                }
            } catch (error) {
                container.innerHTML = '<div class="col-12 text-center text-muted">Search failed. Please try again.</div>';
            }
        }

        function setupSearch() {
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', (e) => {
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(() => {
                        if (e.target.value.trim()) {
                            performSearch(e.target.value.trim());
                        }
                    }, 500);
                });
            }
        }

        // Modal Functions
        function playTrailer(youtubeUrl, title) {
            const modal = new bootstrap.Modal(document.getElementById('trailerModal'));
            const iframe = document.getElementById('trailerFrame');
            const modalTitle = document.querySelector('#trailerModal .modal-title');

            // Extract video ID from YouTube URL
            const videoId = youtubeUrl.includes('watch?v=')
                ? youtubeUrl.split('watch?v=')[1].split('&')[0]
                : youtubeUrl.split('/').pop();

            iframe.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0`;
            modalTitle.textContent = title;
            modal.show();

            // Clear iframe when modal is hidden
            document.getElementById('trailerModal').addEventListener('hidden.bs.modal', () => {
                iframe.src = '';
            });
        }

        async function openContentDetails(contentId) {
            try {
                const data = await fetchWithCache(`${API_BASE}/content/${contentId}`);
                // This would open a detailed modal or navigate to a details page
                console.log('Content details:', data);
                // For now, just show an alert - would be implemented as a full details modal
                alert(`Content Details: ${data.title}\nRating: ${data.rating}\nOverview: ${data.overview}`);
            } catch (error) {
                console.error('Failed to load content details:', error);
            }
        }

        // Utility Functions
        function toggleWatchlist(contentId) {
            // This would toggle watchlist status
            console.log('Toggle watchlist for content:', contentId);
            // Show success message
            showToast('Added to watchlist!');
        }

        function showToast(message) {
            // Simple toast implementation
            const toast = document.createElement('div');
            toast.className = 'position-fixed bottom-0 end-0 m-3 bg-success text-white p-3 rounded';
            toast.style.zIndex = '9999';
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.add('d-none');
            });

            // Show selected section
            const section = document.getElementById(`${sectionName}Section`);
            if (section) {
                section.classList.remove('d-none');
            }

            // Update mobile nav
            document.querySelectorAll('.mobile-nav .nav-item').forEach(item => {
                item.classList.remove('active');
            });

            const navItem = document.querySelector(`.mobile-nav .nav-item[data-section="${sectionName}"]`);
            if (navItem) {
                navItem.classList.add('active');
            }
        }

        function showLoading() {
            document.getElementById('loadingOverlay').classList.remove('d-none');
            document.getElementById('loadingOverlay').classList.add('d-flex');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.add('d-none');
            document.getElementById('loadingOverlay').classList.remove('d-flex');
        }

        // Component Loading Functions
        async function loadComponents() {
            try {
                // Load components
                const [topbar, mobileNav, trailerModal, filterModal, searchBar] = await Promise.all([
                    fetch('./components/layout/topbar.html').then(r => r.text()),
                    fetch('./components/layout/mobile-nav.html').then(r => r.text()),
                    fetch('./components/modals/trailer-modal.html').then(r => r.text()),
                    fetch('./components/modals/filter-modal.html').then(r => r.text()),
                    fetch('./components/ui/search-bar.html').then(r => r.text())
                ]);

                // Insert components
                document.getElementById('topbar-container').innerHTML = topbar;
                document.getElementById('mobile-nav-container').innerHTML = mobileNav;
                document.getElementById('trailer-modal-container').innerHTML = trailerModal;
                document.getElementById('filter-modal-container').innerHTML = filterModal;

                // Insert search bars
                document.getElementById('desktopSearchContainer').innerHTML = searchBar;
                document.getElementById('mobileSearchContainer').innerHTML = searchBar;
                document.getElementById('searchContainer').innerHTML = searchBar;

                // Setup event listeners
                setupMobileNav();
                setupSearch();

            } catch (error) {
                console.error('Failed to load components:', error);
            }
        }

        function setupMobileNav() {
            document.querySelectorAll('.mobile-nav .nav-item').forEach(item => {
                item.addEventListener('click', () => {
                    const section = item.dataset.section;
                    showSection(section);
                });
            });
        }

        // Initialization
        async function init() {
            showLoading();

            try {
                await loadComponents();

                // Load initial content
                await Promise.all([
                    loadTrendingContent(),
                    loadNewReleases(),
                    loadCriticsChoice(),
                    loadRegionalContent('hindi'),
                    loadAnimeContent()
                ]);

            } catch (error) {
                console.error('Initialization failed:', error);
            } finally {
                hideLoading();
            }
        }

        // Start the application
        document.addEventListener('DOMContentLoaded', init);

        // Prefetch critical API endpoints
        setTimeout(() => {
            fetchWithCache(`${API_BASE}/recommendations/trending?limit=6`);
            fetchWithCache(`${API_BASE}/recommendations/new-releases?limit=6`);
        }, 1000);
    </script>

    <!-- Service Worker -->
    <script>
        // Create service worker inline for immediate registration
        if ('serviceWorker' in navigator) {
            const swCode = `
                const CACHE_NAME = 'cinebrain-v1';
                const API_CACHE = 'cinebrain-api-v1';
                
                const STATIC_RESOURCES = [
                    '/',
                    '/index.html',
                    'https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css',
                    'https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js',
                    'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css'
                ];

                self.addEventListener('install', event => {
                    event.waitUntil(
                        caches.open(CACHE_NAME)
                            .then(cache => cache.addAll(STATIC_RESOURCES))
                    );
                });

                self.addEventListener('fetch', event => {
                    const url = new URL(event.request.url);
                    
                    if (url.origin === '${API_BASE.replace('/api', '')}') {
                        event.respondWith(
                            caches.open(API_CACHE).then(cache => {
                                return cache.match(event.request).then(cachedResponse => {
                                    const fetchPromise = fetch(event.request).then(networkResponse => {
                                        cache.put(event.request, networkResponse.clone());
                                        return networkResponse;
                                    });
                                    return cachedResponse || fetchPromise;
                                });
                            })
                        );
                    } else {
                        event.respondWith(
                            caches.match(event.request)
                                .then(response => response || fetch(event.request))
                        );
                    }
                });
            `;

            const blob = new Blob([swCode], { type: 'application/javascript' });
            const swUrl = URL.createObjectURL(blob);

            navigator.serviceWorker.register(swUrl);
        }
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="CineScope - Your premium streaming platform for movies, TV shows, and anime">
    <title>CineScope - Premium Streaming Platform</title>

    <!-- CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="/assets/css/base.css" rel="stylesheet">
    <link href="/assets/css/components.css" rel="stylesheet">
    <link href="/assets/css/layouts.css" rel="stylesheet">
    <link href="/assets/css/animations.css" rel="stylesheet">
    <link href="/assets/css/responsive.css" rel="stylesheet">
    <link href="/assets/css/utilities.css" rel="stylesheet">
</head>

<body>
    <div class="app-layout">
        <!-- Navigation -->
        <nav class="navbar">
            <div class="container navbar__container">
                <a href="/" class="navbar__logo">CineScope</a>

                <div class="navbar__menu">
                    <a href="/content/trending.html" class="navbar__link">Trending</a>
                    <a href="/content/search.html" class="navbar__link">Browse</a>
                    <a href="/content/anime.html" class="navbar__link">Anime</a>
                    <a href="/content/regional.html" class="navbar__link">Regional</a>
                </div>

                <div class="navbar__search">
                    <i class="bi bi-search navbar__search-icon"></i>
                    <input type="text" class="navbar__search-input" placeholder="Search movies, shows..."
                        id="globalSearch">
                </div>

                <div class="navbar__user" id="navbarUser">
                    <!-- Dynamic user menu -->
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="app-layout__main">
            <!-- Hero Section -->
            <section class="hero-banner" id="heroSection">
                <div class="skeleton" style="height: 100%;"></div>
            </section>

            <!-- Trending Section -->
            <section class="section">
                <div class="container">
                    <div class="carousel">
                        <div class="carousel__header">
                            <h2 class="carousel__title">Trending Now</h2>
                            <div class="carousel__controls">
                                <button class="carousel__control" data-action="prev">
                                    <i class="bi bi-chevron-left"></i>
                                </button>
                                <button class="carousel__control" data-action="next">
                                    <i class="bi bi-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                        <div class="carousel__track" id="trendingCarousel">
                            <!-- Dynamic content -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- New Releases -->
            <section class="section">
                <div class="container">
                    <div class="carousel">
                        <div class="carousel__header">
                            <h2 class="carousel__title">New Releases</h2>
                            <a href="/content/search.html?filter=new" class="text-blue">View All</a>
                        </div>
                        <div class="carousel__track" id="newReleasesCarousel">
                            <!-- Dynamic content -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Critics Choice -->
            <section class="section">
                <div class="container">
                    <div class="carousel">
                        <div class="carousel__header">
                            <h2 class="carousel__title">Critics' Choice</h2>
                            <a href="/content/search.html?filter=critics" class="text-blue">View All</a>
                        </div>
                        <div class="carousel__track" id="criticsCarousel">
                            <!-- Dynamic content -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Genre Sections -->
            <section class="section">
                <div class="container">
                    <div class="mb-2xl">
                        <h2 class="text-center mb-xl">Browse by Genre</h2>
                        <div class="d-flex flex-wrap justify-center gap-md">
                            <a href="/content/genre.html?genre=action" class="filter-chip">
                                <i class="bi bi-lightning-fill mr-xs"></i> Action
                            </a>
                            <a href="/content/genre.html?genre=comedy" class="filter-chip">
                                <i class="bi bi-emoji-laughing mr-xs"></i> Comedy
                            </a>
                            <a href="/content/genre.html?genre=drama" class="filter-chip">
                                <i class="bi bi-heart-fill mr-xs"></i> Drama
                            </a>
                            <a href="/content/genre.html?genre=horror" class="filter-chip">
                                <i class="bi bi-emoji-frown mr-xs"></i> Horror
                            </a>
                            <a href="/content/genre.html?genre=sci-fi" class="filter-chip">
                                <i class="bi bi-rocket-fill mr-xs"></i> Sci-Fi
                            </a>
                            <a href="/content/anime.html" class="filter-chip">
                                <i class="bi bi-star-fill mr-xs"></i> Anime
                            </a>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Regional Content -->
            <section class="section">
                <div class="container">
                    <div class="carousel">
                        <div class="carousel__header">
                            <h2 class="carousel__title">Regional Cinema</h2>
                            <a href="/content/regional.html" class="text-blue">Explore All</a>
                        </div>
                        <div class="carousel__track" id="regionalCarousel">
                            <!-- Dynamic content -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Admin Recommendations -->
            <section class="section" id="adminChoiceSection" style="display: none;">
                <div class="container">
                    <div class="carousel">
                        <div class="carousel__header">
                            <h2 class="carousel__title">
                                <i class="bi bi-award-fill text-gold"></i> Admin's Choice
                            </h2>
                        </div>
                        <div class="carousel__track" id="adminChoiceCarousel">
                            <!-- Dynamic content -->
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Mobile Navigation -->
        <nav class="mobile-nav">
            <ul class="mobile-nav__list">
                <li class="mobile-nav__item">
                    <a href="/" class="mobile-nav__link mobile-nav__link--active">
                        <i class="bi bi-house-fill mobile-nav__icon"></i>
                        <span>Home</span>
                    </a>
                </li>
                <li class="mobile-nav__item">
                    <a href="/content/search.html" class="mobile-nav__link">
                        <i class="bi bi-search mobile-nav__icon"></i>
                        <span>Search</span>
                    </a>
                </li>
                <li class="mobile-nav__item">
                    <a href="/content/trending.html" class="mobile-nav__link">
                        <i class="bi bi-fire mobile-nav__icon"></i>
                        <span>Trending</span>
                    </a>
                </li>
                <li class="mobile-nav__item" id="mobileWatchlistItem">
                    <a href="/auth/login.html" class="mobile-nav__link">
                        <i class="bi bi-bookmark mobile-nav__icon"></i>
                        <span>Watchlist</span>
                    </a>
                </li>
                <li class="mobile-nav__item" id="mobileProfileItem">
                    <a href="/auth/login.html" class="mobile-nav__link">
                        <i class="bi bi-person mobile-nav__icon"></i>
                        <span>Profile</span>
                    </a>
                </li>
            </ul>
        </nav>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Scripts -->
    <script src="/assets/js/core/config.js"></script>
    <script src="/assets/js/core/storage.js"></script>
    <script src="/assets/js/core/api.js"></script>
    <script src="/assets/js/core/auth.js"></script>
    <script src="/assets/js/core/router.js"></script>

    <script>
        // Initialize page
        document.addEventListener('DOMContentLoaded', async () => {
            // Update navigation based on auth state
            updateNavigation();

            // Load hero section
            loadHeroSection();

            // Load content sections
            loadTrendingContent();
            loadNewReleases();
            loadCriticsChoice();
            loadRegionalContent();
            loadAdminChoice();

            // Setup search
            setupGlobalSearch();
        });

        function updateNavigation() {
            const navbarUser = document.getElementById('navbarUser');
            const mobileWatchlistItem = document.getElementById('mobileWatchlistItem');
            const mobileProfileItem = document.getElementById('mobileProfileItem');

            if (auth.isAuthenticated()) {
                const user = auth.getUser();
                navbarUser.innerHTML = `
                    <a href="${auth.getUserUrl('watchlist')}" class="navbar__link">
                        <i class="bi bi-bookmark"></i>
                    </a>
                    <a href="${auth.getUserUrl('favorites')}" class="navbar__link">
                        <i class="bi bi-heart"></i>
                    </a>
                    <div class="navbar__avatar">
                        <img src="${user.avatar || '/assets/images/default-avatar.png'}" alt="${user.username}">
                    </div>
                `;

                mobileWatchlistItem.innerHTML = `
                    <a href="${auth.getUserUrl('watchlist')}" class="mobile-nav__link">
                        <i class="bi bi-bookmark mobile-nav__icon"></i>
                        <span>Watchlist</span>
                    </a>
                `;

                mobileProfileItem.innerHTML = `
                    <a href="${auth.getUserUrl('profile')}" class="mobile-nav__link">
                        <i class="bi bi-person mobile-nav__icon"></i>
                        <span>Profile</span>
                    </a>
                `;
            } else {
                navbarUser.innerHTML = `
                    <a href="/auth/login.html" class="btn btn-primary">Sign In</a>
                `;
            }
        }

        async function loadHeroSection() {
            try {
                const response = await api.getTrending('all', 1);
                const featured = response.recommendations[0];

                if (featured) {
                    const heroSection = document.getElementById('heroSection');
                    heroSection.innerHTML = `
                        <img src="${featured.poster_path || featured.backdrop_path}" 
                             alt="${featured.title}" 
                             class="hero-banner__backdrop">
                        <div class="hero-banner__gradient"></div>
                        <div class="container hero-banner__content">
                            <div class="hero-banner__info animate-fadeInUp">
                                <h1 class="hero-banner__title">${featured.title}</h1>
                                <div class="hero-banner__meta">
                                    <span class="content-card__rating">
                                        <i class="bi bi-star-fill content-card__rating-star"></i>
                                        ${featured.rating || 'N/A'}
                                    </span>
                                    <span>${featured.content_type.toUpperCase()}</span>
                                    <span>${featured.genres.slice(0, 3).join(' • ')}</span>
                                </div>
                                <p class="hero-banner__description">${featured.overview}</p>
                                <div class="hero-banner__actions">
                                    <button class="btn btn-primary hero-banner__btn" onclick="playContent(${featured.id})">
                                        <i class="bi bi-play-fill"></i> Play Now
                                    </button>
                                    <button class="btn btn-secondary hero-banner__btn" onclick="navigateToContentDetails(${featured.id})">
                                        <i class="bi bi-info-circle"></i> More Info
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Failed to load hero section:', error);
            }
        }

        async function loadTrendingContent() {
            try {
                const response = await api.getTrending('all', 20);
                renderCarousel('trendingCarousel', response.recommendations);
            } catch (error) {
                console.error('Failed to load trending:', error);
            }
        }

        async function loadNewReleases() {
            try {
                const response = await api.getNewReleases(null, 'movie', 20);
                renderCarousel('newReleasesCarousel', response.recommendations);
            } catch (error) {
                console.error('Failed to load new releases:', error);
            }
        }

        async function loadCriticsChoice() {
            try {
                const response = await api.getCriticsChoice('movie', 20);
                renderCarousel('criticsCarousel', response.recommendations);
            } catch (error) {
                console.error('Failed to load critics choice:', error);
            }
        }

        async function loadRegionalContent() {
            try {
                const response = await api.getRegionalContent('hindi', 'movie', 20);
                renderCarousel('regionalCarousel', response.recommendations);
            } catch (error) {
                console.error('Failed to load regional content:', error);
            }
        }

        async function loadAdminChoice() {
            try {
                const response = await api.getAdminChoice(10);
                if (response.recommendations && response.recommendations.length > 0) {
                    document.getElementById('adminChoiceSection').style.display = 'block';
                    renderCarousel('adminChoiceCarousel', response.recommendations, true);
                }
            } catch (error) {
                console.error('Failed to load admin choice:', error);
            }
        }

        function renderCarousel(carouselId, items, isAdminChoice = false) {
            const carousel = document.getElementById(carouselId);
            carousel.innerHTML = items.map(item => `
                <div class="carousel__item">
                    <div class="content-card" onclick="navigateToContentDetails(${item.id})">
                        <div class="content-card__image-wrapper">
                            <img src="${item.poster_path}" 
                                 alt="${item.title}" 
                                 class="content-card__image"
                                 loading="lazy">
                            ${item.is_new_release ? '<span class="content-card__badge">NEW</span>' : ''}
                            ${item.is_critics_choice ? '<span class="content-card__badge">CRITICS CHOICE</span>' : ''}
                            ${isAdminChoice ? '<span class="content-card__badge bg-gradient-premium">ADMIN PICK</span>' : ''}
                        </div>
                        <div class="content-card__body">
                            <h3 class="content-card__title">${item.title}</h3>
                            <div class="content-card__meta">
                                <span class="content-card__rating">
                                    <i class="bi bi-star-fill content-card__rating-star"></i>
                                    ${item.rating || 'N/A'}
                                </span>
                                <span>${item.content_type}</span>
                            </div>
                        </div>
                        <div class="content-card__overlay">
                            <p class="text-sm mb-sm">${item.overview}</p>
                            <div class="content-card__actions">
                                ${auth.isAuthenticated() ? `
                                    <button class="content-card__action-btn" onclick="event.stopPropagation(); addToWatchlist(${item.id})">
                                        <i class="bi bi-plus"></i> Watchlist
                                    </button>
                                ` : ''}
                                ${item.youtube_trailer ? `
                                    <button class="content-card__action-btn" onclick="event.stopPropagation(); playTrailer('${item.youtube_trailer}')">
                                        <i class="bi bi-play"></i> Trailer
                                    </button>
                                ` : ''}
                            </div>
                            ${isAdminChoice && item.admin_description ? `
                                <div class="mt-sm text-xs text-muted">
                                    <i class="bi bi-chat-quote"></i> "${item.admin_description}" - ${item.admin_name}
                                </div>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `).join('');

            // Setup carousel controls
            setupCarouselControls(carousel.closest('.carousel'));
        }

        function setupCarouselControls(carousel) {
            const track = carousel.querySelector('.carousel__track');
            const prevBtn = carousel.querySelector('[data-action="prev"]');
            const nextBtn = carousel.querySelector('[data-action="next"]');

            let scrollPosition = 0;
            const itemWidth = 220; // item width + gap

            prevBtn.addEventListener('click', () => {
                scrollPosition = Math.max(0, scrollPosition - itemWidth * 3);
                track.style.transform = `translateX(-${scrollPosition}px)`;
            });

            nextBtn.addEventListener('click', () => {
                const maxScroll = track.scrollWidth - track.parentElement.offsetWidth;
                scrollPosition = Math.min(maxScroll, scrollPosition + itemWidth * 3);
                track.style.transform = `translateX(-${scrollPosition}px)`;
            });
        }

        function setupGlobalSearch() {
            const searchInput = document.getElementById('globalSearch');
            let searchTimeout;

            searchInput.addEventListener('input', (e) => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    if (e.target.value.trim()) {
                        navigateToSearch(e.target.value);
                    }
                }, Config.DEBOUNCE_DELAY);
            });

            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && e.target.value.trim()) {
                    navigateToSearch(e.target.value);
                }
            });
        }

        async function addToWatchlist(contentId) {
            if (!auth.isAuthenticated()) {
                router.navigate('/auth/login.html');
                return;
            }

            try {
                await api.recordInteraction(contentId, Config.INTERACTIONS.WATCHLIST);
                showToast('Added to watchlist', 'success');
            } catch (error) {
                showToast('Failed to add to watchlist', 'error');
            }
        }

        function playContent(contentId) {
            // In production, this would integrate with video player
            navigateToContentDetails(contentId);
        }

        function playTrailer(youtubeUrl) {
            window.open(youtubeUrl, '_blank');
        }

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast toast--${type} animate-slideInRight`;
            toast.innerHTML = `
                <i class="bi bi-${type === 'success' ? 'check-circle' : 'exclamation-circle'} toast__icon"></i>
                <span class="toast__message">${message}</span>
                <i class="bi bi-x toast__close" onclick="this.parentElement.remove()"></i>
            `;

            document.getElementById('toastContainer').appendChild(toast);
            setTimeout(() => toast.classList.add('toast--visible'), 10);
            setTimeout(() => toast.remove(), 5000);
        }
    </script>
</body>

</html>
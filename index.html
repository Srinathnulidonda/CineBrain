<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MovieFlix - Your Entertainment Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #e50914;
            --secondary: #141414;
            --text-primary: #ffffff;
            --text-secondary: #b3b3b3;
            --hover: #ffffff1a;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: var(--secondary);
            color: var(--text-primary);
            font-family: 'Helvetica Neue', Arial, sans-serif;
            overflow-x: hidden;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #1a1a1a;
        }

        ::-webkit-scrollbar-thumb {
            background: #4a4a4a;
            border-radius: 4px;
        }

        /* Hero Section */
        .hero {
            position: relative;
            height: 80vh;
            background: linear-gradient(to bottom, transparent 70%, var(--secondary) 100%);
        }

        .hero-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: -1;
        }

        /* Navigation */
        nav {
            position: fixed;
            top: 0;
            width: 100%;
            padding: 20px 50px;
            background: linear-gradient(to bottom, rgba(0,0,0,0.7) 10%, transparent);
            z-index: 1000;
            transition: background 0.3s;
        }

        nav.scrolled {
            background: var(--secondary);
        }

        .logo {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
            text-decoration: none;
        }

        /* Content Cards */
        .content-row {
            margin: 40px 0;
            padding: 0 50px;
        }

        .content-row h2 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .content-carousel {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            scroll-behavior: smooth;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .content-carousel::-webkit-scrollbar {
            display: none;
        }

        .content-card {
            flex: 0 0 200px;
            cursor: pointer;
            transition: transform 0.3s;
            position: relative;
        }

        .content-card:hover {
            transform: scale(1.05);
        }

        .content-card img {
            width: 100%;
            height: 300px;
            object-fit: cover;
            border-radius: 8px;
        }

        .content-info {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 10px;
            background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, transparent 100%);
            border-radius: 0 0 8px 8px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .content-card:hover .content-info {
            opacity: 1;
        }

        /* Loading Skeleton */
        .skeleton {
            background: linear-gradient(90deg, #1a1a1a 25%, #2a2a2a 50%, #1a1a1a 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            nav {
                padding: 15px 20px;
            }

            .content-row {
                padding: 0 20px;
            }

            .content-card {
                flex: 0 0 150px;
            }

            .content-card img {
                height: 225px;
            }

            .hero {
                height: 60vh;
            }
        }

        /* Search Modal */
        .search-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 2000;
            display: none;
            padding: 20px;
        }

        .search-modal.active {
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding-top: 100px;
        }

        .search-input {
            width: 100%;
            max-width: 600px;
            padding: 15px 20px;
            font-size: 1.5rem;
            background: transparent;
            border: none;
            border-bottom: 2px solid var(--text-secondary);
            color: var(--text-primary);
            outline: none;
        }

        .search-results {
            width: 100%;
            max-width: 800px;
            margin-top: 40px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 20px;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav id="navbar">
        <div class="flex justify-between items-center">
            <div class="flex items-center gap-8">
                <a href="#" class="logo">MovieFlix</a>
                <div class="hidden md:flex gap-6">
                    <a href="#movies" class="hover:text-gray-300 transition">Movies</a>
                    <a href="#tv" class="hover:text-gray-300 transition">TV Shows</a>
                    <a href="#anime" class="hover:text-gray-300 transition">Anime</a>
                </div>
            </div>
            <div class="flex items-center gap-4">
                <button id="searchBtn" class="text-xl hover:text-gray-300 transition">
                    <i class="fas fa-search"></i>
                </button>
                <a href="login.html" class="bg-red-600 px-4 py-2 rounded hover:bg-red-700 transition">Sign In</a>
            </div>
        </div>
    </nav>

    <!-- Search Modal -->
    <div id="searchModal" class="search-modal">
        <div class="w-full">
            <div class="flex items-center gap-4">
                <input type="text" id="searchInput" class="search-input" placeholder="Search movies, TV shows, anime...">
                <button id="closeSearch" class="text-2xl">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="searchResults" class="search-results"></div>
        </div>
    </div>

    <!-- Hero Section -->
    <section class="hero">
        <img id="heroBg" class="hero-bg" src="" alt="Hero Background">
        <div class="absolute bottom-0 left-0 p-12 max-w-2xl">
            <h1 id="heroTitle" class="text-5xl font-bold mb-4"></h1>
            <p id="heroDescription" class="text-lg mb-6 text-gray-300"></p>
            <div class="flex gap-4">
                <button class="bg-white text-black px-8 py-3 rounded font-semibold hover:bg-gray-200 transition">
                    <i class="fas fa-play mr-2"></i> Play
                </button>
                <button class="bg-gray-700 px-8 py-3 rounded font-semibold hover:bg-gray-600 transition">
                    <i class="fas fa-info-circle mr-2"></i> More Info
                </button>
            </div>
        </div>
    </section>

    <!-- Content Sections -->
    <main>
        <!-- Trending -->
        <section id="trending" class="content-row">
            <h2>Trending Now</h2>
            <div class="content-carousel" id="trendingCarousel">
                <!-- Dynamic content -->
            </div>
        </section>

        <!-- Popular -->
        <section id="popular" class="content-row">
            <h2>Popular on MovieFlix</h2>
            <div class="content-carousel" id="popularCarousel">
                <!-- Dynamic content -->
            </div>
        </section>

        <!-- Admin Recommendations -->
        <section id="adminPicks" class="content-row">
            <h2>Editor's Picks</h2>
            <div class="content-carousel" id="adminCarousel">
                <!-- Dynamic content -->
            </div>
        </section>

        <!-- Anime -->
        <section id="anime" class="content-row">
            <h2>Anime Collection</h2>
            <div class="content-carousel" id="animeCarousel">
                <!-- Dynamic content -->
            </div>
        </section>

        <!-- Regional Content -->
        <section id="regional" class="content-row">
            <h2>Regional Favorites</h2>
            <div class="content-carousel" id="regionalCarousel">
                <!-- Dynamic content -->
            </div>
        </section>

        <!-- Genre Sections -->
        <div id="genreSections"></div>
    </main>

    <!-- Footer -->
    <footer class="mt-20 p-12 text-gray-400">
        <div class="max-w-6xl mx-auto">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-8 mb-8">
                <div>
                    <h4 class="mb-4">Navigation</h4>
                    <ul class="space-y-2 text-sm">
                        <li><a href="#" class="hover:underline">Home</a></li>
                        <li><a href="#" class="hover:underline">Movies</a></li>
                        <li><a href="#" class="hover:underline">TV Shows</a></li>
                        <li><a href="#" class="hover:underline">Anime</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="mb-4">Account</h4>
                    <ul class="space-y-2 text-sm">
                        <li><a href="login.html" class="hover:underline">Sign In</a></li>
                        <li><a href="login.html" class="hover:underline">Register</a></li>
                    </ul>
                </div>
            </div>
            <p class="text-center text-sm">&copy; 2024 MovieFlix. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // API Configuration
        const API_BASE = 'https://backend-app-970m.onrender.com/api';
        let sessionId = localStorage.getItem('sessionId') || generateSessionId();

        function generateSessionId() {
            const id = 'sess_' + Math.random().toString(36).substr(2, 16);
            localStorage.setItem('sessionId', id);
            return id;
        }

        // Navbar scroll effect
        window.addEventListener('scroll', () => {
            const navbar = document.getElementById('navbar');
            if (window.scrollY > 50) {
                navbar.classList.add('scrolled');
            } else {
                navbar.classList.remove('scrolled');
            }
        });

        // Search functionality
        const searchBtn = document.getElementById('searchBtn');
        const searchModal = document.getElementById('searchModal');
        const closeSearch = document.getElementById('closeSearch');
        const searchInput = document.getElementById('searchInput');
        const searchResults = document.getElementById('searchResults');
        let searchTimeout;

        searchBtn.addEventListener('click', () => {
            searchModal.classList.add('active');
            searchInput.focus();
        });

        closeSearch.addEventListener('click', () => {
            searchModal.classList.remove('active');
            searchInput.value = '';
            searchResults.innerHTML = '';
        });

        searchInput.addEventListener('input', (e) => {
            clearTimeout(searchTimeout);
            const query = e.target.value.trim();
            
            if (query.length < 2) {
                searchResults.innerHTML = '';
                return;
            }

            searchTimeout = setTimeout(() => {
                searchContent(query);
            }, 300);
        });

        async function searchContent(query) {
            try {
                searchResults.innerHTML = '<div class="col-span-full text-center">Searching...</div>';
                
                const response = await fetch(`${API_BASE}/content/search?q=${encodeURIComponent(query)}&type=all`, {
                    headers: {
                        'Session-ID': sessionId
                    }
                });
                
                const data = await response.json();
                
                if (data.results && data.results.length > 0) {
                    searchResults.innerHTML = data.results.map(item => `
                        <div class="content-card" onclick="viewContent('${item.tmdb_id || item.mal_id}', '${item.content_type}')">
                            <img src="${item.poster_url || '/placeholder.jpg'}" alt="${item.title}" onerror="this.src='/placeholder.jpg'">
                            <div class="content-info">
                                <h3 class="text-sm font-semibold">${item.title}</h3>
                                <p class="text-xs text-gray-400">${item.content_type}</p>
                            </div>
                        </div>
                    `).join('');
                } else {
                    searchResults.innerHTML = '<div class="col-span-full text-center text-gray-400">No results found</div>';
                }
            } catch (error) {
                console.error('Search error:', error);
                searchResults.innerHTML = '<div class="col-span-full text-center text-red-500">Error searching content</div>';
            }
        }

        // Load homepage content
        async function loadHomepageContent() {
            try {
                const response = await fetch(`${API_BASE}/recommendations/homepage`, {
                    headers: {
                        'Session-ID': sessionId
                    }
                });
                
                const data = await response.json();
                
                // Load trending
                if (data.trending && data.trending.length > 0) {
                    displayCarousel('trendingCarousel', data.trending);
                    
                    // Set hero section with first trending item
                    const hero = data.trending[0];
                    document.getElementById('heroBg').src = hero.backdrop_url || hero.poster_url;
                    document.getElementById('heroTitle').textContent = hero.title;
                    document.getElementById('heroDescription').textContent = hero.synopsis || '';
                }
                
                // Load popular
                if (data.popular) {
                    displayCarousel('popularCarousel', data.popular);
                }
                
                // Load anime
                if (data.anime) {
                    displayCarousel('animeCarousel', data.anime);
                }
                
                // Load regional
                if (data.regional) {
                    displayCarousel('regionalCarousel', data.regional);
                }
                
                // Load admin recommendations
                loadAdminRecommendations();
                
                // Load genre sections
                if (data.by_genre) {
                    loadGenreSections(data.by_genre);
                }
                
            } catch (error) {
                console.error('Error loading homepage:', error);
            }
        }

        async function loadAdminRecommendations() {
            try {
                const response = await fetch(`${API_BASE}/public/recommendations`);
                const data = await response.json();
                
                if (data.recommendations && data.recommendations.length > 0) {
                    const content = data.recommendations.map(rec => rec.content);
                    displayCarousel('adminCarousel', content);
                }
            } catch (error) {
                console.error('Error loading admin recommendations:', error);
            }
        }

        function loadGenreSections(genreData) {
            const container = document.getElementById('genreSections');
            container.innerHTML = '';
            
            Object.entries(genreData).forEach(([genre, items]) => {
                if (items && items.length > 0) {
                    const section = document.createElement('section');
                    section.className = 'content-row';
                    section.innerHTML = `
                        <h2>${genre} Movies</h2>
                        <div class="content-carousel" id="${genre.toLowerCase()}Carousel"></div>
                    `;
                    container.appendChild(section);
                    displayCarousel(`${genre.toLowerCase()}Carousel`, items);
                }
            });
        }

        function displayCarousel(carouselId, items) {
            const carousel = document.getElementById(carouselId);
            if (!carousel) return;
            
            carousel.innerHTML = items.map(item => `
                <div class="content-card" onclick="viewContent('${item.id}')">
                    <img src="${item.poster_url || '/placeholder.jpg'}" alt="${item.title}" 
                         onerror="this.src='/placeholder.jpg'" loading="lazy">
                    <div class="content-info">
                        <h3 class="text-sm font-semibold">${item.title}</h3>
                        ${item.rating ? `<p class="text-xs text-yellow-400">â˜… ${item.rating}</p>` : ''}
                    </div>
                </div>
            `).join('');
        }

        function viewContent(contentId) {
            // Store content ID and redirect to detail page
            sessionStorage.setItem('selectedContentId', contentId);
            window.location.href = 'movie-detail.html';
        }

        // Initialize
        loadHomepageContent();
    </script>
</body>
</html>
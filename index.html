<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CineBrain - The Mind Behind Your Next Favorite</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/components.css">

    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'netflix-red': {
                            500: '#E50914',
                            600: '#B20710',
                            700: '#8B050C',
                            800: '#660408'
                        },
                        'netflix-dark': {
                            900: '#000000',
                            800: '#141414',
                            700: '#221f1f',
                            600: '#2f2f2f'
                        }
                    },
                    fontFamily: {
                        'sans': ['Inter', 'ui-sans-serif', 'system-ui']
                    }
                }
            }
        }
    </script>

    <style>
        :root {
            /* Netflix Color Palette */
            --netflix-red: #E50914;
            --netflix-red-dark: #B20710;
            --netflix-red-darker: #8B050C;
            --netflix-black: #000000;
            --netflix-dark: #141414;
            --netflix-gray: #221f1f;
            --netflix-light-gray: #564d4d;
            --netflix-white: #ffffff;
            --netflix-light-bg: #f5f5f5;
            --netflix-light-secondary: #e5e5e5;

            /* Theme Variables */
            --primary-color: var(--netflix-red);
            --primary-hover: var(--netflix-red-dark);
            --bg-primary: var(--netflix-dark);
            --bg-secondary: var(--netflix-gray);
            --text-primary: var(--netflix-white);
            --text-secondary: #cccccc;
            --text-muted: #808080;
            --border-color: rgba(255, 255, 255, 0.1);
            --card-bg: rgba(255, 255, 255, 0.05);
            --modal-bg: rgba(20, 20, 20, 0.95);
            --overlay-bg: rgba(0, 0, 0, 0.7);

            /* Gradients */
            --cine-gradient: linear-gradient(135deg, var(--netflix-red) 0%, var(--netflix-red-dark) 100%);
            --cine-bg: linear-gradient(135deg, var(--netflix-black) 0%, var(--netflix-dark) 100%);
        }

        /* Light Theme */
        [data-theme="light"] {
            --bg-primary: var(--netflix-light-bg);
            --bg-secondary: var(--netflix-light-secondary);
            --text-primary: var(--netflix-black);
            --text-secondary: #333333;
            --text-muted: #666666;
            --border-color: rgba(0, 0, 0, 0.1);
            --card-bg: rgba(255, 255, 255, 0.9);
            --modal-bg: rgba(245, 245, 245, 0.95);
            --overlay-bg: rgba(255, 255, 255, 0.9);
            --cine-bg: linear-gradient(135deg, var(--netflix-light-bg) 0%, var(--netflix-white) 100%);
        }

        body {
            background: var(--cine-bg);
            font-family: 'Inter', sans-serif;
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .cine-gradient {
            background: var(--cine-gradient);
        }

        .content-card {
            transition: all 0.3s ease;
            cursor: pointer;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
        }

        .content-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(229, 9, 20, 0.1), 0 10px 10px -5px rgba(229, 9, 20, 0.04);
        }

        .hero-overlay {
            background: var(--overlay-bg);
        }

        .carousel-container {
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .carousel-container::-webkit-scrollbar {
            display: none;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid var(--text-muted);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .fade-in {
            animation: fadeIn 0.6s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .search-expanded {
            width: 100% !important;
        }

        .avatar-dropdown {
            backdrop-filter: blur(10px);
            background: var(--modal-bg);
            border: 1px solid var(--border-color);
        }

        .mobile-nav {
            backdrop-filter: blur(10px);
            background: var(--modal-bg);
            border-top: 1px solid var(--border-color);
        }

        .navbar {
            background: var(--modal-bg) !important;
            border-bottom: 1px solid var(--border-color);
        }

        .btn-netflix {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }

        .btn-netflix:hover {
            background-color: var(--primary-hover);
            border-color: var(--primary-hover);
            color: white;
        }

        .btn-outline-netflix {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .btn-outline-netflix:hover {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }

        .theme-toggle {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            border-radius: 20px;
            padding: 8px 12px;
            transition: all 0.3s ease;
        }

        .theme-toggle:hover {
            background: var(--primary-color);
            color: white;
        }

        .modal-content {
            background: var(--modal-bg) !important;
            border: 1px solid var(--border-color) !important;
        }

        .form-control {
            background: var(--card-bg) !important;
            border: 1px solid var(--border-color) !important;
            color: var(--text-primary) !important;
        }

        .form-control:focus {
            background: var(--card-bg) !important;
            border-color: var(--primary-color) !important;
            box-shadow: 0 0 0 0.2rem rgba(229, 9, 20, 0.25) !important;
            color: var(--text-primary) !important;
        }

        .form-control::placeholder {
            color: var(--text-muted) !important;
        }

        .dropdown-menu {
            background: var(--modal-bg) !important;
            border: 1px solid var(--border-color) !important;
        }

        .dropdown-item {
            color: var(--text-primary) !important;
        }

        .dropdown-item:hover {
            background: var(--card-bg) !important;
            color: var(--text-primary) !important;
        }

        .badge {
            background-color: var(--primary-color) !important;
        }

        .badge.bg-warning {
            background-color: #ffc107 !important;
            color: #000 !important;
        }

        .badge.bg-secondary {
            background-color: var(--text-muted) !important;
        }

        .toast {
            background: var(--modal-bg) !important;
            border: 1px solid var(--border-color) !important;
            color: var(--text-primary) !important;
        }

        .auth-loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        @media (max-width: 768px) {
            .carousel-container {
                padding-bottom: 80px;
            }
        }
    </style>
</head>

<body>
    <!-- Auth Loading Screen -->
    <div id="auth-loading" class="auth-loading">
        <div class="text-center">
            <div class="loading-spinner mx-auto mb-3" style="width: 40px; height: 40px;"></div>
            <p style="color: var(--text-muted);">Verifying authentication...</p>
        </div>
    </div>

    <!-- Fixed Top Navigation -->
    <nav class="navbar navbar-expand-lg fixed-top" style="backdrop-filter: blur(10px); z-index: 1050;">
        <div class="container-fluid px-2 px-md-4">
            <!-- Logo & Tagline -->
            <div class="navbar-brand d-flex flex-column align-items-start me-2 me-md-4">
                <div class="logo fw-bold"
                    style="background: var(--cine-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-size: 1.5rem;">
                    CineBrain
                </div>
                <div class="tagline"
                    style="color: var(--text-muted); font-size: 0.7rem; line-height: 1; margin-top: -2px;">
                    The Mind Behind Your Next Favorite
                </div>
            </div>

            <!-- Search Component -->
            <div class="flex-grow-1 mx-2 position-relative" style="max-width: 400px;">
                <div class="d-flex align-items-center">
                    <!-- Mobile Search Icon -->
                    <button id="mobile-search-btn" class="btn btn-link p-1 me-2 d-md-none"
                        style="font-size: 1.1rem; color: var(--text-primary);">
                        <i class="fas fa-search"></i>
                    </button>

                    <!-- Search Bar (Desktop always visible, Mobile expandable) -->
                    <div id="search-container" class="d-none d-md-block w-100">
                        <form class="position-relative">
                            <input type="text" id="search-input" class="form-control rounded-pill ps-3 pe-4"
                                placeholder="Search movies, TV series, anime..."
                                style="font-size: 0.9rem; height: 38px;">
                            <button type="submit" class="btn position-absolute end-0 top-50 translate-middle-y me-1 p-1"
                                style="background: none; border: none; color: var(--primary-color);">
                                <i class="fas fa-search"></i>
                            </button>
                        </form>

                        <!-- Search Results Dropdown -->
                        <div id="search-results" class="position-absolute w-100 mt-2 rounded-3 shadow-lg d-none"
                            style="background: var(--modal-bg); backdrop-filter: blur(10px); z-index: 1060; max-height: 400px; overflow-y: auto; border: 1px solid var(--border-color);">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Theme Toggle & User Section -->
            <div class="d-flex align-items-center gap-2">
                <!-- Theme Toggle -->
                <button id="theme-toggle" class="theme-toggle" onclick="toggleTheme()" title="Toggle theme"
                    style="padding: 6px 10px; font-size: 0.9rem;">
                    <i class="fas fa-moon" id="theme-icon"></i>
                </button>

                <!-- Public: Login & Sign Up -->
                <div id="auth-buttons" class="d-flex gap-1">
                    <button class="btn btn-outline-netflix btn-sm rounded-pill px-2 px-md-3" data-bs-toggle="modal"
                        data-bs-target="#loginModal" style="font-size: 0.8rem;">
                        Login
                    </button>
                    <button class="btn btn-netflix btn-sm rounded-pill px-2 px-md-3" data-bs-toggle="modal"
                        data-bs-target="#registerModal" style="font-size: 0.8rem;">
                        Sign Up
                    </button>
                </div>

                <!-- Logged In: Avatar Dropdown -->
                <div id="user-menu" class="dropdown d-none">
                    <button class="btn dropdown-toggle p-0 border-0" type="button" data-bs-toggle="dropdown"
                        style="background: none;">
                        <img id="user-avatar" src="https://via.placeholder.com/40" alt="User" class="rounded-circle"
                            style="width: 35px; height: 35px; object-fit: cover;">
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end avatar-dropdown rounded-3 border-0 mt-2"
                        style="min-width: 180px;">
                        <li>
                            <h6 class="dropdown-header" id="user-name" style="color: var(--text-primary);">User Name
                            </h6>
                        </li>
                        <li>
                            <hr class="dropdown-divider" style="border-color: var(--border-color);">
                        </li>
                        <li><a class="dropdown-item" href="#"><i class="fas fa-activity me-2"></i>Activity</a></li>
                        <li><a class="dropdown-item" href="#" onclick="showFavorites()"><i
                                    class="fas fa-heart me-2"></i>Favorites</a></li>
                        <li><a class="dropdown-item" href="#"><i class="fas fa-user me-2"></i>Profile</a>
                        </li>
                        <li><a class="dropdown-item" href="#"><i class="fas fa-cog me-2"></i>Settings</a>
                        </li>
                        <li><a class="dropdown-item" href="#" onclick="showWatchlist()"><i
                                    class="fas fa-bookmark me-2"></i>Watchlist</a></li>
                        <li>
                            <hr class="dropdown-divider" style="border-color: var(--border-color);">
                        </li>
                        <li><a class="dropdown-item text-danger" href="#" onclick="logout()"><i
                                    class="fas fa-sign-out-alt me-2"></i>Logout</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section id="hero-section" class="position-relative" style="height: 70vh; min-height: 500px; margin-top: 70px;">
        <div id="hero-background" class="position-absolute w-100 h-100" style="background: var(--cine-bg);">
            <!-- Hero background will be set via JavaScript -->
        </div>
        <div class="hero-overlay position-absolute w-100 h-100"></div>

        <div class="container h-100 position-relative" style="z-index: 10;">
            <div class="row h-100 align-items-center">
                <div class="col-lg-6">
                    <div class="fade-in">
                        <h1 id="hero-title" class="display-4 fw-bold mb-3" style="color: var(--text-primary);">
                            Discover Your Next Obsession
                        </h1>
                        <p id="hero-description" class="lead mb-4" style="color: var(--text-secondary);">
                            Powered by AI, crafted for cinema lovers. Get personalized recommendations across movies, TV
                            series, and anime.
                        </p>
                        <div class="d-flex gap-3 flex-wrap">
                            <button id="hero-play-btn" class="btn btn-netflix btn-lg rounded-pill px-4 d-none">
                                <i class="fas fa-play me-2"></i>Play Now
                            </button>
                            <button id="hero-add-btn" class="btn btn-outline-light btn-lg rounded-pill px-4 d-none">
                                <i class="fas fa-plus me-2"></i>Add to List
                            </button>
                            <button id="hero-explore-btn" class="btn btn-netflix btn-lg rounded-pill px-4">
                                <i class="fas fa-compass me-2"></i>Explore Now
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <main class="container-fluid px-3 px-md-4 py-5">
        <!-- Loading State -->
        <div id="loading-state" class="text-center py-5">
            <div class="loading-spinner mx-auto mb-3"></div>
            <p style="color: var(--text-muted);">Loading your personalized experience...</p>
        </div>

        <!-- Content Carousels -->
        <div id="content-carousels" class="d-none">
            <!-- Public Carousels -->
            <div id="public-carousels">
                <!-- Trending Now -->
                <section class="mb-5">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2 class="h3 fw-bold" style="color: var(--text-primary);">🔥 Trending Now</h2>
                        <button class="btn btn-outline-netflix btn-sm rounded-pill" onclick="loadMoreTrending()">
                            View All
                        </button>
                    </div>
                    <div id="trending-carousel" class="carousel-container">
                        <div class="d-flex gap-3" style="width: max-content;">
                            <!-- Content cards will be populated via JavaScript -->
                        </div>
                    </div>
                </section>

                <!-- Top Rated Movies -->
                <section class="mb-5">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2 class="h3 fw-bold" style="color: var(--text-primary);">🏆 Critics' Choice</h2>
                        <button class="btn btn-outline-netflix btn-sm rounded-pill" onclick="loadMoreCriticsChoice()">
                            View All
                        </button>
                    </div>
                    <div id="critics-carousel" class="carousel-container">
                        <div class="d-flex gap-3" style="width: max-content;">
                            <!-- Content cards will be populated via JavaScript -->
                        </div>
                    </div>
                </section>

                <!-- New Releases -->
                <section class="mb-5">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2 class="h3 fw-bold" style="color: var(--text-primary);">🆕 New Releases</h2>
                        <button class="btn btn-outline-netflix btn-sm rounded-pill" onclick="loadMoreNewReleases()">
                            View All
                        </button>
                    </div>
                    <div id="new-releases-carousel" class="carousel-container">
                        <div class="d-flex gap-3" style="width: max-content;">
                            <!-- Content cards will be populated via JavaScript -->
                        </div>
                    </div>
                </section>

                <!-- Anime Highlights -->
                <section class="mb-5">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2 class="h3 fw-bold" style="color: var(--text-primary);">🎌 Anime Highlights</h2>
                        <button class="btn btn-outline-netflix btn-sm rounded-pill" onclick="loadMoreAnime()">
                            View All
                        </button>
                    </div>
                    <div id="anime-carousel" class="carousel-container">
                        <div class="d-flex gap-3" style="width: max-content;">
                            <!-- Content cards will be populated via JavaScript -->
                        </div>
                    </div>
                </section>
            </div>

            <!-- Personalized Carousels (for logged-in users) -->
            <div id="personalized-carousels" class="d-none">
                <!-- Personalized Recommendations -->
                <section class="mb-5">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2 class="h3 fw-bold" style="color: var(--text-primary);">✨ Curated for You</h2>
                        <button class="btn btn-outline-netflix btn-sm rounded-pill" onclick="loadMorePersonalized()">
                            View All
                        </button>
                    </div>
                    <div id="personalized-carousel" class="carousel-container">
                        <div class="d-flex gap-3" style="width: max-content;">
                            <!-- Content cards will be populated via JavaScript -->
                        </div>
                    </div>
                </section>

                <!-- Continue Watching -->
                <section class="mb-5">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2 class="h3 fw-bold" style="color: var(--text-primary);">▶️ Continue Watching</h2>
                    </div>
                    <div id="continue-watching-carousel" class="carousel-container">
                        <div class="d-flex gap-3" style="width: max-content;">
                            <!-- Content cards will be populated via JavaScript -->
                        </div>
                    </div>
                </section>

                <!-- Because You Watched -->
                <section class="mb-5">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2 class="h3 fw-bold" style="color: var(--text-primary);" id="because-you-watched-title">🎯
                            Because You Watched</h2>
                    </div>
                    <div id="because-you-watched-carousel" class="carousel-container">
                        <div class="d-flex gap-3" style="width: max-content;">
                            <!-- Content cards will be populated via JavaScript -->
                        </div>
                    </div>
                </section>
            </div>

            <!-- Admin Recommendations -->
            <section class="mb-5">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2 class="h3 fw-bold" style="color: var(--text-primary);">👑 Admin's Choice</h2>
                    <button class="btn btn-outline-netflix btn-sm rounded-pill" onclick="loadMoreAdminChoice()">
                        View All
                    </button>
                </div>
                <div id="admin-choice-carousel" class="carousel-container">
                    <div class="d-flex gap-3" style="width: max-content;">
                        <!-- Content cards will be populated via JavaScript -->
                    </div>
                </div>
            </section>
        </div>

        <!-- Call-to-Action Banner -->
        <section id="cta-banner" class="my-5 rounded-4 p-5 text-center cine-gradient">
            <div id="public-cta" class="fade-in">
                <h3 class="fw-bold text-white mb-3">Create your CineBrain to unlock personalized worlds</h3>
                <p class="text-light mb-4">Join millions of movie lovers discovering their next favorite content with
                    AI-powered recommendations</p>
                <button class="btn btn-light btn-lg rounded-pill px-5" data-bs-toggle="modal"
                    data-bs-target="#registerModal">
                    <i class="fas fa-rocket me-2"></i>Sign Up Free
                </button>
            </div>
            <div id="premium-cta" class="fade-in d-none">
                <h3 class="fw-bold text-white mb-3">Unlock Premium Features</h3>
                <p class="text-light mb-4">Get early access to new releases, exclusive content, and advanced
                    recommendations</p>
                <button class="btn btn-light btn-lg rounded-pill px-5">
                    <i class="fas fa-crown me-2"></i>Upgrade to Premium
                </button>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="py-5 mt-5" style="background: var(--bg-secondary);">
        <div class="container">
            <div class="row">
                <div class="col-md-4 mb-4">
                    <div class="fw-bold text-xl mb-2"
                        style="background: var(--cine-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                        CineBrain
                    </div>
                    <p class="small" style="color: var(--text-muted);">© 2025 CineBrain. All rights reserved.</p>
                </div>
                <div class="col-md-4 mb-4">
                    <div class="d-flex gap-3 justify-content-center">
                        <a href="#" style="color: var(--text-muted);">Privacy</a>
                        <a href="#" style="color: var(--text-muted);">Terms</a>
                        <a href="#" style="color: var(--text-muted);">Contact</a>
                    </div>
                </div>
                <div class="col-md-4 mb-4">
                    <div class="d-flex gap-3 justify-content-end">
                        <a href="#" style="color: var(--text-muted);"><i class="fab fa-twitter"></i></a>
                        <a href="#" style="color: var(--text-muted);"><i class="fab fa-instagram"></i></a>
                        <a href="#" style="color: var(--text-muted);"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- Login Modal -->
    <div class="modal fade" id="loginModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header border-bottom-0">
                    <h5 class="modal-title" style="color: var(--text-primary);">Welcome Back</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" style="filter: invert(1);"></button>
                </div>
                <div class="modal-body">
                    <form id="login-form">
                        <div class="mb-3">
                            <label class="form-label" style="color: var(--text-secondary);">Username</label>
                            <input type="text" class="form-control" id="login-username" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label" style="color: var(--text-secondary);">Password</label>
                            <input type="password" class="form-control" id="login-password" required>
                        </div>
                        <button type="submit" class="btn btn-netflix w-100" id="login-btn">
                            Login
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Register Modal -->
    <div class="modal fade" id="registerModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header border-bottom-0">
                    <h5 class="modal-title" style="color: var(--text-primary);">Join CineBrain</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" style="filter: invert(1);"></button>
                </div>
                <div class="modal-body">
                    <form id="register-form">
                        <div class="mb-3">
                            <label class="form-label" style="color: var(--text-secondary);">Username</label>
                            <input type="text" class="form-control" id="register-username" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label" style="color: var(--text-secondary);">Email</label>
                            <input type="email" class="form-control" id="register-email" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label" style="color: var(--text-secondary);">Password</label>
                            <input type="password" class="form-control" id="register-password" required>
                        </div>
                        <button type="submit" class="btn btn-netflix w-100" id="register-btn">
                            Sign Up Free
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Content Detail Modal -->
    <div class="modal fade" id="contentModal" tabindex="-1">
        <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header border-bottom-0">
                    <h5 class="modal-title" style="color: var(--text-primary);" id="content-modal-title">Content Details
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" style="filter: invert(1);"></button>
                </div>
                <div class="modal-body" id="content-modal-body">
                    <!-- Content details will be populated via JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3" style="z-index: 1055;">
        <div id="toast" class="toast" role="alert">
            <div class="toast-header">
                <strong class="me-auto" style="color: var(--text-primary);">CineBrain</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" style="filter: invert(1);"></button>
            </div>
            <div class="toast-body" id="toast-message">
                <!-- Toast message will be populated via JavaScript -->
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Global variables
        const API_BASE_URL = 'https://backend-app-970m.onrender.com/api';
        let currentUser = null;
        let searchTimeout = null;
        let isAuthChecking = false;

        // Theme management
        function initializeTheme() {
            const savedTheme = localStorage.getItem('cinebrain_theme') || 'dark';
            setTheme(savedTheme);
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'dark';
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            setTheme(newTheme);
        }

        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('cinebrain_theme', theme);

            const themeIcon = document.getElementById('theme-icon');
            if (theme === 'light') {
                themeIcon.className = 'fas fa-sun';
            } else {
                themeIcon.className = 'fas fa-moon';
            }
        }

        // Hide auth loading screen
        function hideAuthLoading() {
            const authLoading = document.getElementById('auth-loading');
            if (authLoading) {
                authLoading.style.display = 'none';
            }
        }

        // Show auth loading screen
        function showAuthLoading() {
            const authLoading = document.getElementById('auth-loading');
            if (authLoading) {
                authLoading.style.display = 'flex';
            }
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function () {
            console.log('🚀 CineBrain application starting...');
            initializeTheme();
            initializeEventListeners();

            // Check auth status first, then load content
            checkAuthStatus().finally(() => {
                loadInitialContent();
            });
        });

        // Enhanced authentication check with retry mechanism
        async function checkAuthStatus(retryCount = 0) {
            const maxRetries = 3;
            const token = localStorage.getItem('cinebrain_token');

            console.log('🔐 Checking authentication status...');

            if (!token) {
                console.log('❌ No token found, showing public UI');
                updateUIForPublicUser();
                hideAuthLoading();
                return Promise.resolve();
            }

            if (isAuthChecking) {
                console.log('⏳ Authentication check already in progress');
                return Promise.resolve();
            }

            isAuthChecking = true;
            showAuthLoading();

            try {
                console.log('🔍 Verifying token with server...');

                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 10000); // 10 second timeout

                const response = await fetch(`${API_BASE_URL}/user/profile`, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    signal: controller.signal
                });

                clearTimeout(timeoutId);

                if (response.ok) {
                    const data = await response.json();
                    console.log('✅ Token verified successfully');

                    currentUser = data.user;
                    updateUIForLoggedInUser();
                    hideAuthLoading();
                    return Promise.resolve();
                } else if (response.status === 401 || response.status === 403) {
                    console.log('🚫 Token invalid or expired, logging out');
                    await performLogout(false);
                    return Promise.resolve();
                } else {
                    throw new Error(`Server responded with status: ${response.status}`);
                }
            } catch (error) {
                console.error('❌ Auth check failed:', error);

                if (error.name === 'AbortError') {
                    console.log('⏰ Auth check timed out');
                }

                // Retry logic for network errors
                if (retryCount < maxRetries && (error.name === 'AbortError' || error.message.includes('fetch'))) {
                    console.log(`🔄 Retrying authentication check (${retryCount + 1}/${maxRetries})...`);
                    await new Promise(resolve => setTimeout(resolve, 1000 * (retryCount + 1))); // Exponential backoff
                    return checkAuthStatus(retryCount + 1);
                } else {
                    // If all retries failed, but we have a token, assume offline mode
                    if (token) {
                        console.log('🔌 Network issues detected, maintaining session...');
                        // Try to get user info from localStorage backup
                        const backupUser = localStorage.getItem('cinebrain_user');
                        if (backupUser) {
                            try {
                                currentUser = JSON.parse(backupUser);
                                updateUIForLoggedInUser();
                                showToast('Working offline - some features may be limited', 'info');
                            } catch (e) {
                                console.error('Failed to parse backup user data');
                                updateUIForPublicUser();
                            }
                        } else {
                            updateUIForPublicUser();
                        }
                    } else {
                        updateUIForPublicUser();
                    }
                    hideAuthLoading();
                    return Promise.resolve();
                }
            } finally {
                isAuthChecking = false;
            }
        }

        // Update UI for logged-in user
        function updateUIForLoggedInUser() {
            console.log('👤 Updating UI for logged-in user:', currentUser?.username);

            // Backup user data to localStorage
            localStorage.setItem('cinebrain_user', JSON.stringify(currentUser));

            document.getElementById('auth-buttons').classList.add('d-none');
            document.getElementById('user-menu').classList.remove('d-none');
            document.getElementById('user-name').textContent = currentUser.username;
            document.getElementById('user-avatar').src = `https://ui-avatars.com/api/?name=${encodeURIComponent(currentUser.username)}&background=E50914&color=fff`;

            // Show personalized content
            document.getElementById('personalized-carousels').classList.remove('d-none');
            document.getElementById('public-cta').classList.add('d-none');
            document.getElementById('premium-cta').classList.remove('d-none');

            // Load personalized content if not already loading
            if (document.getElementById('content-carousels').classList.contains('d-none')) {
                loadPersonalizedContent();
            }
        }

        // Update UI for public user
        function updateUIForPublicUser() {
            console.log('🌐 Updating UI for public user');

            // Clear backup user data
            localStorage.removeItem('cinebrain_user');

            document.getElementById('auth-buttons').classList.remove('d-none');
            document.getElementById('user-menu').classList.add('d-none');

            // Show public content only
            document.getElementById('personalized-carousels').classList.add('d-none');
            document.getElementById('public-cta').classList.remove('d-none');
            document.getElementById('premium-cta').classList.add('d-none');
        }

        // Enhanced logout function
        async function performLogout(showMessage = true) {
            console.log('🚪 Performing logout...');

            localStorage.removeItem('cinebrain_token');
            localStorage.removeItem('cinebrain_user');
            currentUser = null;

            updateUIForPublicUser();

            if (showMessage) {
                showToast('Logged out successfully', 'success');

                // Reload page after a short delay to reset all state
                setTimeout(() => {
                    window.location.reload();
                }, 1500);
            }
        }

        // Initialize event listeners
        function initializeEventListeners() {
            // Search functionality
            const searchInput = document.getElementById('search-input');
            if (searchInput) {
                searchInput.addEventListener('input', handleSearch);
                searchInput.addEventListener('focus', showSearchResults);
                searchInput.addEventListener('blur', hideSearchResults);
            }

            // Mobile search toggle
            document.getElementById('mobile-search-btn')?.addEventListener('click', toggleMobileSearch);

            // Login form
            document.getElementById('login-form')?.addEventListener('submit', handleLogin);

            // Register form
            document.getElementById('register-form')?.addEventListener('submit', handleRegister);

            // Hero action buttons
            document.getElementById('hero-explore-btn')?.addEventListener('click', () => {
                document.getElementById('content-carousels').scrollIntoView({ behavior: 'smooth' });
            });

            // Close search results when clicking outside
            document.addEventListener('click', function (event) {
                const searchContainer = document.getElementById('search-container');
                if (searchContainer && !searchContainer.contains(event.target)) {
                    hideSearchResults();
                }
            });

            // Handle online/offline events
            window.addEventListener('online', () => {
                console.log('🌐 Connection restored');
                showToast('Connection restored', 'success');
                checkAuthStatus();
            });

            window.addEventListener('offline', () => {
                console.log('📡 Connection lost');
                showToast('Working offline - some features may be limited', 'info');
            });
        }

        // Load initial content
        async function loadInitialContent() {
            console.log('📡 Loading initial content...');

            document.getElementById('loading-state').classList.remove('d-none');
            document.getElementById('content-carousels').classList.add('d-none');

            try {
                // Load hero content
                await loadHeroContent();

                // Load public content
                await Promise.all([
                    loadTrendingContent(),
                    loadCriticsChoiceContent(),
                    loadNewReleasesContent(),
                    loadAnimeContent(),
                    loadAdminChoiceContent()
                ]);

                console.log('✅ Initial content loaded successfully');
                document.getElementById('loading-state').classList.add('d-none');
                document.getElementById('content-carousels').classList.remove('d-none');
            } catch (error) {
                console.error('❌ Error loading initial content:', error);
                showToast('Failed to load content. Please refresh the page.', 'error');
            }
        }

        // Load hero content
        async function loadHeroContent() {
            try {
                const response = await fetch(`${API_BASE_URL}/recommendations/trending?limit=1`);
                if (response.ok) {
                    const data = await response.json();
                    if (data.recommendations && data.recommendations.length > 0) {
                        const featured = data.recommendations[0];
                        updateHeroSection(featured);
                    }
                }
            } catch (error) {
                console.error('Error loading hero content:', error);
            }
        }

        // Update hero section with featured content
        function updateHeroSection(content) {
            const heroBackground = document.getElementById('hero-background');
            const heroTitle = document.getElementById('hero-title');
            const heroDescription = document.getElementById('hero-description');
            const playBtn = document.getElementById('hero-play-btn');
            const addBtn = document.getElementById('hero-add-btn');
            const exploreBtn = document.getElementById('hero-explore-btn');

            // Set background image
            if (content.poster_path) {
                heroBackground.style.backgroundImage = `url(${content.poster_path})`;
                heroBackground.style.backgroundSize = 'cover';
                heroBackground.style.backgroundPosition = 'center';
            }

            // Update content
            heroTitle.textContent = content.title;
            heroDescription.textContent = content.overview || 'Discover amazing content personalized just for you.';

            // Show content-specific buttons if logged in
            if (currentUser) {
                playBtn.classList.remove('d-none');
                addBtn.classList.remove('d-none');
                exploreBtn.classList.add('d-none');

                playBtn.onclick = () => playContent(content);
                addBtn.onclick = () => addToWatchlist(content.id);
            }
        }

        // Load trending content
        async function loadTrendingContent() {
            try {
                const response = await fetch(`${API_BASE_URL}/recommendations/trending?limit=20`);
                if (response.ok) {
                    const data = await response.json();
                    populateCarousel('trending-carousel', data.recommendations);
                }
            } catch (error) {
                console.error('Error loading trending content:', error);
            }
        }

        // Load critics choice content
        async function loadCriticsChoiceContent() {
            try {
                const response = await fetch(`${API_BASE_URL}/recommendations/critics-choice?limit=20`);
                if (response.ok) {
                    const data = await response.json();
                    populateCarousel('critics-carousel', data.recommendations);
                }
            } catch (error) {
                console.error('Error loading critics choice:', error);
            }
        }

        // Load new releases
        async function loadNewReleasesContent() {
            try {
                const response = await fetch(`${API_BASE_URL}/recommendations/new-releases?limit=20`);
                if (response.ok) {
                    const data = await response.json();
                    populateCarousel('new-releases-carousel', data.recommendations);
                }
            } catch (error) {
                console.error('Error loading new releases:', error);
            }
        }

        // Load anime content
        async function loadAnimeContent() {
            try {
                const response = await fetch(`${API_BASE_URL}/recommendations/anime?limit=20`);
                if (response.ok) {
                    const data = await response.json();
                    populateCarousel('anime-carousel', data.recommendations);
                }
            } catch (error) {
                console.error('Error loading anime content:', error);
            }
        }

        // Load admin choice content
        async function loadAdminChoiceContent() {
            try {
                const response = await fetch(`${API_BASE_URL}/recommendations/admin-choice?limit=20`);
                if (response.ok) {
                    const data = await response.json();
                    populateCarousel('admin-choice-carousel', data.recommendations);
                }
            } catch (error) {
                console.error('Error loading admin choice:', error);
            }
        }

        // Load personalized content (for logged-in users)
        async function loadPersonalizedContent() {
            if (!currentUser) return;

            console.log('👤 Loading personalized content...');

            try {
                // Load personalized recommendations
                const personalizedResponse = await fetch(`${API_BASE_URL}/recommendations/personalized`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('cinebrain_token')}`
                    }
                });
                if (personalizedResponse.ok) {
                    const data = await personalizedResponse.json();
                    populateCarousel('personalized-carousel', data.recommendations);
                }

                // Load watchlist as "Continue Watching"
                const watchlistResponse = await fetch(`${API_BASE_URL}/user/watchlist`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('cinebrain_token')}`
                    }
                });
                if (watchlistResponse.ok) {
                    const data = await watchlistResponse.json();
                    populateCarousel('continue-watching-carousel', data.watchlist);
                }

            } catch (error) {
                console.error('Error loading personalized content:', error);
            }
        }

        // Populate carousel with content
        function populateCarousel(carouselId, content) {
            const carousel = document.querySelector(`#${carouselId} .d-flex`);
            if (!carousel || !content) return;

            carousel.innerHTML = content.map(item => createContentCard(item)).join('');
        }

        // Create content card HTML
        function createContentCard(content) {
            const posterUrl = content.poster_path || 'https://via.placeholder.com/300x450?text=No+Image';
            const rating = content.rating ? parseFloat(content.rating).toFixed(1) : 'N/A';

            return `
                <div class="content-card flex-shrink-0 rounded-3 overflow-hidden shadow-lg" 
                     style="width: 200px; height: 320px;"
                     onclick="showContentDetails(${content.id})">
                    <div class="position-relative h-75">
                        <img src="${posterUrl}" alt="${content.title}" 
                             class="w-100 h-100 object-cover" style="object-fit: cover;">
                        <div class="position-absolute top-0 end-0 m-2">
                            <span class="badge bg-warning text-dark rounded-pill">
                                <i class="fas fa-star"></i> ${rating}
                            </span>
                        </div>
                        ${content.youtube_trailer ? `
                            <div class="position-absolute top-50 start-50 translate-middle">
                                <button class="btn btn-netflix rounded-circle p-2" onclick="event.stopPropagation(); playTrailer('${content.youtube_trailer}')">
                                    <i class="fas fa-play"></i>
                                </button>
                            </div>
                        ` : ''}
                    </div>
                    <div class="p-3 h-25 d-flex flex-column justify-content-between">
                        <h6 class="mb-1 fw-bold" style="font-size: 0.9rem; line-height: 1.2; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; color: var(--text-primary);">
                            ${content.title}
                        </h6>
                        <div class="d-flex justify-content-between align-items-center">
                            <small style="color: var(--text-muted);">${content.content_type?.toUpperCase()}</small>
                            <div class="d-flex gap-1">
                                <button class="btn btn-outline-netflix btn-sm p-1" onclick="event.stopPropagation(); addToWatchlist(${content.id})" title="Add to Watchlist">
                                    <i class="fas fa-bookmark" style="font-size: 0.7rem;"></i>
                                </button>
                                <button class="btn btn-outline-netflix btn-sm p-1" onclick="event.stopPropagation(); addToFavorites(${content.id})" title="Add to Favorites">
                                    <i class="fas fa-heart" style="font-size: 0.7rem;"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Search functionality
        function handleSearch(event) {
            const query = event.target.value.trim();

            if (searchTimeout) {
                clearTimeout(searchTimeout);
            }

            if (query.length < 2) {
                hideSearchResults();
                return;
            }

            searchTimeout = setTimeout(() => {
                performSearch(query);
            }, 300);
        }

        async function performSearch(query) {
            try {
                const response = await fetch(`${API_BASE_URL}/search?query=${encodeURIComponent(query)}&type=multi`);
                if (response.ok) {
                    const data = await response.json();
                    displaySearchResults(data.results);
                }
            } catch (error) {
                console.error('Search error:', error);
            }
        }

        function displaySearchResults(results) {
            const searchResults = document.getElementById('search-results');
            if (!results || results.length === 0) {
                searchResults.innerHTML = `<div class="p-3" style="color: var(--text-muted);">No results found</div>`;
            } else {
                searchResults.innerHTML = results.slice(0, 5).map(item => `
                    <div class="p-3 border-bottom cursor-pointer" onclick="showContentDetails(${item.id})" 
                         style="border-color: var(--border-color);"
                         onmouseover="this.style.background='var(--card-bg)'" 
                         onmouseout="this.style.background='transparent'">
                        <div class="d-flex align-items-center">
                            <img src="${item.poster_path || 'https://via.placeholder.com/50x75'}" alt="${item.title}" 
                                 class="rounded me-3" style="width: 40px; height: 60px; object-fit: cover;">
                            <div>
                                <h6 class="mb-1" style="color: var(--text-primary);">${item.title}</h6>
                                <small style="color: var(--text-muted);">${item.content_type?.toUpperCase()} • ${item.rating || 'N/A'}/10</small>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
            showSearchResults();
        }

        function showSearchResults() {
            document.getElementById('search-results').classList.remove('d-none');
        }

        function hideSearchResults() {
            setTimeout(() => {
                document.getElementById('search-results').classList.add('d-none');
            }, 200);
        }

        // Mobile search toggle
        function toggleMobileSearch() {
            const searchContainer = document.getElementById('search-container');
            if (searchContainer.classList.contains('d-none')) {
                searchContainer.classList.remove('d-none', 'd-md-block');
                searchContainer.classList.add('d-block');
                document.getElementById('search-input').focus();
            } else {
                searchContainer.classList.add('d-none', 'd-md-block');
                searchContainer.classList.remove('d-block');
            }
        }

        // Enhanced login function
        async function handleLogin(event) {
            event.preventDefault();

            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            const loginBtn = document.getElementById('login-btn');

            if (!username || !password) {
                showToast('Please fill in all fields', 'error');
                return;
            }

            loginBtn.innerHTML = '<span class="loading-spinner"></span> Logging in...';
            loginBtn.disabled = true;

            try {
                const response = await fetch(`${API_BASE_URL}/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, password })
                });

                const data = await response.json();

                if (response.ok) {
                    console.log('✅ Login successful');
                    localStorage.setItem('cinebrain_token', data.token);
                    currentUser = data.user;

                    bootstrap.Modal.getInstance(document.getElementById('loginModal')).hide();
                    updateUIForLoggedInUser();
                    showToast(`Welcome back, ${currentUser.username}!`, 'success');

                    // Load personalized content
                    loadPersonalizedContent();
                } else {
                    console.error('❌ Login failed:', data.error);
                    showToast(data.error || 'Login failed', 'error');
                }
            } catch (error) {
                console.error('❌ Login error:', error);
                showToast('Login failed. Please check your connection and try again.', 'error');
            } finally {
                loginBtn.innerHTML = 'Login';
                loginBtn.disabled = false;
            }
        }

        // Enhanced register function
        async function handleRegister(event) {
            event.preventDefault();

            const username = document.getElementById('register-username').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const registerBtn = document.getElementById('register-btn');

            if (!username || !email || !password) {
                showToast('Please fill in all fields', 'error');
                return;
            }

            registerBtn.innerHTML = '<span class="loading-spinner"></span> Creating account...';
            registerBtn.disabled = true;

            try {
                const response = await fetch(`${API_BASE_URL}/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, email, password })
                });

                const data = await response.json();

                if (response.ok) {
                    console.log('✅ Registration successful');
                    localStorage.setItem('cinebrain_token', data.token);
                    currentUser = data.user;

                    bootstrap.Modal.getInstance(document.getElementById('registerModal')).hide();
                    updateUIForLoggedInUser();
                    showToast(`Welcome to CineBrain, ${currentUser.username}!`, 'success');

                    // Load personalized content
                    loadPersonalizedContent();
                } else {
                    console.error('❌ Registration failed:', data.error);
                    showToast(data.error || 'Registration failed', 'error');
                }
            } catch (error) {
                console.error('❌ Registration error:', error);
                showToast('Registration failed. Please check your connection and try again.', 'error');
            } finally {
                registerBtn.innerHTML = 'Sign Up Free';
                registerBtn.disabled = false;
            }
        }

        function logout() {
            performLogout(true);
        }

        // Content interaction functions
        async function showContentDetails(contentId) {
            try {
                const response = await fetch(`${API_BASE_URL}/content/${contentId}`);
                if (response.ok) {
                    const content = await response.json();
                    displayContentModal(content);

                    // Record interaction if logged in
                    if (currentUser) {
                        recordInteraction(contentId, 'view');
                    }
                }
            } catch (error) {
                console.error('Error loading content details:', error);
                showToast('Failed to load content details', 'error');
            }
        }

        function displayContentModal(content) {
            const modalTitle = document.getElementById('content-modal-title');
            const modalBody = document.getElementById('content-modal-body');

            modalTitle.textContent = content.title;

            const genres = content.genres ? content.genres.join(', ') : 'N/A';
            const rating = content.rating ? parseFloat(content.rating).toFixed(1) : 'N/A';

            modalBody.innerHTML = `
                <div class="row">
                    <div class="col-md-4">
                        <img src="${content.poster_path || 'https://via.placeholder.com/300x450'}" 
                             alt="${content.title}" class="w-100 rounded-3">
                    </div>
                    <div class="col-md-8">
                        <div class="mb-3">
                            <h4 style="color: var(--text-primary);">${content.title}</h4>
                            ${content.original_title && content.original_title !== content.title ?
                    `<p style="color: var(--text-muted);">${content.original_title}</p>` : ''}
                        </div>
                        
                        <div class="mb-3">
                            <span class="badge me-2">${content.content_type?.toUpperCase()}</span>
                            <span class="badge bg-warning text-dark me-2">
                                <i class="fas fa-star"></i> ${rating}
                            </span>
                            ${content.release_date ? `<span class="badge bg-secondary">${content.release_date}</span>` : ''}
                        </div>
                        
                        <div class="mb-3">
                            <h6 style="color: var(--text-secondary);">Genres</h6>
                            <p style="color: var(--text-muted);">${genres}</p>
                        </div>
                        
                        <div class="mb-3">
                            <h6 style="color: var(--text-secondary);">Synopsis</h6>
                            <p style="color: var(--text-primary);">${content.overview || 'No synopsis available.'}</p>
                        </div>
                        
                        <div class="d-flex gap-2 flex-wrap">
                            ${content.youtube_trailer ? `
                                <button class="btn btn-netflix" onclick="playTrailer('${content.youtube_trailer}')">
                                    <i class="fas fa-play me-2"></i>Watch Trailer
                                </button>
                            ` : ''}
                            ${currentUser ? `
                                <button class="btn btn-outline-netflix" onclick="addToWatchlist(${content.id})">
                                    <i class="fas fa-bookmark me-2"></i>Add to Watchlist
                                </button>
                                <button class="btn btn-outline-netflix" onclick="addToFavorites(${content.id})">
                                    <i class="fas fa-heart me-2"></i>Add to Favorites
                                </button>
                            ` : ''}
                        </div>
                    </div>
                </div>
                
                ${content.similar_content && content.similar_content.length > 0 ? `
                    <div class="mt-4">
                        <h5 style="color: var(--text-primary);" class="mb-3">More Like This</h5>
                        <div class="d-flex gap-3 overflow-auto">
                            ${content.similar_content.map(similar => `
                                <div class="flex-shrink-0" style="width: 120px;">
                                    <img src="${similar.poster_path || 'https://via.placeholder.com/120x180'}" 
                                         alt="${similar.title}" class="w-100 rounded cursor-pointer"
                                         onclick="showContentDetails(${similar.id})">
                                    <p class="text-center mt-2 small" style="color: var(--text-primary);">${similar.title}</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}
            `;

            new bootstrap.Modal(document.getElementById('contentModal')).show();
        }

        async function addToWatchlist(contentId) {
            if (!currentUser) {
                showToast('Please login to add to watchlist', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/interactions`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('cinebrain_token')}`
                    },
                    body: JSON.stringify({
                        content_id: contentId,
                        interaction_type: 'watchlist'
                    })
                });

                if (response.ok) {
                    showToast('Added to watchlist!', 'success');
                } else {
                    showToast('Failed to add to watchlist', 'error');
                }
            } catch (error) {
                console.error('Watchlist error:', error);
                showToast('Failed to add to watchlist', 'error');
            }
        }

        async function addToFavorites(contentId) {
            if (!currentUser) {
                showToast('Please login to add to favorites', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/interactions`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('cinebrain_token')}`
                    },
                    body: JSON.stringify({
                        content_id: contentId,
                        interaction_type: 'favorite'
                    })
                });

                if (response.ok) {
                    showToast('Added to favorites!', 'success');
                } else {
                    showToast('Failed to add to favorites', 'error');
                }
            } catch (error) {
                console.error('Favorites error:', error);
                showToast('Failed to add to favorites', 'error');
            }
        }

        async function recordInteraction(contentId, interactionType, rating = null) {
            if (!currentUser) return;

            try {
                await fetch(`${API_BASE_URL}/interactions`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('cinebrain_token')}`
                    },
                    body: JSON.stringify({
                        content_id: contentId,
                        interaction_type: interactionType,
                        rating: rating
                    })
                });
            } catch (error) {
                console.error('Interaction recording error:', error);
            }
        }

        function playTrailer(youtubeUrl) {
            window.open(youtubeUrl, '_blank');
        }

        function playContent(content) {
            if (content.youtube_trailer) {
                playTrailer(content.youtube_trailer);
            } else {
                showToast('Trailer not available', 'info');
            }
        }

        // User profile functions
        async function showWatchlist() {
            if (!currentUser) {
                showToast('Please login to view watchlist', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/user/watchlist`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('cinebrain_token')}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    displayUserList('Watchlist', data.watchlist);
                }
            } catch (error) {
                console.error('Watchlist error:', error);
                showToast('Failed to load watchlist', 'error');
            }
        }

        async function showFavorites() {
            if (!currentUser) {
                showToast('Please login to view favorites', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/user/favorites`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('cinebrain_token')}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    displayUserList('Favorites', data.favorites);
                }
            } catch (error) {
                console.error('Favorites error:', error);
                showToast('Failed to load favorites', 'error');
            }
        }

        function displayUserList(title, items) {
            const modalTitle = document.getElementById('content-modal-title');
            const modalBody = document.getElementById('content-modal-body');

            modalTitle.textContent = title;

            if (!items || items.length === 0) {
                modalBody.innerHTML = `
                    <div class="text-center py-5">
                        <i class="fas fa-${title === 'Favorites' ? 'heart' : 'bookmark'} fa-3x mb-3" style="color: var(--text-muted);"></i>
                        <h5 style="color: var(--text-muted);">Your ${title.toLowerCase()} is empty</h5>
                        <p style="color: var(--text-muted);">Start adding content to see it here!</p>
                    </div>
                `;
            } else {
                modalBody.innerHTML = `
                    <div class="row g-3">
                        ${items.map(item => `
                            <div class="col-md-3 col-sm-4 col-6">
                                <div class="content-card rounded-3 overflow-hidden shadow" onclick="showContentDetails(${item.id})">
                                    <img src="${item.poster_path || 'https://via.placeholder.com/300x450'}" 
                                         alt="${item.title}" class="w-100" style="aspect-ratio: 2/3; object-fit: cover;">
                                    <div class="p-2">
                                        <h6 class="mb-1 small" style="color: var(--text-primary);">${item.title}</h6>
                                        <small style="color: var(--text-muted);">${item.content_type?.toUpperCase()}</small>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            new bootstrap.Modal(document.getElementById('contentModal')).show();
        }

        function showProfile() {
            if (!currentUser) {
                showToast('Please login to view profile', 'error');
                return;
            }
            showToast('Profile feature coming soon!', 'info');
        }

        // Utility functions
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message');

            toastMessage.textContent = message;

            // Update toast styling based on type
            toast.className = 'toast';
            if (type === 'success') {
                toast.style.background = 'var(--primary-color)';
                toast.style.color = 'white';
            } else if (type === 'error') {
                toast.style.background = '#dc3545';
                toast.style.color = 'white';
            } else {
                toast.style.background = 'var(--modal-bg)';
                toast.style.color = 'var(--text-primary)';
            }

            new bootstrap.Toast(toast).show();
        }

        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Load more functions (placeholder)
        function loadMoreTrending() {
            showToast('Load more feature coming soon!', 'info');
        }

        function loadMoreCriticsChoice() {
            showToast('Load more feature coming soon!', 'info');
        }

        function loadMoreNewReleases() {
            showToast('Load more feature coming soon!', 'info');
        }

        function loadMoreAnime() {
            showToast('Load more feature coming soon!', 'info');
        }

        function loadMoreAdminChoice() {
            showToast('Load more feature coming soon!', 'info');
        }

        function loadMorePersonalized() {
            showToast('Load more feature coming soon!', 'info');
        }
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>CineScope - Discover Your Next Favorite</title>

    <!-- CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="/css/base.css" rel="stylesheet">
    <link href="/css/bootstrap-overrides.css" rel="stylesheet">
    <link href="/css/tailwind.css" rel="stylesheet">
    <link href="/css/animation.css" rel="stylesheet">
    <link href="/css/responsive.css" rel="stylesheet">
    <link href="/css/utilities.css" rel="stylesheet">
</head>

<body>
    <div class="app-container">
        <!-- Desktop Sidebar -->
        <div id="sidebar-container"></div>

        <!-- Main Content -->
        <main class="main-content">
            <div class="container-fluid">
                <!-- Hero Section -->
                <section class="hero-section animate-fade-in" id="hero-section">
                    <div class="hero-backdrop" id="hero-backdrop"></div>
                    <div class="hero-content">
                        <h1 class="hero-title">Welcome to CineScope</h1>
                        <p class="hero-description">Discover your next favorite movie, TV show, or anime with our
                            AI-powered recommendations.</p>
                        <div class="d-flex gap-3">
                            <a href="/content/search" class="btn btn-primary btn-lg">
                                <i class="bi bi-search"></i> Start Exploring
                            </a>
                            <button class="btn btn-secondary btn-lg" onclick="scrollToRecommendations()">
                                <i class="bi bi-arrow-down"></i> Browse
                            </button>
                        </div>
                    </div>
                </section>

                <!-- Trending Section -->
                <section class="tw-mb-8" id="trending-section">
                    <div class="d-flex justify-content-between align-items-center tw-mb-4">
                        <h2 class="tw-text-2xl tw-font-bold">
                            <i class="bi bi-fire text-danger"></i> Trending Now
                        </h2>
                        <a href="/content/search?category=trending" class="text-primary">View All</a>
                    </div>
                    <div class="row g-4" id="trending-grid">
                        <!-- Loading skeleton -->
                        <div class="col-12">
                            <div class="skeleton-shimmer" style="height: 200px; border-radius: 8px;"></div>
                        </div>
                    </div>
                </section>

                <!-- New Releases Section -->
                <section class="tw-mb-8" id="new-releases-section">
                    <div class="d-flex justify-content-between align-items-center tw-mb-4">
                        <h2 class="tw-text-2xl tw-font-bold">
                            <i class="bi bi-calendar text-primary"></i> New Releases
                        </h2>
                        <a href="/content/search?category=new" class="text-primary">View All</a>
                    </div>
                    <div class="row g-4" id="new-releases-grid">
                        <!-- Loading skeleton -->
                        <div class="col-12">
                            <div class="skeleton-shimmer" style="height: 200px; border-radius: 8px;"></div>
                        </div>
                    </div>
                </section>

                <!-- Critics Choice Section -->
                <section class="tw-mb-8" id="critics-section">
                    <div class="d-flex justify-content-between align-items-center tw-mb-4">
                        <h2 class="tw-text-2xl tw-font-bold">
                            <i class="bi bi-award text-warning"></i> Critics' Choice
                        </h2>
                        <a href="/content/search?category=critics" class="text-primary">View All</a>
                    </div>
                    <div class="row g-4" id="critics-grid">
                        <!-- Loading skeleton -->
                        <div class="col-12">
                            <div class="skeleton-shimmer" style="height: 200px; border-radius: 8px;"></div>
                        </div>
                    </div>
                </section>

                <!-- Personalized Section (for logged-in users) -->
                <section class="tw-mb-8 d-none" id="personalized-section" data-auth="user">
                    <div class="d-flex justify-content-between align-items-center tw-mb-4">
                        <h2 class="tw-text-2xl tw-font-bold">
                            <i class="bi bi-stars text-gradient"></i> For You
                        </h2>
                        <a href="/user/profile" class="text-primary">Customize</a>
                    </div>
                    <div class="row g-4" id="personalized-grid">
                        <!-- Loading skeleton -->
                        <div class="col-12">
                            <div class="skeleton-shimmer" style="height: 200px; border-radius: 8px;"></div>
                        </div>
                    </div>
                </section>
            </div>
        </main>

        <!-- Mobile Navigation -->
        <div id="mobile-nav-container"></div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/config.js"></script>
    <script src="/js/storage.js"></script>
    <script src="/js/http.js"></script>
    <script src="/js/ui.js"></script>
    <script src="/js/app.js"></script>

    <!-- Page specific JS -->
    <script>
        // Initialize page
        async function pageInit() {
            try {
                // Load trending content
                loadTrending();

                // Load new releases
                loadNewReleases();

                // Load critics choice
                loadCriticsChoice();

                // Load personalized if user is logged in
                if (Storage.getUser()) {
                    document.getElementById('personalized-section').classList.remove('d-none');
                    loadPersonalized();
                }

                // Set hero backdrop
                setHeroBackdrop();
            } catch (error) {
                console.error('Page initialization error:', error);
            }
        }

        async function loadTrending() {
            try {
                const data = await api.content.getTrending('all', 8);
                const grid = document.getElementById('trending-grid');
                grid.innerHTML = UI.createContentGrid(data.recommendations || []);
            } catch (error) {
                console.error('Error loading trending:', error);
                document.getElementById('trending-grid').innerHTML = '<div class="col-12 text-center text-muted">Failed to load trending content</div>';
            }
        }

        async function loadNewReleases() {
            try {
                const data = await api.content.getNewReleases(null, 'movie', 8);
                const grid = document.getElementById('new-releases-grid');
                grid.innerHTML = UI.createContentGrid(data.recommendations || []);
            } catch (error) {
                console.error('Error loading new releases:', error);
                document.getElementById('new-releases-grid').innerHTML = '<div class="col-12 text-center text-muted">Failed to load new releases</div>';
            }
        }

        async function loadCriticsChoice() {
            try {
                const data = await api.content.getCriticsChoice('movie', 8);
                const grid = document.getElementById('critics-grid');
                grid.innerHTML = UI.createContentGrid(data.recommendations || []);
            } catch (error) {
                console.error('Error loading critics choice:', error);
                document.getElementById('critics-grid').innerHTML = '<div class="col-12 text-center text-muted">Failed to load critics choice</div>';
            }
        }

        async function loadPersonalized() {
            try {
                const data = await api.content.getPersonalized(8);
                const grid = document.getElementById('personalized-grid');
                grid.innerHTML = UI.createContentGrid(data.recommendations || []);
            } catch (error) {
                console.error('Error loading personalized:', error);
                // Fallback to anonymous recommendations
                try {
                    const data = await api.content.getAnonymousRecommendations(8);
                    const grid = document.getElementById('personalized-grid');
                    grid.innerHTML = UI.createContentGrid(data.recommendations || []);
                } catch (fallbackError) {
                    document.getElementById('personalized-grid').innerHTML = '<div class="col-12 text-center text-muted">Failed to load recommendations</div>';
                }
            }
        }

        function setHeroBackdrop() {
            // Set a random backdrop from trending
            api.content.getTrending('movie', 1).then(data => {
                if (data.recommendations && data.recommendations.length > 0) {
                    const content = data.recommendations[0];
                    if (content.backdrop_path) {
                        const backdrop = document.getElementById('hero-backdrop');
                        backdrop.style.backgroundImage = `url(https://image.tmdb.org/t/p/w1280${content.backdrop_path})`;
                    }
                }
            }).catch(console.error);
        }

        function scrollToRecommendations() {
            document.getElementById('trending-section').scrollIntoView({ behavior: 'smooth' });
        }

        // Set pageInit for App.js to call
        window.pageInit = pageInit;
    </script>
</body>

</html>
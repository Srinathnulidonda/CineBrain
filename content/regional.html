<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Regional Content - CineBrain">
  <title>Regional Content - CineBrain</title>
  
  <!-- Critical CSS -->
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/components.css">
  <link rel="stylesheet" href="/css/layouts.css">
  <link rel="stylesheet" href="/css/animations.css">
  <link rel="stylesheet" href="/css/responsive.css">
  <link rel="stylesheet" href="/css/theme.css">
</head>
<body>
  <!-- Fixed Topbar -->
  <div id="topbar"></div>

  <!-- Main Content -->
  <div class="page-layout">
    <main class="page-main">
      <div class="container py-8">
        <!-- Header -->
        <div class="text-center mb-12">
          <h1 class="text-5xl font-bold mb-4">🌍 Regional Cinema</h1>
          <p class="text-xl text-muted">Explore movies and shows from different regions</p>
        </div>

        <!-- Language Filters -->
        <div class="flex justify-center mb-8">
          <div class="search-filters">
            <button class="filter-chip active" data-lang="hindi" onclick="setLanguage('hindi')">🇮🇳 Hindi</button>
            <button class="filter-chip" data-lang="telugu" onclick="setLanguage('telugu')">🇮🇳 Telugu</button>
            <button class="filter-chip" data-lang="tamil" onclick="setLanguage('tamil')">🇮🇳 Tamil</button>
            <button class="filter-chip" data-lang="kannada" onclick="setLanguage('kannada')">🇮🇳 Kannada</button>
            <button class="filter-chip" data-lang="malayalam" onclick="setLanguage('malayalam')">🇮🇳 Malayalam</button>
            <button class="filter-chip" data-lang="english" onclick="setLanguage('english')">🇺🇸 English</button>
          </div>
        </div>

        <!-- Content Type Filter -->
        <div class="flex justify-center mb-8">
          <div class="flex gap-2 bg-elevated rounded-lg p-1">
            <button class="btn btn-ghost btn-sm active" data-type="movie" onclick="setContentType('movie')">Movies</button>
            <button class="btn btn-ghost btn-sm" data-type="tv" onclick="setContentType('tv')">TV Shows</button>
          </div>
        </div>

        <!-- Current Selection Info -->
        <div class="text-center mb-8">
          <h2 class="text-2xl font-semibold" id="current-selection">Hindi Movies</h2>
          <p class="text-muted" id="content-count">Loading content...</p>
        </div>

        <!-- Loading State -->
        <div class="text-center py-12" id="regional-loading">
          <div class="loading-spinner mx-auto mb-4"></div>
          <p class="text-muted">Loading regional content...</p>
        </div>

        <!-- Regional Content Grid -->
        <div class="content-grid" id="regional-grid" style="display: none;">
          <!-- Real regional content loaded here -->
        </div>

        <!-- Load More Section -->
        <div class="text-center mt-12" id="load-more-section" style="display: none;">
          <button class="btn btn-outline" id="load-more-btn" onclick="loadMoreRegional()">
            Load More Content
          </button>
        </div>

        <!-- Popular Regional Sections -->
        <section class="content-section mt-16" id="popular-regions">
          <h2 class="section-title">Popular Regional Cinema</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div class="bg-elevated rounded-xl p-6 cursor-pointer hover:bg-surface transition" onclick="setLanguage('hindi')">
              <div class="flex items-center mb-4">
                <span class="text-3xl mr-3">🎬</span>
                <div>
                  <h3 class="font-semibold text-lg">Bollywood</h3>
                  <p class="text-sm text-muted">Hindi Cinema</p>
                </div>
              </div>
              <p class="text-sm">Discover the magic of Bollywood with blockbuster hits and critically acclaimed films.</p>
            </div>
            
            <div class="bg-elevated rounded-xl p-6 cursor-pointer hover:bg-surface transition" onclick="setLanguage('telugu')">
              <div class="flex items-center mb-4">
                <span class="text-3xl mr-3">🎭</span>
                <div>
                  <h3 class="font-semibold text-lg">Tollywood</h3>
                  <p class="text-sm text-muted">Telugu Cinema</p>
                </div>
              </div>
              <p class="text-sm">Experience the grandeur of Telugu cinema with epic stories and spectacular visuals.</p>
            </div>
            
            <div class="bg-elevated rounded-xl p-6 cursor-pointer hover:bg-surface transition" onclick="setLanguage('tamil')">
              <div class="flex items-center mb-4">
                <span class="text-3xl mr-3">🎨</span>
                <div>
                  <h3 class="font-semibold text-lg">Kollywood</h3>
                  <p class="text-sm text-muted">Tamil Cinema</p>
                </div>
              </div>
              <p class="text-sm">Explore Tamil cinema known for its artistic storytelling and powerful performances.</p>
            </div>
            
            <div class="bg-elevated rounded-xl p-6 cursor-pointer hover:bg-surface transition" onclick="setLanguage('kannada')">
              <div class="flex items-center mb-4">
                <span class="text-3xl mr-3">🌟</span>
                <div>
                  <h3 class="font-semibold text-lg">Sandalwood</h3>
                  <p class="text-sm text-muted">Kannada Cinema</p>
                </div>
              </div>
              <p class="text-sm">Discover Kannada films celebrated for innovative narratives and cultural depth.</p>
            </div>
            
            <div class="bg-elevated rounded-xl p-6 cursor-pointer hover:bg-surface transition" onclick="setLanguage('malayalam')">
              <div class="flex items-center mb-4">
                <span class="text-3xl mr-3">🎪</span>
                <div>
                  <h3 class="font-semibold text-lg">Mollywood</h3>
                  <p class="text-sm text-muted">Malayalam Cinema</p>
                </div>
              </div>
              <p class="text-sm">Experience Malayalam cinema known for realistic storytelling and exceptional acting.</p>
            </div>
            
            <div class="bg-elevated rounded-xl p-6 cursor-pointer hover:bg-surface transition" onclick="setLanguage('english')">
              <div class="flex items-center mb-4">
                <span class="text-3xl mr-3">🎯</span>
                <div>
                  <h3 class="font-semibold text-lg">Hollywood</h3>
                  <p class="text-sm text-muted">English Cinema</p>
                </div>
              </div>
              <p class="text-sm">Enjoy the latest blockbusters and critically acclaimed English films.</p>
            </div>
          </div>
        </section>
      </div>
    </main>
  </div>

  <!-- Mobile Navigation -->
  <div id="mobile-nav"></div>

  <!-- Scripts -->
  <script type="module" src="/js/config.js"></script>
  <script type="module" src="/js/api.js"></script>
  <script type="module" src="/js/auth.js"></script>
  <script type="module" src="/js/app.js"></script>

  <!-- Page-Specific Logic -->
  <script>
    let currentLanguage = 'hindi';
    let currentContentType = 'movie';
    let regionalData = [];
    let isLoading = false;

    const languageNames = {
      'hindi': 'Hindi',
      'telugu': 'Telugu', 
      'tamil': 'Tamil',
      'kannada': 'Kannada',
      'malayalam': 'Malayalam',
      'english': 'English'
    };

    document.addEventListener('DOMContentLoaded', function() {
      loadComponents();
      
      window.addEventListener('appReady', function() {
        initializeRegionalPage();
      });
      
      if (window.app && window.app.isInitialized) {
        initializeRegionalPage();
      }
    });

    async function loadComponents() {
      try {
        const topbarResponse = await fetch('/components/layout/topbar.html');
        const topbarHTML = await topbarResponse.text();
        document.getElementById('topbar').innerHTML = topbarHTML;

        const mobileNavResponse = await fetch('/components/layout/mobile-nav.html');
        const mobileNavHTML = await mobileNavResponse.text();
        document.getElementById('mobile-nav').innerHTML = mobileNavHTML;
      } catch (error) {
        console.error('Error loading components:', error);
      }
    }

    async function initializeRegionalPage() {
      updateSelectionDisplay();
      await loadRegionalContent();
      console.log('🌍 Regional content page initialized');
    }

    async function loadRegionalContent() {
      if (isLoading) return;
      
      isLoading = true;
      showLoading(true);

      try {
        const data = await API.get(`/recommendations/regional/${currentLanguage}`, {
          type: currentContentType,
          limit: 30
        });
        
        regionalData = data.recommendations || data;
        
        if (regionalData && regionalData.length > 0) {
          displayRegionalContent();
        } else {
          showEmptyState();
        }
        
      } catch (error) {
        console.error('Regional content error:', error);
        showErrorState();
      } finally {
        isLoading = false;
        showLoading(false);
      }
    }

    function displayRegionalContent() {
      const grid = document.getElementById('regional-grid');
      const loadMoreSection = document.getElementById('load-more-section');
      const contentCount = document.getElementById('content-count');
      
      grid.innerHTML = '';
      grid.style.display = 'grid';
      
      regionalData.forEach((item, index) => {
        const card = app.createContentCard(item);
        card.style.animationDelay = `${index * 0.05}s`;
        card.classList.add('animate-on-scroll');
        grid.appendChild(card);
      });
      
      // Update content count
      contentCount.textContent = `${regionalData.length} ${currentContentType}s available`;
      
      // Show load more if we have enough content
      loadMoreSection.style.display = regionalData.length >= 20 ? 'block' : 'none';
      
      // Trigger animations
      setTimeout(() => {
        document.querySelectorAll('.animate-on-scroll').forEach(el => {
          el.classList.add('in-view');
        });
      }, 100);
    }

    async function loadMoreRegional() {
      if (isLoading) return;
      
      const loadMoreBtn = document.getElementById('load-more-btn');
      const originalText = loadMoreBtn.textContent;
      loadMoreBtn.textContent = 'Loading...';
      loadMoreBtn.disabled = true;

      try {
        const data = await API.get(`/recommendations/regional/${currentLanguage}`, {
          type: currentContentType,
          limit: 20
        });
        
        const newContent = data.recommendations || data;
        
        if (newContent && newContent.length > 0) {
          // Filter out duplicates
          const existingIds = new Set(regionalData.map(item => item.id));
          const uniqueNewContent = newContent.filter(item => !existingIds.has(item.id));
          
          if (uniqueNewContent.length > 0) {
            regionalData = [...regionalData, ...uniqueNewContent];
            appendRegionalContent(uniqueNewContent);
            document.getElementById('content-count').textContent = `${regionalData.length} ${currentContentType}s available`;
          } else {
            loadMoreBtn.style.display = 'none';
            showToast('No more content available', 'info');
          }
        } else {
          loadMoreBtn.style.display = 'none';
          showToast('No more content available', 'info');
        }
        
      } catch (error) {
        console.error('Load more regional error:', error);
        showToast('Failed to load more content', 'error');
      } finally {
        loadMoreBtn.textContent = originalText;
        loadMoreBtn.disabled = false;
      }
    }

    function appendRegionalContent(newContent) {
      const grid = document.getElementById('regional-grid');
      const currentCount = grid.children.length;
      
      newContent.forEach((item, index) => {
        const card = app.createContentCard(item);
        card.style.animationDelay = `${index * 0.05}s`;
        card.classList.add('animate-on-scroll');
        grid.appendChild(card);
      });
      
      // Animate new items
      setTimeout(() => {
        const newItems = Array.from(grid.children).slice(currentCount);
        newItems.forEach(el => el.classList.add('in-view'));
      }, 100);
    }

    function setLanguage(language) {
      if (language === currentLanguage) return;
      
      currentLanguage = language;
      
      // Update active filter
      document.querySelectorAll('[data-lang]').forEach(chip => {
        chip.classList.remove('active');
      });
      document.querySelector(`[data-lang="${language}"]`).classList.add('active');
      
      updateSelectionDisplay();
      loadRegionalContent();
    }

    function setContentType(type) {
      if (type === currentContentType) return;
      
      currentContentType = type;
      
      // Update active type
      document.querySelectorAll('[data-type]').forEach(btn => {
        btn.classList.remove('active');
      });
      document.querySelector(`[data-type="${type}"]`).classList.add('active');
      
      updateSelectionDisplay();
      loadRegionalContent();
    }

    function updateSelectionDisplay() {
      const selection = document.getElementById('current-selection');
      const languageName = languageNames[currentLanguage] || currentLanguage;
      const typeName = currentContentType === 'movie' ? 'Movies' : 'TV Shows';
      selection.textContent = `${languageName} ${typeName}`;
    }

    function showLoading(show) {
      document.getElementById('regional-loading').style.display = show ? 'block' : 'none';
      document.getElementById('regional-grid').style.display = show ? 'none' : 'grid';
      document.getElementById('popular-regions').style.display = show ? 'none' : 'block';
    }

    function showEmptyState() {
      const grid = document.getElementById('regional-grid');
      grid.innerHTML = `
        <div class="col-span-full">
          <div class="empty-state">
            <h3>🎬 No Content Found</h3>
            <p>No ${currentContentType}s found for ${languageNames[currentLanguage]} language</p>
            <button class="btn btn-primary mt-4" onclick="setLanguage('hindi')">Try Hindi Content</button>
          </div>
        </div>
      `;
      grid.style.display = 'grid';
      document.getElementById('content-count').textContent = '0 results';
    }

    function showErrorState() {
      const grid = document.getElementById('regional-grid');
      grid.innerHTML = `
        <div class="col-span-full">
          <div class="error-state">
            <h3>⚠️ Loading Error</h3>
            <p>Failed to load regional content</p>
            <button class="btn btn-primary mt-4" onclick="loadRegionalContent()">Try Again</button>
          </div>
        </div>
      `;
      grid.style.display = 'grid';
      document.getElementById('content-count').textContent = 'Error loading content';
    }
  </script>
</body>
</html>
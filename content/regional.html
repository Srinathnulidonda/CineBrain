<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Regional Cinema - CineScope</title>

    <!-- CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="/assets/css/base.css" rel="stylesheet">
    <link href="/assets/css/components.css" rel="stylesheet">
    <link href="/assets/css/layouts.css" rel="stylesheet">
    <link href="/assets/css/animations.css" rel="stylesheet">
    <link href="/assets/css/responsive.css" rel="stylesheet">
    <link href="/assets/css/utilities.css" rel="stylesheet">
</head>

<body>
    <div class="app-layout">
        <!-- Navigation -->
        <nav class="navbar">
            <div class="container navbar__container">
                <a href="/" class="navbar__logo">CineScope</a>

                <div class="navbar__menu">
                    <a href="/content/trending.html" class="navbar__link">Trending</a>
                    <a href="/content/search.html" class="navbar__link">Browse</a>
                    <a href="/content/anime.html" class="navbar__link">Anime</a>
                    <a href="/content/regional.html" class="navbar__link navbar__link--active">Regional</a>
                </div>

                <div class="navbar__user" id="navbarUser">
                    <!-- Dynamic user menu -->
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="app-layout__main">
            <!-- Regional Hero -->
            <section class="hero-banner" style="height: 50vh; min-height: 400px;">
                <div class="hero-banner__backdrop"
                    style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); opacity: 0.8;"></div>
                <div class="hero-banner__gradient"></div>
                <div class="container hero-banner__content">
                    <div class="hero-banner__info text-center mx-auto" style="max-width: 600px;">
                        <h1 class="hero-banner__title">
                            <i class="bi bi-globe"></i> Regional Cinema
                        </h1>
                        <p class="hero-banner__description">
                            Discover the rich diversity of cinema from around the world
                        </p>
                    </div>
                </div>
            </section>

            <div class="container">
                <!-- Language Selection -->
                <section class="section">
                    <h2 class="text-center mb-xl">Explore by Language</h2>
                    <div class="row justify-center">
                        <div class="col-lg-10">
                            <div class="row g-lg">
                                <div class="col-md-4 col-6">
                                    <div class="regional-card animate-fadeInUp" onclick="loadRegionalContent('hindi')">
                                        <div class="regional-card__flag">ðŸ‡®ðŸ‡³</div>
                                        <h3 class="regional-card__title">Hindi</h3>
                                        <p class="regional-card__subtitle">Bollywood</p>
                                    </div>
                                </div>
                                <div class="col-md-4 col-6">
                                    <div class="regional-card animate-fadeInUp" style="animation-delay: 0.1s"
                                        onclick="loadRegionalContent('telugu')">
                                        <div class="regional-card__flag">ðŸ‡®ðŸ‡³</div>
                                        <h3 class="regional-card__title">Telugu</h3>
                                        <p class="regional-card__subtitle">Tollywood</p>
                                    </div>
                                </div>
                                <div class="col-md-4 col-6">
                                    <div class="regional-card animate-fadeInUp" style="animation-delay: 0.2s"
                                        onclick="loadRegionalContent('tamil')">
                                        <div class="regional-card__flag">ðŸ‡®ðŸ‡³</div>
                                        <h3 class="regional-card__title">Tamil</h3>
                                        <p class="regional-card__subtitle">Kollywood</p>
                                    </div>
                                </div>
                                <div class="col-md-4 col-6">
                                    <div class="regional-card animate-fadeInUp" style="animation-delay: 0.3s"
                                        onclick="loadRegionalContent('kannada')">
                                        <div class="regional-card__flag">ðŸ‡®ðŸ‡³</div>
                                        <h3 class="regional-card__title">Kannada</h3>
                                        <p class="regional-card__subtitle">Sandalwood</p>
                                    </div>
                                </div>
                                <div class="col-md-4 col-6">
                                    <div class="regional-card animate-fadeInUp" style="animation-delay: 0.4s"
                                        onclick="loadRegionalContent('malayalam')">
                                        <div class="regional-card__flag">ðŸ‡®ðŸ‡³</div>
                                        <h3 class="regional-card__title">Malayalam</h3>
                                        <p class="regional-card__subtitle">Mollywood</p>
                                    </div>
                                </div>
                                <div class="col-md-4 col-6">
                                    <div class="regional-card animate-fadeInUp" style="animation-delay: 0.5s"
                                        onclick="loadRegionalContent('english')">
                                        <div class="regional-card__flag">ðŸ‡ºðŸ‡¸</div>
                                        <h3 class="regional-card__title">English</h3>
                                        <p class="regional-card__subtitle">Hollywood</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Content Section -->
                <section class="section" id="regionalContentSection" style="display: none;">
                    <div class="d-flex justify-between align-center mb-lg">
                        <h2 id="regionalTitle">Regional Content</h2>
                        <button class="btn btn-secondary" onclick="resetRegional()">
                            <i class="bi bi-arrow-left"></i> Back to Languages
                        </button>
                    </div>

                    <div class="content-grid content-grid--movies" id="regionalGrid">
                        <!-- Dynamic content -->
                    </div>
                </section>

                <!-- Featured Regional -->
                <section class="section">
                    <h2 class="mb-lg">Popular Across Regions</h2>
                    <div class="content-grid content-grid--movies" id="featuredRegionalGrid">
                        <!-- Loading skeletons -->
                        <div class="content-card skeleton" style="height: 400px;"></div>
                        <div class="content-card skeleton" style="height: 400px;"></div>
                        <div class="content-card skeleton" style="height: 400px;"></div>
                        <div class="content-card skeleton" style="height: 400px;"></div>
                    </div>
                </section>
            </div>
        </main>

        <!-- Mobile Navigation -->
        <nav class="mobile-nav">
            <ul class="mobile-nav__list">
                <li class="mobile-nav__item">
                    <a href="/" class="mobile-nav__link">
                        <i class="bi bi-house mobile-nav__icon"></i>
                        <span>Home</span>
                    </a>
                </li>
                <li class="mobile-nav__item">
                    <a href="/content/search.html" class="mobile-nav__link">
                        <i class="bi bi-search mobile-nav__icon"></i>
                        <span>Search</span>
                    </a>
                </li>
                <li class="mobile-nav__item">
                    <a href="/content/trending.html" class="mobile-nav__link">
                        <i class="bi bi-fire mobile-nav__icon"></i>
                        <span>Trending</span>
                    </a>
                </li>
                <li class="mobile-nav__item" id="mobileWatchlistItem">
                    <a href="/auth/login.html" class="mobile-nav__link">
                        <i class="bi bi-bookmark mobile-nav__icon"></i>
                        <span>Watchlist</span>
                    </a>
                </li>
                <li class="mobile-nav__item" id="mobileProfileItem">
                    <a href="/auth/login.html" class="mobile-nav__link">
                        <i class="bi bi-person mobile-nav__icon"></i>
                        <span>Profile</span>
                    </a>
                </li>
            </ul>
        </nav>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <style>
        .regional-card {
            background: var(--bg-secondary);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-xl);
            text-align: center;
            cursor: pointer;
            transition: all var(--transition-base);
            border: 2px solid transparent;
        }

        .regional-card:hover {
            background: var(--bg-tertiary);
            border-color: var(--accent-blue);
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .regional-card__flag {
            font-size: 3rem;
            margin-bottom: var(--spacing-md);
        }

        .regional-card__title {
            font-size: 1.25rem;
            margin-bottom: var(--spacing-xs);
        }

        .regional-card__subtitle {
            color: var(--text-muted);
            margin: 0;
        }
    </style>

    <!-- Scripts -->
    <script src="/assets/js/core/config.js"></script>
    <script src="/assets/js/core/storage.js"></script>
    <script src="/assets/js/core/api.js"></script>
    <script src="/assets/js/core/auth.js"></script>
    <script src="/assets/js/core/router.js"></script>

    <script>
        // Initialize page
        document.addEventListener('DOMContentLoaded', () => {
            updateNavigation();
            loadFeaturedRegional();

            // Check for language in URL
            const urlParams = new URLSearchParams(window.location.search);
            const language = urlParams.get('language');
            if (language) {
                loadRegionalContent(language);
            }
        });

        function updateNavigation() {
            const navbarUser = document.getElementById('navbarUser');
            const mobileWatchlistItem = document.getElementById('mobileWatchlistItem');
            const mobileProfileItem = document.getElementById('mobileProfileItem');

            if (auth.isAuthenticated()) {
                const user = auth.getUser();
                navbarUser.innerHTML = `
                    <a href="${auth.getUserUrl('watchlist')}" class="navbar__link">
                        <i class="bi bi-bookmark"></i>
                    </a>
                    <a href="${auth.getUserUrl('favorites')}" class="navbar__link">
                        <i class="bi bi-heart"></i>
                    </a>
                    <div class="navbar__avatar">
                        <img src="${user.avatar || '/assets/images/default-avatar.png'}" alt="${user.username}">
                    </div>
                `;

                mobileWatchlistItem.innerHTML = `
                    <a href="${auth.getUserUrl('watchlist')}" class="mobile-nav__link">
                        <i class="bi bi-bookmark mobile-nav__icon"></i>
                        <span>Watchlist</span>
                    </a>
                `;

                mobileProfileItem.innerHTML = `
                    <a href="${auth.getUserUrl('profile')}" class="mobile-nav__link">
                        <i class="bi bi-person mobile-nav__icon"></i>
                        <span>Profile</span>
                    </a>
                `;
            } else {
                navbarUser.innerHTML = `
                    <a href="/auth/login.html" class="btn btn-primary">Sign In</a>
                `;
            }
        }

        async function loadFeaturedRegional() {
            try {
                // Load a mix of regional content
                const response = await api.getRegionalContent('hindi', 'movie', 8);
                renderContentGrid('featuredRegionalGrid', response.recommendations || []);
            } catch (error) {
                console.error('Failed to load featured regional:', error);
            }
        }

        async function loadRegionalContent(language) {
            try {
                // Update URL
                router.updateParams({ language });

                // Show content section
                document.getElementById('regionalContentSection').style.display = 'block';

                // Update title
                const langInfo = Config.LANGUAGES[language];
                document.getElementById('regionalTitle').textContent = `${langInfo.name} Cinema - ${langInfo.region}`;

                // Show loading
                document.getElementById('regionalGrid').innerHTML = `
                    <div class="content-card skeleton" style="height: 400px;"></div>
                    <div class="content-card skeleton" style="height: 400px;"></div>
                    <div class="content-card skeleton" style="height: 400px;"></div>
                    <div class="content-card skeleton" style="height: 400px;"></div>
                `;

                // Scroll to content
                document.getElementById('regionalContentSection').scrollIntoView({ behavior: 'smooth' });

                // Load content
                const response = await api.getRegionalContent(language, 'movie', 20);
                renderContentGrid('regionalGrid', response.recommendations || []);

            } catch (error) {
                console.error('Failed to load regional content:', error);
                showToast('Failed to load regional content', 'error');
            }
        }

        function renderContentGrid(gridId, items) {
            const grid = document.getElementById(gridId);

            if (items.length === 0) {
                grid.innerHTML = '<p class="text-center text-muted col-span-full">No content found</p>';
                return;
            }

            grid.innerHTML = items.map((item, index) => `
                <div class="content-card animate-fadeInUp" style="animation-delay: ${Math.min(index * 0.05, 0.5)}s">
                    <div class="content-card__image-wrapper" onclick="navigateToContentDetails(${item.id})">
                        <img src="${item.poster_path || '/assets/images/placeholder-poster.jpg'}" 
                             alt="${item.title}" 
                             class="content-card__image"
                             loading="lazy">
                    </div>
                    <div class="content-card__body">
                        <h3 class="content-card__title">${item.title}</h3>
                        <div class="content-card__meta">
                            <span class="content-card__rating">
                                <i class="bi bi-star-fill content-card__rating-star"></i>
                                ${item.rating || 'N/A'}
                            </span>
                            <span>${item.content_type}</span>
                        </div>
                    </div>
                    <div class="content-card__overlay">
                        <p class="text-sm mb-sm">${item.overview || 'No description available.'}</p>
                        <div class="content-card__actions">
                            ${auth.isAuthenticated() ? `
                                <button class="content-card__action-btn" onclick="event.stopPropagation(); addToWatchlist(${item.id})">
                                    <i class="bi bi-plus"></i> Watchlist
                                </button>
                            ` : ''}
                            ${item.youtube_trailer ? `
                                <button class="content-card__action-btn" onclick="event.stopPropagation(); window.open('${item.youtube_trailer}', '_blank')">
                                    <i class="bi bi-play"></i> Trailer
                                </button>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function resetRegional() {
            document.getElementById('regionalContentSection').style.display = 'none';
            router.updateParams({ language: null });
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        async function addToWatchlist(contentId) {
            try {
                await api.recordInteraction(contentId, Config.INTERACTIONS.WATCHLIST);
                showToast('Added to watchlist', 'success');
            } catch (error) {
                showToast('Failed to add to watchlist', 'error');
            }
        }

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast toast--${type} animate-slideInRight`;
            toast.innerHTML = `
                <i class="bi bi-${type === 'success' ? 'check-circle' : type === 'error' ? 'x-circle' : 'info-circle'} toast__icon"></i>
                <span class="toast__message">${message}</span>
                <i class="bi bi-x toast__close" onclick="this.parentElement.remove()"></i>
            `;

            document.getElementById('toastContainer').appendChild(toast);
            setTimeout(() => toast.classList.add('toast--visible'), 10);
            setTimeout(() => toast.remove(), 5000);
        }
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="en" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Discover regional cinema on CineBrain - Hindi, Telugu, Tamil, Kannada, Malayalam movies and shows">
    <meta name="keywords" content="regional movies, bollywood, tollywood, kollywood, regional cinema">

    <title>Regional Cinema - CineBrain</title>

    <!-- CSS Files -->
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/components.css">
    <link rel="stylesheet" href="/css/layouts.css">
    <link rel="stylesheet" href="/css/animations.css">
    <link rel="stylesheet" href="/css/responsive.css">
    <link rel="stylesheet" href="/css/theme.css">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/assets/favicon.svg">
</head>

<body>
    <!-- Fixed Topbar -->
    <div id="topbarContainer"></div>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Regional Hero Section -->
        <section class="hero-section py-5"
            style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(139, 92, 246, 0.1) 50%, rgba(239, 68, 68, 0.1) 100%);">
            <div class="container">
                <div class="text-center mb-5">
                    <h1 class="display-4 fw-bold text-white mb-3">
                        <i class="fas fa-globe-asia text-success me-3"></i>
                        Regional Cinema
                    </h1>
                    <p class="lead text-muted">Explore the rich diversity of Indian cinema</p>
                </div>

                <!-- Language Selector -->
                <div class="language-selector d-flex flex-wrap justify-content-center gap-3 mb-5">
                    <div class="language-card" onclick="selectLanguage('hindi')" data-language="hindi">
                        <div class="language-card-inner">
                            <h3 class="language-name">हिंदी</h3>
                            <p class="language-title">Hindi</p>
                            <span class="language-industry">Bollywood</span>
                        </div>
                    </div>
                    <div class="language-card" onclick="selectLanguage('telugu')" data-language="telugu">
                        <div class="language-card-inner">
                            <h3 class="language-name">తెలుగు</h3>
                            <p class="language-title">Telugu</p>
                            <span class="language-industry">Tollywood</span>
                        </div>
                    </div>
                    <div class="language-card" onclick="selectLanguage('tamil')" data-language="tamil">
                        <div class="language-card-inner">
                            <h3 class="language-name">தமிழ்</h3>
                            <p class="language-title">Tamil</p>
                            <span class="language-industry">Kollywood</span>
                        </div>
                    </div>
                    <div class="language-card" onclick="selectLanguage('kannada')" data-language="kannada">
                        <div class="language-card-inner">
                            <h3 class="language-name">ಕನ್ನಡ</h3>
                            <p class="language-title">Kannada</p>
                            <span class="language-industry">Sandalwood</span>
                        </div>
                    </div>
                    <div class="language-card" onclick="selectLanguage('malayalam')" data-language="malayalam">
                        <div class="language-card-inner">
                            <h3 class="language-name">മലയാളം</h3>
                            <p class="language-title">Malayalam</p>
                            <span class="language-industry">Mollywood</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Selected Language Content -->
        <section id="languageContentSection" class="py-5 d-none">
            <div class="container">
                <!-- Language Header -->
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div>
                        <h2 class="h3 text-white fw-bold mb-2" id="selectedLanguageTitle">
                            <i class="fas fa-film text-primary me-2"></i>
                            Loading...
                        </h2>
                        <p class="text-muted" id="selectedLanguageDescription">Loading description...</p>
                    </div>
                    <button class="btn btn-outline-secondary" onclick="showLanguageSelector()">
                        <i class="fas fa-arrow-left me-1"></i>Change Language
                    </button>
                </div>

                <!-- Trending in Language -->
                <div class="mb-5">
                    <h3 class="h4 text-white mb-3">
                        <i class="fas fa-fire text-warning me-2"></i>
                        Trending Now
                    </h3>
                    <div id="trendingRegionalContainer" class="row">
                        <div class="col-12 text-center py-4">
                            <div class="loading-spinner mx-auto mb-3"></div>
                            <p class="text-muted">Loading trending content...</p>
                        </div>
                    </div>
                </div>

                <!-- New Releases -->
                <div class="mb-5">
                    <h3 class="h4 text-white mb-3">
                        <i class="fas fa-sparkles text-info me-2"></i>
                        New Releases
                    </h3>
                    <div id="newRegionalContainer" class="row">
                        <div class="col-12 text-center py-4">
                            <div class="loading-spinner mx-auto mb-3"></div>
                            <p class="text-muted">Loading new releases...</p>
                        </div>
                    </div>
                </div>

                <!-- Top Rated -->
                <div class="mb-5">
                    <h3 class="h4 text-white mb-3">
                        <i class="fas fa-star text-warning me-2"></i>
                        Top Rated
                    </h3>
                    <div id="topRatedRegionalContainer" class="row">
                        <div class="col-12 text-center py-4">
                            <div class="loading-spinner mx-auto mb-3"></div>
                            <p class="text-muted">Loading top rated content...</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- All Regional Content -->
        <section id="allRegionalSection" class="py-5">
            <div class="container">
                <h2 class="h3 text-white fw-bold mb-4">
                    <i class="fas fa-th text-primary me-2"></i>
                    Explore All Regional Content
                </h2>

                <!-- Quick Stats -->
                <div class="row mb-5">
                    <div class="col-md-2 col-6 mb-3">
                        <div class="stat-card text-center">
                            <h4 class="text-primary mb-1">5</h4>
                            <p class="text-muted small mb-0">Languages</p>
                        </div>
                    </div>
                    <div class="col-md-2 col-6 mb-3">
                        <div class="stat-card text-center">
                            <h4 class="text-success mb-1" id="totalMoviesCount">0</h4>
                            <p class="text-muted small mb-0">Movies</p>
                        </div>
                    </div>
                    <div class="col-md-2 col-6 mb-3">
                        <div class="stat-card text-center">
                            <h4 class="text-warning mb-1" id="totalShowsCount">0</h4>
                            <p class="text-muted small mb-0">TV Shows</p>
                        </div>
                    </div>
                    <div class="col-md-2 col-6 mb-3">
                        <div class="stat-card text-center">
                            <h4 class="text-info mb-1" id="newReleasesCount">0</h4>
                            <p class="text-muted small mb-0">New This Month</p>
                        </div>
                    </div>
                    <div class="col-md-2 col-6 mb-3">
                        <div class="stat-card text-center">
                            <h4 class="text-danger mb-1" id="trendingCount">0</h4>
                            <p class="text-muted small mb-0">Trending</p>
                        </div>
                    </div>
                    <div class="col-md-2 col-6 mb-3">
                        <div class="stat-card text-center">
                            <h4 class="text-secondary mb-1" id="topRatedCount">0</h4>
                            <p class="text-muted small mb-0">Top Rated</p>
                        </div>
                    </div>
                </div>

                <!-- Mixed Regional Content -->
                <div id="mixedRegionalContainer" class="row">
                    <div class="col-12 text-center py-4">
                        <div class="loading-spinner mx-auto mb-3"></div>
                        <p class="text-muted">Loading regional content...</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Mobile Navigation -->
    <div id="mobileNavContainer"></div>

    <!-- JavaScript Files -->
    <script src="/js/config.js"></script>
    <script src="/js/api.js"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/app.js"></script>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Page-specific JavaScript -->
    <script>
        (function () {
            let currentLanguage = '';
            let regionalStats = {
                totalMovies: 0,
                totalShows: 0,
                newReleases: 0,
                trending: 0,
                topRated: 0
            };

            const languageInfo = {
                'hindi': {
                    name: 'Hindi',
                    nativeName: 'हिंदी',
                    industry: 'Bollywood',
                    description: 'The largest film industry in India, known for its vibrant musicals and dramatic storytelling',
                    color: 'warning'
                },
                'telugu': {
                    name: 'Telugu',
                    nativeName: 'తెలుగు',
                    industry: 'Tollywood',
                    description: 'Known for grand spectacles, action-packed entertainers, and emotional family dramas',
                    color: 'primary'
                },
                'tamil': {
                    name: 'Tamil',
                    nativeName: 'தமிழ்',
                    industry: 'Kollywood',
                    description: 'Celebrated for innovative storytelling, technical excellence, and social themes',
                    color: 'danger'
                },
                'kannada': {
                    name: 'Kannada',
                    nativeName: 'ಕನ್ನಡ',
                    industry: 'Sandalwood',
                    description: 'Growing industry with diverse content ranging from art films to commercial entertainers',
                    color: 'success'
                },
                'malayalam': {
                    name: 'Malayalam',
                    nativeName: 'മലയാളം',
                    industry: 'Mollywood',
                    description: 'Renowned for realistic cinema, strong narratives, and exceptional performances',
                    color: 'info'
                }
            };

            // Initialize regional page
            async function initRegionalPage() {
                try {
                    await loadComponents();
                    const urlParams = new URLSearchParams(window.location.search);
                    const language = urlParams.get('language');

                    if (language && languageInfo[language]) {
                        selectLanguage(language);
                    } else {
                        showLanguageSelector();
                        await loadMixedRegionalContent();
                    }

                    updateStats();
                } catch (error) {
                    console.error('Regional page initialization failed:', error);
                }
            }

            // Load reusable components
            async function loadComponents() {
                try {
                    // Load topbar
                    const topbarResponse = await fetch('/components/layout/topbar.html');
                    const topbarHTML = await topbarResponse.text();
                    document.getElementById('topbarContainer').innerHTML = topbarHTML;

                    // Load mobile navigation
                    const mobileNavResponse = await fetch('/components/layout/mobile-nav.html');
                    const mobileNavHTML = await mobileNavResponse.text();
                    document.getElementById('mobileNavContainer').innerHTML = mobileNavHTML;

                    // Execute component scripts
                    const scripts = document.querySelectorAll('#topbarContainer script, #mobileNavContainer script');
                    scripts.forEach(script => {
                        const newScript = document.createElement('script');
                        newScript.textContent = script.textContent;
                        document.head.appendChild(newScript);
                    });
                } catch (error) {
                    console.error('Failed to load components:', error);
                }
            }

            // Select language
            window.selectLanguage = async function (language) {
                if (!languageInfo[language]) return;

                currentLanguage = language;

                // Update URL
                const newUrl = new URL(window.location);
                newUrl.searchParams.set('language', language);
                window.history.pushState({}, '', newUrl);

                // Update UI
                hideLanguageSelector();
                showLanguageContent();

                // Update language header
                const info = languageInfo[language];
                document.getElementById('selectedLanguageTitle').innerHTML = `
                <i class="fas fa-film text-${info.color} me-2"></i>
                ${info.name} Cinema (${info.industry})
            `;
                document.getElementById('selectedLanguageDescription').textContent = info.description;

                // Load content for selected language
                await Promise.all([
                    loadTrendingRegional(language),
                    loadNewRegional(language),
                    loadTopRatedRegional(language)
                ]);
            };

            // Show language selector
            window.showLanguageSelector = function () {
                document.querySelector('.language-selector').parentElement.parentElement.style.display = 'block';
                document.getElementById('languageContentSection').classList.add('d-none');
                document.getElementById('allRegionalSection').style.display = 'block';

                // Clear URL parameter
                const newUrl = new URL(window.location);
                newUrl.searchParams.delete('language');
                window.history.pushState({}, '', newUrl);

                currentLanguage = '';
            };

            // Hide language selector
            function hideLanguageSelector() {
                document.querySelector('.language-selector').parentElement.parentElement.style.display = 'none';
            }

            // Show language content
            function showLanguageContent() {
                document.getElementById('languageContentSection').classList.remove('d-none');
                document.getElementById('allRegionalSection').style.display = 'none';
            }

            // Load trending regional content
            async function loadTrendingRegional(language) {
                const container = document.getElementById('trendingRegionalContainer');

                try {
                    const trendingData = await window.api.getRecommendations('regional', {
                        language: language,
                        category: 'trending',
                        limit: 12
                    });

                    if (trendingData && trendingData.length > 0) {
                        const contentHTML = await renderRegionalContent(trendingData);
                        container.innerHTML = contentHTML;
                        initializeContentCards(container);
                        regionalStats.trending += trendingData.length;
                    } else {
                        showNoContent(container, 'No trending content available');
                    }
                } catch (error) {
                    console.error('Failed to load trending regional content:', error);
                    showErrorState(container);
                }
            }

            // Load new regional releases
            async function loadNewRegional(language) {
                const container = document.getElementById('newRegionalContainer');

                try {
                    const newData = await window.api.getRecommendations('new_releases', {
                        language: language,
                        limit: 8
                    });

                    if (newData && newData.length > 0) {
                        const contentHTML = await renderRegionalContent(newData, 'col-6 col-md-3');
                        container.innerHTML = contentHTML;
                        initializeContentCards(container);
                        regionalStats.newReleases += newData.length;
                    } else {
                        showNoContent(container, 'No new releases available');
                    }
                } catch (error) {
                    console.error('Failed to load new regional releases:', error);
                    showErrorState(container);
                }
            }

            // Load top rated regional content
            async function loadTopRatedRegional(language) {
                const container = document.getElementById('topRatedRegionalContainer');

                try {
                    const topRatedData = await window.api.getRecommendations('critics_choice', {
                        language: language,
                        limit: 8
                    });

                    if (topRatedData && topRatedData.length > 0) {
                        const contentHTML = await renderRegionalContent(topRatedData, 'col-6 col-md-3');
                        container.innerHTML = contentHTML;
                        initializeContentCards(container);
                        regionalStats.topRated += topRatedData.length;
                    } else {
                        showNoContent(container, 'No top rated content available');
                    }
                } catch (error) {
                    console.error('Failed to load top rated regional content:', error);
                    showErrorState(container);
                }
            }

            // Load mixed regional content
            async function loadMixedRegionalContent() {
                const container = document.getElementById('mixedRegionalContainer');

                try {
                    const promises = Object.keys(languageInfo).map(lang =>
                        window.api.getRecommendations('regional', {
                            language: lang,
                            limit: 6
                        })
                    );

                    const results = await Promise.all(promises);
                    const allContent = results.flat();

                    if (allContent.length > 0) {
                        // Shuffle content
                        const shuffled = allContent.sort(() => Math.random() - 0.5);
                        const contentHTML = await renderRegionalContent(shuffled);
                        container.innerHTML = contentHTML;
                        initializeContentCards(container);

                        // Update stats
                        allContent.forEach(item => {
                            if (item.content_type === 'movie') regionalStats.totalMovies++;
                            else if (item.content_type === 'tv') regionalStats.totalShows++;
                        });

                        updateStats();
                    } else {
                        showNoContent(container, 'No regional content available');
                    }
                } catch (error) {
                    console.error('Failed to load mixed regional content:', error);
                    showErrorState(container);
                }
            }

            // Render regional content
            async function renderRegionalContent(contentData, colClass = 'col-6 col-md-4 col-lg-3 col-xl-2') {
                return contentData.map((item, index) => {
                    const langInfo = Object.entries(languageInfo).find(([key, info]) =>
                        item.languages && item.languages.some(lang =>
                            lang.toLowerCase().includes(key) || lang.toLowerCase().includes(info.name.toLowerCase())
                        )
                    );

                    const langColor = langInfo ? languageInfo[langInfo[0]].color : 'secondary';
                    const langName = langInfo ? languageInfo[langInfo[0]].name : 'Regional';

                    return `
                    <div class="${colClass} mb-4 content-card-wrapper" style="animation-delay: ${index * 0.05}s;">
                        <div class="content-card card bg-dark border-${langColor} border-opacity-25 h-100" 
                             onclick="viewContentDetails(${item.id})"
                             style="cursor: pointer; transition: all 0.3s ease;">
                            <div class="position-relative overflow-hidden">
                                <img src="${item.poster_path || '/assets/no-poster.jpg'}" 
                                     class="card-img-top" 
                                     style="height: 300px; object-fit: cover;" 
                                     alt="${item.title}"
                                     loading="lazy"
                                     onerror="this.src='/assets/no-poster.jpg'">
                                
                                <!-- Language Badge -->
                                <div class="position-absolute top-0 start-0 m-2">
                                    <span class="badge bg-${langColor}">
                                        ${langName}
                                    </span>
                                </div>
                                
                                <!-- Rating Badge -->
                                ${item.rating ? `
                                    <div class="position-absolute top-0 end-0 m-2">
                                        <span class="badge bg-warning text-dark">
                                            <i class="fas fa-star"></i> ${parseFloat(item.rating).toFixed(1)}
                                        </span>
                                    </div>
                                ` : ''}
                            </div>
                            
                            <div class="card-body p-3">
                                <h6 class="card-title text-white fw-semibold mb-2" 
                                    style="overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">
                                    ${item.title}
                                </h6>
                                
                                ${item.original_title && item.original_title !== item.title ? `
                                    <p class="text-muted small mb-2">
                                        ${item.original_title}
                                    </p>
                                ` : ''}
                                
                                ${item.genres && item.genres.length > 0 ? `
                                    <div class="mb-2">
                                        ${item.genres.slice(0, 2).map(genre =>
                        `<span class="badge bg-secondary me-1 mb-1" style="font-size: 0.7rem;">${genre}</span>`
                    ).join('')}
                                    </div>
                                ` : ''}
                                
                                <div class="d-flex gap-2 mt-auto">
                                    <button class="btn btn-${langColor} btn-sm flex-grow-1" onclick="event.stopPropagation(); viewContentDetails(${item.id})">
                                        <i class="fas fa-info-circle me-1"></i>Details
                                    </button>
                                    <button class="btn btn-outline-danger btn-sm" onclick="event.stopPropagation(); toggleFavorite(${item.id}, this)">
                                        <i class="fas fa-heart"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                }).join('');
            }

            // Initialize content cards
            function initializeContentCards(container) {
                const cards = container.querySelectorAll('.content-card');
                cards.forEach(card => {
                    card.addEventListener('mouseenter', function () {
                        this.style.transform = 'translateY(-8px) scale(1.02)';
                        this.style.boxShadow = '0 15px 35px rgba(59, 130, 246, 0.3)';
                    });

                    card.addEventListener('mouseleave', function () {
                        this.style.transform = 'translateY(0) scale(1)';
                        this.style.boxShadow = '';
                    });
                });

                // Add stagger animation
                const wrappers = container.querySelectorAll('.content-card-wrapper');
                wrappers.forEach((wrapper, index) => {
                    setTimeout(() => {
                        wrapper.classList.add('fade-in-up');
                    }, index * 30);
                });
            }

            // Update statistics
            function updateStats() {
                document.getElementById('totalMoviesCount').textContent = regionalStats.totalMovies;
                document.getElementById('totalShowsCount').textContent = regionalStats.totalShows;
                document.getElementById('newReleasesCount').textContent = regionalStats.newReleases;
                document.getElementById('trendingCount').textContent = regionalStats.trending;
                document.getElementById('topRatedCount').textContent = regionalStats.topRated;
            }

            // Show no content
            function showNoContent(container, message) {
                container.innerHTML = `
                <div class="col-12 text-center py-4">
                    <i class="fas fa-film text-muted mb-2" style="font-size: 2rem;"></i>
                    <p class="text-muted">${message}</p>
                </div>
            `;
            }

            // Show error state
            function showErrorState(container) {
                container.innerHTML = `
                <div class="col-12 text-center py-4">
                    <i class="fas fa-exclamation-triangle text-warning mb-2" style="font-size: 2rem;"></i>
                    <p class="text-muted">Failed to load content. Please try again.</p>
                </div>
            `;
            }

            // Global functions
            window.viewContentDetails = function (contentId) {
                window.location.href = `/content/details.html?id=${contentId}`;
            };

            window.toggleFavorite = async function (contentId, button) {
                try {
                    if (!window.auth || !window.auth.isAuthenticated()) {
                        window.location.href = '/auth/login.html';
                        return;
                    }

                    await window.api.recordInteraction(contentId, 'favorite');

                    const icon = button.querySelector('i');
                    icon.classList.add('heart-beat');
                    button.classList.toggle('btn-outline-danger');
                    button.classList.toggle('btn-danger');

                    setTimeout(() => {
                        icon.classList.remove('heart-beat');
                    }, 600);

                    if (window.showToast) {
                        window.showToast('Added to favorites!', 'success');
                    }
                } catch (error) {
                    console.error('Failed to toggle favorite:', error);
                    if (window.showToast) {
                        window.showToast('Failed to update favorites', 'error');
                    }
                }
            };

            // Initialize when DOM is ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initRegionalPage);
            } else {
                initRegionalPage();
            }
        })();
    </script>

    <!-- Regional-specific Styles -->
    <style>
        .language-card {
            background: linear-gradient(135deg, rgba(20, 20, 24, 0.9) 0%, rgba(30, 30, 35, 0.8) 100%);
            border-radius: 1rem;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            min-width: 150px;
        }

        .language-card:hover {
            transform: translateY(-8px) scale(1.05);
            box-shadow: 0 15px 35px rgba(59, 130, 246, 0.3);
            border-color: rgba(59, 130, 246, 0.5);
        }

        .language-card[data-language="hindi"]:hover {
            border-color: var(--vip-gold);
            box-shadow: 0 15px 35px rgba(245, 158, 11, 0.3);
        }

        .language-card[data-language="telugu"]:hover {
            border-color: var(--platinum-blue);
            box-shadow: 0 15px 35px rgba(59, 130, 246, 0.3);
        }

        .language-card[data-language="tamil"]:hover {
            border-color: var(--danger-red);
            box-shadow: 0 15px 35px rgba(239, 68, 68, 0.3);
        }

        .language-card[data-language="kannada"]:hover {
            border-color: var(--critic-green);
            box-shadow: 0 15px 35px rgba(16, 185, 129, 0.3);
        }

        .language-card[data-language="malayalam"]:hover {
            border-color: var(--info-cyan);
            box-shadow: 0 15px 35px rgba(6, 182, 212, 0.3);
        }

        .language-name {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            color: white;
        }

        .language-title {
            font-size: 1.2rem;
            margin-bottom: 0.25rem;
            color: rgba(255, 255, 255, 0.8);
        }

        .language-industry {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.6);
            font-style: italic;
        }

        .stat-card {
            background: rgba(20, 20, 24, 0.8);
            padding: 1.5rem;
            border-radius: 0.75rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }

        .content-card-wrapper {
            opacity: 0;
        }

        .content-card-wrapper.fade-in-up {
            animation: fadeInUp 0.6s ease-out forwards;
        }

        @media (max-width: 576px) {
            .language-card {
                min-width: 120px;
                padding: 1.5rem 1rem;
            }

            .language-name {
                font-size: 1.5rem;
            }

            .language-title {
                font-size: 1rem;
            }
        }
    </style>
</body>

</html>
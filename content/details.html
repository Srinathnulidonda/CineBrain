<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Content Details - CineScope</title>
    <meta name="description" content="Detailed information about movies, TV shows, and anime on CineScope.">
    
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/components.css">
    <link rel="stylesheet" href="/css/layouts.css">
    <link rel="stylesheet" href="/css/animations.css">
    <link rel="stylesheet" href="/css/responsive.css">
    <link rel="stylesheet" href="/css/theme.css">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Fixed Top Bar -->
    <header class="topbar" id="topbar">
        <div class="topbar-logo" onclick="window.location.href='/'">
            CineScope
        </div>
        
        <div class="topbar-search">
            <div class="search-icon">üîç</div>
            <input type="text" class="search-input" placeholder="Search..." />
        </div>
        
        <div class="topbar-actions">
            <button class="theme-toggle" title="Toggle theme" onclick="toggleTheme()"></button>
            <img class="user-avatar user-only-show" style="display: none;" alt="User Avatar" />
            <button class="login-btn user-only-hide" onclick="window.location.href='/auth/login.html'">Sign In</button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="detail-layout">
            <!-- Loading State -->
            <div id="loadingState" class="detail-loading">
                <div class="loading-spinner animate-spin"></div>
                <p>Loading content details...</p>
            </div>

            <!-- Error State -->
            <div id="errorState" class="detail-error" style="display: none;">
                <div class="error-icon">‚ö†Ô∏è</div>
                <h2>Content Not Found</h2>
                <p>The content you're looking for could not be found or may have been removed.</p>
                <div class="error-actions">
                    <button class="btn btn-primary" onclick="window.history.back()">Go Back</button>
                    <button class="btn btn-outline" onclick="window.location.href='/'">Home</button>
                </div>
            </div>

            <!-- Content Details -->
            <div id="contentDetails" style="display: none;">
                <!-- Hero Section -->
                <div class="detail-hero" id="detailHero">
                    <div class="detail-hero-overlay"></div>
                    <div class="detail-hero-content">
                        <div class="hero-meta" id="heroMeta"></div>
                        <h1 class="hero-title" id="heroTitle"></h1>
                        <div class="hero-rating" id="heroRating"></div>
                        <p class="hero-overview" id="heroOverview"></p>
                        <div class="hero-actions" id="heroActions"></div>
                    </div>
                </div>

                <!-- Main Content -->
                <div class="detail-content">
                    <div class="detail-main">
                        <!-- Synopsis Section -->
                        <section class="detail-section" id="synopsisSection">
                            <h2>Synopsis</h2>
                            <div class="synopsis-content" id="synopsisContent"></div>
                        </section>

                        <!-- Cast & Crew Section -->
                        <section class="detail-section" id="castSection" style="display: none;">
                            <h2>Cast & Crew</h2>
                            <div class="cast-tabs">
                                <button class="tab-btn active" data-tab="cast">Cast</button>
                                <button class="tab-btn" data-tab="crew">Crew</button>
                            </div>
                            <div class="cast-content">
                                <div id="castGrid" class="cast-grid"></div>
                                <div id="crewGrid" class="crew-grid" style="display: none;"></div>
                            </div>
                        </section>

                        <!-- Similar Content Section -->
                        <section class="detail-section" id="similarSection" style="display: none;">
                            <h2>More Like This</h2>
                            <div class="similar-grid" id="similarGrid"></div>
                        </section>

                        <!-- Reviews Section (placeholder for future implementation) -->
                        <section class="detail-section" id="reviewsSection" style="display: none;">
                            <h2>User Reviews</h2>
                            <div class="reviews-container" id="reviewsContainer">
                                <p class="reviews-placeholder">User reviews feature coming soon!</p>
                            </div>
                        </section>
                    </div>

                    <!-- Sidebar -->
                    <div class="detail-sidebar">
                        <div class="sidebar-content">
                            <!-- Poster -->
                            <div class="sidebar-poster" id="sidebarPoster"></div>

                            <!-- Quick Info -->
                            <div class="quick-info" id="quickInfo"></div>

                            <!-- Actions -->
                            <div class="sidebar-actions" id="sidebarActions"></div>

                            <!-- Additional Info -->
                            <div class="additional-info" id="additionalInfo"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Fixed Bottom Navigation (Mobile) -->
    <nav class="mobile-nav">
        <a href="/" class="mobile-nav-item">
            <div class="mobile-nav-icon">üè†</div>
            <span>Home</span>
        </a>
        <a href="/content/search.html" class="mobile-nav-item">
            <div class="mobile-nav-icon">üîç</div>
            <span>Search</span>
        </a>
        <a href="/user/watchlist.html" class="mobile-nav-item user-only-show" style="display: none;">
            <div class="mobile-nav-icon">üìã</div>
            <span>Watchlist</span>
        </a>
        <a href="/user/favorites.html" class="mobile-nav-item user-only-show" style="display: none;">
            <div class="mobile-nav-icon">‚ù§Ô∏è</div>
            <span>Favorites</span>
        </a>
        <a href="#" class="mobile-nav-item" onclick="handleProfileClick()">
            <div class="mobile-nav-icon">üë§</div>
            <span>Profile</span>
        </a>
    </nav>

    <!-- Toast Container -->
    <div class="toast-container"></div>

    <script type="module">
        import apiClient from '/js/api.js';
        import authManager from '/js/auth.js';

        // Page state
        let currentContent = null;
        let contentId = null;

        // DOM elements
        const loadingState = document.getElementById('loadingState');
        const errorState = document.getElementById('errorState');
        const contentDetails = document.getElementById('contentDetails');

        // Show toast function
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type} show`;
            toast.innerHTML = `
                <div class="toast-content">
                    <span class="toast-message">${message}</span>
                    <button class="toast-close" onclick="this.parentElement.parentElement.remove()">&times;</button>
                </div>
            `;
            document.querySelector('.toast-container').appendChild(toast);
            
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.classList.remove('show');
                    setTimeout(() => toast.remove(), 200);
                }
            }, 3000);
        }

        // Get content ID from URL
        function getContentIdFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('id');
        }

        // Load content details
        async function loadContentDetails(id) {
            try {
                showLoading();
                
                // Real API call to get content details
                const content = await apiClient.getContentDetails(id);
                
                if (!content) {
                    showError();
                    return;
                }

                currentContent = content;
                
                // Update page title
                document.title = `${content.title} - CineScope`;
                
                // Update meta description
                const metaDesc = document.querySelector('meta[name="description"]');
                if (metaDesc && content.overview) {
                    metaDesc.content = content.overview.substring(0, 150) + '...';
                }

                // Display content
                displayContent(content);
                
                // Load similar content
                loadSimilarContent(id);
                
                // Record view interaction if user is logged in
                if (authManager.isLoggedIn()) {
                    try {
                        await apiClient.recordInteraction(authManager.getToken(), {
                            content_id: id,
                            interaction_type: 'view'
                        });
                    } catch (error) {
                        console.log('Failed to record interaction:', error);
                    }
                }

            } catch (error) {
                console.error('Error loading content details:', error);
                showError();
            }
        }

        // Display content details
        function displayContent(content) {
            // Hide loading, show content
            loadingState.style.display = 'none';
            errorState.style.display = 'none';
            contentDetails.style.display = 'block';

            // Update hero section
            updateHeroSection(content);
            
            // Update sidebar
            updateSidebar(content);
            
            // Update synopsis
            updateSynopsis(content);
            
            // Update cast & crew
            updateCastAndCrew(content);
            
            // Show sections
            document.getElementById('synopsisSection').style.display = 'block';
            if (content.cast && content.cast.length > 0) {
                document.getElementById('castSection').style.display = 'block';
            }
        }

        // Update hero section
        function updateHeroSection(content) {
            const hero = document.getElementById('detailHero');
            const backdropUrl = content.backdrop_path || content.poster_path;
            
            if (backdropUrl) {
                hero.style.backgroundImage = `url('${backdropUrl}')`;
            }

            // Meta information
            const metaItems = [];
            if (content.release_date) {
                metaItems.push(new Date(content.release_date).getFullYear());
            }
            if (content.runtime) {
                metaItems.push(`${content.runtime} min`);
            }
            metaItems.push((content.content_type || 'movie').toUpperCase());
            
            document.getElementById('heroMeta').innerHTML = metaItems.join(' ‚Ä¢ ');
            
            // Title
            document.getElementById('heroTitle').textContent = content.title;
            
            // Rating
            const ratingHtml = content.rating ? 
                `<div class="rating-display">
                    <span class="rating-star">‚òÖ</span>
                    <span class="rating-value">${content.rating.toFixed(1)}</span>
                    <span class="rating-max">/10</span>
                    ${content.vote_count ? `<span class="rating-count">(${content.vote_count.toLocaleString()} votes)</span>` : ''}
                </div>` : '';
            document.getElementById('heroRating').innerHTML = ratingHtml;
            
            // Overview
            document.getElementById('heroOverview').textContent = content.overview || 'No description available.';
            
            // Action buttons
            const actionsHtml = `
                ${content.youtube_trailer ? `
                    <button class="btn btn-primary" onclick="playTrailer('${content.youtube_trailer}')">
                        <i class="icon-play"></i> Play Trailer
                    </button>
                ` : ''}
                <button class="btn btn-secondary" onclick="addToWatchlist(${content.id})">
                    <i class="icon-plus"></i> Add to Watchlist
                </button>
                <button class="btn btn-outline" onclick="addToFavorites(${content.id})">
                    <i class="icon-heart"></i> Favorite
                </button>
            `;
            document.getElementById('heroActions').innerHTML = actionsHtml;
        }

        // Update sidebar
        function updateSidebar(content) {
            // Poster
            const posterUrl = content.poster_path || '/assets/default-poster.jpg';
            document.getElementById('sidebarPoster').innerHTML = `
                <img src="${posterUrl}" alt="${content.title}" class="poster-image" />
            `;

            // Quick info
            const quickInfoItems = [];
            if (content.genres && content.genres.length > 0) {
                quickInfoItems.push(`<div class="info-item"><label>Genres:</label> ${content.genres.join(', ')}</div>`);
            }
            if (content.languages && content.languages.length > 0) {
                quickInfoItems.push(`<div class="info-item"><label>Languages:</label> ${content.languages.join(', ')}</div>`);
            }
            if (content.release_date) {
                quickInfoItems.push(`<div class="info-item"><label>Release Date:</label> ${new Date(content.release_date).toLocaleDateString()}</div>`);
            }
            if (content.content_type === 'anime' && content.anime_genres && content.anime_genres.length > 0) {
                quickInfoItems.push(`<div class="info-item"><label>Anime Type:</label> ${content.anime_genres.join(', ')}</div>`);
            }
            
            document.getElementById('quickInfo').innerHTML = quickInfoItems.join('');

            // Sidebar actions
            const sidebarActionsHtml = `
                <button class="btn btn-outline btn-full" onclick="shareContent()">
                    <i class="icon-share"></i> Share
                </button>
                <button class="btn btn-outline btn-full" onclick="reportContent()">
                    <i class="icon-flag"></i> Report
                </button>
            `;
            document.getElementById('sidebarActions').innerHTML = sidebarActionsHtml;

            // Additional info
            const additionalInfoItems = [];
            if (content.tmdb_id) {
                additionalInfoItems.push(`<div class="info-item"><label>TMDB ID:</label> ${content.tmdb_id}</div>`);
            }
            if (content.mal_id) {
                additionalInfoItems.push(`<div class="info-item"><label>MAL ID:</label> ${content.mal_id}</div>`);
            }
            if (content.is_trending) {
                additionalInfoItems.push(`<div class="badge badge-trending">Trending</div>`);
            }
            if (content.is_new_release) {
                additionalInfoItems.push(`<div class="badge badge-new">New Release</div>`);
            }
            if (content.is_critics_choice) {
                additionalInfoItems.push(`<div class="badge badge-critics">Critics' Choice</div>`);
            }
            
            document.getElementById('additionalInfo').innerHTML = additionalInfoItems.join('');
        }

        // Update synopsis section
        function updateSynopsis(content) {
            const synopsisHtml = content.overview ? 
                `<p class="synopsis-text">${content.overview}</p>` :
                `<p class="synopsis-empty">No synopsis available for this content.</p>`;
            
            document.getElementById('synopsisContent').innerHTML = synopsisHtml;
        }

        // Update cast and crew
        function updateCastAndCrew(content) {
            const castGrid = document.getElementById('castGrid');
            const crewGrid = document.getElementById('crewGrid');

            // Cast
            if (content.cast && content.cast.length > 0) {
                const castHtml = content.cast.slice(0, 12).map(person => `
                    <div class="cast-member">
                        <div class="cast-photo">
                            <img src="${person.profile_path ? `https://image.tmdb.org/t/p/w185${person.profile_path}` : '/assets/default-avatar.jpg'}" 
                                 alt="${person.name}" loading="lazy" />
                        </div>
                        <div class="cast-info">
                            <div class="cast-name">${person.name}</div>
                            <div class="cast-character">${person.character || person.job || ''}</div>
                        </div>
                    </div>
                `).join('');
                castGrid.innerHTML = castHtml;
            } else {
                castGrid.innerHTML = '<p class="cast-empty">No cast information available.</p>';
            }

            // Crew
            if (content.crew && content.crew.length > 0) {
                const crewHtml = content.crew.slice(0, 8).map(person => `
                    <div class="crew-member">
                        <div class="crew-photo">
                            <img src="${person.profile_path ? `https://image.tmdb.org/t/p/w185${person.profile_path}` : '/assets/default-avatar.jpg'}" 
                                 alt="${person.name}" loading="lazy" />
                        </div>
                        <div class="crew-info">
                            <div class="crew-name">${person.name}</div>
                            <div class="crew-job">${person.job || person.character || ''}</div>
                        </div>
                    </div>
                `).join('');
                crewGrid.innerHTML = crewHtml;
            } else {
                crewGrid.innerHTML = '<p class="crew-empty">No crew information available.</p>';
            }

            // Tab functionality
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    // Remove active class from all tabs
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    document.querySelectorAll('.cast-grid, .crew-grid').forEach(g => g.style.display = 'none');
                    
                    // Activate clicked tab
                    btn.classList.add('active');
                    const tab = btn.dataset.tab;
                    document.getElementById(tab + 'Grid').style.display = 'grid';
                });
            });
        }

        // Load similar content
        async function loadSimilarContent(contentId) {
            try {
                const similarResponse = await apiClient.getSimilarContent(contentId, { limit: 8 });
                
                if (similarResponse && similarResponse.recommendations && similarResponse.recommendations.length > 0) {
                    const similarHtml = similarResponse.recommendations.map(item => createSimilarCard(item)).join('');
                    document.getElementById('similarGrid').innerHTML = similarHtml;
                    document.getElementById('similarSection').style.display = 'block';
                }
            } catch (error) {
                console.error('Error loading similar content:', error);
            }
        }

        // Create similar content card
        function createSimilarCard(item) {
            const posterUrl = item.poster_path || '/assets/default-poster.jpg';
            const rating = item.rating ? `‚òÖ ${item.rating.toFixed(1)}` : '';
            
            return `
                <div class="similar-card" onclick="loadContentDetails(${item.id})">
                    <div class="similar-poster">
                        <img src="${posterUrl}" alt="${item.title}" loading="lazy" />
                        <div class="similar-overlay">
                            <button class="similar-play">‚ñ∂</button>
                        </div>
                    </div>
                    <div class="similar-info">
                        <h4 class="similar-title">${item.title}</h4>
                        <div class="similar-meta">
                            ${rating}
                            <span class="similar-type">${(item.content_type || 'movie').toUpperCase()}</span>
                        </div>
                    </div>
                </div>
            `;
        }

        // Action functions
        window.playTrailer = function(trailerUrl) {
            if (trailerUrl.includes('youtube.com/watch?v=')) {
                const videoId = trailerUrl.split('v=')[1].split('&')[0];
                const embedUrl = `https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0`;
                
                // Create trailer modal
                const modal = document.createElement('div');
                modal.className = 'modal show';
                modal.innerHTML = `
                    <div class="modal-backdrop" onclick="this.parentElement.remove()"></div>
                    <div class="modal-dialog">
                        <div class="trailer-modal">
                            <button class="modal-close" onclick="this.parentElement.parentElement.parentElement.remove()">&times;</button>
                            <div class="trailer-container">
                                <iframe src="${embedUrl}" frameborder="0" allowfullscreen></iframe>
                            </div>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            } else {
                window.open(trailerUrl, '_blank');
            }
        };

        window.addToWatchlist = async function(contentId) {
            if (!authManager.isLoggedIn()) {
                showToast('Please sign in to add to watchlist', 'warning');
                return;
            }
            
            try {
                await apiClient.recordInteraction(authManager.getToken(), {
                    content_id: contentId,
                    interaction_type: 'watchlist'
                });
                showToast('Added to watchlist', 'success');
            } catch (error) {
                showToast('Failed to add to watchlist', 'error');
            }
        };

        window.addToFavorites = async function(contentId) {
            if (!authManager.isLoggedIn()) {
                showToast('Please sign in to add to favorites', 'warning');
                return;
            }
            
            try {
                await apiClient.recordInteraction(authManager.getToken(), {
                    content_id: contentId,
                    interaction_type: 'favorite'
                });
                showToast('Added to favorites', 'success');
            } catch (error) {
                showToast('Failed to add to favorites', 'error');
            }
        };

        window.shareContent = function() {
            if (navigator.share && currentContent) {
                navigator.share({
                    title: currentContent.title,
                    text: currentContent.overview || `Check out ${currentContent.title} on CineScope`,
                    url: window.location.href
                });
            } else {
                // Fallback to clipboard
                navigator.clipboard.writeText(window.location.href).then(() => {
                    showToast('Link copied to clipboard', 'success');
                }).catch(() => {
                    showToast('Failed to copy link', 'error');
                });
            }
        };

        window.reportContent = function() {
            showToast('Content reported. Thank you for your feedback.', 'info');
        };

        // Utility functions
        function showLoading() {
            loadingState.style.display = 'flex';
            errorState.style.display = 'none';
            contentDetails.style.display = 'none';
        }

        function showError() {
            loadingState.style.display = 'none';
            errorState.style.display = 'flex';
            contentDetails.style.display = 'none';
        }

        // Theme toggle
        window.toggleTheme = function() {
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'dark';
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('cinescope_theme', newTheme);
        };

        // Handle profile click
        window.handleProfileClick = function() {
            if (authManager.isLoggedIn()) {
                const username = authManager.getUser().username;
                window.location.href = `/${username}/profile`;
            } else {
                window.location.href = '/auth/login.html';
            }
        };

        // Update auth UI
        function updateAuthUI() {
            const isLoggedIn = authManager.isLoggedIn();
            
            document.querySelectorAll('.user-only-show').forEach(el => {
                el.style.display = isLoggedIn ? 'block' : 'none';
            });
            
            document.querySelectorAll('.user-only-hide').forEach(el => {
                el.style.display = isLoggedIn ? 'none' : 'block';
            });

            if (isLoggedIn) {
                const user = authManager.getUser();
                const avatar = document.querySelector('.user-avatar');
                if (avatar) {
                    avatar.src = `https://ui-avatars.com/api/?name=${encodeURIComponent(user.username)}&background=3b82f6&color=fff&size=40`;
                }
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', () => {
            contentId = getContentIdFromUrl();
            
            if (!contentId) {
                showError();
                return;
            }

            updateAuthUI();
            loadContentDetails(contentId);
            
            // Performance mark
            if (performance.mark) {
                performance.mark('details-page-ready');
            }
        });

        // Handle auth state changes
        authManager.onLogin(updateAuthUI);
        authManager.onLogout(updateAuthUI);
    </script>

    <style>
        .detail-loading,
        .detail-error {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 50vh;
            text-align: center;
            padding: var(--spacing-xl);
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid var(--velvet-dark);
            border-top: 3px solid var(--platinum-blue);
            border-radius: 50%;
            margin-bottom: var(--spacing-lg);
        }

        .error-icon {
            font-size: 4rem;
            margin-bottom: var(--spacing-lg);
        }

        .error-actions {
            display: flex;
            gap: var(--spacing-md);
            margin-top: var(--spacing-lg);
        }

        .detail-hero {
            position: relative;
            height: 60vh;
            min-height: 400px;
            background-size: cover;
            background-position: center;
            border-radius: var(--radius-lg);
            overflow: hidden;
            margin-bottom: var(--spacing-xl);
            display: flex;
            align-items: flex-end;
        }

        .detail-hero-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                135deg,
                rgba(0, 0, 0, 0.6) 0%,
                rgba(0, 0, 0, 0.3) 50%,
                rgba(0, 0, 0, 0.8) 100%
            );
        }

        .detail-hero-content {
            position: relative;
            z-index: 2;
            padding: var(--spacing-2xl);
            max-width: 800px;
        }

        .hero-meta {
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin-bottom: var(--spacing-sm);
        }

        .hero-title {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: var(--spacing-md);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .rating-display {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
        }

        .rating-star {
            color: var(--vip-gold);
            font-size: 1.25rem;
        }

        .rating-value {
            font-size: 1.25rem;
            font-weight: 700;
        }

        .rating-max {
            color: var(--text-secondary);
        }

        .rating-count {
            color: var(--text-muted);
            font-size: 0.875rem;
        }

        .hero-overview {
            font-size: 1rem;
            line-height: 1.6;
            margin-bottom: var(--spacing-xl);
            max-width: 600px;
        }

        .hero-actions {
            display: flex;
            gap: var(--spacing-md);
            flex-wrap: wrap;
        }

        .detail-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: var(--spacing-2xl);
            margin-bottom: var(--spacing-xl);
        }

        .detail-section {
            margin-bottom: var(--spacing-2xl);
        }

        .detail-section h2 {
            font-size: 1.5rem;
            margin-bottom: var(--spacing-lg);
        }

        .synopsis-text {
            font-size: 1rem;
            line-height: 1.7;
            color: var(--text-secondary);
        }

        .synopsis-empty,
        .cast-empty,
        .crew-empty {
            color: var(--text-muted);
            font-style: italic;
            text-align: center;
            padding: var(--spacing-xl);
        }

        .cast-tabs {
            display: flex;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-lg);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .tab-btn {
            padding: var(--spacing-sm) var(--spacing-lg);
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 600;
            border-bottom: 2px solid transparent;
            transition: all 0.2s ease;
        }

        .tab-btn.active {
            color: var(--platinum-blue);
            border-bottom-color: var(--platinum-blue);
        }

        .cast-grid,
        .crew-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: var(--spacing-lg);
        }

        .cast-member,
        .crew-member {
            text-align: center;
        }

        .cast-photo,
        .crew-photo {
            width: 80px;
            height: 80px;
            margin: 0 auto var(--spacing-sm);
            border-radius: 50%;
            overflow: hidden;
        }

        .cast-photo img,
        .crew-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .cast-name,
        .crew-name {
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: var(--spacing-xs);
        }

        .cast-character,
        .crew-job {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .similar-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: var(--spacing-lg);
        }

        .similar-card {
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .similar-card:hover {
            transform: translateY(-4px);
        }

        .similar-poster {
            position: relative;
            aspect-ratio: 2/3;
            border-radius: var(--radius-md);
            overflow: hidden;
            margin-bottom: var(--spacing-sm);
        }

        .similar-poster img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .similar-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .similar-card:hover .similar-overlay {
            opacity: 1;
        }

        .similar-play {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--platinum-blue);
            color: white;
            border: none;
            font-size: 1.25rem;
            cursor: pointer;
        }

        .similar-title {
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: var(--spacing-xs);
            line-height: 1.2;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .similar-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .detail-sidebar {
            position: sticky;
            top: calc(70px + var(--spacing-lg));
            height: fit-content;
        }

        .sidebar-content {
            background: var(--theater-dark);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .poster-image {
            width: 100%;
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-lg);
        }

        .quick-info {
            margin-bottom: var(--spacing-lg);
        }

        .info-item {
            margin-bottom: var(--spacing-md);
            font-size: 0.875rem;
        }

        .info-item label {
            font-weight: 600;
            color: var(--text-primary);
        }

        .badge {
            display: inline-block;
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 600;
            margin: var(--spacing-xs) var(--spacing-xs) var(--spacing-xs) 0;
        }

        .badge-trending {
            background: var(--vip-gold);
            color: var(--cinema-black);
        }

        .badge-new {
            background: var(--success);
            color: white;
        }

        .badge-critics {
            background: var(--royal-purple);
            color: white;
        }

        .sidebar-actions {
            margin-bottom: var(--spacing-lg);
        }

        .btn-full {
            width: 100%;
            margin-bottom: var(--spacing-sm);
        }

        .trailer-modal {
            width: 100%;
            max-width: 900px;
            aspect-ratio: 16/9;
            background: black;
            border-radius: var(--radius-lg);
            overflow: hidden;
            position: relative;
        }

        .trailer-container {
            width: 100%;
            height: 100%;
        }

        .trailer-container iframe {
            width: 100%;
            height: 100%;
        }

        @media (max-width: 1200px) {
            .detail-content {
                grid-template-columns: 1fr;
            }
            
            .detail-sidebar {
                position: static;
            }
        }

        @media (max-width: 768px) {
            .hero-title {
                font-size: 2rem;
            }
            
            .hero-actions {
                flex-direction: column;
            }
            
            .cast-grid,
            .crew-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .similar-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .detail-hero-content {
                padding: var(--spacing-lg);
            }
            
            .hero-title {
                font-size: 1.5rem;
            }
            
            .cast-grid,
            .crew-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</body>
</html>
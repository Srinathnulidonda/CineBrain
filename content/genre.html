<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Browse by Genre - CineScope</title>

    <!-- CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="/css/base.css" rel="stylesheet">
    <link href="/css/bootstrap-overrides.css" rel="stylesheet">
    <link href="/css/tailwind.css" rel="stylesheet">
    <link href="/css/animation.css" rel="stylesheet">
    <link href="/css/responsive.css" rel="stylesheet">
    <link href="/css/utilities.css" rel="stylesheet">
</head>

<body>
    <div class="app-container">
        <!-- Desktop Sidebar -->
        <div id="sidebar-container"></div>

        <!-- Main Content -->
        <main class="main-content">
            <div class="container-fluid">
                <!-- Header -->
                <div class="mb-4">
                    <h1 class="tw-text-3xl tw-font-bold mb-3">
                        <i class="bi bi-grid text-primary"></i> Browse by Genre
                    </h1>
                    <p class="text-muted">Explore movies and TV shows by your favorite genres</p>
                </div>

                <!-- Genre Grid -->
                <div class="row g-4 mb-5">
                    <div class="col-6 col-md-4 col-lg-3">
                        <div class="card h-100 hover-lift cursor-pointer" onclick="selectGenre('action')">
                            <div class="card-body text-center py-4">
                                <i class="bi bi-lightning-fill text-danger" style="font-size: 3rem;"></i>
                                <h5 class="mt-3 mb-0">Action</h5>
                                <small class="text-muted">Explosive thrills</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-6 col-md-4 col-lg-3">
                        <div class="card h-100 hover-lift cursor-pointer" onclick="selectGenre('comedy')">
                            <div class="card-body text-center py-4">
                                <i class="bi bi-emoji-laughing-fill text-warning" style="font-size: 3rem;"></i>
                                <h5 class="mt-3 mb-0">Comedy</h5>
                                <small class="text-muted">Laugh out loud</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-6 col-md-4 col-lg-3">
                        <div class="card h-100 hover-lift cursor-pointer" onclick="selectGenre('drama')">
                            <div class="card-body text-center py-4">
                                <i class="bi bi-heart-fill text-danger" style="font-size: 3rem;"></i>
                                <h5 class="mt-3 mb-0">Drama</h5>
                                <small class="text-muted">Emotional stories</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-6 col-md-4 col-lg-3">
                        <div class="card h-100 hover-lift cursor-pointer" onclick="selectGenre('horror')">
                            <div class="card-body text-center py-4">
                                <i class="bi bi-moon-stars-fill text-secondary" style="font-size: 3rem;"></i>
                                <h5 class="mt-3 mb-0">Horror</h5>
                                <small class="text-muted">Spine-chilling scares</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-6 col-md-4 col-lg-3">
                        <div class="card h-100 hover-lift cursor-pointer" onclick="selectGenre('sci-fi')">
                            <div class="card-body text-center py-4">
                                <i class="bi bi-rocket-takeoff-fill text-info" style="font-size: 3rem;"></i>
                                <h5 class="mt-3 mb-0">Sci-Fi</h5>
                                <small class="text-muted">Future worlds</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-6 col-md-4 col-lg-3">
                        <div class="card h-100 hover-lift cursor-pointer" onclick="selectGenre('romance')">
                            <div class="card-body text-center py-4">
                                <i class="bi bi-hearts text-danger" style="font-size: 3rem;"></i>
                                <h5 class="mt-3 mb-0">Romance</h5>
                                <small class="text-muted">Love stories</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-6 col-md-4 col-lg-3">
                        <div class="card h-100 hover-lift cursor-pointer" onclick="selectGenre('thriller')">
                            <div class="card-body text-center py-4">
                                <i class="bi bi-exclamation-triangle-fill text-warning" style="font-size: 3rem;"></i>
                                <h5 class="mt-3 mb-0">Thriller</h5>
                                <small class="text-muted">Edge of your seat</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-6 col-md-4 col-lg-3">
                        <div class="card h-100 hover-lift cursor-pointer" onclick="selectGenre('animation')">
                            <div class="card-body text-center py-4">
                                <i class="bi bi-palette-fill text-primary" style="font-size: 3rem;"></i>
                                <h5 class="mt-3 mb-0">Animation</h5>
                                <small class="text-muted">Animated adventures</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-6 col-md-4 col-lg-3">
                        <div class="card h-100 hover-lift cursor-pointer" onclick="selectGenre('documentary')">
                            <div class="card-body text-center py-4">
                                <i class="bi bi-camera-reels-fill text-secondary" style="font-size: 3rem;"></i>
                                <h5 class="mt-3 mb-0">Documentary</h5>
                                <small class="text-muted">Real stories</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-6 col-md-4 col-lg-3">
                        <div class="card h-100 hover-lift cursor-pointer" onclick="selectGenre('fantasy')">
                            <div class="card-body text-center py-4">
                                <i class="bi bi-magic text-purple-600" style="font-size: 3rem;"></i>
                                <h5 class="mt-3 mb-0">Fantasy</h5>
                                <small class="text-muted">Magical worlds</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-6 col-md-4 col-lg-3">
                        <div class="card h-100 hover-lift cursor-pointer" onclick="selectGenre('mystery')">
                            <div class="card-body text-center py-4">
                                <i class="bi bi-search text-info" style="font-size: 3rem;"></i>
                                <h5 class="mt-3 mb-0">Mystery</h5>
                                <small class="text-muted">Solve the puzzle</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-6 col-md-4 col-lg-3">
                        <div class="card h-100 hover-lift cursor-pointer" onclick="selectGenre('western')">
                            <div class="card-body text-center py-4">
                                <i class="bi bi-sunset-fill text-warning" style="font-size: 3rem;"></i>
                                <h5 class="mt-3 mb-0">Western</h5>
                                <small class="text-muted">Wild west tales</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Genre Content Section -->
                <div id="genreContent" class="d-none">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2 class="h3 mb-0">
                            <span id="genreTitle"></span> <span class="text-muted">Content</span>
                        </h2>
                        <button class="btn btn-outline-secondary" onclick="clearGenre()">
                            <i class="bi bi-arrow-left"></i> Back to Genres
                        </button>
                    </div>

                    <!-- Content Type Tabs -->
                    <ul class="nav nav-tabs mb-4" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="movies-tab" data-bs-toggle="tab"
                                data-bs-target="#movies" type="button">
                                Movies
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="tv-tab" data-bs-toggle="tab" data-bs-target="#tv"
                                type="button">
                                TV Shows
                            </button>
                        </li>
                    </ul>

                    <!-- Tab Content -->
                    <div class="tab-content">
                        <div class="tab-pane fade show active" id="movies" role="tabpanel">
                            <div class="row g-4" id="moviesGrid">
                                <div class="col-12 text-center">
                                    <div class="spinner-border text-primary" role="status"></div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="tv" role="tabpanel">
                            <div class="row g-4" id="tvGrid">
                                <div class="col-12 text-center">
                                    <div class="spinner-border text-primary" role="status"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Popular Across Genres -->
                <section id="popularSection">
                    <h2 class="h3 mb-4">Popular Across All Genres</h2>
                    <div class="row g-4" id="popularGrid">
                        <div class="col-12 text-center">
                            <div class="spinner-border text-primary" role="status"></div>
                        </div>
                    </div>
                </section>
            </div>
        </main>

        <!-- Mobile Navigation -->
        <div id="mobile-nav-container"></div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/config.js"></script>
    <script src="/js/storage.js"></script>
    <script src="/js/http.js"></script>
    <script src="/js/ui.js"></script>
    <script src="/js/app.js"></script>

    <!-- Page specific JS -->
    <script>
        let currentGenre = null;

        // Initialize page
        async function pageInit() {
            // Load popular content
            loadPopularContent();

            // Check URL for genre parameter
            const urlParams = new URLSearchParams(window.location.search);
            const genre = urlParams.get('genre');
            if (genre) {
                selectGenre(genre);
            }
        }

        async function loadPopularContent() {
            try {
                const data = await api.content.getTrending('all', 12);
                const grid = document.getElementById('popularGrid');

                if (data.recommendations && data.recommendations.length > 0) {
                    grid.innerHTML = UI.createContentGrid(data.recommendations);
                } else {
                    grid.innerHTML = '<div class="col-12 text-center text-muted">No popular content found</div>';
                }
            } catch (error) {
                console.error('Error loading popular content:', error);
                document.getElementById('popularGrid').innerHTML =
                    '<div class="col-12 text-center text-danger">Failed to load popular content</div>';
            }
        }

        async function selectGenre(genre) {
            currentGenre = genre;

            // Update URL
            const url = new URL(window.location);
            url.searchParams.set('genre', genre);
            window.history.pushState({}, '', url);

            // Update UI
            document.getElementById('genreContent').classList.remove('d-none');
            document.getElementById('popularSection').classList.add('d-none');
            document.querySelector('.row.g-4.mb-5').classList.add('d-none');

            // Set genre title
            const genreTitle = genre.charAt(0).toUpperCase() + genre.slice(1).replace('-', ' ');
            document.getElementById('genreTitle').textContent = genreTitle;

            // Load content for both tabs
            loadGenreContent(genre, 'movie', 'moviesGrid');
            loadGenreContent(genre, 'tv', 'tvGrid');

            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        async function loadGenreContent(genre, contentType, gridId) {
            const grid = document.getElementById(gridId);
            grid.innerHTML = '<div class="col-12 text-center"><div class="spinner-border text-primary" role="status"></div></div>';

            try {
                const data = await api.content.getByGenre(genre, contentType, 20);

                if (data.recommendations && data.recommendations.length > 0) {
                    grid.innerHTML = UI.createContentGrid(data.recommendations);
                } else {
                    grid.innerHTML = `<div class="col-12 text-center text-muted">No ${contentType === 'movie' ? 'movies' : 'TV shows'} found in this genre</div>`;
                }
            } catch (error) {
                console.error(`Error loading ${genre} ${contentType}:`, error);
                grid.innerHTML = '<div class="col-12 text-center text-danger">Failed to load content</div>';
            }
        }

        function clearGenre() {
            currentGenre = null;

            // Update URL
            const url = new URL(window.location);
            url.searchParams.delete('genre');
            window.history.pushState({}, '', url);

            // Update UI
            document.getElementById('genreContent').classList.add('d-none');
            document.getElementById('popularSection').classList.remove('d-none');
            document.querySelector('.row.g-4.mb-5').classList.remove('d-none');

            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Set pageInit for App.js
        window.pageInit = pageInit;
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <meta name="description" content="Search movies, TV shows, and anime on CineBrain. Find your next favorite with advanced filters and real-time results.">
    <title>Search - CineBrain</title>
    
    <!-- Preconnect -->
    <link rel="preconnect" href="https://backend-app-970m.onrender.com">
    <link rel="preconnect" href="https://image.tmdb.org/t/p">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    
    <!-- Core CSS -->
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/components.css">
    <link rel="stylesheet" href="/css/layouts.css">
    <link rel="stylesheet" href="/css/animations.css">
    <link rel="stylesheet" href="/css/responsive.css">
    <link rel="stylesheet" href="/css/theme.css">
</head>
<body>
    <!-- Include Topbar -->
    <div id="topbar-container"></div>

    <!-- Main Content -->
    <main class="main-content">
        <div class="app-container">
            <!-- Search Header -->
            <section class="search-header">
                <div class="container">
                    <div class="page-hero">
                        <div class="hero-content">
                            <h1 class="hero-title">Search Everything</h1>
                            <p class="hero-description">Discover movies, TV shows, and anime from around the world</p>
                        </div>
                    </div>
                    
                    <!-- Advanced Search Form -->
                    <div class="search-form-container">
                        <form class="search-form" id="advanced-search-form">
                            <div class="search-input-group">
                                <div class="search-input-wrapper">
                                    <i class="bi bi-search search-icon"></i>
                                    <input type="text" id="main-search-input" class="form-control search-input-main" 
                                           placeholder="Search for movies, shows, anime..." autocomplete="off">
                                    <button type="button" class="search-clear-btn" id="search-clear-btn" style="display: none;">
                                        <i class="bi bi-x"></i>
                                    </button>
                                </div>
                                <button type="submit" class="btn btn-primary search-submit-btn">
                                    <i class="bi bi-search"></i>
                                    <span>Search</span>
                                </button>
                            </div>
                        </form>
                        
                        <!-- Search Suggestions -->
                        <div class="search-suggestions" id="search-suggestions" style="display: none;">
                            <!-- Real-time suggestions populated here -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Search Filters -->
            <section class="search-filters-section" id="search-filters-section">
                <div class="container">
                    <div class="filters-container">
                        <div class="filter-group">
                            <label class="filter-label">Content Type</label>
                            <div class="filter-options">
                                <button class="filter-btn active" data-filter="type" data-value="all">All</button>
                                <button class="filter-btn" data-filter="type" data-value="movie">Movies</button>
                                <button class="filter-btn" data-filter="type" data-value="tv">TV Shows</button>
                                <button class="filter-btn" data-filter="type" data-value="anime">Anime</button>
                            </div>
                        </div>
                        
                        <div class="filter-group">
                            <label class="filter-label">Genre</label>
                            <div class="filter-options" id="genre-filters">
                                <!-- Populated dynamically -->
                            </div>
                        </div>
                        
                        <div class="filter-group">
                            <label class="filter-label">Year</label>
                            <div class="filter-options">
                                <button class="filter-btn active" data-filter="year" data-value="all">Any Year</button>
                                <button class="filter-btn" data-filter="year" data-value="2024">2024</button>
                                <button class="filter-btn" data-filter="year" data-value="2023">2023</button>
                                <button class="filter-btn" data-filter="year" data-value="2022">2022</button>
                                <button class="filter-btn" data-filter="year" data-value="2021">2021</button>
                            </div>
                        </div>
                        
                        <div class="filter-group">
                            <label class="filter-label">Rating</label>
                            <div class="filter-options">
                                <button class="filter-btn active" data-filter="rating" data-value="all">Any Rating</button>
                                <button class="filter-btn" data-filter="rating" data-value="9+">9.0+</button>
                                <button class="filter-btn" data-filter="rating" data-value="8+">8.0+</button>
                                <button class="filter-btn" data-filter="rating" data-value="7+">7.0+</button>
                                <button class="filter-btn" data-filter="rating" data-value="6+">6.0+</button>
                            </div>
                        </div>
                        
                        <div class="filter-group">
                            <label class="filter-label">Language</label>
                            <div class="filter-options">
                                <button class="filter-btn active" data-filter="language" data-value="all">All Languages</button>
                                <button class="filter-btn" data-filter="language" data-value="english">English</button>
                                <button class="filter-btn" data-filter="language" data-value="hindi">Hindi</button>
                                <button class="filter-btn" data-filter="language" data-value="telugu">Telugu</button>
                                <button class="filter-btn" data-filter="language" data-value="tamil">Tamil</button>
                                <button class="filter-btn" data-filter="language" data-value="kannada">Kannada</button>
                                <button class="filter-btn" data-filter="language" data-value="japanese">Japanese</button>
                            </div>
                        </div>
                        
                        <div class="filter-actions">
                            <button class="btn btn-outline-light" id="clear-filters-btn">Clear Filters</button>
                            <button class="btn btn-secondary" id="toggle-filters-btn">
                                <i class="bi bi-funnel"></i> More Filters
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Search Results -->
            <section class="search-results-section" id="search-results-section">
                <div class="container">
                    <!-- Results Header -->
                    <div class="results-header" id="results-header" style="display: none;">
                        <div class="results-info">
                            <h2 class="results-title" id="results-title">Search Results</h2>
                            <p class="results-count" id="results-count">0 results found</p>
                        </div>
                        <div class="results-sort">
                            <label for="sort-select">Sort by:</label>
                            <select id="sort-select" class="form-control">
                                <option value="relevance">Relevance</option>
                                <option value="rating">Rating</option>
                                <option value="popularity">Popularity</option>
                                <option value="release_date">Release Date</option>
                                <option value="title">Title</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Results Grid -->
                    <div class="search-results-grid" id="search-results-grid">
                        <!-- Initial state -->
                        <div class="search-empty-state" id="search-empty-state">
                            <div class="empty-state-content">
                                <i class="bi bi-search empty-state-icon"></i>
                                <h3 class="empty-state-title">Start Your Search</h3>
                                <p class="empty-state-description">Search for movies, TV shows, or anime to discover amazing content</p>
                                <div class="popular-searches">
                                    <h4>Popular Searches:</h4>
                                    <div class="popular-search-tags">
                                        <button class="popular-search-tag" data-search="Marvel">Marvel</button>
                                        <button class="popular-search-tag" data-search="One Piece">One Piece</button>
                                        <button class="popular-search-tag" data-search="Stranger Things">Dark</button>
                                        <button class="popular-search-tag" data-search="The Dark Knight">The Dark Knight</button>
                                        <button class="popular-search-tag" data-search="Breaking Bad">Game of Thrones</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Loading State -->
                        <div class="search-loading-state" id="search-loading-state" style="display: none;">
                            <div class="loading-content">
                                <div class="spinner-border text-primary" role="status"></div>
                                <p>Searching...</p>
                            </div>
                        </div>
                        
                        <!-- Results will be populated here -->
                        <div class="results-grid" id="results-grid" style="display: none;"></div>
                        
                        <!-- No Results State -->
                        <div class="search-no-results" id="search-no-results" style="display: none;">
                            <div class="no-results-content">
                                <i class="bi bi-emoji-frown no-results-icon"></i>
                                <h3 class="no-results-title">No Results Found</h3>
                                <p class="no-results-description">Try adjusting your search terms or filters</p>
                                <div class="search-suggestions-list" id="search-suggestions-list">
                                    <!-- Suggestions will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Load More -->
                    <div class="load-more-container" id="load-more-container" style="display: none;">
                        <button class="btn btn-outline-primary" id="load-more-btn">
                            <i class="bi bi-arrow-down-circle"></i> Load More Results
                        </button>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Include Mobile Nav -->
    <div id="mobile-nav-container"></div>

    <!-- Core JavaScript -->
    <script src="/js/config.js"></script>
    <script src="/js/api.js"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/app.js"></script>

    <!-- Page JavaScript -->
    <script>
        // Search page state
        let currentQuery = '';
        let currentFilters = {
            type: 'all',
            genre: 'all',
            year: 'all',
            rating: 'all',
            language: 'all'
        };
        let currentPage = 1;
        let totalPages = 0;
        let searchTimeout;
        let lastSearchResults = [];

        // Initialize search page
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                await loadLayoutComponents();
                setupSearchForm();
                setupFilters();
                setupPopularSearches();
                loadGenreFilters();
                handleURLParameters();
                setupInfiniteScroll();
                
                // Focus search input
                document.getElementById('main-search-input').focus();
                
            } catch (error) {
                console.error('Search page initialization error:', error);
            }
        });

        // Load layout components
        async function loadLayoutComponents() {
            try {
                const [topbarResponse, mobileNavResponse] = await Promise.all([
                    fetch('/components/layout/topbar.html'),
                    fetch('/components/layout/mobile-nav.html')
                ]);

                if (topbarResponse.ok) {
                    document.getElementById('topbar-container').innerHTML = await topbarResponse.text();
                }
                if (mobileNavResponse.ok) {
                    document.getElementById('mobile-nav-container').innerHTML = await mobileNavResponse.text();
                }
            } catch (error) {
                console.error('Error loading layout components:', error);
            }
        }

        // Setup search form
        function setupSearchForm() {
            const searchForm = document.getElementById('advanced-search-form');
            const searchInput = document.getElementById('main-search-input');
            const clearBtn = document.getElementById('search-clear-btn');
            const suggestions = document.getElementById('search-suggestions');

            // Handle form submission
            searchForm.addEventListener('submit', function(e) {
                e.preventDefault();
                performSearch();
            });

            // Real-time search suggestions
            searchInput.addEventListener('input', function(e) {
                const query = e.target.value.trim();
                
                // Show/hide clear button
                clearBtn.style.display = query ? 'flex' : 'none';
                
                // Get suggestions
                clearTimeout(searchTimeout);
                if (query.length >= 2) {
                    searchTimeout = setTimeout(() => getSuggestions(query), 300);
                } else {
                    hideSuggestions();
                }
            });

            // Clear search
            clearBtn.addEventListener('click', function() {
                searchInput.value = '';
                searchInput.focus();
                clearBtn.style.display = 'none';
                hideSuggestions();
                clearResults();
            });

            // Handle suggestion clicks
            suggestions.addEventListener('click', function(e) {
                const suggestion = e.target.closest('.suggestion-item');
                if (suggestion) {
                    const title = suggestion.dataset.title;
                    const contentId = suggestion.dataset.contentId;
                    
                    if (contentId) {
                        // Navigate to content details
                        window.location.href = `/content/details.html?id=${contentId}`;
                    } else if (title) {
                        // Use as search query
                        searchInput.value = title;
                        hideSuggestions();
                        performSearch();
                    }
                }
            });

            // Hide suggestions when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.search-form-container')) {
                    hideSuggestions();
                }
            });
        }

        // Get real-time search suggestions
        async function getSuggestions(query) {
            try {
                const response = await fetch(`https://backend-app-970m.onrender.com/api/search?query=${encodeURIComponent(query)}&limit=8`);
                if (!response.ok) throw new Error('Suggestions failed');
                
                const data = await response.json();
                displaySuggestions(data.results || []);
            } catch (error) {
                console.error('Error getting suggestions:', error);
                hideSuggestions();
            }
        }

        // Display search suggestions
        function displaySuggestions(results) {
            const suggestions = document.getElementById('search-suggestions');
            
            if (results.length === 0) {
                hideSuggestions();
                return;
            }

            const html = results.map(item => `
                <div class="suggestion-item" data-content-id="${item.id}" data-title="${item.title}">
                    <img src="${item.poster_path ? `https://image.tmdb.org/t/p/w92${item.poster_path}` : '/images/placeholder-poster.jpg'}" 
                         alt="${item.title}" class="suggestion-poster">
                    <div class="suggestion-info">
                        <h6 class="suggestion-title">${item.title}</h6>
                        <p class="suggestion-meta">
                            ${item.content_type.toUpperCase()} • 
                            ${item.rating ? `${item.rating}/10` : 'NR'}
                            ${item.release_date ? ` • ${new Date(item.release_date).getFullYear()}` : ''}
                        </p>
                    </div>
                    <i class="bi bi-arrow-up-right suggestion-arrow"></i>
                </div>
            `).join('');

            suggestions.innerHTML = html;
            suggestions.style.display = 'block';
        }

        // Hide suggestions
        function hideSuggestions() {
            const suggestions = document.getElementById('search-suggestions');
            suggestions.style.display = 'none';
        }

        // Setup filters
        function setupFilters() {
            const filterBtns = document.querySelectorAll('.filter-btn');
            const clearFiltersBtn = document.getElementById('clear-filters-btn');
            const sortSelect = document.getElementById('sort-select');

            // Handle filter clicks
            filterBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const filterType = this.dataset.filter;
                    const filterValue = this.dataset.value;
                    
                    // Update filter state
                    currentFilters[filterType] = filterValue;
                    
                    // Update UI
                    const filterGroup = this.closest('.filter-group');
                    filterGroup.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Re-search with new filters
                    if (currentQuery) {
                        currentPage = 1;
                        performSearch();
                    }
                });
            });

            // Clear all filters
            clearFiltersBtn.addEventListener('click', function() {
                currentFilters = {
                    type: 'all',
                    genre: 'all',
                    year: 'all',
                    rating: 'all',
                    language: 'all'
                };
                
                // Reset UI
                filterBtns.forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.value === 'all');
                });
                
                sortSelect.value = 'relevance';
                
                // Re-search
                if (currentQuery) {
                    currentPage = 1;
                    performSearch();
                }
            });

            // Handle sort change
            sortSelect.addEventListener('change', function() {
                if (currentQuery) {
                    currentPage = 1;
                    performSearch();
                }
            });
        }

        // Load genre filters dynamically
        async function loadGenreFilters() {
            const genreFilters = document.getElementById('genre-filters');
            const genres = [
                'Action', 'Comedy', 'Drama', 'Thriller', 'Romance', 'Sci-Fi', 
                'Horror', 'Documentary', 'Animation', 'Crime', 'Fantasy', 'Adventure'
            ];

            let html = '<button class="filter-btn active" data-filter="genre" data-value="all">All Genres</button>';
            genres.forEach(genre => {
                html += `<button class="filter-btn" data-filter="genre" data-value="${genre.toLowerCase()}">${genre}</button>`;
            });

            genreFilters.innerHTML = html;

            // Add event listeners to new buttons
            genreFilters.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const filterValue = this.dataset.value;
                    currentFilters.genre = filterValue;
                    
                    genreFilters.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    if (currentQuery) {
                        currentPage = 1;
                        performSearch();
                    }
                });
            });
        }

        // Setup popular searches
        function setupPopularSearches() {
            const popularSearchTags = document.querySelectorAll('.popular-search-tag');
            
            popularSearchTags.forEach(tag => {
                tag.addEventListener('click', function() {
                    const searchTerm = this.dataset.search;
                    document.getElementById('main-search-input').value = searchTerm;
                    currentQuery = searchTerm;
                    performSearch();
                });
            });
        }

        // Handle URL parameters
        function handleURLParameters() {
            const urlParams = new URLSearchParams(window.location.search);
            const query = urlParams.get('q');
            const type = urlParams.get('type');
            const filter = urlParams.get('filter');

            if (query) {
                document.getElementById('main-search-input').value = query;
                currentQuery = query;
                performSearch();
            }

            if (type && currentFilters.hasOwnProperty('type')) {
                currentFilters.type = type;
                updateFilterUI('type', type);
            }

            if (filter) {
                // Handle special filters like 'trending', 'new', 'critics'
                handleSpecialFilter(filter);
            }
        }

        // Update filter UI
        function updateFilterUI(filterType, value) {
            const filterBtn = document.querySelector(`[data-filter="${filterType}"][data-value="${value}"]`);
            if (filterBtn) {
                const filterGroup = filterBtn.closest('.filter-group');
                filterGroup.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
                filterBtn.classList.add('active');
            }
        }

        // Handle special filters
        function handleSpecialFilter(filter) {
            switch (filter) {
                case 'trending':
                    loadTrendingContent();
                    break;
                case 'new':
                    loadNewReleases();
                    break;
                case 'critics':
                    loadCriticsChoice();
                    break;
            }
        }

        // Perform search
        async function performSearch() {
            const searchInput = document.getElementById('main-search-input');
            const query = searchInput.value.trim();
            
            if (!query) {
                clearResults();
                return;
            }

            currentQuery = query;
            currentPage = 1;

            try {
                showLoadingState();
                
                const params = new URLSearchParams({
                    query: query,
                    page: currentPage,
                    type: currentFilters.type !== 'all' ? currentFilters.type : 'multi'
                });

                // Add additional filters
                Object.keys(currentFilters).forEach(key => {
                    if (currentFilters[key] !== 'all' && key !== 'type') {
                        params.append(key, currentFilters[key]);
                    }
                });

                // Add sort parameter
                const sortValue = document.getElementById('sort-select').value;
                if (sortValue !== 'relevance') {
                    params.append('sort', sortValue);
                }

                const response = await fetch(`https://backend-app-970m.onrender.com/api/search?${params}`);
                if (!response.ok) throw new Error('Search failed');

                const data = await response.json();
                displaySearchResults(data);
                
                // Update URL
                updateURL(query);

            } catch (error) {
                console.error('Search error:', error);
                showErrorState();
            }
        }

        // Display search results
        function displaySearchResults(data) {
            const resultsGrid = document.getElementById('results-grid');
            const resultsHeader = document.getElementById('results-header');
            const resultsTitle = document.getElementById('results-title');
            const resultsCount = document.getElementById('results-count');
            const loadMoreContainer = document.getElementById('load-more-container');

            lastSearchResults = data.results || [];
            totalPages = data.total_pages || 0;

            hideAllStates();

            if (lastSearchResults.length === 0) {
                showNoResultsState();
                return;
            }

            // Show results header
            resultsHeader.style.display = 'flex';
            resultsTitle.textContent = `Search Results for "${currentQuery}"`;
            resultsCount.textContent = `${data.total_results || 0} results found`;

            // Generate results HTML
            const html = lastSearchResults.map(item => createResultCard(item)).join('');
            resultsGrid.innerHTML = html;
            resultsGrid.style.display = 'grid';

            // Show load more if there are more pages
            if (currentPage < totalPages) {
                loadMoreContainer.style.display = 'block';
            } else {
                loadMoreContainer.style.display = 'none';
            }

            // Initialize content cards
            initializeResultCards();
        }

        // Create result card HTML
        function createResultCard(item) {
            const posterUrl = item.poster_path 
                ? `https://image.tmdb.org/t/p/w500${item.poster_path}`
                : '/images/placeholder-poster.jpg';

            return `
                <div class="result-card" data-content-id="${item.id}">
                    <div class="result-poster" data-action="view-content" data-content-id="${item.id}">
                        <img src="${posterUrl}" alt="${item.title}" loading="lazy">
                        <div class="result-overlay">
                            <button class="btn btn-play" data-action="play-trailer" data-content-id="${item.id}">
                                <i class="bi bi-play-fill"></i>
                            </button>
                        </div>
                        <div class="result-badges">
                            ${item.is_new_release ? '<span class="badge badge-new">NEW</span>' : ''}
                            ${item.is_trending ? '<span class="badge badge-trending">TRENDING</span>' : ''}
                            ${item.is_critics_choice ? '<span class="badge badge-critics">CRITICS\' CHOICE</span>' : ''}
                        </div>
                    </div>
                    <div class="result-content">
                        <h3 class="result-title" data-action="view-content" data-content-id="${item.id}">${item.title}</h3>
                        <div class="result-meta">
                            <span class="result-rating">
                                ${item.rating ? `<i class="bi bi-star-fill"></i> ${Number(item.rating).toFixed(1)}` : 'NR'}
                            </span>
                            <span class="result-type type-badge ${item.content_type}">${item.content_type.toUpperCase()}</span>
                            <span class="result-year">${item.release_date ? new Date(item.release_date).getFullYear() : 'TBA'}</span>
                        </div>
                        <p class="result-overview">${item.overview ? (item.overview.length > 150 ? item.overview.substring(0, 150) + '...' : item.overview) : 'No description available.'}</p>
                        <div class="result-genres">
                            ${item.genres ? item.genres.slice(0, 3).map(genre => `<span class="genre-chip">${genre}</span>`).join('') : ''}
                        </div>
                        <div class="result-actions">
                            <button class="btn btn-sm btn-primary" data-action="view-content" data-content-id="${item.id}">
                                <i class="bi bi-info-circle"></i> Details
                            </button>
                            <button class="btn btn-sm btn-outline-light" data-action="add-watchlist" data-content-id="${item.id}">
                                <i class="bi bi-bookmark"></i> Watchlist
                            </button>
                            <button class="btn btn-sm btn-outline-light" data-action="add-favorite" data-content-id="${item.id}">
                                <i class="bi bi-heart"></i> Favorite
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // Initialize result cards
        function initializeResultCards() {
            const resultCards = document.querySelectorAll('.result-card');
            
            resultCards.forEach(card => {
                // Add hover effects
                card.addEventListener('mouseenter', function() {
                    this.classList.add('result-card-hover');
                });
                
                card.addEventListener('mouseleave', function() {
                    this.classList.remove('result-card-hover');
                });
            });
        }

        // Load more results
        async function loadMoreResults() {
            if (currentPage >= totalPages) return;

            try {
                const loadMoreBtn = document.getElementById('load-more-btn');
                loadMoreBtn.disabled = true;
                loadMoreBtn.innerHTML = '<div class="spinner-border spinner-border-sm"></div> Loading...';

                currentPage++;

                const params = new URLSearchParams({
                    query: currentQuery,
                    page: currentPage,
                    type: currentFilters.type !== 'all' ? currentFilters.type : 'multi'
                });

                Object.keys(currentFilters).forEach(key => {
                    if (currentFilters[key] !== 'all' && key !== 'type') {
                        params.append(key, currentFilters[key]);
                    }
                });

                const sortValue = document.getElementById('sort-select').value;
                if (sortValue !== 'relevance') {
                    params.append('sort', sortValue);
                }

                const response = await fetch(`https://backend-app-970m.onrender.com/api/search?${params}`);
                if (!response.ok) throw new Error('Load more failed');

                const data = await response.json();
                
                // Append new results
                const resultsGrid = document.getElementById('results-grid');
                const newHTML = (data.results || []).map(item => createResultCard(item)).join('');
                resultsGrid.insertAdjacentHTML('beforeend', newHTML);
                
                // Update load more button
                loadMoreBtn.disabled = false;
                loadMoreBtn.innerHTML = '<i class="bi bi-arrow-down-circle"></i> Load More Results';
                
                if (currentPage >= totalPages) {
                    document.getElementById('load-more-container').style.display = 'none';
                }

                initializeResultCards();

            } catch (error) {
                console.error('Load more error:', error);
                const loadMoreBtn = document.getElementById('load-more-btn');
                loadMoreBtn.disabled = false;
                loadMoreBtn.innerHTML = '<i class="bi bi-arrow-down-circle"></i> Load More Results';
            }
        }

        // Setup infinite scroll
        function setupInfiniteScroll() {
            const loadMoreBtn = document.getElementById('load-more-btn');
            loadMoreBtn.addEventListener('click', loadMoreResults);

            // Optional: Auto-load on scroll
            window.addEventListener('scroll', () => {
                if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 1000) {
                    const loadMoreContainer = document.getElementById('load-more-container');
                    if (loadMoreContainer.style.display === 'block' && !loadMoreBtn.disabled) {
                        loadMoreResults();
                    }
                }
            });
        }

        // Load trending content
        async function loadTrendingContent() {
            try {
                showLoadingState();
                const response = await fetch('https://backend-app-970m.onrender.com/api/recommendations/trending?type=all&limit=20');
                if (!response.ok) throw new Error('Failed to load trending');
                
                const data = await response.json();
                displaySpecialResults('Trending Content', data.recommendations || []);
            } catch (error) {
                console.error('Error loading trending:', error);
                showErrorState();
            }
        }

        // Load new releases
        async function loadNewReleases() {
            try {
                showLoadingState();
                const response = await fetch('https://backend-app-970m.onrender.com/api/recommendations/new-releases?type=movie&limit=20');
                if (!response.ok) throw new Error('Failed to load new releases');
                
                const data = await response.json();
                displaySpecialResults('New Releases', data.recommendations || []);
            } catch (error) {
                console.error('Error loading new releases:', error);
                showErrorState();
            }
        }

        // Load critics choice
        async function loadCriticsChoice() {
            try {
                showLoadingState();
                const response = await fetch('https://backend-app-970m.onrender.com/api/recommendations/critics-choice?type=movie&limit=20');
                if (!response.ok) throw new Error('Failed to load critics choice');
                
                const data = await response.json();
                displaySpecialResults('Critics\' Choice', data.recommendations || []);
            } catch (error) {
                console.error('Error loading critics choice:', error);
                showErrorState();
            }
        }

        // Display special results
        function displaySpecialResults(title, results) {
            const resultsHeader = document.getElementById('results-header');
            const resultsTitle = document.getElementById('results-title');
            const resultsCount = document.getElementById('results-count');
            const resultsGrid = document.getElementById('results-grid');
            const loadMoreContainer = document.getElementById('load-more-container');

            hideAllStates();

            if (results.length === 0) {
                showNoResultsState();
                return;
            }

            resultsHeader.style.display = 'flex';
            resultsTitle.textContent = title;
            resultsCount.textContent = `${results.length} items`;

            const html = results.map(item => createResultCard(item)).join('');
            resultsGrid.innerHTML = html;
            resultsGrid.style.display = 'grid';
            loadMoreContainer.style.display = 'none';

            initializeResultCards();
        }

        // State management
        function showLoadingState() {
            hideAllStates();
            document.getElementById('search-loading-state').style.display = 'flex';
        }

        function showNoResultsState() {
            hideAllStates();
            document.getElementById('search-no-results').style.display = 'flex';
        }

        function showErrorState() {
            hideAllStates();
            const noResults = document.getElementById('search-no-results');
            noResults.querySelector('.no-results-title').textContent = 'Search Error';
            noResults.querySelector('.no-results-description').textContent = 'Something went wrong. Please try again.';
            noResults.style.display = 'flex';
        }

        function clearResults() {
            hideAllStates();
            document.getElementById('search-empty-state').style.display = 'flex';
            document.getElementById('results-header').style.display = 'none';
        }

        function hideAllStates() {
            document.getElementById('search-empty-state').style.display = 'none';
            document.getElementById('search-loading-state').style.display = 'none';
            document.getElementById('search-no-results').style.display = 'none';
            document.getElementById('results-grid').style.display = 'none';
        }

        // Update URL
        function updateURL(query) {
            const url = new URL(window.location);
            url.searchParams.set('q', query);
            
            Object.keys(currentFilters).forEach(key => {
                if (currentFilters[key] !== 'all') {
                    url.searchParams.set(key, currentFilters[key]);
                } else {
                    url.searchParams.delete(key);
                }
            });
            
            window.history.pushState({}, '', url);
        }
    </script>

    <!-- Page-specific CSS -->
    <style>
        /* Search Form Styles */
        .search-form-container {
            position: relative;
            max-width: 48rem;
            margin: 0 auto;
        }

        .search-input-group {
            display: flex;
            gap: var(--space-md);
        }

        .search-input-wrapper {
            position: relative;
            flex: 1;
        }

        .search-input-main {
            padding-left: 3rem;
            padding-right: 3rem;
            height: 3.5rem;
            font-size: 1.125rem;
            border-radius: var(--radius-lg);
            border: 2px solid var(--border-primary);
            background: var(--bg-secondary);
        }

        .search-input-main:focus {
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 0.2rem rgba(99, 102, 241, 0.25);
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            font-size: 1.25rem;
        }

        .search-clear-btn {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 1.25rem;
            cursor: pointer;
            padding: 0.25rem;
            border-radius: var(--radius-sm);
            transition: all var(--transition-fast);
        }

        .search-clear-btn:hover {
            color: var(--text-primary);
            background: var(--bg-tertiary);
        }

        .search-submit-btn {
            height: 3.5rem;
            padding: 0 2rem;
            font-weight: 600;
            border-radius: var(--radius-lg);
        }

        /* Search Suggestions */
        .search-suggestions {
            position: absolute;
            top: calc(100% + 0.5rem);
            left: 0;
            right: 0;
            background: var(--bg-secondary);
            border: 1px solid var(--border-primary);
            border-radius: var(--radius-lg);
            max-height: 24rem;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: var(--shadow-xl);
        }

        .suggestion-item {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            padding: var(--space-md);
            cursor: pointer;
            transition: background-color var(--transition-fast);
            border-bottom: 1px solid var(--border-secondary);
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        .suggestion-item:hover {
            background: var(--bg-tertiary);
        }

        .suggestion-poster {
            width: 2.5rem;
            height: 3.75rem;
            object-fit: cover;
            border-radius: var(--radius-sm);
            flex-shrink: 0;
        }

        .suggestion-info {
            flex: 1;
            min-width: 0;
        }

        .suggestion-title {
            font-size: 0.875rem;
            font-weight: 600;
            margin: 0 0 0.25rem 0;
            color: var(--text-primary);
        }

        .suggestion-meta {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin: 0;
        }

        .suggestion-arrow {
            color: var(--text-muted);
            font-size: 1rem;
        }

        /* Filters */
        .filters-container {
            background: var(--bg-secondary);
            border-radius: var(--radius-xl);
            padding: var(--space-xl);
            margin-bottom: var(--space-xl);
        }

        .filter-group {
            margin-bottom: var(--space-lg);
        }

        .filter-label {
            display: block;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--space-sm);
            font-size: 0.875rem;
        }

        .filter-options {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-sm);
        }

        .filter-btn {
            padding: 0.375rem 0.75rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-primary);
            border-radius: var(--radius-md);
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .filter-btn:hover {
            background: var(--bg-quaternary);
            border-color: var(--accent-primary);
        }

        .filter-btn.active {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            color: white;
        }

        .filter-actions {
            display: flex;
            gap: var(--space-md);
            margin-top: var(--space-lg);
            padding-top: var(--space-lg);
            border-top: 1px solid var(--border-primary);
        }

        /* Results */
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-xl);
            padding-bottom: var(--space-lg);
            border-bottom: 1px solid var(--border-primary);
        }

        .results-title {
            font-size: 1.75rem;
            font-weight: 700;
            margin: 0 0 0.25rem 0;
            color: var(--text-primary);
        }

        .results-count {
            color: var(--text-muted);
            margin: 0;
        }

        .results-sort {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .results-sort label {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .results-sort select {
            min-width: 8rem;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: var(--space-xl);
            margin-bottom: var(--space-3xl);
        }

        /* Result Cards */
        .result-card {
            background: var(--bg-secondary);
            border-radius: var(--radius-xl);
            overflow: hidden;
            transition: all var(--transition-base);
            border: 1px solid transparent;
        }

        .result-card:hover,
        .result-card.result-card-hover {
            transform: translateY(-0.25rem);
            box-shadow: var(--shadow-xl);
            border-color: var(--border-primary);
        }

        .result-poster {
            position: relative;
            aspect-ratio: 2/3;
            overflow: hidden;
            cursor: pointer;
        }

        .result-poster img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform var(--transition-slow);
        }

        .result-card:hover .result-poster img {
            transform: scale(1.05);
        }

        .result-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.7), transparent, rgba(0, 0, 0, 0.8));
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity var(--transition-base);
        }

        .result-card:hover .result-overlay {
            opacity: 1;
        }

        .result-badges {
            position: absolute;
            top: 0.75rem;
            left: 0.75rem;
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .badge {
            padding: 0.125rem 0.375rem;
            border-radius: var(--radius-sm);
            font-size: 0.625rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-new {
            background: var(--emerald-green);
            color: white;
        }

        .badge-trending {
            background: var(--cinema-red);
            color: white;
        }

        .badge-critics {
            background: var(--vip-gold);
            color: white;
        }

        .result-content {
            padding: var(--space-lg);
        }

        .result-title {
            font-size: 1.125rem;
            font-weight: 700;
            margin: 0 0 var(--space-sm) 0;
            color: var(--text-primary);
            cursor: pointer;
            transition: color var(--transition-fast);
        }

        .result-title:hover {
            color: var(--accent-primary);
        }

        .result-meta {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            margin-bottom: var(--space-md);
            font-size: 0.875rem;
        }

        .result-rating {
            color: var(--vip-gold);
            font-weight: 600;
        }

        .result-overview {
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: var(--space-md);
            font-size: 0.875rem;
        }

        .result-genres {
            display: flex;
            flex-wrap: wrap;
            gap: 0.25rem;
            margin-bottom: var(--space-md);
        }

        .result-actions {
            display: flex;
            gap: var(--space-sm);
        }

        .result-actions .btn {
            flex: 1;
            font-size: 0.75rem;
            padding: 0.375rem 0.75rem;
        }

        /* States */
        .search-empty-state,
        .search-loading-state,
        .search-no-results {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 24rem;
            text-align: center;
        }

        .empty-state-content,
        .loading-content,
        .no-results-content {
            max-width: 28rem;
        }

        .empty-state-icon,
        .no-results-icon {
            font-size: 4rem;
            color: var(--text-muted);
            margin-bottom: var(--space-lg);
        }

        .empty-state-title,
        .no-results-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: var(--space-md);
            color: var(--text-primary);
        }

        .empty-state-description,
        .no-results-description {
            color: var(--text-secondary);
            margin-bottom: var(--space-xl);
        }

        .popular-searches h4 {
            font-size: 1rem;
            margin-bottom: var(--space-md);
            color: var(--text-primary);
        }

        .popular-search-tags {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-sm);
            justify-content: center;
        }

        .popular-search-tag {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-primary);
            border-radius: var(--radius-md);
            padding: 0.375rem 0.75rem;
            color: var(--text-secondary);
            font-size: 0.875rem;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .popular-search-tag:hover {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            color: white;
        }

        .load-more-container {
            text-align: center;
            margin: var(--space-3xl) 0;
        }

        /* Responsive */
        @media (max-width: 767.98px) {
            .search-input-group {
                flex-direction: column;
            }

            .search-submit-btn {
                width: 100%;
            }

            .filters-container {
                padding: var(--space-lg);
            }

            .filter-options {
                justify-content: flex-start;
            }

            .filter-actions {
                flex-direction: column;
            }

            .results-header {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--space-md);
            }

            .results-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: var(--space-lg);
            }

            .result-actions {
                flex-direction: column;
            }

            .popular-search-tags {
                justify-content: flex-start;
            }
        }
    </style>
</body>
</html>
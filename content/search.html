<!DOCTYPE html>
<html lang="en" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Search movies, TV shows, and anime on CineBrain - Find your next favorite with advanced filters">
    <meta name="keywords" content="search movies, TV shows, anime, filters, recommendations">

    <title>Search - CineBrain</title>

    <!-- CSS Files -->
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/components.css">
    <link rel="stylesheet" href="/css/layouts.css">
    <link rel="stylesheet" href="/css/animations.css">
    <link rel="stylesheet" href="/css/responsive.css">
    <link rel="stylesheet" href="/css/theme.css">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/assets/favicon.svg">
</head>

<body>
    <!-- Fixed Topbar -->
    <div id="topbarContainer"></div>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container-fluid py-4">
            <!-- Search Header -->
            <div class="row justify-content-center mb-4">
                <div class="col-lg-8">
                    <div class="text-center mb-4">
                        <h1 class="h2 text-white fw-bold mb-2">
                            <i class="fas fa-search text-primary me-2"></i>
                            Discover Content
                        </h1>
                        <p class="text-muted">Search through millions of movies, TV shows, and anime</p>
                    </div>

                    <!-- Advanced Search Component -->
                    <div id="searchBarContainer"></div>
                </div>
            </div>

            <!-- Search Layout -->
            <div class="search-layout">
                <!-- Search Filters Sidebar -->
                <div class="search-filters">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="text-white mb-0">
                            <i class="fas fa-sliders-h me-2"></i>
                            Filters
                        </h5>
                        <button class="btn btn-outline-secondary btn-sm" onclick="clearAllFilters()">
                            <i class="fas fa-times me-1"></i>Clear
                        </button>
                    </div>

                    <!-- Content Type Filter -->
                    <div class="filter-group mb-4">
                        <h6 class="text-white mb-3">Content Type</h6>
                        <div class="d-flex flex-column gap-2">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="movie" id="filterMovie" checked>
                                <label class="form-check-label text-white" for="filterMovie">
                                    <i class="fas fa-film me-1 text-primary"></i>Movies
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="tv" id="filterTV" checked>
                                <label class="form-check-label text-white" for="filterTV">
                                    <i class="fas fa-tv me-1 text-success"></i>TV Series
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="anime" id="filterAnime" checked>
                                <label class="form-check-label text-white" for="filterAnime">
                                    <i class="fas fa-dragon me-1 text-warning"></i>Anime
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Genre Filter -->
                    <div class="filter-group mb-4">
                        <h6 class="text-white mb-3">Genres</h6>
                        <div id="genreFilters" class="d-flex flex-column gap-2 max-height-200 overflow-auto">
                            <!-- Genre checkboxes will be populated -->
                        </div>
                    </div>

                    <!-- Rating Filter -->
                    <div class="filter-group mb-4">
                        <h6 class="text-white mb-3">Rating Range</h6>
                        <div class="row g-2">
                            <div class="col-6">
                                <select class="form-select form-select-sm bg-dark text-white border-secondary"
                                    id="minRating">
                                    <option value="">Min</option>
                                    <option value="9">9.0+</option>
                                    <option value="8">8.0+</option>
                                    <option value="7">7.0+</option>
                                    <option value="6">6.0+</option>
                                    <option value="5">5.0+</option>
                                </select>
                            </div>
                            <div class="col-6">
                                <select class="form-select form-select-sm bg-dark text-white border-secondary"
                                    id="maxRating">
                                    <option value="">Max</option>
                                    <option value="10">10.0</option>
                                    <option value="9">9.0</option>
                                    <option value="8">8.0</option>
                                    <option value="7">7.0</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Year Filter -->
                    <div class="filter-group mb-4">
                        <h6 class="text-white mb-3">Release Year</h6>
                        <div class="row g-2">
                            <div class="col-6">
                                <select class="form-select form-select-sm bg-dark text-white border-secondary"
                                    id="fromYear">
                                    <option value="">From</option>
                                    <!-- Years will be populated -->
                                </select>
                            </div>
                            <div class="col-6">
                                <select class="form-select form-select-sm bg-dark text-white border-secondary"
                                    id="toYear">
                                    <option value="">To</option>
                                    <!-- Years will be populated -->
                                </select>
                            </div>
                        </div>

                        <!-- Quick year buttons -->
                        <div class="mt-2">
                            <div class="d-flex flex-wrap gap-1">
                                <button class="btn btn-outline-secondary btn-sm year-filter"
                                    data-year="2024">2024</button>
                                <button class="btn btn-outline-secondary btn-sm year-filter" data-from="2020"
                                    data-to="2024">2020s</button>
                                <button class="btn btn-outline-secondary btn-sm year-filter" data-from="2010"
                                    data-to="2019">2010s</button>
                                <button class="btn btn-outline-secondary btn-sm year-filter" data-from="2000"
                                    data-to="2009">2000s</button>
                            </div>
                        </div>
                    </div>

                    <!-- Language Filter -->
                    <div class="filter-group mb-4">
                        <h6 class="text-white mb-3">Languages</h6>
                        <div class="d-flex flex-column gap-2">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="english" id="langEn">
                                <label class="form-check-label text-white" for="langEn">English</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="hindi" id="langHi">
                                <label class="form-check-label text-white" for="langHi">Hindi</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="telugu" id="langTe">
                                <label class="form-check-label text-white" for="langTe">Telugu</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="tamil" id="langTa">
                                <label class="form-check-label text-white" for="langTa">Tamil</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="kannada" id="langKn">
                                <label class="form-check-label text-white" for="langKn">Kannada</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="japanese" id="langJa">
                                <label class="form-check-label text-white" for="langJa">Japanese</label>
                            </div>
                        </div>
                    </div>

                    <!-- Sort Options -->
                    <div class="filter-group">
                        <h6 class="text-white mb-3">Sort By</h6>
                        <select class="form-select form-select-sm bg-dark text-white border-secondary" id="sortBy">
                            <option value="popularity">Popularity</option>
                            <option value="rating">Rating</option>
                            <option value="release_date">Release Date</option>
                            <option value="title">Title (A-Z)</option>
                        </select>
                    </div>
                </div>

                <!-- Search Results -->
                <div class="search-results">
                    <!-- Search Stats -->
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div>
                            <h5 class="text-white mb-1" id="resultsTitle">Search Results</h5>
                            <p class="text-muted small mb-0" id="resultsStats">Enter a search term to get started</p>
                        </div>
                        <div class="d-flex gap-2">
                            <button class="btn btn-outline-secondary btn-sm" id="viewToggle" onclick="toggleView()">
                                <i class="fas fa-th-large" id="viewIcon"></i>
                            </button>
                            <button class="btn btn-outline-primary btn-sm d-lg-none" data-bs-toggle="offcanvas"
                                data-bs-target="#filtersOffcanvas">
                                <i class="fas fa-filter me-1"></i>Filters
                            </button>
                        </div>
                    </div>

                    <!-- Results Container -->
                    <div id="searchResultsContainer" class="row">
                        <!-- Initial state -->
                        <div class="col-12 text-center py-5" id="initialState">
                            <i class="fas fa-search text-muted mb-3" style="font-size: 3rem;"></i>
                            <h4 class="text-muted mb-2">Start Your Discovery</h4>
                            <p class="text-muted">Use the search bar above to find movies, TV shows, and anime</p>

                            <!-- Popular searches -->
                            <div class="mt-4">
                                <p class="text-muted small mb-2">Popular searches:</p>
                                <div class="d-flex flex-wrap justify-content-center gap-2">
                                    <button class="btn btn-outline-secondary btn-sm popular-search"
                                        onclick="searchPopular('Marvel')">Marvel</button>
                                    <button class="btn btn-outline-secondary btn-sm popular-search"
                                        onclick="searchPopular('Studio Ghibli')">Studio Ghibli</button>
                                    <button class="btn btn-outline-secondary btn-sm popular-search"
                                        onclick="searchPopular('Christopher Nolan')">Christopher Nolan</button>
                                    <button class="btn btn-outline-secondary btn-sm popular-search"
                                        onclick="searchPopular('One Piece')">One Piece</button>
                                    <button class="btn btn-outline-secondary btn-sm popular-search"
                                        onclick="searchPopular('Breaking Bad')">Breaking Bad</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Loading State -->
                    <div id="loadingState" class="d-none">
                        <div class="row">
                            <div class="col-12 text-center py-4">
                                <div class="loading-spinner mx-auto mb-3"></div>
                                <p class="text-muted">Searching content...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Pagination -->
                    <div id="paginationContainer" class="d-flex justify-content-center mt-4 d-none">
                        <!-- Pagination will be inserted here -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Mobile Filters Offcanvas -->
    <div class="offcanvas offcanvas-start" tabindex="-1" id="filtersOffcanvas">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title text-white">
                <i class="fas fa-sliders-h me-2"></i>Filters
            </h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas"></button>
        </div>
        <div class="offcanvas-body">
            <!-- Mobile filters content (duplicate of sidebar) -->
        </div>
    </div>

    <!-- Mobile Navigation -->
    <div id="mobileNavContainer"></div>

    <!-- JavaScript Files -->
    <script src="/js/config.js"></script>
    <script src="/js/api.js"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/app.js"></script>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Page-specific JavaScript -->
    <script>
        (function () {
            let currentQuery = '';
            let currentPage = 1;
            let currentFilters = {};
            let currentView = 'grid'; // grid or list
            let isSearching = false;
            let searchTimeout;

            // Initialize search page
            async function initSearchPage() {
                try {
                    await loadComponents();
                    setupFilters();
                    setupSearch();
                    parseURLParameters();
                    setupEventListeners();
                } catch (error) {
                    console.error('Search page initialization failed:', error);
                }
            }

            // Load reusable components
            async function loadComponents() {
                try {
                    // Load topbar
                    const topbarResponse = await fetch('/components/layout/topbar.html');
                    const topbarHTML = await topbarResponse.text();
                    document.getElementById('topbarContainer').innerHTML = topbarHTML;

                    // Load mobile navigation
                    const mobileNavResponse = await fetch('/components/layout/mobile-nav.html');
                    const mobileNavHTML = await mobileNavResponse.text();
                    document.getElementById('mobileNavContainer').innerHTML = mobileNavHTML;

                    // Load search bar component
                    const searchBarResponse = await fetch('/components/ui/search-bar.html');
                    const searchBarHTML = await searchBarResponse.text();
                    document.getElementById('searchBarContainer').innerHTML = searchBarHTML;

                    // Execute component scripts
                    const scripts = document.querySelectorAll('#topbarContainer script, #mobileNavContainer script, #searchBarContainer script');
                    scripts.forEach(script => {
                        const newScript = document.createElement('script');
                        newScript.textContent = script.textContent;
                        document.head.appendChild(newScript);
                    });
                } catch (error) {
                    console.error('Failed to load components:', error);
                }
            }

            // Setup filters
            function setupFilters() {
                populateGenreFilters();
                populateYearFilters();
                setupFilterEventListeners();
            }

            // Populate genre filters
            function populateGenreFilters() {
                const genres = [
                    'Action', 'Adventure', 'Animation', 'Biography', 'Comedy', 'Crime',
                    'Documentary', 'Drama', 'Family', 'Fantasy', 'History', 'Horror',
                    'Music', 'Mystery', 'Romance', 'Sci-Fi', 'Sport', 'Thriller',
                    'War', 'Western'
                ];

                const container = document.getElementById('genreFilters');
                const genreHTML = genres.map(genre => `
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="${genre}" id="genre${genre}">
                    <label class="form-check-label text-white" for="genre${genre}">${genre}</label>
                </div>
            `).join('');

                container.innerHTML = genreHTML;
            }

            // Populate year filters
            function populateYearFilters() {
                const currentYear = new Date().getFullYear();
                const fromYear = document.getElementById('fromYear');
                const toYear = document.getElementById('toYear');

                for (let year = currentYear; year >= 1900; year--) {
                    const option1 = new Option(year, year);
                    const option2 = new Option(year, year);
                    fromYear.add(option1);
                    toYear.add(option2);
                }
            }

            // Setup filter event listeners
            function setupFilterEventListeners() {
                // All filter inputs
                const filterInputs = document.querySelectorAll(
                    '.search-filters input[type="checkbox"], .search-filters select'
                );

                filterInputs.forEach(input => {
                    input.addEventListener('change', applyFilters);
                });

                // Year filter buttons
                const yearButtons = document.querySelectorAll('.year-filter');
                yearButtons.forEach(button => {
                    button.addEventListener('click', function () {
                        const year = this.dataset.year;
                        const fromYear = this.dataset.from;
                        const toYear = this.dataset.to;

                        if (year) {
                            document.getElementById('fromYear').value = year;
                            document.getElementById('toYear').value = year;
                        } else if (fromYear && toYear) {
                            document.getElementById('fromYear').value = fromYear;
                            document.getElementById('toYear').value = toYear;
                        }

                        // Update button states
                        yearButtons.forEach(btn => btn.classList.remove('active'));
                        this.classList.add('active');

                        applyFilters();
                    });
                });
            }

            // Setup search functionality
            function setupSearch() {
                // Override search bar functionality if needed
                const searchInput = document.getElementById('advancedSearchInput');
                if (searchInput) {
                    searchInput.addEventListener('input', handleSearchInput);
                }
            }

            // Handle search input
            function handleSearchInput(event) {
                clearTimeout(searchTimeout);
                const query = event.target.value.trim();

                if (query.length >= 2) {
                    searchTimeout = setTimeout(() => {
                        performSearch(query);
                    }, 300);
                } else if (query.length === 0) {
                    showInitialState();
                }
            }

            // Perform search
            async function performSearch(query, page = 1) {
                if (isSearching && currentQuery === query && currentPage === page) return;

                currentQuery = query;
                currentPage = page;
                isSearching = true;

                showLoadingState();
                updateResultsTitle(query);

                try {
                    const searchParams = {
                        query: query,
                        page: page,
                        ...collectFilters()
                    };

                    const results = await window.api.search(query, searchParams);

                    if (results && results.results) {
                        displaySearchResults(results);
                        updatePagination(results);
                        updateResultsStats(results);
                    } else {
                        showNoResults(query);
                    }
                } catch (error) {
                    console.error('Search failed:', error);
                    showSearchError();
                } finally {
                    isSearching = false;
                }
            }

            // Collect current filters
            function collectFilters() {
                const filters = {};

                // Content types
                const contentTypes = [];
                if (document.getElementById('filterMovie').checked) contentTypes.push('movie');
                if (document.getElementById('filterTV').checked) contentTypes.push('tv');
                if (document.getElementById('filterAnime').checked) contentTypes.push('anime');
                if (contentTypes.length > 0) filters.type = contentTypes.join(',');

                // Genres
                const genres = [];
                document.querySelectorAll('#genreFilters input:checked').forEach(input => {
                    genres.push(input.value);
                });
                if (genres.length > 0) filters.genres = genres.join(',');

                // Rating
                const minRating = document.getElementById('minRating').value;
                const maxRating = document.getElementById('maxRating').value;
                if (minRating) filters.min_rating = minRating;
                if (maxRating) filters.max_rating = maxRating;

                // Year
                const fromYear = document.getElementById('fromYear').value;
                const toYear = document.getElementById('toYear').value;
                if (fromYear) filters.from_year = fromYear;
                if (toYear) filters.to_year = toYear;

                // Languages
                const languages = [];
                document.querySelectorAll('.search-filters input[type="checkbox"][value$="english"], .search-filters input[type="checkbox"][value$="hindi"], .search-filters input[type="checkbox"][value$="telugu"], .search-filters input[type="checkbox"][value$="tamil"], .search-filters input[type="checkbox"][value$="kannada"], .search-filters input[type="checkbox"][value$="japanese"]').forEach(input => {
                    if (input.checked) languages.push(input.value);
                });
                if (languages.length > 0) filters.languages = languages.join(',');

                // Sort
                const sortBy = document.getElementById('sortBy').value;
                if (sortBy) filters.sort_by = sortBy;

                return filters;
            }

            // Display search results
            async function displaySearchResults(results) {
                const container = document.getElementById('searchResultsContainer');
                hideInitialState();
                hideLoadingState();

                if (!results.results || results.results.length === 0) {
                    showNoResults(currentQuery);
                    return;
                }

                let resultHTML = '';

                if (currentView === 'grid') {
                    resultHTML = await renderGridResults(results.results);
                } else {
                    resultHTML = await renderListResults(results.results);
                }

                container.innerHTML = resultHTML;

                // Initialize content cards
                initializeContentCards();
            }

            // Render grid results
            async function renderGridResults(results) {
                const cardTemplate = await getContentCardTemplate();

                return results.map(item => {
                    return `
                    <div class="col-6 col-md-4 col-lg-3 col-xl-2 mb-4 stagger-item">
                        ${generateContentCard(item)}
                    </div>
                `;
                }).join('');
            }

            // Render list results
            async function renderListResults(results) {
                return results.map(item => {
                    return `
                    <div class="col-12 mb-3 stagger-item">
                        <div class="card card-horizontal bg-dark border-secondary">
                            <img src="${item.poster_path || '/assets/no-poster.jpg'}" 
                                 class="card-img-top" style="width: 120px; height: 180px; object-fit: cover;">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div class="flex-grow-1">
                                        <h5 class="card-title text-white">${item.title}</h5>
                                        <div class="d-flex align-items-center gap-2 mb-2">
                                            <span class="badge bg-primary">${item.content_type.toUpperCase()}</span>
                                            ${item.rating ? `<span class="badge bg-warning text-dark">${parseFloat(item.rating).toFixed(1)}/10</span>` : ''}
                                            ${item.release_date ? `<span class="text-muted small">${new Date(item.release_date).getFullYear()}</span>` : ''}
                                        </div>
                                        <p class="card-text text-muted">${item.overview ? item.overview.substring(0, 200) + '...' : 'No description available'}</p>
                                        <div class="d-flex gap-2">
                                            <button class="btn btn-primary btn-sm" onclick="viewDetails(${item.id})">
                                                <i class="fas fa-info-circle me-1"></i>Details
                                            </button>
                                            <button class="btn btn-outline-secondary btn-sm" onclick="addToWatchlist(${item.id})">
                                                <i class="fas fa-bookmark me-1"></i>Watchlist
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                }).join('');
            }

            // Generate content card HTML
            function generateContentCard(item) {
                return `
                <div class="content-card card bg-dark border-secondary h-100" 
                     data-content-id="${item.id}" 
                     onclick="viewDetails(${item.id})"
                     style="cursor: pointer; transition: all 0.3s ease;">
                    <div class="position-relative">
                        <img src="${item.poster_path || '/assets/no-poster.jpg'}" 
                             class="card-img-top" 
                             style="height: 300px; object-fit: cover;" 
                             alt="${item.title}"
                             onerror="this.src='/assets/no-poster.jpg'">
                        <div class="position-absolute top-0 start-0 m-2">
                            <span class="badge bg-primary">${item.content_type.toUpperCase()}</span>
                        </div>
                        ${item.rating ? `
                            <div class="position-absolute top-0 end-0 m-2">
                                <span class="badge bg-warning text-dark">
                                    <i class="fas fa-star"></i> ${parseFloat(item.rating).toFixed(1)}
                                </span>
                            </div>
                        ` : ''}
                    </div>
                    <div class="card-body p-3">
                        <h6 class="card-title text-white fw-semibold mb-2" style="height: 2.4em; overflow: hidden;">
                            ${item.title}
                        </h6>
                        ${item.genres && item.genres.length > 0 ? `
                            <div class="mb-2">
                                ${item.genres.slice(0, 2).map(genre =>
                    `<span class="badge bg-secondary me-1 mb-1" style="font-size: 0.7rem;">${genre}</span>`
                ).join('')}
                            </div>
                        ` : ''}
                        <p class="card-text text-muted small" style="height: 3.6em; overflow: hidden;">
                            ${item.overview ? item.overview.substring(0, 100) + '...' : 'No description available'}
                        </p>
                        <div class="d-flex gap-2 mt-auto">
                            <button class="btn btn-primary btn-sm flex-grow-1" onclick="event.stopPropagation(); viewDetails(${item.id})">
                                <i class="fas fa-info-circle me-1"></i>Details
                            </button>
                            <button class="btn btn-outline-danger btn-sm" onclick="event.stopPropagation(); toggleFavorite(${item.id}, this)">
                                <i class="fas fa-heart"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;
            }

            // Initialize content cards
            function initializeContentCards() {
                // Add stagger animation
                const items = document.querySelectorAll('.stagger-item');
                items.forEach((item, index) => {
                    setTimeout(() => {
                        item.classList.add('stagger-animate');
                    }, index * 50);
                });
            }

            // Show loading state
            function showLoadingState() {
                document.getElementById('initialState').classList.add('d-none');
                document.getElementById('loadingState').classList.remove('d-none');
                document.getElementById('searchResultsContainer').innerHTML = '';
            }

            // Hide loading state
            function hideLoadingState() {
                document.getElementById('loadingState').classList.add('d-none');
            }

            // Show initial state
            function showInitialState() {
                document.getElementById('initialState').classList.remove('d-none');
                document.getElementById('loadingState').classList.add('d-none');
                document.getElementById('paginationContainer').classList.add('d-none');
                document.getElementById('searchResultsContainer').innerHTML = '<div class="col-12 text-center py-5" id="initialState"><i class="fas fa-search text-muted mb-3" style="font-size: 3rem;"></i><h4 class="text-muted mb-2">Start Your Discovery</h4><p class="text-muted">Use the search bar above to find movies, TV shows, and anime</p></div>';
            }

            // Hide initial state
            function hideInitialState() {
                document.getElementById('initialState').classList.add('d-none');
            }

            // Show no results
            function showNoResults(query) {
                const container = document.getElementById('searchResultsContainer');
                container.innerHTML = `
                <div class="col-12 text-center py-5">
                    <i class="fas fa-search-minus text-muted mb-3" style="font-size: 3rem;"></i>
                    <h4 class="text-muted mb-2">No Results Found</h4>
                    <p class="text-muted">We couldn't find anything matching "${query}"</p>
                    <div class="mt-3">
                        <button class="btn btn-outline-primary" onclick="clearAllFilters()">
                            <i class="fas fa-filter me-1"></i>Clear Filters
                        </button>
                        <button class="btn btn-outline-secondary ms-2" onclick="showInitialState()">
                            <i class="fas fa-undo me-1"></i>New Search
                        </button>
                    </div>
                </div>
            `;
            }

            // Show search error
            function showSearchError() {
                const container = document.getElementById('searchResultsContainer');
                container.innerHTML = `
                <div class="col-12 text-center py-5">
                    <i class="fas fa-exclamation-triangle text-warning mb-3" style="font-size: 3rem;"></i>
                    <h4 class="text-muted mb-2">Search Error</h4>
                    <p class="text-muted">Something went wrong. Please try again.</p>
                    <button class="btn btn-outline-primary" onclick="performSearch(currentQuery, currentPage)">
                        <i class="fas fa-retry me-1"></i>Try Again
                    </button>
                </div>
            `;
            }

            // Update results title
            function updateResultsTitle(query) {
                document.getElementById('resultsTitle').textContent = `Results for "${query}"`;
            }

            // Update results stats
            function updateResultsStats(results) {
                const stats = document.getElementById('resultsStats');
                const totalResults = results.total_results || 0;
                const currentPageResults = results.results?.length || 0;
                const startResult = ((currentPage - 1) * 20) + 1;
                const endResult = startResult + currentPageResults - 1;

                stats.textContent = `Showing ${startResult}-${endResult} of ${totalResults.toLocaleString()} results`;
            }

            // Update pagination
            function updatePagination(results) {
                const container = document.getElementById('paginationContainer');
                const totalPages = results.total_pages || 1;

                if (totalPages <= 1) {
                    container.classList.add('d-none');
                    return;
                }

                let paginationHTML = '<nav><ul class="pagination pagination-sm justify-content-center">';

                // Previous button
                if (currentPage > 1) {
                    paginationHTML += `
                    <li class="page-item">
                        <a class="page-link" href="#" onclick="changePage(${currentPage - 1})">
                            <i class="fas fa-chevron-left"></i>
                        </a>
                    </li>
                `;
                }

                // Page numbers
                const startPage = Math.max(1, currentPage - 2);
                const endPage = Math.min(totalPages, currentPage + 2);

                for (let i = startPage; i <= endPage; i++) {
                    paginationHTML += `
                    <li class="page-item ${i === currentPage ? 'active' : ''}">
                        <a class="page-link" href="#" onclick="changePage(${i})">${i}</a>
                    </li>
                `;
                }

                // Next button
                if (currentPage < totalPages) {
                    paginationHTML += `
                    <li class="page-item">
                        <a class="page-link" href="#" onclick="changePage(${currentPage + 1})">
                            <i class="fas fa-chevron-right"></i>
                        </a>
                    </li>
                `;
                }

                paginationHTML += '</ul></nav>';
                container.innerHTML = paginationHTML;
                container.classList.remove('d-none');
            }

            // Parse URL parameters
            function parseURLParameters() {
                const urlParams = new URLSearchParams(window.location.search);
                const query = urlParams.get('query');

                if (query) {
                    const searchInput = document.getElementById('advancedSearchInput');
                    if (searchInput) {
                        searchInput.value = query;
                        performSearch(query);
                    }
                }
            }

            // Setup additional event listeners
            function setupEventListeners() {
                // View toggle
                document.getElementById('viewToggle').addEventListener('click', toggleView);
            }

            // Global functions
            window.changePage = function (page) {
                if (currentQuery) {
                    performSearch(currentQuery, page);
                }
            };

            window.toggleView = function () {
                currentView = currentView === 'grid' ? 'list' : 'grid';
                const icon = document.getElementById('viewIcon');

                if (currentView === 'grid') {
                    icon.className = 'fas fa-th-large';
                } else {
                    icon.className = 'fas fa-list';
                }

                if (currentQuery) {
                    performSearch(currentQuery, currentPage);
                }
            };

            window.applyFilters = function () {
                if (currentQuery) {
                    performSearch(currentQuery, 1);
                }
            };

            window.clearAllFilters = function () {
                // Reset all filter inputs
                document.querySelectorAll('.search-filters input[type="checkbox"]').forEach(input => {
                    if (['filterMovie', 'filterTV', 'filterAnime'].includes(input.id)) {
                        input.checked = true;
                    } else {
                        input.checked = false;
                    }
                });

                document.querySelectorAll('.search-filters select').forEach(select => {
                    select.value = '';
                });

                // Reset year buttons
                document.querySelectorAll('.year-filter').forEach(btn => {
                    btn.classList.remove('active');
                });

                if (currentQuery) {
                    performSearch(currentQuery, 1);
                }
            };

            window.searchPopular = function (term) {
                const searchInput = document.getElementById('advancedSearchInput');
                if (searchInput) {
                    searchInput.value = term;
                    performSearch(term);
                }
            };

            window.viewDetails = function (contentId) {
                window.location.href = `/content/details.html?id=${contentId}`;
            };

            window.addToWatchlist = async function (contentId) {
                try {
                    if (!window.auth || !window.auth.isAuthenticated()) {
                        window.location.href = '/auth/login.html';
                        return;
                    }

                    await window.api.recordInteraction(contentId, 'watchlist');
                    showToast('Added to watchlist!', 'success');
                } catch (error) {
                    console.error('Failed to add to watchlist:', error);
                    showToast('Failed to add to watchlist', 'error');
                }
            };

            window.toggleFavorite = async function (contentId, button) {
                try {
                    if (!window.auth || !window.auth.isAuthenticated()) {
                        window.location.href = '/auth/login.html';
                        return;
                    }

                    await window.api.recordInteraction(contentId, 'favorite');

                    const icon = button.querySelector('i');
                    icon.classList.add('heart-beat');

                    setTimeout(() => {
                        icon.classList.remove('heart-beat');
                    }, 600);

                    showToast('Added to favorites!', 'success');
                } catch (error) {
                    console.error('Failed to toggle favorite:', error);
                    showToast('Failed to update favorites', 'error');
                }
            };

            // Initialize when DOM is ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initSearchPage);
            } else {
                initSearchPage();
            }
        })();
    </script>
</body>

</html>
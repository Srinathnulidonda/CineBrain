<!DOCTYPE html>
<html lang="en" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Discover the best anime on CineBrain - From action-packed adventures to heartfelt stories">
    <meta name="keywords" content="anime, japanese animation, manga adaptations, anime recommendations">

    <title>Anime Universe - CineBrain</title>

    <!-- CSS Files -->
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/components.css">
    <link rel="stylesheet" href="/css/layouts.css">
    <link rel="stylesheet" href="/css/animations.css">
    <link rel="stylesheet" href="/css/responsive.css">
    <link rel="stylesheet" href="/css/theme.css">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/assets/favicon.svg">
</head>

<body>
    <!-- Fixed Topbar -->
    <div id="topbarContainer"></div>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Anime Hero Section -->
        <section class="hero-section py-5"
            style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(139, 92, 246, 0.1) 50%, rgba(59, 130, 246, 0.1) 100%);">
            <div class="container">
                <div class="text-center mb-5">
                    <h1 class="display-4 fw-bold text-white mb-3">
                        <i class="fas fa-dragon text-warning me-3"></i>
                        Anime Universe
                    </h1>
                    <p class="lead text-muted">Explore the vast world of Japanese animation</p>

                    <!-- Anime Categories -->
                    <div class="d-flex flex-wrap justify-content-center gap-2 mt-4">
                        <button class="btn btn-outline-warning anime-category active" data-category="all"
                            onclick="filterAnimeCategory('all')">
                            All Anime
                        </button>
                        <button class="btn btn-outline-warning anime-category" data-category="shonen"
                            onclick="filterAnimeCategory('shonen')">
                            Shonen
                        </button>
                        <button class="btn btn-outline-warning anime-category" data-category="shojo"
                            onclick="filterAnimeCategory('shojo')">
                            Shojo
                        </button>
                        <button class="btn btn-outline-warning anime-category" data-category="seinen"
                            onclick="filterAnimeCategory('seinen')">
                            Seinen
                        </button>
                        <button class="btn btn-outline-warning anime-category" data-category="josei"
                            onclick="filterAnimeCategory('josei')">
                            Josei
                        </button>
                        <button class="btn btn-outline-warning anime-category" data-category="kodomomuke"
                            onclick="filterAnimeCategory('kodomomuke')">
                            Kids
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Trending Anime Section -->
        <section class="py-5">
            <div class="container">
                <div class="section-header mb-4">
                    <h2 class="h3 text-white fw-bold">
                        <i class="fas fa-fire text-warning me-2"></i>
                        Trending Anime
                    </h2>
                    <p class="text-muted">What otakus are watching right now</p>
                </div>

                <div id="trendingAnimeContainer" class="row">
                    <div class="col-12 text-center py-4">
                        <div class="loading-spinner mx-auto mb-3"></div>
                        <p class="text-muted">Loading trending anime...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Top Rated Anime -->
        <section class="py-5 bg-dark bg-opacity-50">
            <div class="container">
                <div class="section-header mb-4">
                    <h2 class="h3 text-white fw-bold">
                        <i class="fas fa-star text-warning me-2"></i>
                        Top Rated Anime
                    </h2>
                    <p class="text-muted">Highest rated anime of all time</p>
                </div>

                <div id="topRatedAnimeContainer" class="row">
                    <div class="col-12 text-center py-4">
                        <div class="loading-spinner mx-auto mb-3"></div>
                        <p class="text-muted">Loading top rated anime...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Anime by Genre -->
        <section class="py-5">
            <div class="container">
                <div class="section-header mb-4">
                    <h2 class="h3 text-white fw-bold">
                        <i class="fas fa-th-large text-warning me-2"></i>
                        Browse by Genre
                    </h2>
                    <p class="text-muted">Find your favorite anime genres</p>
                </div>

                <!-- Genre Tabs -->
                <ul class="nav nav-pills mb-4 flex-wrap" id="animeGenreTabs">
                    <li class="nav-item">
                        <button class="nav-link active" data-genre="action" onclick="loadAnimeByGenre('action')">
                            <i class="fas fa-fist-raised me-1"></i>Action
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" data-genre="adventure" onclick="loadAnimeByGenre('adventure')">
                            <i class="fas fa-compass me-1"></i>Adventure
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" data-genre="comedy" onclick="loadAnimeByGenre('comedy')">
                            <i class="fas fa-laugh me-1"></i>Comedy
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" data-genre="drama" onclick="loadAnimeByGenre('drama')">
                            <i class="fas fa-theater-masks me-1"></i>Drama
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" data-genre="fantasy" onclick="loadAnimeByGenre('fantasy')">
                            <i class="fas fa-magic me-1"></i>Fantasy
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" data-genre="romance" onclick="loadAnimeByGenre('romance')">
                            <i class="fas fa-heart me-1"></i>Romance
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" data-genre="slice-of-life" onclick="loadAnimeByGenre('slice-of-life')">
                            <i class="fas fa-coffee me-1"></i>Slice of Life
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" data-genre="supernatural" onclick="loadAnimeByGenre('supernatural')">
                            <i class="fas fa-ghost me-1"></i>Supernatural
                        </button>
                    </li>
                </ul>

                <div id="genreAnimeContainer" class="row">
                    <!-- Genre-specific anime will be loaded here -->
                </div>
            </div>
        </section>

        <!-- New Season Anime -->
        <section class="py-5 bg-dark bg-opacity-50">
            <div class="container">
                <div class="section-header mb-4">
                    <h2 class="h3 text-white fw-bold">
                        <i class="fas fa-sparkles text-warning me-2"></i>
                        New Season Releases
                    </h2>
                    <p class="text-muted">Fresh anime from the current season</p>
                </div>

                <div id="newSeasonContainer" class="row">
                    <div class="col-12 text-center py-4">
                        <div class="loading-spinner mx-auto mb-3"></div>
                        <p class="text-muted">Loading new season anime...</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Mobile Navigation -->
    <div id="mobileNavContainer"></div>

    <!-- JavaScript Files -->
    <script src="/js/config.js"></script>
    <script src="/js/api.js"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/app.js"></script>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Page-specific JavaScript -->
    <script>
        (function () {
            let currentCategory = 'all';
            let currentGenre = 'action';
            let isLoading = false;

            // Initialize anime page
            async function initAnimePage() {
                try {
                    await loadComponents();
                    await Promise.all([
                        loadTrendingAnime(),
                        loadTopRatedAnime(),
                        loadAnimeByGenre('action'),
                        loadNewSeasonAnime()
                    ]);
                } catch (error) {
                    console.error('Anime page initialization failed:', error);
                }
            }

            // Load reusable components
            async function loadComponents() {
                try {
                    // Load topbar
                    const topbarResponse = await fetch('/components/layout/topbar.html');
                    const topbarHTML = await topbarResponse.text();
                    document.getElementById('topbarContainer').innerHTML = topbarHTML;

                    // Load mobile navigation
                    const mobileNavResponse = await fetch('/components/layout/mobile-nav.html');
                    const mobileNavHTML = await mobileNavResponse.text();
                    document.getElementById('mobileNavContainer').innerHTML = mobileNavHTML;

                    // Execute component scripts
                    const scripts = document.querySelectorAll('#topbarContainer script, #mobileNavContainer script');
                    scripts.forEach(script => {
                        const newScript = document.createElement('script');
                        newScript.textContent = script.textContent;
                        document.head.appendChild(newScript);
                    });
                } catch (error) {
                    console.error('Failed to load components:', error);
                }
            }

            // Load trending anime
            async function loadTrendingAnime() {
                const container = document.getElementById('trendingAnimeContainer');

                try {
                    const trendingData = await window.api.getRecommendations('anime', {
                        category: 'trending',
                        limit: 12
                    });

                    if (trendingData && trendingData.length > 0) {
                        const contentHTML = await renderAnimeGrid(trendingData);
                        container.innerHTML = contentHTML;
                        initializeAnimeCards(container);
                    } else {
                        showNoContent(container, 'No trending anime available');
                    }
                } catch (error) {
                    console.error('Failed to load trending anime:', error);
                    showErrorState(container, 'Failed to load trending anime');
                }
            }

            // Load top rated anime
            async function loadTopRatedAnime() {
                const container = document.getElementById('topRatedAnimeContainer');

                try {
                    const topRatedData = await window.api.getRecommendations('anime', {
                        category: 'top-rated',
                        limit: 8
                    });

                    if (topRatedData && topRatedData.length > 0) {
                        const contentHTML = await renderAnimeGrid(topRatedData, 'col-6 col-md-4 col-lg-3');
                        container.innerHTML = contentHTML;
                        initializeAnimeCards(container);
                    } else {
                        showNoContent(container, 'No top rated anime available');
                    }
                } catch (error) {
                    console.error('Failed to load top rated anime:', error);
                    showErrorState(container, 'Failed to load top rated anime');
                }
            }

            // Load anime by genre
            window.loadAnimeByGenre = async function (genre) {
                if (isLoading || currentGenre === genre) return;

                currentGenre = genre;
                isLoading = true;

                // Update active tab
                document.querySelectorAll('#animeGenreTabs .nav-link').forEach(tab => {
                    tab.classList.remove('active');
                    if (tab.dataset.genre === genre) {
                        tab.classList.add('active');
                    }
                });

                const container = document.getElementById('genreAnimeContainer');
                showLoadingState(container);

                try {
                    const genreData = await window.api.getRecommendations('anime', {
                        genre: genre,
                        limit: 16
                    });

                    if (genreData && genreData.length > 0) {
                        const contentHTML = await renderAnimeGrid(genreData);
                        container.innerHTML = contentHTML;
                        initializeAnimeCards(container);
                    } else {
                        showNoContent(container, `No ${genre} anime available`);
                    }
                } catch (error) {
                    console.error(`Failed to load ${genre} anime:`, error);
                    showErrorState(container, `Failed to load ${genre} anime`);
                } finally {
                    isLoading = false;
                }
            };

            // Load new season anime
            async function loadNewSeasonAnime() {
                const container = document.getElementById('newSeasonContainer');

                try {
                    const newSeasonData = await window.api.getRecommendations('anime', {
                        category: 'new-season',
                        limit: 12
                    });

                    if (newSeasonData && newSeasonData.length > 0) {
                        const contentHTML = await renderAnimeGrid(newSeasonData);
                        container.innerHTML = contentHTML;
                        initializeAnimeCards(container);
                    } else {
                        showNoContent(container, 'No new season anime available');
                    }
                } catch (error) {
                    console.error('Failed to load new season anime:', error);
                    showErrorState(container, 'Failed to load new season anime');
                }
            }

            // Filter anime by category
            window.filterAnimeCategory = async function (category) {
                if (currentCategory === category) return;

                currentCategory = category;

                // Update active button
                document.querySelectorAll('.anime-category').forEach(btn => {
                    btn.classList.remove('active');
                    if (btn.dataset.category === category) {
                        btn.classList.add('active');
                    }
                });

                // Reload all sections with category filter
                await Promise.all([
                    loadTrendingAnime(),
                    loadTopRatedAnime(),
                    loadAnimeByGenre(currentGenre),
                    loadNewSeasonAnime()
                ]);
            };

            // Render anime grid
            async function renderAnimeGrid(animeData, colClass = 'col-6 col-md-4 col-lg-3 col-xl-2') {
                return animeData.map((anime, index) => `
                <div class="${colClass} mb-4 anime-card-wrapper" style="animation-delay: ${index * 0.05}s;">
                    <div class="anime-card card bg-dark border-warning border-opacity-25 h-100" 
                         onclick="viewAnimeDetails(${anime.id})"
                         style="cursor: pointer; transition: all 0.3s ease;">
                        <div class="position-relative overflow-hidden">
                            <img src="${anime.poster_path || '/assets/no-poster.jpg'}" 
                                 class="card-img-top anime-poster" 
                                 style="height: 300px; object-fit: cover;" 
                                 alt="${anime.title}"
                                 loading="lazy"
                                 onerror="this.src='/assets/no-poster.jpg'">
                            
                            <!-- Anime Badge -->
                            <div class="position-absolute top-0 start-0 m-2">
                                <span class="badge bg-warning text-dark">
                                    <i class="fas fa-dragon me-1"></i>ANIME
                                </span>
                            </div>
                            
                            <!-- Rating Badge -->
                            ${anime.rating ? `
                                <div class="position-absolute top-0 end-0 m-2">
                                    <span class="badge bg-dark text-warning border border-warning">
                                        <i class="fas fa-star"></i> ${parseFloat(anime.rating).toFixed(1)}
                                    </span>
                                </div>
                            ` : ''}
                            
                            <!-- Play Overlay -->
                            <div class="anime-overlay position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center" 
                                 style="background: rgba(245, 158, 11, 0.9); opacity: 0; transition: opacity 0.3s ease;">
                                <button class="btn btn-dark btn-lg rounded-circle" style="width: 60px; height: 60px;">
                                    <i class="fas fa-play text-warning"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="card-body p-3">
                            <h6 class="card-title text-white fw-semibold mb-2 anime-title" 
                                style="overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">
                                ${anime.title}
                            </h6>
                            
                            ${anime.original_title && anime.original_title !== anime.title ? `
                                <p class="text-muted small mb-2">
                                    <i class="fas fa-language me-1"></i>${anime.original_title}
                                </p>
                            ` : ''}
                            
                            ${anime.genres && anime.genres.length > 0 ? `
                                <div class="mb-2">
                                    ${anime.genres.slice(0, 3).map(genre =>
                    `<span class="badge bg-dark text-warning me-1 mb-1" style="font-size: 0.65rem;">${genre}</span>`
                ).join('')}
                                </div>
                            ` : ''}
                            
                            ${anime.anime_genres && anime.anime_genres.length > 0 ? `
                                <div class="mb-2">
                                    ${anime.anime_genres.slice(0, 2).map(genre =>
                    `<span class="badge bg-warning bg-opacity-25 text-warning me-1" style="font-size: 0.65rem;">${genre.toUpperCase()}</span>`
                ).join('')}
                                </div>
                            ` : ''}
                            
                            <p class="card-text text-muted small mb-3" 
                               style="overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">
                                ${anime.overview || 'No description available'}
                            </p>
                            
                            <div class="d-flex gap-2">
                                <button class="btn btn-warning btn-sm flex-grow-1" onclick="event.stopPropagation(); viewAnimeDetails(${anime.id})">
                                    <i class="fas fa-info-circle me-1"></i>Details
                                </button>
                                <button class="btn btn-outline-warning btn-sm" onclick="event.stopPropagation(); toggleAnimeFavorite(${anime.id}, this)">
                                    <i class="fas fa-heart"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
            }

            // Initialize anime cards
            function initializeAnimeCards(container) {
                // Add hover effects
                const cards = container.querySelectorAll('.anime-card');
                cards.forEach(card => {
                    const overlay = card.querySelector('.anime-overlay');
                    const poster = card.querySelector('.anime-poster');

                    card.addEventListener('mouseenter', function () {
                        this.style.transform = 'translateY(-8px) scale(1.02)';
                        this.style.boxShadow = '0 15px 35px rgba(245, 158, 11, 0.3)';
                        if (overlay) overlay.style.opacity = '1';
                        if (poster) poster.style.transform = 'scale(1.1)';
                    });

                    card.addEventListener('mouseleave', function () {
                        this.style.transform = 'translateY(0) scale(1)';
                        this.style.boxShadow = '';
                        if (overlay) overlay.style.opacity = '0';
                        if (poster) poster.style.transform = 'scale(1)';
                    });
                });

                // Add stagger animation
                const wrappers = container.querySelectorAll('.anime-card-wrapper');
                wrappers.forEach((wrapper, index) => {
                    setTimeout(() => {
                        wrapper.classList.add('fade-in-up');
                    }, index * 50);
                });
            }

            // Show loading state
            function showLoadingState(container) {
                container.innerHTML = `
                <div class="col-12 text-center py-4">
                    <div class="loading-spinner mx-auto mb-3"></div>
                    <p class="text-muted">Loading anime...</p>
                </div>
            `;
            }

            // Show no content state
            function showNoContent(container, message) {
                container.innerHTML = `
                <div class="col-12 text-center py-5">
                    <i class="fas fa-dragon text-muted mb-3" style="font-size: 3rem;"></i>
                    <h5 class="text-muted">${message}</h5>
                    <p class="text-muted">Check back later for more anime content</p>
                </div>
            `;
            }

            // Show error state
            function showErrorState(container, message) {
                container.innerHTML = `
                <div class="col-12 text-center py-5">
                    <i class="fas fa-exclamation-triangle text-warning mb-3" style="font-size: 3rem;"></i>
                    <h5 class="text-muted">${message}</h5>
                    <button class="btn btn-outline-warning mt-2" onclick="location.reload()">
                        <i class="fas fa-refresh me-1"></i>Try Again
                    </button>
                </div>
            `;
            }

            // Global functions
            window.viewAnimeDetails = function (animeId) {
                window.location.href = `/content/details.html?id=${animeId}`;
            };

            window.toggleAnimeFavorite = async function (animeId, button) {
                try {
                    if (!window.auth || !window.auth.isAuthenticated()) {
                        window.location.href = '/auth/login.html';
                        return;
                    }

                    await window.api.recordInteraction(animeId, 'favorite');

                    const icon = button.querySelector('i');
                    icon.classList.add('heart-beat');
                    button.classList.toggle('btn-outline-warning');
                    button.classList.toggle('btn-warning');

                    setTimeout(() => {
                        icon.classList.remove('heart-beat');
                    }, 600);

                    if (window.showToast) {
                        window.showToast('Anime added to favorites!', 'success');
                    }
                } catch (error) {
                    console.error('Failed to toggle favorite:', error);
                    if (window.showToast) {
                        window.showToast('Failed to update favorites', 'error');
                    }
                }
            };

            // Initialize when DOM is ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initAnimePage);
            } else {
                initAnimePage();
            }
        })();
    </script>

    <!-- Anime-specific Styles -->
    <style>
        .anime-card {
            border: 2px solid transparent;
            background: linear-gradient(135deg, rgba(20, 20, 24, 0.9) 0%, rgba(30, 30, 35, 0.8) 100%);
        }

        .anime-card:hover {
            border-color: rgba(245, 158, 11, 0.5);
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.05) 0%, rgba(30, 30, 35, 0.9) 100%);
        }

        .anime-poster {
            transition: transform 0.5s ease;
        }

        .anime-category {
            transition: all 0.3s ease;
            border-width: 2px;
        }

        .anime-category:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
        }

        .anime-category.active {
            background: var(--vip-gold);
            border-color: var(--vip-gold);
            color: var(--cinema-black) !important;
        }

        .anime-title {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        .anime-card-wrapper {
            opacity: 0;
        }

        .anime-card-wrapper.fade-in-up {
            animation: fadeInUp 0.6s ease-out forwards;
        }

        #animeGenreTabs .nav-link {
            color: rgba(255, 255, 255, 0.7);
            border: 2px solid transparent;
            margin: 0.25rem;
            transition: all 0.3s ease;
        }

        #animeGenreTabs .nav-link:hover {
            color: var(--vip-gold);
            border-color: rgba(245, 158, 11, 0.3);
            transform: translateY(-2px);
        }

        #animeGenreTabs .nav-link.active {
            background: var(--vip-gold);
            border-color: var(--vip-gold);
            color: var(--cinema-black);
        }
    </style>
</body>

</html>
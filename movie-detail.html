<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Details - MovieRec</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --netflix-red: #e50914;
            --netflix-dark: #141414;
            --netflix-gray: #333333;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: linear-gradient(135deg, #141414 0%, #000000 100%);
            color: white;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 0;
        }

        .hero-backdrop {
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }

        .hero-overlay {
            background: linear-gradient(to bottom, rgba(0,0,0,0.3) 0%, rgba(0,0,0,0.7) 50%, rgba(20,20,20,1) 100%);
        }

        .navbar {
            backdrop-filter: blur(20px);
            background: rgba(20, 20, 20, 0.95);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .content-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--netflix-red) 0%, #c41e3a 100%);
            transition: all 0.3s ease;
            min-height: 44px;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #c41e3a 0%, var(--netflix-red) 100%);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(229, 9, 20, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            min-height: 44px;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .cast-card {
            transition: all 0.3s ease;
        }

        .cast-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .rating-star {
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .rating-star:hover {
            transform: scale(1.2);
        }

        .rating-star.filled {
            color: #fbbf24;
        }

        .rating-star.empty {
            color: #6b7280;
        }

        .video-thumbnail {
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .video-thumbnail:hover {
            transform: scale(1.05);
        }

        .video-play-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .video-thumbnail:hover .video-play-button {
            background: var(--netflix-red);
            transform: translate(-50%, -50%) scale(1.1);
        }

        .tab-content {
            min-height: 300px;
        }

        .tab-button {
            transition: all 0.3s ease;
            border-bottom: 2px solid transparent;
        }

        .tab-button.active {
            border-bottom-color: var(--netflix-red);
            color: var(--netflix-red);
        }

        .scroll-container {
            scrollbar-width: none;
            -ms-overflow-style: none;
            overflow-x: auto;
            scroll-behavior: smooth;
        }

        .scroll-container::-webkit-scrollbar {
            display: none;
        }

        @media (max-width: 768px) {
            .hero-content {
                padding: 2rem 1rem;
            }
            
            .poster-image {
                width: 200px;
                height: 300px;
            }
        }

        @media (min-width: 769px) {
            .poster-image {
                width: 300px;
                height: 450px;
            }
        }

        .loading-shimmer {
            background: linear-gradient(90deg, #333 25%, #555 50%, #333 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        .modal {
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar fixed top-0 w-full z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="text-white hover:text-red-400 transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                        </svg>
                    </button>
                    <h1 class="text-xl font-bold text-red-500">MovieRec</h1>
                </div>
                
                <div class="flex items-center space-x-4">
                    <button onclick="shareContent()" class="text-white hover:text-red-400 transition-colors p-2">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"></path>
                        </svg>
                    </button>
                    
                    <a href="dashboard.html" class="text-white hover:text-red-400 transition-colors">
                        Dashboard
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section id="hero-section" class="hero-backdrop min-h-screen relative">
        <div class="hero-overlay absolute inset-0"></div>
        <div class="relative z-10 pt-16">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="hero-content flex flex-col lg:flex-row gap-8 py-12">
                    <!-- Poster -->
                    <div class="flex-shrink-0">
                        <img id="movie-poster" 
                             src="" 
                             alt="Movie Poster"
                             class="poster-image rounded-lg shadow-2xl mx-auto lg:mx-0">
                    </div>
                    
                    <!-- Content -->
                    <div class="flex-1 space-y-6">
                        <div>
                            <h1 id="movie-title" class="text-4xl lg:text-6xl font-bold text-white mb-2">
                                Loading...
                            </h1>
                            <p id="movie-subtitle" class="text-xl text-gray-300 mb-4"></p>
                            
                            <!-- Meta Info -->
                            <div class="flex flex-wrap items-center gap-4 text-sm text-gray-300 mb-6">
                                <span id="movie-year" class="bg-gray-700 px-3 py-1 rounded-full">-</span>
                                <span id="movie-rating" class="bg-yellow-600 px-3 py-1 rounded-full">‚≠ê -</span>
                                <span id="movie-runtime" class="bg-gray-700 px-3 py-1 rounded-full">-</span>
                                <span id="movie-type" class="bg-red-600 px-3 py-1 rounded-full">-</span>
                            </div>
                            
                            <!-- Genres -->
                            <div id="movie-genres" class="flex flex-wrap gap-2 mb-6">
                                <!-- Genres will be loaded here -->
                            </div>
                        </div>
                        
                        <!-- Description -->
                        <div>
                            <p id="movie-overview" class="text-gray-300 text-lg leading-relaxed max-w-3xl">
                                Loading description...
                            </p>
                        </div>
                        
                        <!-- Action Buttons -->
                        <div class="flex flex-wrap gap-4">
                            <button onclick="watchTrailer()" class="btn-primary px-8 py-3 rounded-lg font-semibold flex items-center space-x-2">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"></path>
                                </svg>
                                <span>Watch Trailer</span>
                            </button>
                            
                            <button onclick="addToWatchlist()" id="watchlist-btn" class="btn-secondary text-white px-6 py-3 rounded-lg font-semibold flex items-center space-x-2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                </svg>
                                <span>Add to Watchlist</span>
                            </button>
                            
                            <button onclick="addToFavorites()" id="favorites-btn" class="btn-secondary text-white px-6 py-3 rounded-lg font-semibold flex items-center space-x-2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                                </svg>
                                <span>Add to Favorites</span>
                            </button>
                        </div>
                        
                        <!-- User Rating -->
                        <div class="content-card p-6 rounded-lg">
                            <h3 class="text-lg font-semibold mb-4">Rate This Movie</h3>
                            <div class="flex items-center space-x-2">
                                <div id="rating-stars" class="flex space-x-1">
                                    <!-- Stars will be generated here -->
                                </div>
                                <span id="rating-text" class="text-gray-400 ml-4">Click to rate</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Content Tabs -->
    <section class="bg-gray-900 py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <!-- Tab Navigation -->
            <div class="border-b border-gray-700 mb-8">
                <nav class="flex space-x-8">
                    <button onclick="switchTab('overview')" id="overview-tab" class="tab-button active py-4 px-1 font-medium">
                        Overview
                    </button>
                    <button onclick="switchTab('cast')" id="cast-tab" class="tab-button py-4 px-1 font-medium">
                        Cast & Crew
                    </button>
                    <button onclick="switchTab('videos')" id="videos-tab" class="tab-button py-4 px-1 font-medium">
                        Videos
                    </button>
                    <button onclick="switchTab('reviews')" id="reviews-tab" class="tab-button py-4 px-1 font-medium">
                        Reviews
                    </button>
                    <button onclick="switchTab('similar')" id="similar-tab" class="tab-button py-4 px-1 font-medium">
                        Similar
                    </button>
                </nav>
            </div>

            <!-- Tab Content -->
            <div id="tab-content" class="tab-content">
                <!-- Overview Tab -->
                <div id="overview-content" class="tab-pane">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <div class="lg:col-span-2">
                            <h3 class="text-2xl font-bold mb-4">Plot Summary</h3>
                            <p id="detailed-overview" class="text-gray-300 text-lg leading-relaxed mb-6">
                                Loading detailed overview...
                            </p>
                            
                            <!-- Additional Details -->
                            <div id="movie-details" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <!-- Details will be loaded here -->
                            </div>
                        </div>
                        
                        <div>
                            <!-- Quick Stats -->
                            <div class="content-card p-6 rounded-lg mb-6">
                                <h4 class="text-lg font-semibold mb-4">Quick Info</h4>
                                <div id="quick-stats" class="space-y-3">
                                    <!-- Stats will be loaded here -->
                                </div>
                            </div>
                            
                            <!-- Keywords/Tags -->
                            <div class="content-card p-6 rounded-lg">
                                <h4 class="text-lg font-semibold mb-4">Keywords</h4>
                                <div id="movie-keywords" class="flex flex-wrap gap-2">
                                    <!-- Keywords will be loaded here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Cast Tab -->
                <div id="cast-content" class="tab-pane hidden">
                    <h3 class="text-2xl font-bold mb-6">Cast & Crew</h3>
                    <div id="cast-grid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-6">
                        <!-- Cast will be loaded here -->
                    </div>
                </div>

                <!-- Videos Tab -->
                <div id="videos-content" class="tab-pane hidden">
                    <h3 class="text-2xl font-bold mb-6">Trailers & Videos</h3>
                    <div id="videos-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Videos will be loaded here -->
                    </div>
                </div>

                <!-- Reviews Tab -->
                <div id="reviews-content" class="tab-pane hidden">
                    <h3 class="text-2xl font-bold mb-6">User Reviews</h3>
                    <div id="reviews-list" class="space-y-6">
                        <!-- Reviews will be loaded here -->
                    </div>
                </div>

                <!-- Similar Tab -->
                <div id="similar-content" class="tab-pane hidden">
                    <h3 class="text-2xl font-bold mb-6">You Might Also Like</h3>
                    <div id="similar-grid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-6">
                        <!-- Similar content will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Video Modal -->
    <div id="video-modal" class="modal fixed inset-0 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-black rounded-lg overflow-hidden w-full max-w-4xl">
            <div class="flex items-center justify-between p-4 border-b border-gray-700">
                <h3 id="video-modal-title" class="text-lg font-semibold">Video</h3>
                <button onclick="closeVideoModal()" class="text-gray-400 hover:text-white">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div id="video-modal-content" class="aspect-video">
                <!-- Video will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-75 z-40 flex items-center justify-center hidden">
        <div class="text-center">
            <div class="loading-shimmer w-16 h-16 rounded-full mb-4"></div>
            <p class="text-white">Loading movie details...</p>
        </div>
    </div>

    <script>
        const API_BASE = 'https://backend-app-970m.onrender.com/api';
        let authToken = window.authToken || null;
        let currentMovie = null;
        let currentTab = 'overview';
        let userRating = 0;

        // Get movie ID from URL
        function getMovieIdFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('id');
        }

        // Utility functions
        function showLoading() {
            document.getElementById('loading-overlay').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loading-overlay').classList.add('hidden');
        }

        function goBack() {
            window.history.back();
        }

        // API calls
        async function fetchMovieDetails(movieId) {
            try {
                const response = await fetch(`${API_BASE}/content/${movieId}/details`);
                if (!response.ok) throw new Error('Failed to fetch movie details');
                return await response.json();
            } catch (error) {
                console.error('Error fetching movie details:', error);
                throw error;
            }
        }

        async function interactWithContent(contentId, interactionType, rating = null) {
            if (!authToken) {
                alert('Please log in to interact with content');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/interact`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        content_id: contentId,
                        interaction_type: interactionType,
                        rating: rating
                    })
                });

                if (!response.ok) throw new Error('Failed to record interaction');
                
                showInteractionFeedback(interactionType);
                return await response.json();
            } catch (error) {
                console.error('Interaction error:', error);
                throw error;
            }
        }

        // Content rendering functions
        function renderMovieDetails(movie) {
            currentMovie = movie;
            
            // Update hero section
            const poster = movie.content.poster_path || 'https://via.placeholder.com/300x450/333/fff?text=No+Image';
            const backdrop = movie.content.backdrop_path || poster;
            
            document.getElementById('movie-poster').src = poster;
            document.getElementById('movie-title').textContent = movie.content.title;
            document.getElementById('movie-subtitle').textContent = movie.content.original_title || '';
            document.getElementById('detailed-overview').textContent = movie.content.overview || 'No description available.';
            
            // Set backdrop
            const heroSection = document.getElementById('hero-section');
            heroSection.style.backgroundImage = `url(${backdrop})`;
            
            // Meta information
            document.getElementById('movie-year').textContent = movie.content.release_date ? 
                new Date(movie.content.release_date).getFullYear() : 'Unknown';
            document.getElementById('movie-rating').textContent = `‚≠ê ${movie.content.rating?.toFixed(1) || 'N/A'}`;
            document.getElementById('movie-runtime').textContent = movie.content.runtime ? 
                `${movie.content.runtime} min` : 'Unknown';
            document.getElementById('movie-type').textContent = movie.content.content_type || 'Movie';
            
            // Genres
            const genresContainer = document.getElementById('movie-genres');
            genresContainer.innerHTML = (movie.content.genre_names || []).map(genre => 
                `<span class="bg-gray-700 text-gray-300 px-3 py-1 rounded-full text-sm">${genre}</span>`
            ).join('');
            
            // Initialize rating stars
            initializeRatingStars();
            
            // Load tab content
            loadOverviewContent(movie);
        }

        function loadOverviewContent(movie) {
            // Quick stats
            const quickStats = document.getElementById('quick-stats');
            const stats = [
                { label: 'Release Date', value: movie.content.release_date || 'Unknown' },
                { label: 'Language', value: movie.content.language?.toUpperCase() || 'Unknown' },
                { label: 'Content Type', value: movie.content.content_type || 'Movie' },
                { label: 'Popularity', value: movie.content.popularity?.toFixed(1) || 'N/A' }
            ];
            
            quickStats.innerHTML = stats.map(stat => `
                <div class="flex justify-between">
                    <span class="text-gray-400">${stat.label}:</span>
                    <span class="text-white">${stat.value}</span>
                </div>
            `).join('');
            
            // Movie details from TMDB
            const detailsContainer = document.getElementById('movie-details');
            if (movie.tmdb_details) {
                const details = movie.tmdb_details;
                detailsContainer.innerHTML = `
                    <div class="content-card p-4 rounded-lg">
                        <h4 class="font-semibold mb-2">Production</h4>
                        <p class="text-gray-300 text-sm">${details.production_companies?.map(c => c.name).join(', ') || 'Unknown'}</p>
                    </div>
                    <div class="content-card p-4 rounded-lg">
                        <h4 class="font-semibold mb-2">Budget</h4>
                        <p class="text-gray-300 text-sm">${details.budget ? `$${(details.budget / 1000000).toFixed(1)}M` : 'Unknown'}</p>
                    </div>
                `;
            }
            
            // Keywords
            const keywordsContainer = document.getElementById('movie-keywords');
            const keywords = movie.tmdb_details?.keywords?.keywords || movie.tmdb_details?.keywords || [];
            if (keywords.length > 0) {
                keywordsContainer.innerHTML = keywords.slice(0, 10).map(keyword => 
                    `<span class="bg-blue-600 text-white px-2 py-1 rounded text-xs">${keyword.name || keyword}</span>`
                ).join('');
            } else {
                keywordsContainer.innerHTML = '<span class="text-gray-400">No keywords available</span>';
            }
        }

        function loadCastContent(movie) {
            const castContainer = document.getElementById('cast-grid');
            const cast = movie.tmdb_details?.credits?.cast || [];
            
            if (cast.length > 0) {
                castContainer.innerHTML = cast.slice(0, 12).map(person => `
                    <div class="cast-card text-center">
                        <img src="${person.profile_path ? `https://image.tmdb.org/t/p/w200${person.profile_path}` : 'https://via.placeholder.com/200x300/333/fff?text=No+Photo'}" 
                             alt="${person.name}"
                             class="w-full h-40 object-cover rounded-lg mb-3"
                             loading="lazy">
                        <h4 class="font-semibold text-sm text-white">${person.name}</h4>
                        <p class="text-gray-400 text-xs">${person.character || person.job || ''}</p>
                    </div>
                `).join('');
            } else {
                castContainer.innerHTML = '<p class="col-span-full text-gray-400 text-center">No cast information available</p>';
            }
        }

        function loadVideosContent(movie) {
            const videosContainer = document.getElementById('videos-grid');
            const videos = movie.youtube_videos || {};
            const allVideos = [...(videos.trailers || []), ...(videos.teasers || [])];
            
            if (allVideos.length > 0) {
                videosContainer.innerHTML = allVideos.map(video => `
                    <div class="video-thumbnail rounded-lg overflow-hidden" onclick="playVideo('${video.video_id}', '${video.title}')">
                        <img src="${video.thumbnail}" 
                             alt="${video.title}"
                             class="w-full h-48 object-cover">
                        <div class="video-play-button">
                            <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                        <div class="p-3">
                            <h4 class="text-white font-medium text-sm">${video.title}</h4>
                            <p class="text-gray-400 text-xs">${video.type}</p>
                        </div>
                    </div>
                `).join('');
            } else {
                videosContainer.innerHTML = '<p class="col-span-full text-gray-400 text-center">No videos available</p>';
            }
        }

        function loadReviewsContent(movie) {
            const reviewsContainer = document.getElementById('reviews-list');
            const reviews = movie.user_reviews || [];
            
            if (reviews.length > 0) {
                reviewsContainer.innerHTML = reviews.map(review => `
                    <div class="content-card p-6 rounded-lg">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 bg-red-600 rounded-full flex items-center justify-center">
                                    <span class="text-white font-semibold">${review.username.charAt(0).toUpperCase()}</span>
                                </div>
                                <div>
                                    <h4 class="font-semibold text-white">${review.username}</h4>
                                    <p class="text-gray-400 text-sm">${new Date(review.created_at).toLocaleDateString()}</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-1">
                                ${Array.from({length: 5}, (_, i) => 
                                    `<span class="text-${i < review.rating ? 'yellow' : 'gray'}-400">‚≠ê</span>`
                                ).join('')}
                                <span class="text-gray-400 ml-2">${review.rating}/5</span>
                            </div>
                        </div>
                        <p class="text-gray-300">${review.review_text || 'No review text provided.'}</p>
                    </div>
                `).join('');
            } else {
                reviewsContainer.innerHTML = '<p class="text-gray-400 text-center">No reviews yet. Be the first to review!</p>';
            }
        }

        function loadSimilarContent(movie) {
            const similarContainer = document.getElementById('similar-grid');
            const similar = movie.similar_content || [];
            
            if (similar.length > 0) {
                similarContainer.innerHTML = similar.map(item => `
                    <div class="cursor-pointer" onclick="viewMovie(${item.id})">
                        <img src="${item.poster_path || 'https://via.placeholder.com/300x450/333/fff?text=No+Image'}" 
                             alt="${item.title}"
                             class="w-full h-64 object-cover rounded-lg mb-3 hover:opacity-80 transition-opacity"
                             loading="lazy">
                        <h4 class="font-semibold text-sm text-white">${item.title}</h4>
                        <p class="text-gray-400 text-xs">${item.release_date?.split('-')[0] || ''}</p>
                        <div class="flex items-center space-x-1 mt-1">
                            <span class="text-yellow-400 text-xs">‚≠ê</span>
                            <span class="text-gray-300 text-xs">${item.rating?.toFixed(1) || 'N/A'}</span>
                        </div>
                    </div>
                `).join('');
            } else {
                similarContainer.innerHTML = '<p class="col-span-full text-gray-400 text-center">No similar content found</p>';
            }
        }

        // Tab switching
        function switchTab(tabName) {
            // Hide all tab content
            document.querySelectorAll('.tab-pane').forEach(pane => {
                pane.classList.add('hidden');
            });
            
            // Remove active class from all tab buttons
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(`${tabName}-content`).classList.remove('hidden');
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            currentTab = tabName;
            
            // Load content based on tab
            if (currentMovie) {
                switch(tabName) {
                    case 'cast':
                        loadCastContent(currentMovie);
                        break;
                    case 'videos':
                        loadVideosContent(currentMovie);
                        break;
                    case 'reviews':
                        loadReviewsContent(currentMovie);
                        break;
                    case 'similar':
                        loadSimilarContent(currentMovie);
                        break;
                }
            }
        }

        // Rating system
        function initializeRatingStars() {
            const starsContainer = document.getElementById('rating-stars');
            starsContainer.innerHTML = Array.from({length: 5}, (_, i) => 
                `<span class="rating-star empty text-2xl" onclick="setRating(${i + 1})">‚≠ê</span>`
            ).join('');
        }

        function setRating(rating) {
            userRating = rating;
            const stars = document.querySelectorAll('.rating-star');
            const ratingText = document.getElementById('rating-text');
            
            stars.forEach((star, index) => {
                if (index < rating) {
                    star.classList.remove('empty');
                    star.classList.add('filled');
                } else {
                    star.classList.remove('filled');
                    star.classList.add('empty');
                }
            });
            
            ratingText.textContent = `You rated this ${rating}/5 stars`;
            
            // Submit rating
            if (currentMovie && authToken) {
                interactWithContent(currentMovie.content.id, 'view', rating);
            }
        }

        // Action functions
        async function addToWatchlist() {
            if (!currentMovie) return;
            
            try {
                await interactWithContent(currentMovie.content.id, 'wishlist');
                const btn = document.getElementById('watchlist-btn');
                btn.innerHTML = `
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    <span>Added to Watchlist</span>
                `;
                btn.disabled = true;
                btn.classList.add('opacity-50');
            } catch (error) {
                console.error('Error adding to watchlist:', error);
            }
        }

        async function addToFavorites() {
            if (!currentMovie) return;
            
            try {
                await interactWithContent(currentMovie.content.id, 'favorite');
                const btn = document.getElementById('favorites-btn');
                btn.innerHTML = `
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd"></path>
                    </svg>
                    <span>Added to Favorites</span>
                `;
                btn.disabled = true;
                btn.classList.add('opacity-50');
            } catch (error) {
                console.error('Error adding to favorites:', error);
            }
        }

        function watchTrailer() {
            if (currentMovie && currentMovie.youtube_videos) {
                const trailers = currentMovie.youtube_videos.trailers || [];
                if (trailers.length > 0) {
                    playVideo(trailers[0].video_id, trailers[0].title);
                } else {
                    alert('No trailer available for this movie');
                }
            }
        }

        function playVideo(videoId, title) {
            const modal = document.getElementById('video-modal');
            const modalTitle = document.getElementById('video-modal-title');
            const modalContent = document.getElementById('video-modal-content');
            
            modalTitle.textContent = title;
            modalContent.innerHTML = `
                <iframe width="100%" height="100%" 
                        src="https://www.youtube.com/embed/${videoId}?autoplay=1" 
                        frameborder="0" 
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                        allowfullscreen>
                </iframe>
            `;
            
            modal.classList.remove('hidden');
        }

        function closeVideoModal() {
            const modal = document.getElementById('video-modal');
            const modalContent = document.getElementById('video-modal-content');
            
            modalContent.innerHTML = '';
            modal.classList.add('hidden');
        }

        function shareContent() {
            if (navigator.share && currentMovie) {
                navigator.share({
                    title: currentMovie.content.title,
                    text: currentMovie.content.overview,
                    url: window.location.href
                });
            } else {
                // Fallback: copy to clipboard
                navigator.clipboard.writeText(window.location.href).then(() => {
                    alert('Link copied to clipboard!');
                });
            }
        }

        function viewMovie(movieId) {
            window.location.href = `movie-detail.html?id=${movieId}`;
        }

        function showInteractionFeedback(type) {
            const messages = {
                'favorite': '‚ù§Ô∏è Added to favorites!',
                'wishlist': 'üìå Added to watchlist!',
                'view': 'üëÅÔ∏è Rating submitted!'
            };

            const message = messages[type] || 'Action completed!';
            
            // Create toast notification
            const toast = document.createElement('div');
            toast.className = 'fixed top-20 right-4 bg-green-600 text-white px-6 py-3 rounded-lg z-50 transform translate-x-full';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            // Animate in
            setTimeout(() => {
                toast.classList.remove('translate-x-full');
            }, 100);
            
            // Remove after 3 seconds
            setTimeout(() => {
                toast.classList.add('translate-x-full');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const videoModal = document.getElementById('video-modal');
                if (!videoModal.classList.contains('hidden')) {
                    closeVideoModal();
                }
            }
        });

        // Initialize page
        async function initializePage() {
            const movieId = getMovieIdFromUrl();
            
            if (!movieId) {
                alert('No movie ID provided');
                window.location.href = 'index.html';
                return;
            }

            try {
                showLoading();
                const movieData = await fetchMovieDetails(movieId);
                renderMovieDetails(movieData);
                hideLoading();
            } catch (error) {
                console.error('Error loading movie:', error);
                hideLoading();
                alert('Failed to load movie details');
                window.location.href = 'index.html';
            }
        }

        // Load page when DOM is ready
        document.addEventListener('DOMContentLoaded', initializePage);
    </script>
</body>
</html>
<!-- Reusable Header Component -->
<header class="header">
    <nav class="nav container">
        <!-- Brand -->
        <div class="nav-brand">
            <a href="/" class="nav-brand">CineScope</a>
        </div>

        <!-- Search Bar -->
        <div class="search-container">
            <svg class="search-icon" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"></path>
            </svg>
            <input type="text" 
                   placeholder="Search movies, TV shows, anime..." 
                   class="search-input"
                   data-search-input>
            <div class="search-results" style="display: none;"></div>
        </div>

        <!-- Desktop Navigation -->
        <div class="nav-menu">
            <!-- Browse Menu -->
            <div class="dropdown">
                <button class="dropdown-toggle nav-link">
                    Browse
                    <svg width="12" height="12" fill="currentColor" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/>
                    </svg>
                </button>
                <div class="dropdown-menu">
                    <a href="/categories/movies" class="dropdown-item">🎬 Movies</a>
                    <a href="/categories/tv-shows" class="dropdown-item">📺 TV Shows</a>
                    <a href="/categories/anime" class="dropdown-item">🎌 Anime</a>
                    <div class="dropdown-divider"></div>
                    <a href="/categories/trending" class="dropdown-item">🔥 Trending</a>
                    <a href="/categories/popular" class="dropdown-item">⭐ Popular</a>
                    <a href="/categories/new-releases" class="dropdown-item">✨ New Releases</a>
                    <a href="/categories/critic-choices" class="dropdown-item">🏆 Critics Choice</a>
                </div>
            </div>

            <!-- Languages Menu -->
            <div class="dropdown">
                <button class="dropdown-toggle nav-link">
                    Languages
                    <svg width="12" height="12" fill="currentColor" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/>
                    </svg>
                </button>
                <div class="dropdown-menu">
                    <a href="/languages/english" class="dropdown-item">🇺🇸 English</a>
                    <a href="/languages/hindi" class="dropdown-item">🇮🇳 Hindi</a>
                    <a href="/languages/telugu" class="dropdown-item">🎭 Telugu</a>
                    <a href="/languages/tamil" class="dropdown-item">🎪 Tamil</a>
                    <a href="/languages/kannada" class="dropdown-item">🎨 Kannada</a>
                    <a href="/languages/malayalam" class="dropdown-item">🌴 Malayalam</a>
                </div>
            </div>

            <!-- User Menu -->
            <div class="flex items-center gap-4">
                <!-- Not Authenticated -->
                <div data-auth="false">
                    <a href="/login" class="btn btn-outline btn-sm">Sign In</a>
                </div>
                
                <!-- Authenticated -->
                <div data-auth="required" class="flex items-center gap-2">
                    <a href="/dashboard" class="nav-link">Dashboard</a>
                    
                    <!-- User Dropdown -->
                    <div class="dropdown">
                        <button class="dropdown-toggle flex items-center gap-2 p-2 rounded-lg hover:bg-gray-800">
                            <div class="w-8 h-8 bg-gradient-primary rounded-full flex items-center justify-center text-sm font-bold">
                                <span data-user="initials"></span>
                            </div>
                            <span data-user="name" class="hidden md:inline"></span>
                            <svg width="12" height="12" fill="currentColor" viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/>
                            </svg>
                        </button>
                        <div class="dropdown-menu">
                            <a href="/profile" class="dropdown-item">👤 Profile</a>
                            <a href="/user/watchlist" class="dropdown-item">📚 Watchlist</a>
                            <a href="/user/favorites" class="dropdown-item">❤️ Favorites</a>
                            <div class="dropdown-divider"></div>
                            <div data-admin="true">
                                <a href="/admin/dashboard" class="dropdown-item">⚡ Admin Dashboard</a>
                                <div class="dropdown-divider"></div>
                            </div>
                            <button onclick="app.logout()" class="dropdown-item w-full text-left text-red-400">
                                🚪 Logout
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mobile Menu Button -->
        <button class="btn btn-secondary md:hidden" data-mobile-menu-toggle>
            <svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z"/>
            </svg>
        </button>
    </nav>
</header>

<!-- Mobile Menu -->
<div class="mobile-menu">
    <div class="mobile-menu-header">
        <div class="nav-brand">CineScope</div>
        <button class="btn btn-secondary" data-mobile-menu-toggle>
            <svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
            </svg>
        </button>
    </div>
    <nav class="mobile-menu-nav">
        <a href="/" class="mobile-menu-link">🏠 Home</a>
        
        <!-- Browse Section -->
        <div class="mobile-menu-section">
            <div class="mobile-menu-section-title">Browse</div>
            <a href="/categories/movies" class="mobile-menu-link pl-4">🎬 Movies</a>
            <a href="/categories/tv-shows" class="mobile-menu-link pl-4">📺 TV Shows</a>
            <a href="/categories/anime" class="mobile-menu-link pl-4">🎌 Anime</a>
            <a href="/categories/trending" class="mobile-menu-link pl-4">🔥 Trending</a>
            <a href="/categories/new-releases" class="mobile-menu-link pl-4">✨ New Releases</a>
        </div>

        <!-- Languages Section -->
        <div class="mobile-menu-section">
            <div class="mobile-menu-section-title">Languages</div>
            <a href="/languages/english" class="mobile-menu-link pl-4">🇺🇸 English</a>
            <a href="/languages/hindi" class="mobile-menu-link pl-4">🇮🇳 Hindi</a>
            <a href="/languages/telugu" class="mobile-menu-link pl-4">🎭 Telugu</a>
            <a href="/languages/tamil" class="mobile-menu-link pl-4">🎪 Tamil</a>
        </div>
        
        <div data-auth="false">
            <a href="/login" class="mobile-menu-link">🔐 Sign In</a>
        </div>
        
        <div data-auth="required">
            <a href="/dashboard" class="mobile-menu-link">📊 Dashboard</a>
            <a href="/user/watchlist" class="mobile-menu-link">📚 Watchlist</a>
            <a href="/user/favorites" class="mobile-menu-link">❤️ Favorites</a>
            <a href="/profile" class="mobile-menu-link">👤 Profile</a>
            <div data-admin="true">
                <a href="/admin/dashboard" class="mobile-menu-link">⚡ Admin Dashboard</a>
            </div>
            <button onclick="app.logout()" class="mobile-menu-link w-full text-left text-red-400">🚪 Logout</button>
        </div>
    </nav>
</div>

<script>
// Initialize header functionality
document.addEventListener('DOMContentLoaded', function() {
    // Setup dropdown menus
    setupDropdowns();
    
    // Update user info in header
    updateHeaderUserInfo();
    
    // Setup mobile menu
    setupMobileMenu();
});

function setupDropdowns() {
    const dropdowns = document.querySelectorAll('.dropdown');
    
    dropdowns.forEach(dropdown => {
        const toggle = dropdown.querySelector('.dropdown-toggle');
        const menu = dropdown.querySelector('.dropdown-menu');
        
        if (!toggle || !menu) return;
        
        toggle.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            
            // Close other dropdowns
            dropdowns.forEach(other => {
                if (other !== dropdown) {
                    other.classList.remove('active');
                }
            });
            
            // Toggle current dropdown
            dropdown.classList.toggle('active');
        });
    });
    
    // Close dropdowns when clicking outside
    document.addEventListener('click', () => {
        dropdowns.forEach(dropdown => {
            dropdown.classList.remove('active');
        });
    });
}

function updateHeaderUserInfo() {
    if (window.app && window.app.isAuthenticated() && window.app.user) {
        const user = window.app.user;
        
        // Update user name
        const nameElements = document.querySelectorAll('[data-user="name"]');
        nameElements.forEach(el => el.textContent = user.username);
        
        // Update user initials
        const initialsElements = document.querySelectorAll('[data-user="initials"]');
        const initials = user.username.substring(0, 2).toUpperCase();
        initialsElements.forEach(el => el.textContent = initials);
    }
}

function setupMobileMenu() {
    const toggles = document.querySelectorAll('[data-mobile-menu-toggle]');
    const mobileMenu = document.querySelector('.mobile-menu');
    
    toggles.forEach(toggle => {
        toggle.addEventListener('click', () => {
            if (mobileMenu) {
                mobileMenu.classList.toggle('active');
                document.body.style.overflow = mobileMenu.classList.contains('active') ? 'hidden' : '';
            }
        });
    });
    
    // Close mobile menu when clicking menu links
    const mobileLinks = document.querySelectorAll('.mobile-menu-link');
    mobileLinks.forEach(link => {
        link.addEventListener('click', () => {
            if (mobileMenu) {
                mobileMenu.classList.remove('active');
                document.body.style.overflow = '';
            }
        });
    });
}
</script>

<style>
.mobile-menu-section {
    margin: 1rem 0;
}

.mobile-menu-section-title {
    font-weight: 600;
    color: var(--text-muted);
    font-size: 0.875rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 0.5rem;
    padding: 0 1rem;
}

.pl-4 {
    padding-left: 1rem;
}
</style>

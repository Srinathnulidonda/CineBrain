<!-- CineScope Filters Offcanvas -->
<div class="offcanvas offcanvas-start" tabindex="-1" id="filtersOffcanvas">
    <div class="offcanvas-header border-bottom border-secondary">
        <h5 class="offcanvas-title text-white">
            <i class="bi bi-funnel me-2"></i>Filters
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas"></button>
    </div>
    <div class="offcanvas-body">
        <form id="filters-form">
            <!-- Content Type -->
            <div class="mb-4">
                <h6 class="text-white mb-3">Content Type</h6>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="filter-movies" value="movie" checked>
                    <label class="form-check-label text-secondary" for="filter-movies">Movies</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="filter-tv" value="tv" checked>
                    <label class="form-check-label text-secondary" for="filter-tv">TV Shows</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="filter-anime" value="anime" checked>
                    <label class="form-check-label text-secondary" for="filter-anime">Anime</label>
                </div>
            </div>

            <!-- Genres -->
            <div class="mb-4">
                <h6 class="text-white mb-3">Genres</h6>
                <div class="row g-2">
                    <div class="col-6">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="genre-action" value="action">
                            <label class="form-check-label text-secondary" for="genre-action">Action</label>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="genre-comedy" value="comedy">
                            <label class="form-check-label text-secondary" for="genre-comedy">Comedy</label>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="genre-drama" value="drama">
                            <label class="form-check-label text-secondary" for="genre-drama">Drama</label>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="genre-horror" value="horror">
                            <label class="form-check-label text-secondary" for="genre-horror">Horror</label>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="genre-romance" value="romance">
                            <label class="form-check-label text-secondary" for="genre-romance">Romance</label>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="genre-sci-fi" value="sci-fi">
                            <label class="form-check-label text-secondary" for="genre-sci-fi">Sci-Fi</label>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="genre-thriller" value="thriller">
                            <label class="form-check-label text-secondary" for="genre-thriller">Thriller</label>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="genre-fantasy" value="fantasy">
                            <label class="form-check-label text-secondary" for="genre-fantasy">Fantasy</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Rating Range -->
            <div class="mb-4">
                <h6 class="text-white mb-3">Rating</h6>
                <div class="mb-3">
                    <label for="rating-range" class="form-label text-secondary">
                        Minimum Rating: <span id="rating-value">0</span>/10
                    </label>
                    <input type="range" class="form-range" id="rating-range" min="0" max="10" step="0.5" value="0">
                </div>
            </div>

            <!-- Release Year -->
            <div class="mb-4">
                <h6 class="text-white mb-3">Release Year</h6>
                <div class="row g-2">
                    <div class="col-6">
                        <label for="year-from" class="form-label text-secondary small">From</label>
                        <select class="form-select form-select-sm bg-dark text-white border-secondary" id="year-from">
                            <option value="">Any</option>
                            <option value="2024">2024</option>
                            <option value="2023">2023</option>
                            <option value="2022">2022</option>
                            <option value="2021">2021</option>
                            <option value="2020">2020</option>
                            <option value="2019">2019</option>
                            <option value="2018">2018</option>
                            <option value="2017">2017</option>
                            <option value="2016">2016</option>
                            <option value="2015">2015</option>
                            <option value="2010">2010</option>
                            <option value="2000">2000</option>
                            <option value="1990">1990</option>
                        </select>
                    </div>
                    <div class="col-6">
                        <label for="year-to" class="form-label text-secondary small">To</label>
                        <select class="form-select form-select-sm bg-dark text-white border-secondary" id="year-to">
                            <option value="">Any</option>
                            <option value="2024">2024</option>
                            <option value="2023">2023</option>
                            <option value="2022">2022</option>
                            <option value="2021">2021</option>
                            <option value="2020">2020</option>
                            <option value="2019">2019</option>
                            <option value="2018">2018</option>
                            <option value="2017">2017</option>
                            <option value="2016">2016</option>
                            <option value="2015">2015</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Language -->
            <div class="mb-4">
                <h6 class="text-white mb-3">Language</h6>
                <select class="form-select bg-dark text-white border-secondary" id="language-filter">
                    <option value="">All Languages</option>
                    <option value="english">English</option>
                    <option value="hindi">Hindi</option>
                    <option value="telugu">Telugu</option>
                    <option value="tamil">Tamil</option>
                    <option value="kannada">Kannada</option>
                    <option value="malayalam">Malayalam</option>
                    <option value="japanese">Japanese (Anime)</option>
                    <option value="korean">Korean</option>
                    <option value="spanish">Spanish</option>
                    <option value="french">French</option>
                </select>
            </div>

            <!-- Sort Options -->
            <div class="mb-4">
                <h6 class="text-white mb-3">Sort By</h6>
                <select class="form-select bg-dark text-white border-secondary" id="sort-filter">
                    <option value="popularity">Popularity</option>
                    <option value="rating">Rating</option>
                    <option value="release_date">Release Date</option>
                    <option value="title">Title (A-Z)</option>
                    <option value="recently_added">Recently Added</option>
                </select>
            </div>

            <!-- Action Buttons -->
            <div class="d-grid gap-2">
                <button type="submit" class="btn btn-primary">
                    <i class="bi bi-search me-2"></i>Apply Filters
                </button>
                <button type="button" class="btn btn-outline-secondary" id="clear-filters">
                    <i class="bi bi-x-circle me-2"></i>Clear All
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    // Initialize filters functionality
    document.addEventListener('DOMContentLoaded', function () {
        const ratingRange = document.getElementById('rating-range');
        const ratingValue = document.getElementById('rating-value');
        const filtersForm = document.getElementById('filters-form');
        const clearFiltersBtn = document.getElementById('clear-filters');

        // Update rating display
        if (ratingRange && ratingValue) {
            ratingRange.addEventListener('input', function () {
                ratingValue.textContent = this.value;
            });
        }

        // Handle form submission
        if (filtersForm) {
            filtersForm.addEventListener('submit', function (e) {
                e.preventDefault();

                // Collect filter values
                const filters = {
                    contentTypes: Array.from(document.querySelectorAll('input[type="checkbox"][id^="filter-"]:checked')).map(cb => cb.value),
                    genres: Array.from(document.querySelectorAll('input[type="checkbox"][id^="genre-"]:checked')).map(cb => cb.value),
                    minRating: document.getElementById('rating-range').value,
                    yearFrom: document.getElementById('year-from').value,
                    yearTo: document.getElementById('year-to').value,
                    language: document.getElementById('language-filter').value,
                    sortBy: document.getElementById('sort-filter').value
                };

                // Apply filters
                window.CineScope.Filters.apply(filters);

                // Close offcanvas
                const offcanvas = bootstrap.Offcanvas.getInstance(document.getElementById('filtersOffcanvas'));
                if (offcanvas) {
                    offcanvas.hide();
                }

                // Show toast
                CineScope.UI.toast.info('Filters applied successfully');
            });
        }

        // Handle clear filters
        if (clearFiltersBtn) {
            clearFiltersBtn.addEventListener('click', function () {
                // Reset form
                filtersForm.reset();

                // Reset rating display
                if (ratingValue) {
                    ratingValue.textContent = '0';
                }

                // Clear filters
                window.CineScope.Filters.clear();

                // Show toast
                CineScope.UI.toast.info('Filters cleared');
            });
        }
    });

    // Filters functionality
    window.CineScope = window.CineScope || {};
    window.CineScope.Filters = {
        // Current filters state
        currentFilters: {},

        // Apply filters
        apply(filters) {
            this.currentFilters = filters;

            // Trigger filter event
            document.dispatchEvent(new CustomEvent('cinescope:filtersChanged', {
                detail: filters
            }));

            // Store in localStorage for persistence
            localStorage.setItem('cinescope_filters', JSON.stringify(filters));
        },

        // Clear filters
        clear() {
            this.currentFilters = {};

            // Trigger filter event
            document.dispatchEvent(new CustomEvent('cinescope:filtersCleared'));

            // Remove from localStorage
            localStorage.removeItem('cinescope_filters');
        },

        // Get current filters
        get() {
            return this.currentFilters;
        },

        // Load saved filters
        load() {
            try {
                const saved = localStorage.getItem('cinescope_filters');
                if (saved) {
                    this.currentFilters = JSON.parse(saved);
                    this.applyToForm();
                }
            } catch (error) {
                console.warn('Failed to load saved filters:', error);
            }
        },

        // Apply filters to form UI
        applyToForm() {
            const filters = this.currentFilters;

            // Content types
            if (filters.contentTypes) {
                filters.contentTypes.forEach(type => {
                    const checkbox = document.querySelector(`input[id^="filter-"][value="${type}"]`);
                    if (checkbox) checkbox.checked = true;
                });
            }

            // Genres
            if (filters.genres) {
                filters.genres.forEach(genre => {
                    const checkbox = document.querySelector(`input[id^="genre-"][value="${genre}"]`);
                    if (checkbox) checkbox.checked = true;
                });
            }

            // Rating
            if (filters.minRating) {
                const ratingRange = document.getElementById('rating-range');
                const ratingValue = document.getElementById('rating-value');
                if (ratingRange) {
                    ratingRange.value = filters.minRating;
                    if (ratingValue) ratingValue.textContent = filters.minRating;
                }
            }

            // Year range
            if (filters.yearFrom) {
                const yearFrom = document.getElementById('year-from');
                if (yearFrom) yearFrom.value = filters.yearFrom;
            }

            if (filters.yearTo) {
                const yearTo = document.getElementById('year-to');
                if (yearTo) yearTo.value = filters.yearTo;
            }

            // Language
            if (filters.language) {
                const language = document.getElementById('language-filter');
                if (language) language.value = filters.language;
            }

            // Sort
            if (filters.sortBy) {
                const sort = document.getElementById('sort-filter');
                if (sort) sort.value = filters.sortBy;
            }
        },

        // Build query parameters from filters
        toQueryParams() {
            const filters = this.currentFilters;
            const params = new URLSearchParams();

            if (filters.contentTypes && filters.contentTypes.length > 0) {
                params.set('types', filters.contentTypes.join(','));
            }

            if (filters.genres && filters.genres.length > 0) {
                params.set('genres', filters.genres.join(','));
            }

            if (filters.minRating && filters.minRating > 0) {
                params.set('min_rating', filters.minRating);
            }

            if (filters.yearFrom) {
                params.set('year_from', filters.yearFrom);
            }

            if (filters.yearTo) {
                params.set('year_to', filters.yearTo);
            }

            if (filters.language) {
                params.set('language', filters.language);
            }

            if (filters.sortBy) {
                params.set('sort', filters.sortBy);
            }

            return params.toString();
        }
    };

    // Load saved filters on initialization
    window.CineScope.Filters.load();
</script>
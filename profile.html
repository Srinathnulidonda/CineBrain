<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile - MovieRec</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/responsive.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-primary text-white">
    <!-- Navigation -->
    <nav class="fixed top-0 left-0 right-0 z-50 bg-primary/95 backdrop-blur-sm border-b border-border-color">
        <div class="container mx-auto px-4 py-3">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <a href="index.html" class="text-2xl font-bold text-accent-red">MovieRec</a>
                    <div class="hidden md:flex space-x-6">
                        <a href="index.html" class="nav-link">Home</a>
                        <a href="dashboard.html" class="nav-link">Dashboard</a>
                        <a href="profile.html" class="nav-link text-white">Profile</a>
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="user-menu">
                        <button id="userMenuToggle" class="flex items-center space-x-2 p-2 hover:bg-secondary-bg rounded-lg">
                            <div class="user-avatar"></div>
                            <span id="userName"></span>
                        </button>
                        <div id="userDropdown" class="user-dropdown hidden">
                            <a href="dashboard.html" class="dropdown-item">Dashboard</a>
                            <a href="profile.html" class="dropdown-item">Profile</a>
                            <div class="border-t border-border-color my-2"></div>
                            <button id="logoutBtn" class="dropdown-item w-full text-left">Logout</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="pt-20 pb-8">
        <div class="container mx-auto px-4">
            <!-- Profile Header -->
            <div class="bg-gradient-to-r from-secondary-bg to-dark-blue rounded-lg p-8 mb-8">
                <div class="flex flex-col md:flex-row items-center md:items-start space-y-4 md:space-y-0 md:space-x-6">
                    <div class="relative">
                        <div class="w-24 h-24 bg-accent-red rounded-full flex items-center justify-center text-3xl font-bold">
                            <span id="userInitial"></span>
                        </div>
                        <button class="absolute -bottom-2 -right-2 w-8 h-8 bg-secondary-bg rounded-full flex items-center justify-center hover:bg-card-hover">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
                            </svg>
                        </button>
                    </div>
                    <div class="flex-1 text-center md:text-left">
                        <h1 class="text-3xl font-bold mb-2" id="profileUserName"></h1>
                        <p class="text-text-secondary mb-4" id="profileUserEmail"></p>
                        <div class="flex flex-wrap justify-center md:justify-start gap-4">
                            <div class="text-center">
                                <div class="text-2xl font-bold text-accent-red" id="profileMoviesWatched">0</div>
                                <div class="text-sm text-text-secondary">Movies Watched</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-accent-red" id="profileFavorites">0</div>
                                <div class="text-sm text-text-secondary">Favorites</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-accent-red" id="profileWishlist">0</div>
                                <div class="text-sm text-text-secondary">Wishlist</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Profile Tabs -->
            <div class="profile-tabs mb-8">
                <button class="profile-tab active" data-tab="preferences">Preferences</button>
                <button class="profile-tab" data-tab="activity">Activity</button>
                <button class="profile-tab" data-tab="settings">Settings</button>
            </div>

            <!-- Preferences Tab -->
            <div id="preferencesTab" class="tab-content">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Favorite Genres -->
                    <div class="bg-secondary-bg rounded-lg p-6">
                        <h3 class="text-xl font-bold mb-4">Favorite Genres</h3>
                        <div class="space-y-3">
                            <div class="genre-preference-item">
                                <label class="flex items-center justify-between">
                                    <span>Action</span>
                                    <input type="checkbox" class="genre-checkbox" data-genre="Action">
                                </label>
                            </div>
                            <div class="genre-preference-item">
                                <label class="flex items-center justify-between">
                                    <span>Drama</span>
                                    <input type="checkbox" class="genre-checkbox" data-genre="Drama">
                                </label>
                            </div>
                            <div class="genre-preference-item">
                                <label class="flex items-center justify-between">
                                    <span>Comedy</span>
                                    <input type="checkbox" class="genre-checkbox" data-genre="Comedy">
                                </label>
                            </div>
                            <div class="genre-preference-item">
                                <label class="flex items-center justify-between">
                                    <span>Sci-Fi</span>
                                    <input type="checkbox" class="genre-checkbox" data-genre="Science Fiction">
                                </label>
                            </div>
                            <div class="genre-preference-item">
                                <label class="flex items-center justify-between">
                                    <span>Horror</span>
                                    <input type="checkbox" class="genre-checkbox" data-genre="Horror">
                                </label>
                            </div>
                            <div class="genre-preference-item">
                                <label class="flex items-center justify-between">
                                    <span>Romance</span>
                                    <input type="checkbox" class="genre-checkbox" data-genre="Romance">
                                </label>
                            </div>
                            <div class="genre-preference-item">
                                <label class="flex items-center justify-between">
                                    <span>Thriller</span>
                                    <input type="checkbox" class="genre-checkbox" data-genre="Thriller">
                                </label>
                            </div>
                            <div class="genre-preference-item">
                                <label class="flex items-center justify-between">
                                    <span>Animation</span>
                                    <input type="checkbox" class="genre-checkbox" data-genre="Animation">
                                </label>
                            </div>
                        </div>
                        <button id="saveGenrePreferences" class="btn-primary w-full mt-4">Save Preferences</button>
                    </div>

                    <!-- Language Preferences -->
                    <div class="bg-secondary-bg rounded-lg p-6">
                        <h3 class="text-xl font-bold mb-4">Language Preferences</h3>
                        <div class="space-y-3">
                            <div class="language-preference-item">
                                <label class="flex items-center justify-between">
                                    <span>English</span>
                                    <input type="checkbox" class="language-checkbox" data-language="en" checked>
                                </label>
                            </div>
                            <div class="language-preference-item">
                                <label class="flex items-center justify-between">
                                    <span>Hindi</span>
                                    <input type="checkbox" class="language-checkbox" data-language="hi">
                                </label>
                            </div>
                            <div class="language-preference-item">
                                <label class="flex items-center justify-between">
                                    <span>Telugu</span>
                                    <input type="checkbox" class="language-checkbox" data-language="te">
                                </label>
                            </div>
                            <div class="language-preference-item">
                                <label class="flex items-center justify-between">
                                    <span>Tamil</span>
                                    <input type="checkbox" class="language-checkbox" data-language="ta">
                                </label>
                            </div>
                            <div class="language-preference-item">
                                <label class="flex items-center justify-between">
                                    <span>Kannada</span>
                                    <input type="checkbox" class="language-checkbox" data-language="kn">
                                </label>
                            </div>
                        </div>
                        <button id="saveLanguagePreferences" class="btn-primary w-full mt-4">Save Preferences</button>
                    </div>
                </div>

                <!-- Content Type Preferences -->
                <div class="bg-secondary-bg rounded-lg p-6 mt-8">
                    <h3 class="text-xl font-bold mb-4">Content Type Preferences</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <label class="content-type-card">
                            <input type="checkbox" class="content-type-checkbox" data-type="movie" checked>
                            <div class="card-content">
                                <svg class="w-8 h-8 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 4V2a1 1 0 011-1h8a1 1 0 011 1v2h3a1 1 0 011 1v16a1 1 0 01-1 1H4a1 1 0 01-1-1V5a1 1 0 011-1h3z"></path>
                                </svg>
                                <span class="font-medium">Movies</span>
                            </div>
                        </label>
                        <label class="content-type-card">
                            <input type="checkbox" class="content-type-checkbox" data-type="tv" checked>
                            <div class="card-content">
                                <svg class="w-8 h-8 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                                </svg>
                                <span class="font-medium">TV Shows</span>
                            </div>
                        </label>
                        <label class="content-type-card">
                            <input type="checkbox" class="content-type-checkbox" data-type="anime">
                            <div class="card-content">
                                <svg class="w-8 h-8 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1.01M15 10h1.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <span class="font-medium">Anime</span>
                            </div>
                        </label>
                    </div>
                    <button id="saveContentTypePreferences" class="btn-primary w-full mt-4">Save Preferences</button>
                </div>
            </div>

            <!-- Activity Tab -->
            <div id="activityTab" class="tab-content hidden">
                <div class="space-y-8">
                    <!-- Recent Activity -->
                    <div class="bg-secondary-bg rounded-lg p-6">
                        <h3 class="text-xl font-bold mb-4">Recent Activity</h3>
                        <div id="recentActivity" class="space-y-4">
                            <!-- Dynamic activity content -->
                        </div>
                    </div>

                    <!-- Viewing History -->
                    <div class="bg-secondary-bg rounded-lg p-6">
                        <h3 class="text-xl font-bold mb-4">Viewing History</h3>
                        <div class="content-grid" id="viewingHistory">
                            <!-- Dynamic viewing history -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="settingsTab" class="tab-content hidden">
                <div class="space-y-8">
                    <!-- Account Settings -->
                    <div class="bg-secondary-bg rounded-lg p-6">
                        <h3 class="text-xl font-bold mb-4">Account Settings</h3>
                        <form id="accountSettingsForm" class="space-y-4">
                            <div>
                                <label for="currentPassword" class="block text-sm font-medium mb-2">Current Password</label>
                                <input type="password" id="currentPassword" class="form-input">
                            </div>
                            <div>
                                <label for="newPassword" class="block text-sm font-medium mb-2">New Password</label>
                                <input type="password" id="newPassword" class="form-input">
                            </div>
                            <div>
                                <label for="confirmNewPassword" class="block text-sm font-medium mb-2">Confirm New Password</label>
                                <input type="password" id="confirmNewPassword" class="form-input">
                            </div>
                            <button type="submit" class="btn-primary">Update Password</button>
                        </form>
                    </div>

                    <!-- Privacy Settings -->
                    <div class="bg-secondary-bg rounded-lg p-6">
                        <h3 class="text-xl font-bold mb-4">Privacy Settings</h3>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h4 class="font-medium">Public Profile</h4>
                                    <p class="text-sm text-text-secondary">Allow others to see your profile and activity</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="publicProfile">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="flex items-center justify-between">
                                <div>
                                    <h4 class="font-medium">Email Notifications</h4>
                                    <p class="text-sm text-text-secondary">Receive recommendations and updates via email</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="emailNotifications" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="flex items-center justify-between">
                                <div>
                                    <h4 class="font-medium">Data Collection</h4>
                                    <p class="text-sm text-text-secondary">Allow us to collect viewing data for better recommendations</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="dataCollection" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        <button id="savePrivacySettings" class="btn-primary mt-4">Save Settings</button>
                    </div>

                    <!-- Danger Zone -->
                    <div class="bg-red-900/20 border border-red-500/20 rounded-lg p-6">
                        <h3 class="text-xl font-bold mb-4 text-red-400">Danger Zone</h3>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h4 class="font-medium text-red-400">Clear All Data</h4>
                                    <p class="text-sm text-text-secondary">Remove all your ratings, favorites, and viewing history</p>
                                </div>
                                <button id="clearDataBtn" class="btn-secondary border-red-500 text-red-400 hover:bg-red-500 hover:text-white">
                                    Clear Data
                                </button>
                            </div>
                            <div class="flex items-center justify-between">
                                <div>
                                    <h4 class="font-medium text-red-400">Delete Account</h4>
                                    <p class="text-sm text-text-secondary">Permanently delete your account and all associated data</p>
                                </div>
                                <button id="deleteAccountBtn" class="btn-secondary border-red-500 text-red-400 hover:bg-red-500 hover:text-white">
                                    Delete Account
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Scripts -->
    <script src="js/utils.js"></script>
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/components.js"></script>
    <script>
        class ProfilePage {
            constructor() {
                this.currentTab = 'preferences';
                this.userPreferences = {};
                this.init();
            }

            init() {
                if (!authManager.requireAuth()) return;

                this.initEventListeners();
                this.loadUserProfile();
                this.loadUserPreferences();
            }

            initEventListeners() {
                // User menu
                const userMenuToggle = document.getElementById('userMenuToggle');
                const userDropdown = document.getElementById('userDropdown');
                const logoutBtn = document.getElementById('logoutBtn');

                if (userMenuToggle && userDropdown) {
                    userMenuToggle.addEventListener('click', (e) => {
                        e.stopPropagation();
                        userDropdown.classList.toggle('hidden');
                    });

                    document.addEventListener('click', () => {
                        userDropdown.classList.add('hidden');
                    });
                }

                if (logoutBtn) {
                    logoutBtn.addEventListener('click', () => {
                        authManager.logout();
                    });
                }

                // Tab navigation
                const tabBtns = document.querySelectorAll('.profile-tab');
                tabBtns.forEach(btn => {
                    btn.addEventListener('click', () => {
                        this.switchTab(btn.getAttribute('data-tab'));
                    });
                });

                // Preference save buttons
                document.getElementById('saveGenrePreferences')?.addEventListener('click', () => {
                    this.saveGenrePreferences();
                });

                document.getElementById('saveLanguagePreferences')?.addEventListener('click', () => {
                    this.saveLanguagePreferences();
                });

                document.getElementById('saveContentTypePreferences')?.addEventListener('click', () => {
                    this.saveContentTypePreferences();
                });

                // Settings
                document.getElementById('accountSettingsForm')?.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.updatePassword();
                });

                document.getElementById('savePrivacySettings')?.addEventListener('click', () => {
                    this.savePrivacySettings();
                });

                // Danger zone
                document.getElementById('clearDataBtn')?.addEventListener('click', () => {
                    this.clearUserData();
                });

                document.getElementById('deleteAccountBtn')?.addEventListener('click', () => {
                    this.deleteAccount();
                });
            }

            loadUserProfile() {
                const user = authManager.currentUser;
                if (!user) return;

                document.getElementById('userName').textContent = user.username;
                document.getElementById('userInitial').textContent = user.username.charAt(0).toUpperCase();
                document.getElementById('profileUserName').textContent = user.username;
                document.getElementById('profileUserEmail').textContent = user.email || 'No email provided';

                // Load mock stats
                document.getElementById('profileMoviesWatched').textContent = Math.floor(Math.random() * 100) + 50;
                document.getElementById('profileFavorites').textContent = Math.floor(Math.random() * 50) + 20;
                document.getElementById('profileWishlist').textContent = Math.floor(Math.random() * 30) + 10;
            }

            loadUserPreferences() {
                // Load preferences from localStorage for now
                this.userPreferences = Utils.getStorage('userPreferences', {
                    genres: [],
                    languages: ['en'],
                    contentTypes: ['movie', 'tv']
                });

                this.updatePreferenceUI();
            }

            updatePreferenceUI() {
                // Update genre checkboxes
                const genreCheckboxes = document.querySelectorAll('.genre-checkbox');
                genreCheckboxes.forEach(checkbox => {
                    const genre = checkbox.getAttribute('data-genre');
                    checkbox.checked = this.userPreferences.genres.includes(genre);
                });

                // Update language checkboxes
                const languageCheckboxes = document.querySelectorAll('.language-checkbox');
                languageCheckboxes.forEach(checkbox => {
                    const language = checkbox.getAttribute('data-language');
                    checkbox.checked = this.userPreferences.languages.includes(language);
                });

                // Update content type checkboxes
                const contentTypeCheckboxes = document.querySelectorAll('.content-type-checkbox');
                contentTypeCheckboxes.forEach(checkbox => {
                    const type = checkbox.getAttribute('data-type');
                    checkbox.checked = this.userPreferences.contentTypes.includes(type);
                });
            }

            switchTab(tabName) {
                // Update tab buttons
                document.querySelectorAll('.profile-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

                // Update tab content
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.add('hidden');
                });
                document.getElementById(`${tabName}Tab`).classList.remove('hidden');

                this.currentTab = tabName;

                // Load tab-specific content
                if (tabName === 'activity') {
                    this.loadActivityData();
                }
            }

            saveGenrePreferences() {
                const checkedGenres = Array.from(document.querySelectorAll('.genre-checkbox:checked'))
                    .map(checkbox => checkbox.getAttribute('data-genre'));

                this.userPreferences.genres = checkedGenres;
                Utils.setStorage('userPreferences', this.userPreferences);

                UIComponents.showToast('Genre preferences saved!', 'success');
            }

            saveLanguagePreferences() {
                const checkedLanguages = Array.from(document.querySelectorAll('.language-checkbox:checked'))
                    .map(checkbox => checkbox.getAttribute('data-language'));

                this.userPreferences.languages = checkedLanguages;
                Utils.setStorage('userPreferences', this.userPreferences);

                UIComponents.showToast('Language preferences saved!', 'success');
            }

            saveContentTypePreferences() {
                const checkedTypes = Array.from(document.querySelectorAll('.content-type-checkbox:checked'))
                    .map(checkbox => checkbox.getAttribute('data-type'));

                this.userPreferences.contentTypes = checkedTypes;
                Utils.setStorage('userPreferences', this.userPreferences);

                UIComponents.showToast('Content type preferences saved!', 'success');
            }

            loadActivityData() {
                // Mock activity data
                const recentActivity = document.getElementById('recentActivity');
                const viewingHistory = document.getElementById('viewingHistory');

                recentActivity.innerHTML = `
                    <div class="activity-item">
                        <div class="flex items-center space-x-4">
                            <div class="w-2 h-2 bg-accent-red rounded-full"></div>
                            <div>
                                <p>Rated <strong>The Dark Knight</strong> - 5 stars</p>
                                <p class="text-sm text-text-secondary">2 hours ago</p>
                            </div>
                        </div>
                    </div>
                    <div class="activity-item">
                        <div class="flex items-center space-x-4">
                            <div class="w-2 h-2 bg-blue-400 rounded-full"></div>
                            <div>
                                <p>Added <strong>Inception</strong> to wishlist</p>
                                <p class="text-sm text-text-secondary">1 day ago</p>
                            </div>
                        </div>
                    </div>
                    <div class="activity-item">
                        <div class="flex items-center space-x-4">
                            <div class="w-2 h-2 bg-green-400 rounded-full"></div>
                            <div>
                                <p>Watched <strong>Avengers: Endgame</strong></p>
                                <p class="text-sm text-text-secondary">3 days ago</p>
                            </div>
                        </div>
                    </div>
                `;

                viewingHistory.innerHTML = `
                    <div class="text-center py-8 text-text-secondary">
                        <p>No viewing history available</p>
                    </div>
                `;
            }

            updatePassword() {
                const currentPassword = document.getElementById('currentPassword').value;
                const newPassword = document.getElementById('newPassword').value;
                const confirmNewPassword = document.getElementById('confirmNewPassword').value;

                if (!currentPassword || !newPassword || !confirmNewPassword) {
                    UIComponents.showToast('Please fill in all password fields', 'error');
                    return;
                }

                if (newPassword !== confirmNewPassword) {
                    UIComponents.showToast('New passwords do not match', 'error');
                    return;
                }

                if (newPassword.length < 8) {
                    UIComponents.showToast('New password must be at least 8 characters', 'error');
                    return;
                }

                // Mock password update
                UIComponents.showToast('Password updated successfully!', 'success');
                document.getElementById('accountSettingsForm').reset();
            }

            savePrivacySettings() {
                const publicProfile = document.getElementById('publicProfile').checked;
                const emailNotifications = document.getElementById('emailNotifications').checked;
                const dataCollection = document.getElementById('dataCollection').checked;

                const privacySettings = {
                    publicProfile,
                    emailNotifications,
                    dataCollection
                };

                Utils.setStorage('privacySettings', privacySettings);
                UIComponents.showToast('Privacy settings saved!', 'success');
            }

            clearUserData() {
                const confirmed = confirm('Are you sure you want to clear all your data? This action cannot be undone.');
                if (confirmed) {
                    // Clear user data
                    Utils.removeStorage('userPreferences');
                    Utils.removeStorage('privacySettings');
                    
                    UIComponents.showToast('All user data cleared', 'success');
                    
                    // Reload page
                    setTimeout(() => {
                        window.location.reload();
                    }, 1500);
                }
            }

            deleteAccount() {
                const confirmed = confirm('Are you sure you want to delete your account? This action cannot be undone and will permanently delete all your data.');
                if (confirmed) {
                    const doubleConfirm = confirm('This is your final warning. Your account and all data will be permanently deleted. Are you absolutely sure?');
                    if (doubleConfirm) {
                        // Mock account deletion
                        UIComponents.showToast('Account deletion initiated. You will be logged out shortly.', 'warning');
                        
                        setTimeout(() => {
                            authManager.logout();
                        }, 2000);
                    }
                }
            }
        }

        // Initialize profile page
        document.addEventListener('DOMContentLoaded', () => {
            new ProfilePage();
        });
    </script>
</body>
</html>
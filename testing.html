<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>CineBrain - Your Streaming Guide</title>

    <!-- Bootstrap CSS (for TopBar) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- TailwindCSS (for Mobile Nav) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'cinebrain-red': '#E50914',
                        'cinebrain-blue': '#0073E6',
                        'cinebrain-purple': '#8B5CF6',
                        'cinebrain-dark': '#0F0F0F',
                        'cinebrain-darker': '#000000',
                    }
                }
            }
        }
    </script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Inter:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">

    <!-- Component CSS Files -->
    <link rel="stylesheet" href="/css/topbar.css">
    <link rel="stylesheet" href="/css/mobile-nav.css">

    <!-- Feather Icons -->
    <script src="https://unpkg.com/feather-icons"></script>

    <!-- SVG Gradients for icons -->
    <svg width="0" height="0" style="position:absolute">
        <defs>
            <linearGradient id="icon-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#E50914;stop-opacity:1" />
                <stop offset="100%" style="stop-color:#FF416C;stop-opacity:1" />
            </linearGradient>
        </defs>
    </svg>

    <!-- Updated styles for showing both navigations -->
    <style>
        /* Show topbar on all devices */
        .navbar-cinebrain {
            display: flex !important;
        }

        /* Mobile-specific adjustments for topbar */
        @media (max-width: 767px) {

            /* Hide desktop search in topbar on mobile */
            .search-container.desktop-search {
                display: none !important;
            }

            /* Show mobile search trigger in topbar */
            .icon-button.mobile-search-trigger {
                display: flex !important;
            }

            /* Adjust body padding for both navigations */
            body {
                padding-top: var(--navbar-height, 60px) !important;
                padding-bottom: calc(var(--nav-height, 60px) + var(--safe-area-inset-bottom, 0px)) !important;
            }

            /* Make topbar more compact on mobile */
            :root {
                --navbar-height: 56px !important;
            }

            /* Adjust main content padding */
            .main-content {
                padding-top: 20px;
                padding-bottom: 80px;
            }

            /* Ensure mobile search overlay from topbar works */
            .mobile-search-overlay {
                display: none;
            }

            .mobile-search-overlay.show {
                display: block !important;
            }
        }

        /* Desktop-specific styles */
        @media (min-width: 768px) {

            /* Hide mobile bottom navigation on desktop */
            .mobile-nav,
            .search-overlay,
            .profile-menu,
            .profile-menu-overlay {
                display: none !important;
            }

            /* Hide mobile search trigger on desktop */
            .icon-button.mobile-search-trigger {
                display: none !important;
            }

            /* Show desktop search */
            .search-container.desktop-search {
                display: block !important;
            }

            /* Desktop content padding */
            .main-content {
                padding-top: 20px;
                padding-bottom: 40px;
            }

            body {
                padding-bottom: 0 !important;
            }
        }

        /* Ensure proper z-index hierarchy */
        .navbar-cinebrain {
            z-index: 1030;
        }

        .mobile-nav {
            z-index: 1040;
        }

        .mobile-search-overlay,
        .search-overlay {
            z-index: 1050;
        }

        .profile-menu-overlay {
            z-index: 1051;
        }

        .profile-menu {
            z-index: 1052;
        }

        /* Main content adjustments */
        .main-content {
            min-height: 100vh;
        }

        /* Smooth transitions */
        * {
            transition: padding 0.3s ease;
        }
    </style>
</head>

<body>
    <!-- TopBar Navigation (Visible on Both Desktop and Mobile) -->
    <nav class="navbar navbar-expand-lg navbar-cinebrain fixed-top">
        <div class="container-fluid">
            <!-- Brand Section -->
            <div class="navbar-brand-wrapper">
                <a href="/" style="text-decoration: none;">
                    <div class="navbar-brand-cinebrain">CineBrain</div>
                    <div class="tagline">
                        <span class="tagline-full">The Mind Behind Your Next Favorite</span>
                        <span class="tagline-medium" style="display: none;">Your Next Favorite</span>
                        <span class="tagline-short" style="display: none;">Next Favorite</span>
                    </div>
                </a>
            </div>

            <!-- Desktop Search (Hidden on Mobile) -->
            <div class="search-container desktop-search">
                <div class="input-group">
                    <span class="input-group-text bg-transparent border-0 ps-2 pe-1">
                        <i data-feather="search" class="text-secondary" style="width: 18px; height: 18px;"></i>
                    </span>
                    <input type="text" class="form-control search-input border-0 ps-1" id="desktopSearchInput"
                        placeholder="Search movies, shows, anime..." autocomplete="off">
                </div>
                <div class="search-results" id="desktopSearchResults"></div>
            </div>

            <!-- Right Section: Icons -->
            <div class="nav-icons-section">
                <!-- Mobile Search Trigger (Visible on Mobile) -->
                <button class="icon-button mobile-search-trigger" id="mobileSearchTrigger" aria-label="Search">
                    <i data-feather="search"></i>
                </button>

                <!-- Theme Toggle -->
                <button class="icon-button theme-toggle" id="themeToggle" aria-label="Toggle theme">
                    <i data-feather="sun" class="theme-icon"></i>
                </button>

                <!-- Avatar/User Menu -->
                <div class="dropdown">
                    <div class="avatar-menu" data-bs-toggle="dropdown" aria-expanded="false" id="avatarMenu"
                        role="button">
                        <i data-feather="user"></i>
                    </div>
                    <ul class="dropdown-menu dropdown-menu-end dropdown-menu-cinebrain" id="userDropdown">
                        <!-- Dynamic content inserted by JavaScript -->
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <!-- Mobile Search Overlay (For TopBar Mobile Search) -->
    <div class="mobile-search-overlay" id="mobileSearchOverlay">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h4 class="mb-0">Search</h4>
                <button class="btn btn-link p-0" id="closeMobileSearch" aria-label="Close search">
                    <i data-feather="x" style="width: 28px; height: 28px;"></i>
                </button>
            </div>
            <div class="search-container" style="display: block; margin: 0; max-width: 100%;">
                <input type="text" class="form-control form-control-lg search-input" id="mobileSearchInput"
                    placeholder="Search movies, shows, anime..." autocomplete="off">
                <div class="search-results mt-3" id="mobileSearchResults"></div>
            </div>
        </div>
    </div>

    <!-- Mobile Bottom Navigation Bar (Visible on Mobile Only) -->
    <nav class="mobile-nav fixed bottom-0 inset-x-0 z-50 block md:hidden" role="navigation"
        aria-label="Main navigation">
        <div class="flex h-full">
            <!-- Home Tab -->
            <button class="nav-tab flex-1 active" data-route="/" data-tab="home" role="tab" aria-selected="true"
                aria-label="Home">
                <div class="nav-icon relative">
                    <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                    </svg>
                </div>
                <span class="nav-label">Home</span>
            </button>

            <!-- Discover Tab -->
            <button class="nav-tab flex-1" data-route="/content/trending.html" data-tab="discover" role="tab"
                aria-selected="false" aria-label="Discover trending content">
                <div class="nav-icon relative">
                    <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M7 20l4-16m2 16l4-16M6 9h14M4 15h14" />
                    </svg>
                </div>
                <span class="nav-label">Discover</span>
            </button>

            <!-- Search Tab -->
            <button class="nav-tab flex-1" data-route="/content/search.html" data-tab="search" role="tab"
                aria-selected="false" aria-label="Search content">
                <div class="nav-icon relative">
                    <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                </div>
                <span class="nav-label">Search</span>
            </button>

            <!-- Watchlist Tab -->
            <button class="nav-tab flex-1" data-route="/user/watchlist.html" data-tab="watchlist" role="tab"
                aria-selected="false" aria-label="My watchlist">
                <div class="nav-icon relative">
                    <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z" />
                    </svg>
                    <span class="nav-badge" id="watchlistBadge" style="display: none;">0</span>
                </div>
                <span class="nav-label">My List</span>
            </button>

            <!-- Profile Tab -->
            <button class="nav-tab flex-1" data-tab="profile" role="tab" aria-selected="false"
                aria-label="Profile menu">
                <div class="nav-icon relative" id="profileIcon">
                    <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                    </svg>
                </div>
                <span class="nav-label">Profile</span>
            </button>
        </div>
    </nav>

    <!-- Mobile Bottom Nav Search Overlay -->
    <div class="search-overlay" id="searchOverlay">
        <div class="search-container p-4">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-semibold text-white">Search</h2>
                <button class="p-2 text-white" id="closeSearch" aria-label="Close search">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>

            <input type="text" class="search-input w-full" id="searchInput" placeholder="Search movies, shows, anime..."
                autocomplete="off">

            <div class="mt-4 flex-1 overflow-y-auto" id="searchResults">
                <!-- Search results will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Mobile Profile Menu Overlay -->
    <div class="profile-menu-overlay" id="profileMenuOverlay"></div>

    <!-- Mobile Profile Menu -->
    <div class="profile-menu" id="profileMenu">
        <div class="menu-handle"></div>
        <div id="profileMenuContent">
            <!-- Menu content will be inserted here -->
        </div>
    </div>

    <!-- Main Content Area -->
    <main class="main-content">
        <div class="container mx-auto px-4">
            <!-- Hero Section -->
            <section class="hero-section py-8">
                <div class="text-center">
                    <h1
                        class="text-3xl sm:text-4xl md:text-5xl font-bold mb-4 bg-gradient-to-r from-red-600 to-purple-600 bg-clip-text text-transparent">
                        Welcome to CineBrain
                    </h1>
                    <p class="text-base sm:text-lg md:text-xl text-gray-400 mb-8">
                        The Mind Behind Your Next Favorite Movie, Show, or Anime
                    </p>
                </div>
            </section>

            <!-- Quick Actions for Mobile -->
            <section class="quick-actions py-4 md:hidden">
                <div class="grid grid-cols-2 gap-3">
                    <button
                        class="bg-gradient-to-r from-red-600 to-red-700 text-white py-3 px-4 rounded-lg font-semibold text-sm">
                        Browse Movies
                    </button>
                    <button
                        class="bg-gradient-to-r from-blue-600 to-blue-700 text-white py-3 px-4 rounded-lg font-semibold text-sm">
                        TV Shows
                    </button>
                </div>
            </section>

            <!-- Featured Content Section -->
            <section class="featured-content py-8">
                <h2 class="text-xl sm:text-2xl font-semibold mb-6 text-white">Trending Now</h2>
                <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3 sm:gap-4">
                    <!-- Content cards -->
                    <div
                        class="bg-gradient-to-b from-gray-800 to-gray-900 rounded-lg overflow-hidden hover:scale-105 transition-transform cursor-pointer">
                        <div class="aspect-[2/3] bg-gradient-to-br from-red-600 to-purple-600"></div>
                        <div class="p-2">
                            <h3 class="text-xs sm:text-sm font-medium truncate text-white">Movie Title</h3>
                            <p class="text-xs text-gray-400">2024</p>
                        </div>
                    </div>
                    <div
                        class="bg-gradient-to-b from-gray-800 to-gray-900 rounded-lg overflow-hidden hover:scale-105 transition-transform cursor-pointer">
                        <div class="aspect-[2/3] bg-gradient-to-br from-blue-600 to-cyan-600"></div>
                        <div class="p-2">
                            <h3 class="text-xs sm:text-sm font-medium truncate text-white">Series Name</h3>
                            <p class="text-xs text-gray-400">2024</p>
                        </div>
                    </div>
                    <div
                        class="bg-gradient-to-b from-gray-800 to-gray-900 rounded-lg overflow-hidden hover:scale-105 transition-transform cursor-pointer">
                        <div class="aspect-[2/3] bg-gradient-to-br from-purple-600 to-pink-600"></div>
                        <div class="p-2">
                            <h3 class="text-xs sm:text-sm font-medium truncate text-white">Anime Title</h3>
                            <p class="text-xs text-gray-400">2024</p>
                        </div>
                    </div>
                    <div
                        class="bg-gradient-to-b from-gray-800 to-gray-900 rounded-lg overflow-hidden hover:scale-105 transition-transform cursor-pointer">
                        <div class="aspect-[2/3] bg-gradient-to-br from-green-600 to-teal-600"></div>
                        <div class="p-2">
                            <h3 class="text-xs sm:text-sm font-medium truncate text-white">Documentary</h3>
                            <p class="text-xs text-gray-400">2024</p>
                        </div>
                    </div>
                    <!-- Add more cards as needed -->
                </div>
            </section>

            <!-- Categories Section -->
            <section class="categories-section py-8">
                <h2 class="text-xl sm:text-2xl font-semibold mb-6 text-white">Browse by Category</h2>
                <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3 sm:gap-4">
                    <div
                        class="bg-gradient-to-br from-red-600 to-red-800 rounded-lg p-4 sm:p-6 text-center cursor-pointer hover:scale-105 transition-transform">
                        <svg class="w-8 h-8 mx-auto mb-2 text-white" fill="none" stroke="currentColor"
                            viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M7 4v16M17 4v16M3 8h4m10 0h4M3 16h4m10 0h4"></path>
                        </svg>
                        <h3 class="font-semibold text-sm sm:text-base text-white">Movies</h3>
                    </div>
                    <div
                        class="bg-gradient-to-br from-blue-600 to-blue-800 rounded-lg p-4 sm:p-6 text-center cursor-pointer hover:scale-105 transition-transform">
                        <svg class="w-8 h-8 mx-auto mb-2 text-white" fill="none" stroke="currentColor"
                            viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z">
                            </path>
                        </svg>
                        <h3 class="font-semibold text-sm sm:text-base text-white">TV Shows</h3>
                    </div>
                    <div
                        class="bg-gradient-to-br from-purple-600 to-purple-800 rounded-lg p-4 sm:p-6 text-center cursor-pointer hover:scale-105 transition-transform">
                        <svg class="w-8 h-8 mx-auto mb-2 text-white" fill="none" stroke="currentColor"
                            viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z">
                            </path>
                        </svg>
                        <h3 class="font-semibold text-sm sm:text-base text-white">Anime</h3>
                    </div>
                    <div
                        class="bg-gradient-to-br from-green-600 to-green-800 rounded-lg p-4 sm:p-6 text-center cursor-pointer hover:scale-105 transition-transform">
                        <svg class="w-8 h-8 mx-auto mb-2 text-white" fill="none" stroke="currentColor"
                            viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <h3 class="font-semibold text-sm sm:text-base text-white">Documentaries</h3>
                    </div>
                </div>
            </section>

            <!-- Extra padding at bottom for mobile nav -->
            <div class="h-20 md:hidden"></div>
        </div>
    </main>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Component JavaScript Files -->
    <script src="/js/topbar.js"></script>
    <script src="/js/mobile-nav.js"></script>

    <!-- Unified Management Script -->
    <script>
        // Handle Home tab highlighting for mobile nav
        document.addEventListener('DOMContentLoaded', () => {
            // Override the highlightActiveTab function to include Home
            setTimeout(() => {
                if (window.mobileNav) {
                    const originalHighlight = window.mobileNav.highlightActiveTab.bind(window.mobileNav);
                    window.mobileNav.highlightActiveTab = function () {
                        const currentPath = window.location.pathname;
                        let activeTab = null;

                        if (currentPath === '/' || currentPath === '/index.html' || currentPath === '') {
                            activeTab = document.querySelector('[data-tab="home"]');
                        } else if (currentPath.includes('/trending')) {
                            activeTab = document.querySelector('[data-tab="discover"]');
                        } else if (currentPath.includes('/search')) {
                            activeTab = document.querySelector('[data-tab="search"]');
                        } else if (currentPath.includes('/watchlist')) {
                            activeTab = document.querySelector('[data-tab="watchlist"]');
                        } else if (currentPath.includes('/profile') || currentPath.includes('/user')) {
                            activeTab = document.querySelector('[data-tab="profile"]');
                        }

                        if (activeTab) {
                            this.setActiveTab(activeTab);
                        }
                    };

                    // Re-run highlight on load
                    window.mobileNav.highlightActiveTab();
                }
            }, 200);
        });

        // Unified theme and authentication management
        class UnifiedManager {
            constructor() {
                this.initTheme();
                this.syncComponents();
                this.handleMobileSearch();
            }

            initTheme() {
                const savedTheme = localStorage.getItem('cinebrain-theme') || 'dark';
                document.documentElement.setAttribute('data-theme', savedTheme);
            }

            syncComponents() {
                // Sync theme toggles between desktop and mobile
                if (window.topbar && window.mobileNav) {
                    const originalTopbarToggle = window.topbar.toggleTheme.bind(window.topbar);
                    window.topbar.toggleTheme = () => {
                        originalTopbarToggle();
                        const currentTheme = document.documentElement.getAttribute('data-theme');
                        document.documentElement.setAttribute('data-theme', currentTheme);
                    };

                    const originalMobileToggle = window.mobileNav.toggleTheme.bind(window.mobileNav);
                    window.mobileNav.toggleTheme = () => {
                        originalMobileToggle();
                        const currentTheme = document.documentElement.getAttribute('data-theme');
                        if (window.topbar) {
                            window.topbar.setTheme(currentTheme);
                        }
                    };
                }

                // Sync user authentication
                if (window.topbar && window.mobileNav) {
                    // Update both profile icons when user changes
                    const updateBothProfiles = () => {
                        if (window.topbar.currentUser) {
                            window.mobileNav.currentUser = window.topbar.currentUser;
                            window.mobileNav.updateProfileIcon();
                        }
                    };

                    // Check periodically for sync
                    setInterval(updateBothProfiles, 5000);
                }
            }

            handleMobileSearch() {
                // Prevent conflict between two search overlays on mobile
                const isMobile = window.innerWidth < 768;
                if (isMobile) {
                    // Ensure topbar uses its own search overlay
                    const topbarSearchTrigger = document.getElementById('mobileSearchTrigger');
                    const mobileNavSearchTab = document.querySelector('[data-tab="search"]');

                    if (topbarSearchTrigger && mobileNavSearchTab) {
                        // Keep them separate to avoid conflicts
                        topbarSearchTrigger.addEventListener('click', (e) => {
                            e.stopPropagation();
                            // Use topbar's search overlay
                        });

                        mobileNavSearchTab.addEventListener('click', (e) => {
                            e.stopPropagation();
                            // Use mobile nav's search overlay
                        });
                    }
                }
            }
        }

        // Initialize after components load
        setTimeout(() => {
            new UnifiedManager();
        }, 300);

        // Handle responsive behavior
        function detectDevice() {
            const width = window.innerWidth;
            const body = document.body;

            if (width < 768) {
                body.classList.add('mobile-view');
                body.classList.remove('desktop-view');
                // Adjust padding for both navigations on mobile
                body.style.paddingTop = 'var(--navbar-height, 56px)';
                body.style.paddingBottom = 'calc(var(--nav-height, 60px) + var(--safe-area-inset-bottom, 0px))';
            } else {
                body.classList.add('desktop-view');
                body.classList.remove('mobile-view');
                // Only top padding needed on desktop
                body.style.paddingTop = 'var(--navbar-height, 60px)';
                body.style.paddingBottom = '0';
            }
        }

        // Initial detection
        detectDevice();

        // Detect on resize
        window.addEventListener('resize', detectDevice);

        // Sync authentication between components
        window.addEventListener('storage', (e) => {
            if (e.key === 'cinebrain-token' || e.key === 'cinebrain-user') {
                // Reload to sync both navigation components
                window.location.reload();
            }
        });
    </script>
</body>

</html>
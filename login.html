<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign In - CineScope</title>
    
    <!-- Stylesheets -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/main.css" rel="stylesheet">
    <link href="/css/components.css" rel="stylesheet">
    <link href="/css/responsive.css" rel="stylesheet">
</head>
<body class="dark-theme">
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-container">
            <div class="loading-logo">
                <div class="logo-animation">
                    <span class="logo-text">CineScope</span>
                    <div class="loading-bars">
                        <div class="loading-bar" style="--delay: 0s"></div>
                        <div class="loading-bar" style="--delay: 0.1s"></div>
                        <div class="loading-bar" style="--delay: 0.2s"></div>
                        <div class="loading-bar" style="--delay: 0.3s"></div>
                        <div class="loading-bar" style="--delay: 0.4s"></div>
                    </div>
                </div>
            </div>
            <div class="loading-text">
                <p id="loadingText">Preparing your experience...</p>
            </div>
        </div>
    </div>

    <!-- Header -->
    <div id="header-container"></div>

    <!-- Main Content -->
    <main class="auth-main">
        <div class="auth-container">
            <div class="auth-wrapper">
                <!-- Left Side - Branding -->
                <div class="auth-branding">
                    <div class="branding-content">
                        <h1 class="branding-title">
                            Welcome to
                            <span class="brand-highlight">CineScope</span>
                        </h1>
                        <p class="branding-subtitle">
                            Discover your next favorite movie, TV show, or anime with personalized recommendations powered by AI
                        </p>
                        <div class="branding-features">
                            <div class="feature-item">
                                <span class="feature-icon">üé¨</span>
                                <span>Millions of movies and shows</span>
                            </div>
                            <div class="feature-item">
                                <span class="feature-icon">ü§ñ</span>
                                <span>AI-powered recommendations</span>
                            </div>
                            <div class="feature-item">
                                <span class="feature-icon">üì±</span>
                                <span>Available on all devices</span>
                            </div>
                            <div class="feature-item">
                                <span class="feature-icon">üåç</span>
                                <span>Multi-language content</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Side - Auth Forms -->
                <div class="auth-forms-container">
                    <div class="auth-card">
                        <div class="auth-header">
                            <div class="auth-tabs">
                                <button class="auth-tab active" data-tab="login">Sign In</button>
                                <button class="auth-tab" data-tab="register">Sign Up</button>
                            </div>
                        </div>

                        <div class="auth-body">
                            <!-- Login Form -->
                            <form id="loginForm" class="auth-form active">
                                <div class="form-header">
                                    <h2 class="form-title">Welcome back!</h2>
                                    <p class="form-subtitle">Sign in to your account</p>
                                </div>

                                <div class="form-group">
                                    <label for="loginUsername" class="form-label">Username</label>
                                    <input type="text" id="loginUsername" class="form-control" placeholder="Enter your username" required>
                                </div>

                                <div class="form-group">
                                    <label for="loginPassword" class="form-label">Password</label>
                                    <div class="password-input-group">
                                        <input type="password" id="loginPassword" class="form-control" placeholder="Enter your password" required>
                                        <button type="button" class="password-toggle" onclick="togglePassword('loginPassword')">
                                            <svg class="eye-icon" viewBox="0 0 24 24">
                                                <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
                                            </svg>
                                        </button>
                                    </div>
                                </div>

                                <div class="form-options">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="rememberMe">
                                        <span class="checkmark"></span>
                                        Remember me
                                    </label>
                                    <a href="#" class="forgot-link">Forgot password?</a>
                                </div>

                                <button type="submit" class="btn btn-primary auth-submit">
                                    Sign In
                                </button>

                                <div class="form-footer">
                                    <p>Don't have an account? <a href="#" class="switch-form-link" data-tab="register">Sign up</a></p>
                                </div>
                            </form>

                            <!-- Register Form -->
                            <form id="registerForm" class="auth-form">
                                <div class="form-header">
                                    <h2 class="form-title">Join CineScope</h2>
                                    <p class="form-subtitle">Create your account and start discovering</p>
                                </div>

                                <div class="form-group">
                                    <label for="registerUsername" class="form-label">Username</label>
                                    <input type="text" id="registerUsername" class="form-control" placeholder="Choose a username" required>
                                    <small class="form-help">Username must be 3-20 characters long</small>
                                </div>

                                <div class="form-group">
                                    <label for="registerEmail" class="form-label">Email</label>
                                    <input type="email" id="registerEmail" class="form-control" placeholder="Enter your email" required>
                                </div>

                                <div class="form-group">
                                    <label for="registerPassword" class="form-label">Password</label>
                                    <div class="password-input-group">
                                        <input type="password" id="registerPassword" class="form-control" placeholder="Create a password" required>
                                        <button type="button" class="password-toggle" onclick="togglePassword('registerPassword')">
                                            <svg class="eye-icon" viewBox="0 0 24 24">
                                                <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
                                            </svg>
                                        </button>
                                    </div>
                                    <small class="form-help">Password must be at least 6 characters long</small>
                                </div>

                                <div class="preferences-section">
                                    <h4 class="preferences-title">Personalize Your Experience</h4>
                                    
                                    <div class="preference-group">
                                        <label class="preference-label">Preferred Languages</label>
                                        <div class="language-checkboxes">
                                            <label class="checkbox-label">
                                                <input type="checkbox" name="languages" value="english" checked>
                                                <span class="checkmark"></span>
                                                English
                                            </label>
                                            <label class="checkbox-label">
                                                <input type="checkbox" name="languages" value="hindi">
                                                <span class="checkmark"></span>
                                                ‡§π‡§ø‡§Ç‡§¶‡•Ä
                                            </label>
                                            <label class="checkbox-label">
                                                <input type="checkbox" name="languages" value="telugu">
                                                <span class="checkmark"></span>
                                                ‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å
                                            </label>
                                            <label class="checkbox-label">
                                                <input type="checkbox" name="languages" value="tamil">
                                                <span class="checkmark"></span>
                                                ‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç
                                            </label>
                                        </div>
                                    </div>

                                    <div class="preference-group">
                                        <label class="preference-label">Favorite Genres</label>
                                        <div class="genre-checkboxes">
                                            <label class="checkbox-label">
                                                <input type="checkbox" name="genres" value="Action">
                                                <span class="checkmark"></span>
                                                Action
                                            </label>
                                            <label class="checkbox-label">
                                                <input type="checkbox" name="genres" value="Drama">
                                                <span class="checkmark"></span>
                                                Drama
                                            </label>
                                            <label class="checkbox-label">
                                                <input type="checkbox" name="genres" value="Comedy">
                                                <span class="checkmark"></span>
                                                Comedy
                                            </label>
                                            <label class="checkbox-label">
                                                <input type="checkbox" name="genres" value="Romance">
                                                <span class="checkmark"></span>
                                                Romance
                                            </label>
                                            <label class="checkbox-label">
                                                <input type="checkbox" name="genres" value="Thriller">
                                                <span class="checkmark"></span>
                                                Thriller
                                            </label>
                                            <label class="checkbox-label">
                                                <input type="checkbox" name="genres" value="Animation">
                                                <span class="checkmark"></span>
                                                Animation
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-terms">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="agreeTerms" required>
                                        <span class="checkmark"></span>
                                        I agree to the <a href="#" class="terms-link">Terms of Service</a> and <a href="#" class="terms-link">Privacy Policy</a>
                                    </label>
                                </div>

                                <button type="submit" class="btn btn-primary auth-submit">
                                    Create Account
                                </button>

                                <div class="form-footer">
                                    <p>Already have an account? <a href="#" class="switch-form-link" data-tab="login">Sign in</a></p>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Quick Access -->
                    <div class="quick-access">
                        <p class="quick-access-text">Or continue without signing in</p>
                        <a href="/" class="btn btn-outline quick-access-btn">
                            Browse as Guest
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <div id="footer-container"></div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script src="/js/include.js"></script>
    <script src="/js/api.js"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/components.js"></script>
    <script src="/js/main.js"></script>

    <script>
        // Login page specific functionality
        class LoginPage {
            constructor() {
                this.init();
            }

            async init() {
                // Check if already logged in
                if (await Auth.checkExistingSession()) {
                    window.location.href = '/dashboard';
                    return;
                }

                await this.loadIncludes();
                this.setupEventListeners();
                this.hideLoading();
            }

            async loadIncludes() {
                try {
                    await Promise.all([
                        includeHTML('header-container', '/includes/header.html'),
                        includeHTML('footer-container', '/includes/footer.html')
                    ]);
                } catch (error) {
                    console.error('Failed to load includes:', error);
                }
            }

            setupEventListeners() {
                // Tab switching
                document.querySelectorAll('.auth-tab, .switch-form-link').forEach(element => {
                    element.addEventListener('click', (e) => {
                        e.preventDefault();
                        this.switchTab(element.dataset.tab);
                    });
                });

                // Form validation
                document.getElementById('registerUsername').addEventListener('input', this.validateUsername);
                document.getElementById('registerEmail').addEventListener('input', this.validateEmail);
                document.getElementById('registerPassword').addEventListener('input', this.validatePassword);

                // Auto-detect user preferences
                this.detectUserPreferences();
            }

            switchTab(tabType) {
                // Update tab buttons
                document.querySelectorAll('.auth-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.querySelector(`[data-tab="${tabType}"].auth-tab`).classList.add('active');

                // Update forms
                document.querySelectorAll('.auth-form').forEach(form => {
                    form.classList.remove('active');
                });
                document.getElementById(`${tabType}Form`).classList.add('active');

                // Update URL without reload
                const newUrl = tabType === 'register' ? '/login?tab=register' : '/login';
                history.replaceState(null, '', newUrl);
            }

            validateUsername(event) {
                const username = event.target.value;
                const isValid = username.length >= 3 && username.length <= 20 && /^[a-zA-Z0-9_]+$/.test(username);
                
                event.target.classList.toggle('is-valid', isValid && username.length > 0);
                event.target.classList.toggle('is-invalid', !isValid && username.length > 0);
            }

            validateEmail(event) {
                const email = event.target.value;
                const isValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
                
                event.target.classList.toggle('is-valid', isValid);
                event.target.classList.toggle('is-invalid', !isValid && email.length > 0);
            }

            validatePassword(event) {
                const password = event.target.value;
                const isValid = password.length >= 6;
                
                event.target.classList.toggle('is-valid', isValid);
                event.target.classList.toggle('is-invalid', !isValid && password.length > 0);
            }

            detectUserPreferences() {
                // Detect user's language preference
                const userLang = navigator.language.toLowerCase();
                const langMap = {
                    'hi': 'hindi',
                    'te': 'telugu', 
                    'ta': 'tamil',
                    'kn': 'kannada',
                    'ml': 'malayalam'
                };

                const detectedLang = Object.keys(langMap).find(code => userLang.includes(code));
                if (detectedLang) {
                    const checkbox = document.querySelector(`input[name="languages"][value="${langMap[detectedLang]}"]`);
                    if (checkbox) {
                        checkbox.checked = true;
                    }
                }

                // Auto-select popular genres
                const popularGenres = ['Action', 'Drama', 'Comedy'];
                popularGenres.forEach(genre => {
                    const checkbox = document.querySelector(`input[name="genres"][value="${genre}"]`);
                    if (checkbox) {
                        checkbox.checked = true;
                    }
                });
            }

            hideLoading() {
                const loadingScreen = document.getElementById('loadingScreen');
                if (loadingScreen) {
                    setTimeout(() => {
                        loadingScreen.classList.add('hidden');
                    }, 500);
                }
            }
        }

        // Password toggle functionality
        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const button = input.nextElementSibling;
            
            if (input.type === 'password') {
                input.type = 'text';
                button.innerHTML = `
                    <svg class="eye-icon" viewBox="0 0 24 24">
                        <path d="M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"/>
                    </svg>
                `;
            } else {
                input.type = 'password';
                button.innerHTML = `
                    <svg class="eye-icon" viewBox="0 0 24 24">
                        <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
                    </svg>
                `;
            }
        }

        // Check URL parameters for tab
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const tab = urlParams.get('tab');
            
            if (tab === 'register') {
                document.querySelector('[data-tab="register"]').click();
            }
            
            new LoginPage();
        });
    </script>
</body>
</html>
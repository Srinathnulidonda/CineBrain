<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#141414">
    <title>Sign In - MovieRec</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --netflix-red: #E50914;
            --netflix-black: #141414;
            --netflix-gray: #333333;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--netflix-black);
            color: #fff;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        .auth-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            background: linear-gradient(to bottom, rgba(0,0,0,0.6) 0%, rgba(0,0,0,0.8) 100%),
                        url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1920 1080"><rect fill="%23141414" width="1920" height="1080"/><path fill="%23E50914" opacity="0.1" d="M0,540 Q480,440 960,540 T1920,540 L1920,1080 L0,1080 Z"/></svg>');
            background-size: cover;
            background-position: center;
        }

        .header {
            padding: 1rem;
            background: rgba(0, 0, 0, 0.5);
        }

        @media (min-width: 768px) {
            .header {
                padding: 1.5rem 3rem;
            }
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--netflix-red);
            text-transform: uppercase;
            letter-spacing: 2px;
            text-decoration: none;
            display: inline-block;
        }

        @media (min-width: 768px) {
            .logo {
                font-size: 2rem;
            }
        }

        .auth-form-container {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .auth-form {
            background: rgba(0, 0, 0, 0.75);
            padding: 2rem;
            border-radius: 8px;
            width: 100%;
            max-width: 450px;
        }

        @media (min-width: 768px) {
            .auth-form {
                padding: 3rem;
            }
        }

        .form-title {
            font-size: 2rem;
            margin-bottom: 2rem;
            text-align: center;
        }

        .form-tabs {
            display: flex;
            margin-bottom: 2rem;
            border-bottom: 2px solid var(--netflix-gray);
        }

        .tab-button {
            flex: 1;
            padding: 1rem;
            background: none;
            border: none;
            color: #999;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .tab-button.active {
            color: #fff;
        }

        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--netflix-red);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            color: #999;
        }

        .form-input {
            width: 100%;
            padding: 1rem;
            background: var(--netflix-gray);
            border: none;
            border-radius: 4px;
            color: #fff;
            font-size: 1rem;
            transition: all 0.3s ease;
            min-height: 50px;
        }

        .form-input:focus {
            outline: none;
            background: #454545;
            box-shadow: 0 0 0 2px var(--netflix-red);
        }

        .form-input.error {
            box-shadow: 0 0 0 2px #ff0000;
        }

        .error-message {
            color: #ff0000;
            font-size: 0.875rem;
            margin-top: 0.5rem;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .submit-btn {
            width: 100%;
            padding: 1rem;
            background: var(--netflix-red);
            color: #fff;
            border: none;
            border-radius: 4px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .submit-btn:hover {
            background: #f40612;
        }

        .submit-btn:active {
            transform: scale(0.98);
        }

        .submit-btn:disabled {
            background: #666;
            cursor: not-allowed;
        }

        .loader {
            display: none;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 0.8s linear infinite;
        }

        .submit-btn:disabled .loader {
            display: inline-block;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .alert {
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
            display: none;
        }

        .alert.show {
            display: block;
        }

        .alert-error {
            background: rgba(255, 0, 0, 0.1);
            border: 1px solid #ff0000;
            color: #ff6b6b;
        }

        .alert-success {
            background: rgba(0, 255, 0, 0.1);
            border: 1px solid #00ff00;
            color: #51cf66;
        }

        .password-strength {
            margin-top: 0.5rem;
            height: 4px;
            background: #333;
            border-radius: 2px;
            overflow: hidden;
        }

        .password-strength-bar {
            height: 100%;
            width: 0;
            transition: all 0.3s ease;
            border-radius: 2px;
        }

        .strength-weak { background: #ff4444; width: 33%; }
        .strength-medium { background: #ffaa00; width: 66%; }
        .strength-strong { background: #00ff00; width: 100%; }

        .show-password {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            padding: 0.5rem;
        }

        .input-wrapper {
            position: relative;
        }

        .demo-info {
            margin-top: 2rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
            text-align: center;
            font-size: 0.875rem;
            color: #999;
        }

        @media (max-width: 768px) {
            .auth-form {
                background: rgba(0, 0, 0, 0.95);
                border-radius: 0;
                min-height: 100vh;
            }
        }
    </style>
</head>
<body>
    <div class="auth-container">
        <header class="header">
            <a href="index.html" class="logo">MovieRec</a>
        </header>

        <div class="auth-form-container">
            <div class="auth-form">
                <h1 class="form-title">Welcome</h1>

                <div class="form-tabs">
                    <button class="tab-button active" id="signInTab" onclick="switchTab('signin')">Sign In</button>
                    <button class="tab-button" id="signUpTab" onclick="switchTab('signup')">Sign Up</button>
                </div>

                <div class="alert alert-error" id="alertError"></div>
                <div class="alert alert-success" id="alertSuccess"></div>

                <!-- Sign In Form -->
                <form id="signInForm" class="auth-form-content">
                    <div class="form-group">
                        <label class="form-label">Username or Email</label>
                        <input type="text" class="form-input" id="signInUsername" required>
                        <span class="error-message" id="signInUsernameError">Please enter your username or email</span>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <div class="input-wrapper">
                            <input type="password" class="form-input" id="signInPassword" required>
                            <button type="button" class="show-password" onclick="togglePassword('signInPassword')">üëÅ</button>
                        </div>
                        <span class="error-message" id="signInPasswordError">Please enter your password</span>
                    </div>

                    <button type="submit" class="submit-btn" id="signInSubmit">
                        <span>Sign In</span>
                        <div class="loader"></div>
                    </button>
                </form>

                <!-- Sign Up Form -->
                <form id="signUpForm" class="auth-form-content" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">Username</label>
                        <input type="text" class="form-input" id="signUpUsername" required minlength="3">
                        <span class="error-message" id="signUpUsernameError">Username must be at least 3 characters</span>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" id="signUpEmail" required>
                        <span class="error-message" id="signUpEmailError">Please enter a valid email</span>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <div class="input-wrapper">
                            <input type="password" class="form-input" id="signUpPassword" required minlength="8">
                            <button type="button" class="show-password" onclick="togglePassword('signUpPassword')">üëÅ</button>
                        </div>
                        <div class="password-strength">
                            <div class="password-strength-bar" id="passwordStrengthBar"></div>
                        </div>
                        <span class="error-message" id="signUpPasswordError">Password must be at least 8 characters</span>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Confirm Password</label>
                        <div class="input-wrapper">
                            <input type="password" class="form-input" id="signUpConfirmPassword" required>
                            <button type="button" class="show-password" onclick="togglePassword('signUpConfirmPassword')">üëÅ</button>
                        </div>
                        <span class="error-message" id="signUpConfirmPasswordError">Passwords do not match</span>
                    </div>

                    <button type="submit" class="submit-btn" id="signUpSubmit">
                        <span>Create Account</span>
                        <div class="loader"></div>
                    </button>
                </form>

                <div class="demo-info">
                    <p>Demo Credentials:</p>
                    <p>Admin: admin / AdminPass123!</p>
                    <p>User: demo / demo123</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'https://backend-app-970m.onrender.com/api';
        let currentTab = 'signin';

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Check if user is already logged in
            const hash = window.location.hash.substring(1);
            if (hash) {
                try {
                    const authData = JSON.parse(atob(hash));
                    if (authData.token) {
                        redirectUser(authData);
                    }
                } catch (e) {
                    window.location.hash = '';
                }
            }

            // Form submissions
            document.getElementById('signInForm').addEventListener('submit', handleSignIn);
            document.getElementById('signUpForm').addEventListener('submit', handleSignUp);

            // Password strength indicator
            document.getElementById('signUpPassword').addEventListener('input', updatePasswordStrength);
        });

        // Switch tabs
        function switchTab(tab) {
            currentTab = tab;
            
            // Update tab buttons
            document.getElementById('signInTab').classList.toggle('active', tab === 'signin');
            document.getElementById('signUpTab').classList.toggle('active', tab === 'signup');
            
            // Update forms
            document.getElementById('signInForm').style.display = tab === 'signin' ? 'block' : 'none';
            document.getElementById('signUpForm').style.display = tab === 'signup' ? 'block' : 'none';
            
            // Clear alerts
            hideAlerts();
        }

        // Toggle password visibility
        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            input.type = input.type === 'password' ? 'text' : 'password';
        }

        // Update password strength
        function updatePasswordStrength(e) {
            const password = e.target.value;
            const strengthBar = document.getElementById('passwordStrengthBar');
            
            if (password.length < 8) {
                strengthBar.className = 'password-strength-bar strength-weak';
            } else if (password.match(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).+$/)) {
                strengthBar.className = 'password-strength-bar strength-strong';
            } else {
                strengthBar.className = 'password-strength-bar strength-medium';
            }
        }

        // Handle sign in
        async function handleSignIn(e) {
            e.preventDefault();
            
            if (!validateSignInForm()) return;
            
            const submitBtn = document.getElementById('signInSubmit');
            const username = document.getElementById('signInUsername').value.trim();
            const password = document.getElementById('signInPassword').value;
            
            try {
                setLoading(submitBtn, true);
                hideAlerts();
                
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, password })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showAlert('success', 'Login successful! Redirecting...');
                    
                    // Create auth data
                    const authData = {
                        token: data.token,
                        user: data.user
                    };
                    
                    // Redirect after short delay
                    setTimeout(() => redirectUser(authData), 1000);
                } else {
                    showAlert('error', data.message || 'Invalid credentials');
                }
            } catch (error) {
                showAlert('error', 'Network error. Please try again.');
            } finally {
                setLoading(submitBtn, false);
            }
        }

        // Handle sign up
        async function handleSignUp(e) {
            e.preventDefault();
            
            if (!validateSignUpForm()) return;
            
            const submitBtn = document.getElementById('signUpSubmit');
            const username = document.getElementById('signUpUsername').value.trim();
            const email = document.getElementById('signUpEmail').value.trim();
            const password = document.getElementById('signUpPassword').value;
            
            try {
                setLoading(submitBtn, true);
                hideAlerts();
                
                const response = await fetch(`${API_BASE}/auth/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, email, password })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showAlert('success', 'Account created successfully! Redirecting...');
                    
                    // Create auth data
                    const authData = {
                        token: data.token,
                        user: data.user
                    };
                    
                    // Redirect after short delay
                    setTimeout(() => redirectUser(authData), 1000);
                } else {
                    showAlert('error', data.message || 'Registration failed');
                }
            } catch (error) {
                showAlert('error', 'Network error. Please try again.');
            } finally {
                setLoading(submitBtn, false);
            }
        }

        // Validation
        function validateSignInForm() {
            let isValid = true;
            
            const username = document.getElementById('signInUsername');
            const password = document.getElementById('signInPassword');
            
            if (!username.value.trim()) {
                showError('signInUsernameError');
                username.classList.add('error');
                isValid = false;
            } else {
                hideError('signInUsernameError');
                username.classList.remove('error');
            }
            
            if (!password.value) {
                showError('signInPasswordError');
                password.classList.add('error');
                isValid = false;
            } else {
                hideError('signInPasswordError');
                password.classList.remove('error');
            }
            
            return isValid;
        }

        function validateSignUpForm() {
            let isValid = true;
            
            const username = document.getElementById('signUpUsername');
            const email = document.getElementById('signUpEmail');
            const password = document.getElementById('signUpPassword');
            const confirmPassword = document.getElementById('signUpConfirmPassword');
            
            if (username.value.trim().length < 3) {
                showError('signUpUsernameError');
                username.classList.add('error');
                isValid = false;
            } else {
                hideError('signUpUsernameError');
                username.classList.remove('error');
            }
            
            if (!email.value.trim() || !email.validity.valid) {
                showError('signUpEmailError');
                email.classList.add('error');
                isValid = false;
            } else {
                hideError('signUpEmailError');
                email.classList.remove('error');
            }
            
            if (password.value.length < 8) {
                showError('signUpPasswordError');
                password.classList.add('error');
                isValid = false;
            } else {
                hideError('signUpPasswordError');
                password.classList.remove('error');
            }
            
            if (password.value !== confirmPassword.value) {
                showError('signUpConfirmPasswordError');
                confirmPassword.classList.add('error');
                isValid = false;
            } else {
                hideError('signUpConfirmPasswordError');
                confirmPassword.classList.remove('error');
            }
            
            return isValid;
        }

        // UI helpers
        function showError(errorId) {
            document.getElementById(errorId).classList.add('show');
        }

        function hideError(errorId) {
            document.getElementById(errorId).classList.remove('show');
        }

        function showAlert(type, message) {
            const alertId = type === 'error' ? 'alertError' : 'alertSuccess';
            const alert = document.getElementById(alertId);
            alert.textContent = message;
            alert.classList.add('show');
        }

        function hideAlerts() {
            document.getElementById('alertError').classList.remove('show');
            document.getElementById('alertSuccess').classList.remove('show');
        }

        function setLoading(button, isLoading) {
            button.disabled = isLoading;
            button.querySelector('span').style.display = isLoading ? 'none' : 'inline';
            button.querySelector('.loader').style.display = isLoading ? 'inline-block' : 'none';
        }

        // Redirect user based on role
        function redirectUser(authData) {
            const encodedAuth = btoa(JSON.stringify(authData));
            
            if (authData.user.is_admin) {
                window.location.href = `admin/dashboard.html#${encodedAuth}`;
            } else {
                window.location.href = `dashboard.html#${encodedAuth}`;
            }
        }
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <script>document.write('<script src="/includes/head.html"><\/script>');</script>
</head>
<body>
    <!-- Header -->
    <div data-include="header"></div>

    <!-- Login/Register Page -->
    <main class="min-h-screen flex items-center justify-center py-20 px-4">
        <div class="max-w-md w-full">
            <!-- Tab Navigation -->
            <div class="flex mb-8 bg-gray-800 rounded-lg p-1">
                <button id="loginTab" class="auth-tab active flex-1 py-3 px-4 rounded-md font-medium transition-all">
                    Login
                </button>
                <button id="registerTab" class="auth-tab flex-1 py-3 px-4 rounded-md font-medium transition-all">
                    Register
                </button>
            </div>

            <!-- Login Form -->
            <div id="loginForm" class="auth-form">
                <div class="text-center mb-8">
                    <h1 class="text-3xl font-bold text-gradient mb-2">Welcome Back</h1>
                    <p class="text-gray-400">Sign in to continue your journey</p>
                </div>

                <form class="space-y-6">
                    <div>
                        <label class="auth-label">Username</label>
                        <input type="text" id="loginUsername" class="auth-input" placeholder="Enter your username" required>
                    </div>

                    <div>
                        <label class="auth-label">Password</label>
                        <input type="password" id="loginPassword" class="auth-input" placeholder="Enter your password" required>
                    </div>

                    <button type="submit" id="loginBtn" class="btn btn-primary w-full">
                        <span class="btn-text">Sign In</span>
                        <div class="btn-loading hidden">
                            <div class="spinner"></div>
                        </div>
                    </button>
                </form>

                <div class="mt-6 text-center">
                    <p class="text-gray-400">
                        Demo Accounts: 
                        <button class="text-primary-500 hover:text-primary-400" onclick="fillDemoLogin('admin', 'admin123')">
                            Admin
                        </button>
                         | 
                        <button class="text-primary-500 hover:text-primary-400" onclick="fillDemoLogin('user', 'user123')">
                            User
                        </button>
                    </p>
                </div>
            </div>

            <!-- Register Form -->
            <div id="registerForm" class="auth-form hidden">
                <div class="text-center mb-8">
                    <h1 class="text-3xl font-bold text-gradient mb-2">Join CineScope</h1>
                    <p class="text-gray-400">Create your account to get personalized recommendations</p>
                </div>

                <form class="space-y-6">
                    <div>
                        <label class="auth-label">Username</label>
                        <input type="text" id="registerUsername" class="auth-input" placeholder="Choose a username" required>
                    </div>

                    <div>
                        <label class="auth-label">Email</label>
                        <input type="email" id="registerEmail" class="auth-input" placeholder="Enter your email" required>
                    </div>

                    <div>
                        <label class="auth-label">Password</label>
                        <input type="password" id="registerPassword" class="auth-input" placeholder="Create a password" required>
                    </div>

                    <div>
                        <label class="auth-label">Preferred Languages</label>
                        <div class="preferences-grid">
                            <label class="preference-item">
                                <input type="checkbox" value="english" class="preference-checkbox">
                                <span class="preference-label">English</span>
                            </label>
                            <label class="preference-item">
                                <input type="checkbox" value="hindi" class="preference-checkbox">
                                <span class="preference-label">Hindi</span>
                            </label>
                            <label class="preference-item">
                                <input type="checkbox" value="telugu" class="preference-checkbox">
                                <span class="preference-label">Telugu</span>
                            </label>
                            <label class="preference-item">
                                <input type="checkbox" value="tamil" class="preference-checkbox">
                                <span class="preference-label">Tamil</span>
                            </label>
                            <label class="preference-item">
                                <input type="checkbox" value="kannada" class="preference-checkbox">
                                <span class="preference-label">Kannada</span>
                            </label>
                            <label class="preference-item">
                                <input type="checkbox" value="malayalam" class="preference-checkbox">
                                <span class="preference-label">Malayalam</span>
                            </label>
                        </div>
                    </div>

                    <div>
                        <label class="auth-label">Preferred Genres</label>
                        <div class="preferences-grid">
                            <label class="preference-item">
                                <input type="checkbox" value="action" class="preference-checkbox">
                                <span class="preference-label">Action</span>
                            </label>
                            <label class="preference-item">
                                <input type="checkbox" value="comedy" class="preference-checkbox">
                                <span class="preference-label">Comedy</span>
                            </label>
                            <label class="preference-item">
                                <input type="checkbox" value="drama" class="preference-checkbox">
                                <span class="preference-label">Drama</span>
                            </label>
                            <label class="preference-item">
                                <input type="checkbox" value="horror" class="preference-checkbox">
                                <span class="preference-label">Horror</span>
                            </label>
                            <label class="preference-item">
                                <input type="checkbox" value="romance" class="preference-checkbox">
                                <span class="preference-label">Romance</span>
                            </label>
                            <label class="preference-item">
                                <input type="checkbox" value="sci-fi" class="preference-checkbox">
                                <span class="preference-label">Sci-Fi</span>
                            </label>
                        </div>
                    </div>

                    <button type="submit" id="registerBtn" class="btn btn-primary w-full">
                        <span class="btn-text">Create Account</span>
                        <div class="btn-loading hidden">
                            <div class="spinner"></div>
                        </div>
                    </button>
                </form>
            </div>

            <!-- Error/Success Messages -->
            <div id="authMessage" class="hidden mt-4 p-4 rounded-lg"></div>
        </div>
    </main>

    <!-- Footer -->
    <div data-include="footer"></div>

    <!-- Scripts -->
    <script src="/js/auth.js"></script>
    <script src="/js/api.js"></script>
    <script src="/js/main.js"></script>

    <!-- Page-specific script -->
    <script>
        let currentTab = 'login';

        // Tab switching
        document.getElementById('loginTab').addEventListener('click', () => switchTab('login'));
        document.getElementById('registerTab').addEventListener('click', () => switchTab('register'));

        function switchTab(tab) {
            currentTab = tab;
            
            // Update tab buttons
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.getElementById(tab + 'Tab').classList.add('active');
            
            // Update forms
            document.getElementById('loginForm').classList.toggle('hidden', tab !== 'login');
            document.getElementById('registerForm').classList.toggle('hidden', tab !== 'register');
            
            // Clear messages
            hideMessage();
        }

        // Form submissions
        document.getElementById('loginForm').addEventListener('submit', handleLogin);
        document.getElementById('registerForm').addEventListener('submit', handleRegister);

        async function handleLogin(e) {
            e.preventDefault();
            
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!username || !password) {
                showMessage('Please fill in all fields', 'error');
                return;
            }

            setLoading('loginBtn', true);
            
            try {
                const result = await AuthManager.login(username, password);
                
                if (result.success) {
                    showMessage('Login successful! Redirecting...', 'success');
                    setTimeout(() => {
                        AuthManager.redirectBasedOnRole(result.user);
                    }, 1000);
                } else {
                    showMessage(result.error, 'error');
                }
            } catch (error) {
                showMessage('Login failed. Please try again.', 'error');
            } finally {
                setLoading('loginBtn', false);
            }
        }

        async function handleRegister(e) {
            e.preventDefault();
            
            const username = document.getElementById('registerUsername').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            
            const preferredLanguages = Array.from(document.querySelectorAll('#registerForm .preference-checkbox:checked'))
                .map(cb => cb.value);
            
            const preferredGenres = Array.from(document.querySelectorAll('#registerForm .preference-checkbox:checked'))
                .map(cb => cb.value);

            if (!username || !email || !password) {
                showMessage('Please fill in all fields', 'error');
                return;
            }

            setLoading('registerBtn', true);
            
            try {
                const result = await AuthManager.register({
                    username,
                    email,
                    password,
                    preferred_languages: preferredLanguages,
                    preferred_genres: preferredGenres
                });
                
                if (result.success) {
                    showMessage('Registration successful! Redirecting...', 'success');
                    setTimeout(() => {
                        AuthManager.redirectBasedOnRole(result.user);
                    }, 1000);
                } else {
                    showMessage(result.error, 'error');
                }
            } catch (error) {
                showMessage('Registration failed. Please try again.', 'error');
            } finally {
                setLoading('registerBtn', false);
            }
        }

        function fillDemoLogin(username, password) {
            document.getElementById('loginUsername').value = username;
            document.getElementById('loginPassword').value = password;
        }

        function setLoading(buttonId, loading) {
            const btn = document.getElementById(buttonId);
            const text = btn.querySelector('.btn-text');
            const spinner = btn.querySelector('.btn-loading');
            
            btn.disabled = loading;
            text.classList.toggle('hidden', loading);
            spinner.classList.toggle('hidden', !loading);
        }

        function showMessage(message, type) {
            const messageEl = document.getElementById('authMessage');
            messageEl.textContent = message;
            messageEl.className = `p-4 rounded-lg ${type === 'success' ? 'bg-green-900 text-green-200' : 'bg-red-900 text-red-200'}`;
            messageEl.classList.remove('hidden');
        }

        function hideMessage() {
            document.getElementById('authMessage').classList.add('hidden');
        }

        // Check if already authenticated
        document.addEventListener('DOMContentLoaded', () => {
            if (AuthManager.isAuthenticated()) {
                AuthManager.redirectBasedOnRole(AuthManager.currentUser);
            }
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign In - MovieRec</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --netflix-red: #e50914;
            --netflix-dark: #141414;
            --netflix-gray: #333333;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: linear-gradient(135deg, #141414 0%, #000000 100%);
            color: white;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 0;
            min-height: 100vh;
        }

        .auth-container {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .input-field {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            transition: all 0.3s ease;
            min-height: 48px;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--netflix-red);
            box-shadow: 0 0 0 2px rgba(229, 9, 20, 0.2);
            background: rgba(255, 255, 255, 0.15);
        }

        .input-field::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--netflix-red) 0%, #c41e3a 100%);
            transition: all 0.3s ease;
            min-height: 48px;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #c41e3a 0%, var(--netflix-red) 100%);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(229, 9, 20, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .tab-active {
            background: var(--netflix-red);
            color: white;
        }

        .tab-inactive {
            background: transparent;
            color: rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .slide-up {
            transform: translateY(20px);
            opacity: 0;
            animation: slideUp 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        @keyframes slideUp {
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .error-message {
            background: rgba(220, 38, 38, 0.1);
            border: 1px solid rgba(220, 38, 38, 0.3);
            color: #fca5a5;
        }

        .success-message {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            color: #86efac;
        }

        .loading-spinner {
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-left: 2px solid var(--netflix-red);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .auth-container {
                margin: 1rem;
                padding: 2rem 1.5rem;
            }
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <!-- Background Pattern -->
    <div class="fixed inset-0 opacity-5">
        <div class="absolute inset-0" style="background-image: radial-gradient(circle at 1px 1px, white 1px, transparent 0); background-size: 20px 20px;"></div>
    </div>

    <!-- Auth Container -->
    <div class="auth-container w-full max-w-md p-8 rounded-2xl shadow-2xl slide-up">
        <!-- Logo -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-red-500 mb-2">MovieRec</h1>
            <p class="text-gray-400">Your personal movie companion</p>
        </div>

        <!-- Tab Navigation -->
        <div class="flex mb-8">
            <button id="login-tab" onclick="switchTab('login')" class="flex-1 py-3 px-4 text-center font-medium rounded-l-lg tab-active transition-all">
                Sign In
            </button>
            <button id="register-tab" onclick="switchTab('register')" class="flex-1 py-3 px-4 text-center font-medium rounded-r-lg tab-inactive transition-all">
                Sign Up
            </button>
        </div>

        <!-- Login Form -->
        <form id="login-form" class="space-y-6">
            <div>
                <label for="login-username" class="block text-sm font-medium text-gray-300 mb-2">
                    Username or Email
                </label>
                <input type="text" 
                       id="login-username" 
                       name="username"
                       placeholder="Enter your username or email"
                       class="input-field w-full px-4 py-3 rounded-lg"
                       required>
            </div>

            <div>
                <label for="login-password" class="block text-sm font-medium text-gray-300 mb-2">
                    Password
                </label>
                <div class="relative">
                    <input type="password" 
                           id="login-password" 
                           name="password"
                           placeholder="Enter your password"
                           class="input-field w-full px-4 py-3 rounded-lg pr-12"
                           required>
                    <button type="button" 
                            onclick="togglePassword('login-password')"
                            class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-white">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <button type="submit" id="login-btn" class="btn-primary w-full py-3 rounded-lg font-semibold flex items-center justify-center">
                <span id="login-btn-text">Sign In</span>
                <div id="login-spinner" class="loading-spinner w-5 h-5 rounded-full ml-2 hidden"></div>
            </button>
        </form>

        <!-- Register Form -->
        <form id="register-form" class="space-y-6 hidden">
            <div>
                <label for="register-username" class="block text-sm font-medium text-gray-300 mb-2">
                    Username
                </label>
                <input type="text" 
                       id="register-username" 
                       name="username"
                       placeholder="Choose a username"
                       class="input-field w-full px-4 py-3 rounded-lg"
                       required>
            </div>

            <div>
                <label for="register-email" class="block text-sm font-medium text-gray-300 mb-2">
                    Email
                </label>
                <input type="email" 
                       id="register-email" 
                       name="email"
                       placeholder="Enter your email"
                       class="input-field w-full px-4 py-3 rounded-lg"
                       required>
            </div>

            <div>
                <label for="register-password" class="block text-sm font-medium text-gray-300 mb-2">
                    Password
                </label>
                <div class="relative">
                    <input type="password" 
                           id="register-password" 
                           name="password"
                           placeholder="Create a password"
                           class="input-field w-full px-4 py-3 rounded-lg pr-12"
                           required>
                    <button type="button" 
                            onclick="togglePassword('register-password')"
                            class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-white">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                        </svg>
                    </button>
                </div>
                <p class="text-xs text-gray-400 mt-1">Password must be at least 6 characters</p>
            </div>

            <div>
                <label for="confirm-password" class="block text-sm font-medium text-gray-300 mb-2">
                    Confirm Password
                </label>
                <input type="password" 
                       id="confirm-password" 
                       name="confirmPassword"
                       placeholder="Confirm your password"
                       class="input-field w-full px-4 py-3 rounded-lg"
                       required>
            </div>

            <button type="submit" id="register-btn" class="btn-primary w-full py-3 rounded-lg font-semibold flex items-center justify-center">
                <span id="register-btn-text">Sign Up</span>
                <div id="register-spinner" class="loading-spinner w-5 h-5 rounded-full ml-2 hidden"></div>
            </button>
        </form>

        <!-- Message Container -->
        <div id="message-container" class="mt-6 hidden">
            <div id="message" class="p-4 rounded-lg text-sm"></div>
        </div>

        <!-- Back to Home -->
        <div class="text-center mt-8">
            <a href="index.html" class="text-gray-400 hover:text-red-400 transition-colors text-sm">
                ← Back to Home
            </a>
        </div>

        <!-- Demo Credentials -->
        <div class="text-center mt-6 p-4 bg-gray-800 rounded-lg">
            <p class="text-xs text-gray-400 mb-2">Demo Credentials:</p>
            <p class="text-xs text-gray-300">Username: <span class="text-red-400">demo</span> | Password: <span class="text-red-400">demo123</span></p>
        </div>
    </div>

    <script>
        const API_BASE = 'https://backend-app-970m.onrender.com/api';
        let currentTab = 'login';
        let authToken = null;

        // Tab switching
        function switchTab(tab) {
            currentTab = tab;
            
            // Update tab styles
            const loginTab = document.getElementById('login-tab');
            const registerTab = document.getElementById('register-tab');
            const loginForm = document.getElementById('login-form');
            const registerForm = document.getElementById('register-form');

            if (tab === 'login') {
                loginTab.className = loginTab.className.replace('tab-inactive', 'tab-active');
                registerTab.className = registerTab.className.replace('tab-active', 'tab-inactive');
                loginForm.classList.remove('hidden');
                registerForm.classList.add('hidden');
            } else {
                registerTab.className = registerTab.className.replace('tab-inactive', 'tab-active');
                loginTab.className = loginTab.className.replace('tab-active', 'tab-inactive');
                registerForm.classList.remove('hidden');
                loginForm.classList.add('hidden');
            }

            hideMessage();
        }

        // Password visibility toggle
        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
            input.setAttribute('type', type);
        }

        // Message display functions
        function showMessage(message, type = 'error') {
            const container = document.getElementById('message-container');
            const messageDiv = document.getElementById('message');
            
            messageDiv.textContent = message;
            messageDiv.className = `p-4 rounded-lg text-sm ${type === 'error' ? 'error-message' : 'success-message'}`;
            container.classList.remove('hidden');
            
            // Auto hide after 5 seconds
            setTimeout(hideMessage, 5000);
        }

        function hideMessage() {
            document.getElementById('message-container').classList.add('hidden');
        }

        // Loading states
        function setLoading(formType, isLoading) {
            const btn = document.getElementById(`${formType}-btn`);
            const btnText = document.getElementById(`${formType}-btn-text`);
            const spinner = document.getElementById(`${formType}-spinner`);
            
            btn.disabled = isLoading;
            if (isLoading) {
                btnText.textContent = formType === 'login' ? 'Signing In...' : 'Signing Up...';
                spinner.classList.remove('hidden');
            } else {
                btnText.textContent = formType === 'login' ? 'Sign In' : 'Sign Up';
                spinner.classList.add('hidden');
            }
        }

        // Form validation
        function validateLoginForm(formData) {
            if (!formData.username || !formData.password) {
                throw new Error('Please fill in all fields');
            }
        }

        function validateRegisterForm(formData) {
            if (!formData.username || !formData.email || !formData.password || !formData.confirmPassword) {
                throw new Error('Please fill in all fields');
            }
            
            if (formData.username.length < 3) {
                throw new Error('Username must be at least 3 characters');
            }
            
            if (formData.password.length < 6) {
                throw new Error('Password must be at least 6 characters');
            }
            
            if (formData.password !== formData.confirmPassword) {
                throw new Error('Passwords do not match');
            }
            
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(formData.email)) {
                throw new Error('Please enter a valid email address');
            }
        }

        // API calls
        async function loginUser(credentials) {
            const response = await fetch(`${API_BASE}/login`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(credentials)
            });

            const data = await response.json();
            
            if (!response.ok) {
                throw new Error(data.error || 'Login failed');
            }

            return data;
        }

        async function registerUser(userData) {
            const response = await fetch(`${API_BASE}/register`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(userData)
            });

            const data = await response.json();
            
            if (!response.ok) {
                throw new Error(data.error || 'Registration failed');
            }

            return data;
        }

        // Form handlers
        async function handleLogin(event) {
            event.preventDefault();
            hideMessage();
            
            try {
                const formData = new FormData(event.target);
                const credentials = {
                    username: formData.get('username').trim(),
                    password: formData.get('password')
                };

                validateLoginForm(credentials);
                setLoading('login', true);

                const response = await loginUser(credentials);
                
                // Store auth token in memory
                authToken = response.token;
                window.authToken = authToken;
                
                showMessage('Login successful! Redirecting...', 'success');
                
                // Redirect to dashboard after short delay
                setTimeout(() => {
                    window.location.href = 'dashboard.html';
                }, 1500);
                
            } catch (error) {
                showMessage(error.message);
                setLoading('login', false);
            }
        }

        async function handleRegister(event) {
            event.preventDefault();
            hideMessage();
            
            try {
                const formData = new FormData(event.target);
                const userData = {
                    username: formData.get('username').trim(),
                    email: formData.get('email').trim(),
                    password: formData.get('password'),
                    confirmPassword: formData.get('confirmPassword')
                };

                validateRegisterForm(userData);
                setLoading('register', true);

                const response = await registerUser({
                    username: userData.username,
                    email: userData.email,
                    password: userData.password
                });
                
                // Store auth token in memory
                authToken = response.token;
                window.authToken = authToken;
                
                showMessage('Registration successful! Redirecting...', 'success');
                
                // Redirect to dashboard after short delay
                setTimeout(() => {
                    window.location.href = 'dashboard.html';
                }, 1500);
                
            } catch (error) {
                showMessage(error.message);
                setLoading('register', false);
            }
        }

        // Event listeners
        document.getElementById('login-form').addEventListener('submit', handleLogin);
        document.getElementById('register-form').addEventListener('submit', handleRegister);

        // Auto-fill demo credentials when demo username is clicked
        document.addEventListener('click', function(e) {
            if (e.target.textContent === 'demo') {
                document.getElementById('login-username').value = 'demo';
                document.getElementById('login-password').value = 'demo123';
            }
        });

        // Enter key handling for better UX
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const activeForm = currentTab === 'login' ? 'login-form' : 'register-form';
                document.getElementById(activeForm).dispatchEvent(new Event('submit'));
            }
        });

        // Check if user is already logged in
        document.addEventListener('DOMContentLoaded', function() {
            if (window.authToken) {
                window.location.href = 'dashboard.html';
            }
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en" data-theme="dark" data-bs-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forgot Password - CineBrain</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicon-32x32.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/apple-icon-180x180.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Inter:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <link rel="stylesheet" href="/assets/css/auth.css">
</head>

<body>
    <div class="forgot-card">
        <div class="brand">
            <h1 class="brand-name">CineBrain</h1>
            <p class="brand-tagline">Your Personal Entertainment Companion</p>
        </div>

        <div class="page-title">
            <h2>Forgot Password?</h2>
        </div>
        <p class="page-description">
            Enter your email address and we'll send you a link to reset your password.
        </p>

        <div class="alert" id="alertBox"></div>

        <form id="forgotForm" novalidate>
            <div class="form-group">
                <label for="email" class="form-label">Email Address</label>
                <div class="input-wrapper">
                    <input type="email" id="email" name="email" class="form-input"
                        placeholder="Enter your email address" required autocomplete="email">
                </div>
            </div>

            <button type="submit" class="submit-button" id="submitButton">
                <div class="submit-button-content">
                    <span class="button-text">Send Reset Link</span>
                    <div class="spinner"></div>
                </div>
            </button>
        </form>

        <div class="form-links">
            <a href="/auth/login.html" class="back-link">
                <i data-feather="arrow-left"></i>
                Back to Login
            </a>
        </div>
    </div>
    <script src="/assets/js/config.js"></script>
    <script>
        const API_BASE = window.CineBrainConfig.apiBase;

        function detectAndApplyTheme() {
            const savedTheme = localStorage.getItem('cinebrain-theme');
            let theme = savedTheme || 'dark';

            if (!savedTheme && window.matchMedia) {
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                theme = prefersDark ? 'dark' : 'light';
            }

            applyTheme(theme);
        }

        function applyTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            document.documentElement.setAttribute('data-bs-theme', theme);
            document.body.setAttribute('data-theme', theme);
            document.body.setAttribute('data-bs-theme', theme);
        }

        window.addEventListener('storage', (e) => {
            if (e.key === 'cinebrain-theme' && e.newValue) {
                applyTheme(e.newValue);
            }
        });

        document.addEventListener('DOMContentLoaded', () => {
            detectAndApplyTheme();

            if (typeof feather !== 'undefined') {
                feather.replace();
            }

            setupFormValidation();
            setupForgotForm();
        });

        function setupFormValidation() {
            const emailInput = document.getElementById('email');

            emailInput.addEventListener('input', () => {
                hideAlert();
            });
        }

        function validateEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        function validateForm(email) {
            if (!email) {
                showAlert('Email address is required', 'error');
                return false;
            }

            if (!validateEmail(email)) {
                showAlert('Please enter a valid email address', 'error');
                return false;
            }

            return true;
        }

        function setupForgotForm() {
            const forgotForm = document.getElementById('forgotForm');

            forgotForm.addEventListener('submit', async (e) => {
                e.preventDefault();

                const email = document.getElementById('email').value.trim();

                if (!validateForm(email)) {
                    return;
                }

                await submitForgotPassword(email);
            });
        }

        async function submitForgotPassword(email) {
            const submitButton = document.getElementById('submitButton');

            try {
                submitButton.classList.add('loading');
                submitButton.disabled = true;
                hideAlert();

                const response = await fetch(`${API_BASE}/auth/forgot-password`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email })
                });

                const data = await response.json();

                if (response.ok) {
                    showAlert(
                        data.message || 'If a CineBrain account exists with this email, you will receive password reset instructions.',
                        'success'
                    );

                    document.getElementById('email').value = '';
                } else {
                    showAlert(data.error || 'An error occurred. Please try again.', 'error');
                }
            } catch (error) {
                console.error('CineBrain forgot password error:', error);
                showAlert('Network error. Please check your connection and try again.', 'error');
            } finally {
                submitButton.classList.remove('loading');
                submitButton.disabled = false;
            }
        }

        function showAlert(message, type = 'error') {
            const alertBox = document.getElementById('alertBox');

            alertBox.textContent = message;
            alertBox.className = `alert alert-${type} show`;

            if (type === 'success') {
                setTimeout(() => hideAlert(), 5000);
            }
        }

        function hideAlert() {
            const alertBox = document.getElementById('alertBox');
            alertBox.classList.remove('show');
        }
    </script>
</body>

</html>
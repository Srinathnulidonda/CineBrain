<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="description" content="Reset Password - CineScope">
    <title>Forgot Password - CineScope</title>
    
    <link rel="preload" href="../js/config.js" as="script">
    <link rel="preload" href="../js/api.js" as="script">
    <link rel="preload" href="../js/auth.js" as="script">
    
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/components.css">
    <link rel="stylesheet" href="../css/responsive.css">
    <link rel="stylesheet" href="../css/theme.css">
</head>
<body class="auth-body">
    <!-- Minimal Top Bar -->
    <nav class="topbar auth-topbar">
        <a href="/" class="logo">CineScope</a>
        <div class="auth-nav">
            <a href="/auth/login.html" class="btn btn-outline btn-sm">Sign In</a>
        </div>
    </nav>

    <main class="auth-main">
        <div class="auth-container">
            <div class="auth-form-wrapper">
                <div class="auth-header">
                    <h1>Reset Your Password</h1>
                    <p>Enter your email address and we'll send you instructions to reset your password</p>
                </div>

                <form class="auth-form" id="forgotPasswordForm">
                    <div class="form-group">
                        <label for="email" class="form-label">Email Address</label>
                        <input type="email" 
                               id="email" 
                               name="email" 
                               class="form-input" 
                               required 
                               autocomplete="email"
                               placeholder="Enter your registered email">
                        <div class="form-error" id="emailError"></div>
                        <div class="form-hint">We'll send password reset instructions to this email</div>
                    </div>

                    <button type="submit" class="btn btn-primary btn-full" id="resetBtn">
                        <span class="btn-text">Send Reset Instructions</span>
                        <div class="btn-spinner" style="display: none;"></div>
                    </button>

                    <div class="auth-divider">
                        <span>Remember your password?</span>
                    </div>

                    <a href="/auth/login.html" class="btn btn-outline btn-full">
                        Back to Sign In
                    </a>
                </form>

                <div class="auth-footer">
                    <p class="auth-disclaimer">
                        If you don't receive an email within a few minutes, check your spam folder or 
                        <a href="#" class="link-primary" onclick="resendEmail()">try again</a>.
                    </p>
                </div>
            </div>

            <!-- Success State -->
            <div class="auth-success" id="successState" style="display: none;">
                <div class="success-icon">‚úâÔ∏è</div>
                <h2>Check Your Email</h2>
                <p>We've sent password reset instructions to:</p>
                <p class="email-display" id="emailDisplay"></p>
                <div class="success-actions">
                    <a href="/auth/login.html" class="btn btn-primary">Back to Sign In</a>
                    <button class="btn btn-outline" onclick="resendEmail()">Resend Email</button>
                </div>
                <p class="success-note">
                    Didn't receive the email? Check your spam folder or make sure you entered the correct email address.
                </p>
            </div>

            <!-- Info Panel -->
            <div class="auth-promo">
                <div class="promo-content">
                    <h2>Account Security Tips</h2>
                    <ul class="security-tips">
                        <li>üîê Use a strong, unique password for your CineScope account</li>
                        <li>üìß Keep your email address up to date</li>
                        <li>üîÑ Change your password regularly</li>
                        <li>‚ö†Ô∏è Never share your password with anyone</li>
                        <li>üõ°Ô∏è Enable two-factor authentication when available</li>
                    </ul>
                    <div class="promo-stats">
                        <div class="stat-item">
                            <div class="stat-icon">üîí</div>
                            <div class="stat-info">
                                <div class="stat-label">Secure Platform</div>
                                <div class="stat-value">256-bit Encryption</div>
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-icon">üë§</div>
                            <div class="stat-info">
                                <div class="stat-label">Protected Accounts</div>
                                <div class="stat-value">100K+ Users</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="../js/config.js"></script>
    <script src="../js/api.js"></script>
    <script src="../js/auth.js"></script>

    <script>
        let submittedEmail = '';

        document.addEventListener('DOMContentLoaded', () => {
            // Check if already authenticated
            if (window.auth.isAuthenticated()) {
                window.auth.navigateToUserProfile();
                return;
            }

            setupForgotPasswordForm();
        });

        function setupForgotPasswordForm() {
            const form = document.getElementById('forgotPasswordForm');
            const resetBtn = document.getElementById('resetBtn');
            const btnText = resetBtn.querySelector('.btn-text');
            const btnSpinner = resetBtn.querySelector('.btn-spinner');

            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const formData = new FormData(form);
                const email = formData.get('email').trim();

                // Validation
                if (!validateEmail(email)) {
                    showError('emailError', 'Please enter a valid email address');
                    return;
                }

                // Show loading state
                resetBtn.disabled = true;
                btnText.style.display = 'none';
                btnSpinner.style.display = 'inline-block';

                try {
                    // In a real implementation, this would call the password reset API
                    // For now, we'll simulate the request
                    await simulatePasswordReset(email);
                    
                    submittedEmail = email;
                    showSuccessState(email);
                    
                } catch (error) {
                    console.error('Password reset error:', error);
                    showError('emailError', 'Failed to send reset instructions. Please try again.');
                    showToast('Failed to send reset instructions', 'error');
                } finally {
                    // Reset button state
                    resetBtn.disabled = false;
                    btnText.style.display = 'inline';
                    btnSpinner.style.display = 'none';
                }
            });

            // Real-time email validation
            document.getElementById('email').addEventListener('blur', () => {
                const email = document.getElementById('email').value.trim();
                if (email && !validateEmail(email)) {
                    showError('emailError', 'Please enter a valid email address');
                } else {
                    clearError('emailError');
                }
            });
        }

        async function simulatePasswordReset(email) {
            // Simulate API call delay
            return new Promise((resolve) => {
                setTimeout(() => {
                    // In a real app, this would make an API call to:
                    // await window.api.request('/auth/forgot-password', { method: 'POST', body: JSON.stringify({ email }) });
                    resolve();
                }, 1500);
            });
        }

        function showSuccessState(email) {
            document.querySelector('.auth-form-wrapper').style.display = 'none';
            document.getElementById('successState').style.display = 'block';
            document.getElementById('emailDisplay').textContent = email;
            
            showToast('Password reset instructions sent!', 'success');
        }

        async function resendEmail() {
            if (!submittedEmail) {
                // Go back to form
                document.querySelector('.auth-form-wrapper').style.display = 'block';
                document.getElementById('successState').style.display = 'none';
                return;
            }

            showToast('Sending email...', 'info');

            try {
                await simulatePasswordReset(submittedEmail);
                showToast('Reset instructions resent!', 'success');
            } catch (error) {
                showToast('Failed to resend email. Please try again.', 'error');
            }
        }

        function validateEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        function showError(elementId, message) {
            const errorElement = document.getElementById(elementId);
            errorElement.textContent = message;
            errorElement.style.display = 'block';
            
            const input = document.querySelector(`#${elementId.replace('Error', '')}`);
            if (input) input.classList.add('input-error');
        }

        function clearError(elementId) {
            const errorElement = document.getElementById(elementId);
            errorElement.textContent = '';
            errorElement.style.display = 'none';
            
            const input = document.querySelector(`#${elementId.replace('Error', '')}`);
            if (input) input.classList.remove('input-error');
        }

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => toast.classList.add('toast-show'), 100);
            setTimeout(() => {
                toast.classList.remove('toast-show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Reset Password - CineBrain">
  <title>Reset Password - CineBrain</title>
  
  <!-- Critical CSS -->
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/components.css">
  <link rel="stylesheet" href="/css/layouts.css">
  <link rel="stylesheet" href="/css/animations.css">
  <link rel="stylesheet" href="/css/responsive.css">
  <link rel="stylesheet" href="/css/theme.css">
</head>
<body>
  <!-- Fixed Topbar -->
  <div id="topbar"></div>

  <!-- Main Content -->
  <div class="page-layout">
    <main class="page-main">
      <div class="container" style="max-width: 480px; margin-top: 15vh;">
        <div class="bg-elevated rounded-2xl p-8 shadow-premium">
          <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-primary mb-2">Reset Password</h1>
            <p class="text-muted">Enter your email to receive reset instructions</p>
          </div>

          <!-- Password Reset Form -->
          <form id="reset-form">
            <div class="form-group">
              <label for="email" class="form-label">Email Address</label>
              <input 
                type="email" 
                id="email" 
                name="email" 
                class="form-input focus-ring" 
                placeholder="Enter your email address"
                required
                autocomplete="email"
              >
              <div class="form-error" id="email-error"></div>
            </div>

            <button type="submit" class="btn btn-primary w-full" id="reset-btn">
              <span id="reset-btn-text">Send Reset Link</span>
              <div id="reset-spinner" class="loading-spinner" style="display: none; width: 20px; height: 20px;"></div>
            </button>

            <div class="form-error text-center" id="reset-error"></div>
            <div class="form-success text-center" id="reset-success"></div>
          </form>

          <!-- Back to Login -->
          <div class="mt-6 text-center">
            <p class="text-muted">
              Remember your password? 
              <a href="/auth/login.html" class="text-primary hover:underline font-medium">
                Back to login
              </a>
            </p>
          </div>

          <!-- Information Box -->
          <div class="mt-6 p-4 bg-surface rounded-lg border border-blue-500/20">
            <h3 class="text-sm font-medium text-blue-400 mb-2">Password Reset Process</h3>
            <ul class="text-xs text-muted space-y-1">
              <li>â€¢ We'll send a secure reset link to your email</li>
              <li>â€¢ Link expires in 15 minutes for security</li>
              <li>â€¢ Check your spam folder if you don't see it</li>
              <li>â€¢ Contact support if you need help</li>
            </ul>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Mobile Navigation -->
  <div id="mobile-nav"></div>

  <!-- Scripts -->
  <script type="module" src="/js/config.js"></script>
  <script type="module" src="/js/api.js"></script>
  <script type="module" src="/js/auth.js"></script>
  <script type="module" src="/js/app.js"></script>

  <!-- Page-Specific Logic -->
  <script>
    let isSubmitting = false;

    document.addEventListener('DOMContentLoaded', function() {
      loadComponents();
      initializeResetPage();
    });

    async function loadComponents() {
      try {
        const topbarResponse = await fetch('/components/layout/topbar.html');
        const topbarHTML = await topbarResponse.text();
        document.getElementById('topbar').innerHTML = topbarHTML;

        const mobileNavResponse = await fetch('/components/layout/mobile-nav.html');
        const mobileNavHTML = await mobileNavResponse.text();
        document.getElementById('mobile-nav').innerHTML = mobileNavHTML;
      } catch (error) {
        console.error('Error loading components:', error);
      }
    }

    function initializeResetPage() {
      const resetForm = document.getElementById('reset-form');
      resetForm.addEventListener('submit', handlePasswordReset);

      document.getElementById('email').focus();
      
      console.log('ðŸ”‘ Password reset page initialized');
    }

    async function handlePasswordReset(event) {
      event.preventDefault();
      
      if (isSubmitting) return;
      isSubmitting = true;
      
      clearMessages();
      showLoading(true);

      try {
        const formData = new FormData(event.target);
        const email = formData.get('email').trim();

        if (!validateEmail(email)) {
          showError('email-error', 'Please enter a valid email address');
          return;
        }

        // Simulate password reset request (since backend doesn't have this endpoint)
        await simulatePasswordReset(email);
        
        showSuccess('Reset instructions sent! Check your email for the password reset link.');
        
        // Disable form after successful submission
        document.getElementById('email').disabled = true;
        document.getElementById('reset-btn').disabled = true;
        
      } catch (error) {
        console.error('Password reset error:', error);
        showError('reset-error', error.message || 'Failed to send reset instructions. Please try again.');
        
      } finally {
        isSubmitting = false;
        showLoading(false);
      }
    }

    async function simulatePasswordReset(email) {
      // Since the backend doesn't have a password reset endpoint,
      // we'll simulate the process with a realistic delay
      return new Promise((resolve, reject) => {
        setTimeout(() => {
          // Simulate validation
          if (email.includes('@')) {
            resolve({ success: true });
          } else {
            reject(new Error('Invalid email address'));
          }
        }, 2000); // 2 second delay to simulate server processing
      });
    }

    function validateEmail(email) {
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return emailRegex.test(email);
    }

    function showLoading(show) {
      const btn = document.getElementById('reset-btn');
      const btnText = document.getElementById('reset-btn-text');
      const spinner = document.getElementById('reset-spinner');
      
      if (show) {
        btn.disabled = true;
        btnText.style.display = 'none';
        spinner.style.display = 'block';
      } else {
        btn.disabled = false;
        btnText.style.display = 'block';
        spinner.style.display = 'none';
      }
    }

    function showError(elementId, message) {
      const errorElement = document.getElementById(elementId);
      errorElement.textContent = message;
      errorElement.style.display = 'block';
    }

    function showSuccess(message) {
      const successElement = document.getElementById('reset-success');
      successElement.textContent = message;
      successElement.style.display = 'block';
    }

    function clearMessages() {
      document.getElementById('email-error').style.display = 'none';
      document.getElementById('reset-error').style.display = 'none';
      document.getElementById('reset-success').style.display = 'none';
    }
  </script>
</body>
</html>
<!-- Content Type Badge Component -->
<div class="type-badge-component d-inline-flex align-items-center" data-content-type="">

    <!-- Type Icon -->
    <i class="type-icon me-2"></i>

    <!-- Type Text -->
    <span class="type-text fw-semibold text-uppercase">Movie</span>

    <!-- Additional Info (Runtime, Episodes, etc.) -->
    <span class="type-info text-muted ms-2 d-none">
        <span class="info-text"></span>
    </span>

    <!-- Quality Badge (HD, 4K, etc.) -->
    <span class="quality-badge ms-2 d-none">
        <span class="quality-text"></span>
    </span>
</div>

<script>
    class TypeBadge {
        constructor(element) {
            this.element = element;
            this.contentType = '';
            this.additionalInfo = null;
            this.quality = null;
            this.initialize();
        }

        initialize() {
            this.loadTypeData();
            this.setupTooltip();
        }

        setupTooltip() {
            if (typeof bootstrap !== 'undefined') {
                new bootstrap.Tooltip(this.element, {
                    title: () => this.getTooltipText(),
                    placement: 'top'
                });
            }
        }

        getTooltipText() {
            const typeDescriptions = {
                'movie': 'Feature Film',
                'tv': 'Television Series',
                'anime': 'Japanese Animation',
                'documentary': 'Documentary Film',
                'short': 'Short Film',
                'series': 'TV Series'
            };

            return typeDescriptions[this.contentType] || 'Unknown Content Type';
        }

        updateType(contentType, additionalInfo = null, quality = null) {
            this.contentType = contentType.toLowerCase();
            this.additionalInfo = additionalInfo;
            this.quality = quality;

            this.updateDisplay();
            this.updateIcon();
            this.updateStyling();
            this.updateAdditionalInfo();
            this.updateQuality();
        }

        updateDisplay() {
            const typeText = this.element.querySelector('.type-text');
            const typeDisplayNames = {
                'movie': 'Movie',
                'tv': 'TV Show',
                'anime': 'Anime',
                'documentary': 'Documentary',
                'short': 'Short',
                'series': 'Series'
            };

            typeText.textContent = typeDisplayNames[this.contentType] || this.contentType.toUpperCase();
            this.element.dataset.contentType = this.contentType;
        }

        updateIcon() {
            const iconElement = this.element.querySelector('.type-icon');
            const typeIcons = {
                'movie': 'bi-camera-reels',
                'tv': 'bi-tv',
                'anime': 'bi-emoji-heart-eyes',
                'documentary': 'bi-file-text',
                'short': 'bi-clock',
                'series': 'bi-collection-play'
            };

            // Remove existing icon classes
            iconElement.className = 'type-icon me-2';

            // Add new icon class
            const iconClass = typeIcons[this.contentType] || 'bi-question-circle';
            iconElement.classList.add(iconClass);
        }

        updateStyling() {
            // Remove existing type classes
            this.element.classList.remove(
                'type-movie', 'type-tv', 'type-anime',
                'type-documentary', 'type-short', 'type-series'
            );

            // Add new type class
            this.element.classList.add(`type-${this.contentType}`);
        }

        updateAdditionalInfo() {
            const infoElement = this.element.querySelector('.type-info');
            const infoText = this.element.querySelector('.info-text');

            if (this.additionalInfo) {
                infoText.textContent = this.additionalInfo;
                infoElement.classList.remove('d-none');
            } else {
                infoElement.classList.add('d-none');
            }
        }

        updateQuality() {
            const qualityElement = this.element.querySelector('.quality-badge');
            const qualityText = this.element.querySelector('.quality-text');

            if (this.quality) {
                qualityText.textContent = this.quality;
                qualityElement.classList.remove('d-none');
            } else {
                qualityElement.classList.add('d-none');
            }
        }

        // Load type data from content details
        async loadTypeData() {
            const contentId = this.element.dataset.contentId;
            if (!contentId) return;

            try {
                const response = await api.getContentDetails(contentId);

                if (response) {
                    let additionalInfo = null;

                    // Format additional info based on content type
                    if (response.content_type === 'movie' && response.runtime) {
                        additionalInfo = `${response.runtime} min`;
                    } else if (response.content_type === 'tv' && response.number_of_episodes) {
                        additionalInfo = `${response.number_of_episodes} episodes`;
                    } else if (response.content_type === 'anime' && response.episodes) {
                        additionalInfo = `${response.episodes} episodes`;
                    }

                    // Determine quality based on release date and other factors
                    let quality = null;
                    if (response.release_date) {
                        const releaseYear = new Date(response.release_date).getFullYear();
                        if (releaseYear >= 2020) {
                            quality = '4K';
                        } else if (releaseYear >= 2010) {
                            quality = 'HD';
                        }
                    }

                    this.updateType(response.content_type, additionalInfo, quality);
                }

            } catch (error) {
                console.error('Error loading type data:', error);
            }
        }

        // Static method to create type badge from data
        static createFromData(contentData) {
            const badge = document.createElement('div');
            badge.className = 'type-badge-component d-inline-flex align-items-center';
            badge.innerHTML = `
      <i class="type-icon me-2"></i>
      <span class="type-text fw-semibold text-uppercase">Movie</span>
      <span class="type-info text-muted ms-2 d-none">
        <span class="info-text"></span>
      </span>
      <span class="quality-badge ms-2 d-none">
        <span class="quality-text"></span>
      </span>
    `;

            const typeBadge = new TypeBadge(badge);

            let additionalInfo = null;
            if (contentData.content_type === 'movie' && contentData.runtime) {
                additionalInfo = `${contentData.runtime} min`;
            } else if (contentData.content_type === 'tv' && contentData.number_of_episodes) {
                additionalInfo = `${contentData.number_of_episodes} eps`;
            }

            let quality = null;
            if (contentData.release_date) {
                const releaseYear = new Date(contentData.release_date).getFullYear();
                if (releaseYear >= 2020) quality = '4K';
                else if (releaseYear >= 2010) quality = 'HD';
            }

            typeBadge.updateType(contentData.content_type, additionalInfo, quality);

            return badge;
        }
    }

    // Initialize type badges
    document.addEventListener('DOMContentLoaded', function () {
        const typeBadges = document.querySelectorAll('.type-badge-component');
        typeBadges.forEach(badge => {
            new TypeBadge(badge);
        });
    });

    // Export for dynamic use
    window.TypeBadge = TypeBadge;
</script>

<style>
    .type-badge-component {
        font-size: 0.75rem;
        padding: 0.375rem 0.75rem;
        border-radius: 20px;
        border: 1px solid transparent;
        transition: all 0.3s ease;
        white-space: nowrap;
    }

    .type-icon {
        font-size: 0.875rem;
    }

    .type-text {
        font-size: 0.75rem;
        letter-spacing: 0.5px;
    }

    .type-info {
        font-size: 0.65rem;
    }

    .quality-badge {
        font-size: 0.6rem;
        padding: 2px 6px;
        border-radius: 10px;
        background: rgba(16, 185, 129, 0.2);
        color: #10b981;
        border: 1px solid rgba(16, 185, 129, 0.3);
    }

    /* Type-specific styling */
    .type-movie {
        background: rgba(59, 130, 246, 0.1);
        color: #3b82f6;
        border-color: rgba(59, 130, 246, 0.3);
    }

    .type-tv {
        background: rgba(139, 92, 246, 0.1);
        color: #8b5cf6;
        border-color: rgba(139, 92, 246, 0.3);
    }

    .type-anime {
        background: rgba(236, 72, 153, 0.1);
        color: #ec4899;
        border-color: rgba(236, 72, 153, 0.3);
    }

    .type-documentary {
        background: rgba(245, 158, 11, 0.1);
        color: #f59e0b;
        border-color: rgba(245, 158, 11, 0.3);
    }

    .type-short {
        background: rgba(16, 185, 129, 0.1);
        color: #10b981;
        border-color: rgba(16, 185, 129, 0.3);
    }

    .type-series {
        background: rgba(139, 92, 246, 0.1);
        color: #8b5cf6;
        border-color: rgba(139, 92, 246, 0.3);
    }

    /* Hover effects */
    .type-badge-component:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    .type-movie:hover {
        background: rgba(59, 130, 246, 0.2);
        border-color: rgba(59, 130, 246, 0.5);
    }

    .type-tv:hover {
        background: rgba(139, 92, 246, 0.2);
        border-color: rgba(139, 92, 246, 0.5);
    }

    .type-anime:hover {
        background: rgba(236, 72, 153, 0.2);
        border-color: rgba(236, 72, 153, 0.5);
    }
</style>
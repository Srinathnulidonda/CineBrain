<!-- CineBrain Content Type Badge Component -->
<span class="type-badge" data-content-type="" data-content-subtype="">
    <i class="type-icon"></i>
    <span class="type-text"></span>
</span>

<script>
(function() {
    'use strict';
    
    class TypeBadge {
        constructor(element, contentType, contentSubtype = null) {
            this.element = element;
            this.contentType = contentType;
            this.contentSubtype = contentSubtype;
            this.init();
        }
        
        init() {
            this.setupBadge();
            this.loadAdditionalData();
        }
        
        setupBadge() {
            this.element.setAttribute('data-content-type', this.contentType);
            if (this.contentSubtype) {
                this.element.setAttribute('data-content-subtype', this.contentSubtype);
            }
            
            const typeConfig = this.getTypeConfig();
            this.updateDisplay(typeConfig);
        }
        
        getTypeConfig() {
            const typeConfigs = {
                movie: {
                    text: 'MOVIE',
                    icon: 'bi-film',
                    class: 'type-movie',
                    color: 'var(--royal-purple)'
                },
                tv: {
                    text: 'TV SERIES',
                    icon: 'bi-tv',
                    class: 'type-tv',
                    color: 'var(--vip-gold)'
                },
                anime: {
                    text: 'ANIME',
                    icon: 'bi-stars',
                    class: 'type-anime',
                    color: 'var(--cinema-red)'
                },
                documentary: {
                    text: 'DOCUMENTARY',
                    icon: 'bi-camera-reels',
                    class: 'type-documentary',
                    color: 'var(--emerald-green)'
                },
                miniseries: {
                    text: 'MINISERIES',
                    icon: 'bi-collection-play',
                    class: 'type-miniseries',
                    color: 'var(--sky-blue)'
                },
                short: {
                    text: 'SHORT',
                    icon: 'bi-stopwatch',
                    class: 'type-short',
                    color: 'var(--sunset-orange)'
                }
            };
            
            // Handle anime subtypes
            if (this.contentType === 'anime' && this.contentSubtype) {
                const animeSubtypes = {
                    movie: { text: 'ANIME MOVIE', icon: 'bi-film' },
                    tv: { text: 'ANIME SERIES', icon: 'bi-tv' },
                    ova: { text: 'OVA', icon: 'bi-disc' },
                    ona: { text: 'ONA', icon: 'bi-wifi' },
                    special: { text: 'SPECIAL', icon: 'bi-star' }
                };
                
                if (animeSubtypes[this.contentSubtype]) {
                    return {
                        ...typeConfigs.anime,
                        ...animeSubtypes[this.contentSubtype]
                    };
                }
            }
            
            return typeConfigs[this.contentType] || {
                text: this.contentType.toUpperCase(),
                icon: 'bi-question-circle',
                class: 'type-unknown',
                color: 'var(--text-muted)'
            };
        }
        
        updateDisplay(config) {
            const typeIcon = this.element.querySelector('.type-icon');
            const typeText = this.element.querySelector('.type-text');
            
            // Update icon
            typeIcon.className = `type-icon ${config.icon}`;
            
            // Update text
            typeText.textContent = config.text;
            
            // Update badge class and styling
            this.element.className = `type-badge ${config.class}`;
            this.element.style.setProperty('--type-color', config.color);
        }
        
        async loadAdditionalData() {
            // Load additional data to refine the type badge
            const contentId = this.element.closest('[data-content-id]')?.dataset.contentId;
            if (!contentId) return;
            
            try {
                const response = await fetch(`https://backend-app-970m.onrender.com/api/content/${contentId}`);
                if (response.ok) {
                    const contentData = await response.json();
                    this.refineType(contentData);
                }
            } catch (error) {
                console.error('Error loading additional type data:', error);
            }
        }
        
        refineType(contentData) {
            let refinedConfig = this.getTypeConfig();
            
            // Add quality indicators
            if (contentData.video_quality) {
                this.addQualityIndicators(contentData.video_quality);
            }
            
            // Add episode count for TV series
            if (this.contentType === 'tv' && contentData.episode_count) {
                this.addEpisodeCount(contentData.episode_count);
            }
            
            // Add season count for TV series
            if (this.contentType === 'tv' && contentData.season_count) {
                this.addSeasonCount(contentData.season_count);
            }
            
            // Add runtime indicator for movies
            if (this.contentType === 'movie' && contentData.runtime) {
                this.addRuntime(contentData.runtime);
            }
            
            // Add anime episode count
            if (this.contentType === 'anime' && contentData.episode_count) {
                this.addAnimeEpisodes(contentData.episode_count);
            }
        }
        
        addQualityIndicators(videoQualities) {
            const qualityContainer = document.createElement('div');
            qualityContainer.className = 'quality-indicators';
            
            if (Array.isArray(videoQualities)) {
                videoQualities.forEach(quality => {
                    const indicator = document.createElement('span');
                    indicator.className = `quality-indicator quality-${quality.toLowerCase()}`;
                    indicator.textContent = quality;
                    qualityContainer.appendChild(indicator);
                });
            } else if (typeof videoQualities === 'string') {
                const indicator = document.createElement('span');
                indicator.className = `quality-indicator quality-${videoQualities.toLowerCase()}`;
                indicator.textContent = videoQualities;
                qualityContainer.appendChild(indicator);
            }
            
            this.element.appendChild(qualityContainer);
        }
        
        addEpisodeCount(episodeCount) {
            const episodeInfo = document.createElement('span');
            episodeInfo.className = 'episode-info';
            episodeInfo.textContent = `${episodeCount} ep`;
            this.element.appendChild(episodeInfo);
        }
        
        addSeasonCount(seasonCount) {
            const seasonInfo = document.createElement('span');
            seasonInfo.className = 'season-info';
            seasonInfo.textContent = `${seasonCount} season${seasonCount > 1 ? 's' : ''}`;
            this.element.appendChild(seasonInfo);
        }
        
        addRuntime(runtime) {
            const runtimeInfo = document.createElement('span');
            runtimeInfo.className = 'runtime-info';
            
            const hours = Math.floor(runtime / 60);
            const minutes = runtime % 60;
            
            if (hours > 0) {
                runtimeInfo.textContent = `${hours}h ${minutes}m`;
            } else {
                runtimeInfo.textContent = `${minutes}m`;
            }
            
            this.element.appendChild(runtimeInfo);
        }
        
        addAnimeEpisodes(episodeCount) {
            const episodeInfo = document.createElement('span');
            episodeInfo.className = 'anime-episode-info';
            
            if (episodeCount === 1) {
                episodeInfo.textContent = 'Movie';
            } else if (episodeCount <= 12) {
                episodeInfo.textContent = `${episodeCount} ep`;
            } else if (episodeCount <= 26) {
                episodeInfo.textContent = `${episodeCount} ep (2-cour)`;
            } else {
                episodeInfo.textContent = `${episodeCount} ep (Long)`;
            }
            
            this.element.appendChild(episodeInfo);
        }
    }
    
    // Global function to create type badge
    window.createTypeBadge = function(contentType, container, contentSubtype = null) {
        const badgeHTML = `
            <span class="type-badge" data-content-type="${contentType}" ${contentSubtype ? `data-content-subtype="${contentSubtype}"` : ''}>
                <i class="type-icon"></i>
                <span class="type-text"></span>
            </span>
        `;
        
        if (container) {
            container.insertAdjacentHTML('beforeend', badgeHTML);
            const newBadge = container.lastElementChild;
            new TypeBadge(newBadge, contentType, contentSubtype);
            return newBadge;
        } else {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = badgeHTML;
            const badgeElement = tempDiv.firstElementChild;
            new TypeBadge(badgeElement, contentType, contentSubtype);
            return badgeElement;
        }
    };
    
    // Auto-initialize type badges
    function initTypeBadges() {
        document.querySelectorAll('.type-badge:not([data-initialized])').forEach(badgeElement => {
            badgeElement.setAttribute('data-initialized', 'true');
            
            const contentType = badgeElement.dataset.contentType;
            const contentSubtype = badgeElement.dataset.contentSubtype;
            
            if (contentType) {
                new TypeBadge(badgeElement, contentType, contentSubtype);
            }
        });
    }
    
    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initTypeBadges);
    } else {
        initTypeBadges();
    }
    
})();
</script>

<style>
.type-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.125rem 0.5rem;
    background: var(--type-color, var(--bg-tertiary));
    color: white;
    border-radius: var(--radius-sm);
    font-size: 0.625rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    line-height: 1.2;
    border: 1px solid rgba(255, 255, 255, 0.2);
    transition: all var(--transition-fast) var(--ease-cinematic);
}

.type-badge:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
}

.type-icon {
    font-size: 0.75em;
    flex-shrink: 0;
}

.type-text {
    white-space: nowrap;
}

/* Type-specific styles */
.type-badge.type-movie {
    background: linear-gradient(135deg, var(--royal-purple), #5855eb);
    box-shadow: 0 2px 4px rgba(99, 102, 241, 0.3);
}

.type-badge.type-tv {
    background: linear-gradient(135deg, var(--vip-gold), #f97316);
    box-shadow: 0 2px 4px rgba(245, 158, 11, 0.3);
}

.type-badge.type-anime {
    background: linear-gradient(135deg, var(--cinema-red), #dc2626);
    box-shadow: 0 2px 4px rgba(239, 68, 68, 0.3);
}

.type-badge.type-documentary {
    background: linear-gradient(135deg, var(--emerald-green), #059669);
    box-shadow: 0 2px 4px rgba(16, 185, 129, 0.3);
}

.type-badge.type-miniseries {
    background: linear-gradient(135deg, var(--sky-blue), #0284c7);
    box-shadow: 0 2px 4px rgba(14, 165, 233, 0.3);
}

.type-badge.type-short {
    background: linear-gradient(135deg, var(--sunset-orange), #ea580c);
    box-shadow: 0 2px 4px rgba(249, 115, 22, 0.3);
}

.type-badge.type-unknown {
    background: var(--bg-tertiary);
    color: var(--text-muted);
    border-color: var(--border-primary);
    box-shadow: none;
}

/* Additional info elements */
.quality-indicators {
    display: flex;
    gap: 0.125rem;
    margin-left: 0.25rem;
}

.quality-indicator {
    background: rgba(255, 255, 255, 0.2);
    padding: 0.0625rem 0.25rem;
    border-radius: 0.125rem;
    font-size: 0.5rem;
    font-weight: 600;
}

.quality-indicator.quality-4k {
    background: linear-gradient(135deg, var(--vip-gold), #f97316);
}

.quality-indicator.quality-hd {
    background: linear-gradient(135deg, var(--sky-blue), #0284c7);
}

.quality-indicator.quality-hdr {
    background: linear-gradient(135deg, var(--emerald-green), #059669);
}

.episode-info,
.season-info,
.runtime-info,
.anime-episode-info {
    background: rgba(255, 255, 255, 0.2);
    padding: 0.0625rem 0.25rem;
    border-radius: 0.125rem;
    font-size: 0.5rem;
    margin-left: 0.25rem;
    white-space: nowrap;
}

/* Hover effects for type-specific badges */
.type-badge.type-movie:hover {
    box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
}

.type-badge.type-tv:hover {
    box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4);
}

.type-badge.type-anime:hover {
    box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
}

.type-badge.type-documentary:hover {
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
}

.type-badge.type-miniseries:hover {
    box-shadow: 0 4px 12px rgba(14, 165, 233, 0.4);
}

.type-badge.type-short:hover {
    box-shadow: 0 4px 12px rgba(249, 115, 22, 0.4);
}

/* Responsive adjustments */
@media (max-width: 767.98px) {
    .type-badge {
        font-size: 0.5625rem;
        padding: 0.0625rem 0.375rem;
        gap: 0.1875rem;
    }
    
    .quality-indicators,
    .episode-info,
    .season-info,
    .runtime-info,
    .anime-episode-info {
        display: none; /* Hide additional info on mobile for space */
    }
}

/* Animation for dynamic updates */
@keyframes typeBadgeUpdate {
    0% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.05);
    }
    100% {
        transform: scale(1);
    }
}

.type-badge.updating {
    animation: typeBadgeUpdate 0.3s ease-in-out;
}
</style>
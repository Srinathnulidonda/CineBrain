<div class="search-bar-container">
    <div class="search-bar">
        <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <circle cx="11" cy="11" r="8"/>
            <path d="m21 21-4.35-4.35"/>
        </svg>
        <input type="text" 
               id="mainSearchInput" 
               placeholder="Search movies, TV shows, anime..." 
               autocomplete="off">
        <button class="search-clear" id="searchClear" style="display: none;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <line x1="18" y1="6" x2="6" y2="18"/>
                <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
        </button>
    </div>
    <div class="search-suggestions" id="searchSuggestions"></div>
</div>

<script>
(function() {
    const input = document.getElementById('mainSearchInput');
    const clear = document.getElementById('searchClear');
    const suggestions = document.getElementById('searchSuggestions');
    let searchTimeout;
    
    input.addEventListener('input', (e) => {
        const query = e.target.value.trim();
        clear.style.display = query ? 'block' : 'none';
        
        clearTimeout(searchTimeout);
        if (query.length < 2) {
            suggestions.innerHTML = '';
            return;
        }
        
        searchTimeout = setTimeout(async () => {
            try {
                const response = await fetch(`https://backend-app-970m.onrender.com/api/search?query=${encodeURIComponent(query)}&type=multi`);
                const data = await response.json();
                
                suggestions.innerHTML = data.results.slice(0, 8).map(item => `
                    <a href="/content/details.html?id=${item.id}" class="suggestion-item">
                        <img src="${item.poster_path || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNzUiIGZpbGw9IiMxZTFlMjMiPjxyZWN0IHdpZHRoPSI1MCIgaGVpZ2h0PSI3NSIvPjwvc3ZnPg=='}" alt="${item.title}">
                        <div class="suggestion-info">
                            <div class="suggestion-title">${item.title}</div>
                            <div class="suggestion-meta">
                                <span>${item.content_type}</span>
                                <span>â˜… ${item.rating || 'N/A'}</span>
                            </div>
                        </div>
                    </a>
                `).join('');
            } catch (error) {
                console.error('Search error:', error);
            }
        }, 300);
    });
    
    clear.addEventListener('click', () => {
        input.value = '';
        clear.style.display = 'none';
        suggestions.innerHTML = '';
    });
})();
</script>
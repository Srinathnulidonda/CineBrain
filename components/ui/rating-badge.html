<!-- CineBrain Rating Badge Component -->
<span class="rating-badge badge d-flex align-items-center gap-1 px-2 py-1" 
      style="font-size: 0.8rem; border-radius: 12px; backdrop-filter: blur(5px);">
  <i class="fas fa-star rating-star" style="font-size: 0.75rem;"></i>
  <span class="rating-text fw-semibold">Loading...</span>
  <span class="rating-source text-white-50 ms-1 d-none" style="font-size: 0.7rem;"></span>
</span>

<script>
// Rating Badge Component JavaScript
(function() {
  // Initialize rating badge with content data
  window.initRatingBadge = function(badgeElement, contentData) {
    const ratingText = badgeElement.querySelector('.rating-text');
    const ratingSource = badgeElement.querySelector('.rating-source');
    const star = badgeElement.querySelector('.rating-star');
    
    if (contentData.rating && contentData.rating > 0) {
      const rating = parseFloat(contentData.rating);
      ratingText.textContent = rating.toFixed(1);
      
      // Color coding based on rating
      if (rating >= 8.0) {
        badgeElement.className = 'rating-badge badge d-flex align-items-center gap-1 px-2 py-1 bg-success text-white';
        star.style.color = '#ffd700'; // Gold star
      } else if (rating >= 7.0) {
        badgeElement.className = 'rating-badge badge d-flex align-items-center gap-1 px-2 py-1 bg-primary text-white';
        star.style.color = '#ffd700';
      } else if (rating >= 6.0) {
        badgeElement.className = 'rating-badge badge d-flex align-items-center gap-1 px-2 py-1 bg-warning text-dark';
        star.style.color = '#ff8c00';
      } else if (rating >= 4.0) {
        badgeElement.className = 'rating-badge badge d-flex align-items-center gap-1 px-2 py-1 bg-secondary text-white';
        star.style.color = '#ffa500';
      } else {
        badgeElement.className = 'rating-badge badge d-flex align-items-center gap-1 px-2 py-1 bg-danger text-white';
        star.style.color = '#ff6b6b';
      }
      
      // Show rating source if available
      if (contentData.content_type === 'anime') {
        ratingSource.textContent = 'MAL';
        ratingSource.classList.remove('d-none');
      } else {
        ratingSource.textContent = 'TMDB';
        ratingSource.classList.remove('d-none');
      }
      
      // Add hover effect for more details
      badgeElement.title = `${rating}/10 - ${getRatingDescription(rating)}`;
      
    } else {
      ratingText.textContent = 'N/A';
      badgeElement.className = 'rating-badge badge d-flex align-items-center gap-1 px-2 py-1 bg-dark text-muted border border-secondary';
      star.style.color = '#6c757d';
      badgeElement.title = 'No rating available';
    }
  };

  // Get rating description
  function getRatingDescription(rating) {
    if (rating >= 9.0) return 'Masterpiece';
    if (rating >= 8.5) return 'Excellent';
    if (rating >= 8.0) return 'Very Good';
    if (rating >= 7.5) return 'Good';
    if (rating >= 7.0) return 'Above Average';
    if (rating >= 6.0) return 'Average';
    if (rating >= 5.0) return 'Below Average';
    if (rating >= 4.0) return 'Poor';
    return 'Very Poor';
  }

  // Animate rating badge on load
  window.animateRatingBadge = function(badgeElement) {
    badgeElement.style.transform = 'scale(0)';
    badgeElement.style.opacity = '0';
    
    setTimeout(() => {
      badgeElement.style.transition = 'all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1)';
      badgeElement.style.transform = 'scale(1)';
      badgeElement.style.opacity = '1';
    }, 100);
  };

  // Fetch and display real-time rating from content ID
  window.loadRatingFromAPI = async function(badgeElement, contentId) {
    try {
      const response = await fetch(`${API_ENDPOINTS.BASE_URL}${API_ENDPOINTS.CONTENT_DETAILS}/${contentId}`);
      const contentData = await response.json();
      
      if (contentData) {
        initRatingBadge(badgeElement, contentData);
        animateRatingBadge(badgeElement);
      }
    } catch (error) {
      console.error('Failed to load rating:', error);
      badgeElement.querySelector('.rating-text').textContent = 'Error';
      badgeElement.className = 'rating-badge badge d-flex align-items-center gap-1 px-2 py-1 bg-danger text-white';
    }
  };

  // Create rating badge dynamically
  window.createRatingBadge = function(contentData, options = {}) {
    const badge = document.createElement('span');
    badge.className = 'rating-badge badge d-flex align-items-center gap-1 px-2 py-1';
    badge.style.fontSize = options.fontSize || '0.8rem';
    badge.style.borderRadius = '12px';
    badge.style.backdropFilter = 'blur(5px)';
    
    badge.innerHTML = `
      <i class="fas fa-star rating-star" style="font-size: 0.75rem;"></i>
      <span class="rating-text fw-semibold">Loading...</span>
      <span class="rating-source text-white-50 ms-1 d-none" style="font-size: 0.7rem;"></span>
    `;
    
    initRatingBadge(badge, contentData);
    
    if (options.animate !== false) {
      animateRatingBadge(badge);
    }
    
    return badge;
  };
})();

const ratingBadgeStyles = `
<style>
.rating-badge {
  transition: all 0.3s ease;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.rating-badge:hover {
  transform: scale(1.05);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}

.rating-star {
  animation: starTwinkle 2s infinite;
}

@keyframes starTwinkle {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}

.rating-badge.bg-success .rating-star {
  filter: drop-shadow(0 0 2px rgba(255, 215, 0, 0.8));
}

.rating-badge.bg-primary .rating-star {
  filter: drop-shadow(0 0 2px rgba(255, 215, 0, 0.6));
}

.rating-badge.bg-warning .rating-star {
  filter: drop-shadow(0 0 2px rgba(255, 140, 0, 0.8));
}
</style>
`;

// Inject rating badge styles
document.head.insertAdjacentHTML('beforeend', ratingBadgeStyles);
</script>
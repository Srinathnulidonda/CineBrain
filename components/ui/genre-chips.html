<!-- Genre Chips Component -->
<div class="genre-chips-container" data-genres="" data-max-display="3" data-style="default">
    <!-- Genres will be populated dynamically -->
</div>

<script>
    class GenreChips {
        constructor(element, genres = [], maxDisplay = 3, style = 'default') {
            this.element = element;
            this.genres = Array.isArray(genres) ? genres : [];
            this.maxDisplay = parseInt(maxDisplay) || 3;
            this.style = style;

            this.init();
        }

        init() {
            this.element.dataset.genres = JSON.stringify(this.genres);
            this.element.dataset.maxDisplay = this.maxDisplay;
            this.element.dataset.style = this.style;
            this.render();
        }

        render() {
            if (!this.genres || this.genres.length === 0) {
                this.element.innerHTML = '<span class="text-muted small">No genres available</span>';
                return;
            }

            const displayGenres = this.genres.slice(0, this.maxDisplay);
            const remainingCount = this.genres.length - this.maxDisplay;

            let html = '<div class="d-flex flex-wrap gap-1 align-items-center">';

            displayGenres.forEach((genre, index) => {
                const config = this.getGenreConfig(genre);
                const chipClass = this.getChipClass(config);

                html += `
        <span class="genre-chip ${chipClass} px-2 py-1 rounded-pill small fw-medium d-inline-flex align-items-center"
              data-genre="${genre.toLowerCase()}"
              style="cursor: pointer; transition: all 0.2s ease;">
          <i class="${config.icon} me-1" style="font-size: 0.7rem;"></i>
          <span>${genre}</span>
        </span>
      `;
            });

            // Show remaining count if more genres exist
            if (remainingCount > 0) {
                html += `
        <span class="genre-chip genre-more bg-secondary text-white px-2 py-1 rounded-pill small fw-medium"
              style="cursor: pointer; transition: all 0.2s ease;"
              title="Show all genres">
          +${remainingCount} more
        </span>
      `;
            }

            html += '</div>';
            this.element.innerHTML = html;

            this.attachEventListeners();
        }

        getGenreConfig(genre) {
            const genreConfigs = {
                // Action & Adventure
                'action': { icon: 'fas fa-fist-raised', color: '#E50914', category: 'action' },
                'adventure': { icon: 'fas fa-map', color: '#F59E0B', category: 'action' },
                'thriller': { icon: 'fas fa-bolt', color: '#DC2626', category: 'action' },
                'crime': { icon: 'fas fa-mask', color: '#7F1D1D', category: 'action' },
                'war': { icon: 'fas fa-helmet-battle', color: '#92400E', category: 'action' },

                // Drama & Romance
                'drama': { icon: 'fas fa-masks-theater', color: '#7C3AED', category: 'drama' },
                'romance': { icon: 'fas fa-heart', color: '#EC4899', category: 'drama' },
                'family': { icon: 'fas fa-home', color: '#46D369', category: 'drama' },
                'biography': { icon: 'fas fa-user-circle', color: '#6366F1', category: 'drama' },

                // Comedy & Light
                'comedy': { icon: 'fas fa-laugh', color: '#FFD700', category: 'comedy' },
                'animation': { icon: 'fas fa-magic', color: '#8B5CF6', category: 'comedy' },
                'musical': { icon: 'fas fa-music', color: '#06B6D4', category: 'comedy' },

                // Sci-Fi & Fantasy
                'science fiction': { icon: 'fas fa-rocket', color: '#0071EB', category: 'scifi' },
                'sci-fi': { icon: 'fas fa-rocket', color: '#0071EB', category: 'scifi' },
                'fantasy': { icon: 'fas fa-dragon', color: '#8B5CF6', category: 'scifi' },
                'supernatural': { icon: 'fas fa-ghost', color: '#6B46C1', category: 'scifi' },

                // Horror & Dark
                'horror': { icon: 'fas fa-skull', color: '#374151', category: 'horror' },
                'mystery': { icon: 'fas fa-search', color: '#4B5563', category: 'horror' },
                'psychological': { icon: 'fas fa-brain', color: '#1F2937', category: 'horror' },

                // Documentary & Real
                'documentary': { icon: 'fas fa-camera', color: '#14B8A6', category: 'real' },
                'history': { icon: 'fas fa-landmark', color: '#92400E', category: 'real' },
                'sport': { icon: 'fas fa-trophy', color: '#F59E0B', category: 'real' },

                // Anime-specific
                'shonen': { icon: 'fas fa-fist-raised', color: '#E50914', category: 'anime' },
                'shojo': { icon: 'fas fa-heart', color: '#EC4899', category: 'anime' },
                'seinen': { icon: 'fas fa-user-tie', color: '#6366F1', category: 'anime' },
                'josei': { icon: 'fas fa-female', color: '#8B5CF6', category: 'anime' },
                'mecha': { icon: 'fas fa-robot', color: '#374151', category: 'anime' },
                'slice of life': { icon: 'fas fa-coffee', color: '#46D369', category: 'anime' }
            };

            const key = genre.toLowerCase();
            return genreConfigs[key] || {
                icon: 'fas fa-tag',
                color: '#6B7280',
                category: 'default'
            };
        }

        getChipClass(config) {
            switch (this.style) {
                case 'minimal':
                    return 'bg-dark text-white border border-secondary';
                case 'colorful':
                    return 'text-white';
                case 'outline':
                    return 'bg-transparent text-white border';
                default:
                    return 'bg-secondary bg-opacity-75 text-white';
            }
        }

        attachEventListeners() {
            // Genre chip clicks
            this.element.querySelectorAll('.genre-chip[data-genre]').forEach(chip => {
                chip.addEventListener('click', () => {
                    const genre = chip.dataset.genre;
                    this.onGenreClick(genre);
                });

                // Hover effects
                chip.addEventListener('mouseenter', () => {
                    chip.style.transform = 'translateY(-1px) scale(1.05)';
                    chip.style.filter = 'brightness(1.2)';
                });

                chip.addEventListener('mouseleave', () => {
                    chip.style.transform = 'translateY(0) scale(1)';
                    chip.style.filter = 'brightness(1)';
                });
            });

            // "More genres" click
            const moreChip = this.element.querySelector('.genre-more');
            if (moreChip) {
                moreChip.addEventListener('click', () => {
                    this.showAllGenres();
                });
            }
        }

        onGenreClick(genre) {
            // Navigate to genre page or filter
            const event = new CustomEvent('genreSelected', {
                detail: { genre, allGenres: this.genres }
            });
            document.dispatchEvent(event);

            // Default action: navigate to genre search
            window.location.href = `content/search.html?genre=${encodeURIComponent(genre)}`;
        }

        showAllGenres() {
            // Expand to show all genres
            this.maxDisplay = this.genres.length;
            this.render();

            // Dispatch event
            const event = new CustomEvent('genresExpanded', {
                detail: { genres: this.genres }
            });
            document.dispatchEvent(event);
        }

        // Update genres dynamically
        updateGenres(newGenres, newMaxDisplay = null) {
            this.genres = Array.isArray(newGenres) ? newGenres : [];
            if (newMaxDisplay !== null) {
                this.maxDisplay = parseInt(newMaxDisplay) || 3;
            }
            this.render();
        }

        // Set style
        setStyle(newStyle) {
            this.style = newStyle;
            this.render();
        }
    }

    // Auto-initialize genre chips
    document.addEventListener('DOMContentLoaded', () => {
        const genreContainers = document.querySelectorAll('.genre-chips-container[data-auto-init="true"]');
        genreContainers.forEach(container => {
            const genres = JSON.parse(container.dataset.genres || '[]');
            const maxDisplay = container.dataset.maxDisplay || 3;
            const style = container.dataset.style || 'default';
            new GenreChips(container, genres, maxDisplay, style);
        });
    });

    // Global function for creating genre chips
    window.createGenreChips = function (element, genres, maxDisplay, style) {
        return new GenreChips(element, genres, maxDisplay, style);
    };
</script>

<style>
    .genre-chip {
        font-size: 0.7rem;
        line-height: 1.2;
        border: 1px solid rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(4px);
        user-select: none;
        white-space: nowrap;
    }

    .genre-chip:hover {
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    }

    .genre-chip.style-colorful {
        border: none;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .genre-more {
        background: linear-gradient(135deg, #374151 0%, #4B5563 100%) !important;
    }

    .genre-more:hover {
        background: linear-gradient(135deg, #4B5563 0%, #6B7280 100%) !important;
    }

    /* Responsive adjustments */
    @media (max-width: 576px) {
        .genre-chip {
            font-size: 0.65rem;
            padding: 0.25rem 0.5rem !important;
        }
    }
</style>
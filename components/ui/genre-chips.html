<!-- CineBrain Genre Chips Component -->
<div class="genre-chips-container d-flex flex-wrap gap-1">
  <!-- Genre chips will be populated here -->
</div>

<script>
// Genre Chips Component JavaScript
(function() {
  // Genre color mapping for visual differentiation
  const GENRE_COLORS = {
    // Movies & TV
    'Action': { bg: 'bg-danger', text: 'text-white', gradient: 'linear-gradient(135deg, #dc3545, #b02a37)' },
    'Adventure': { bg: 'bg-success', text: 'text-white', gradient: 'linear-gradient(135deg, #198754, #146c43)' },
    'Animation': { bg: 'bg-warning', text: 'text-dark', gradient: 'linear-gradient(135deg, #ffc107, #ffca2c)' },
    'Comedy': { bg: 'bg-info', text: 'text-white', gradient: 'linear-gradient(135deg, #0dcaf0, #31d2f2)' },
    'Crime': { bg: 'bg-dark', text: 'text-white', gradient: 'linear-gradient(135deg, #212529, #495057)' },
    'Documentary': { bg: 'bg-secondary', text: 'text-white', gradient: 'linear-gradient(135deg, #6c757d, #5c636a)' },
    'Drama': { bg: 'bg-primary', text: 'text-white', gradient: 'linear-gradient(135deg, #0d6efd, #0b5ed7)' },
    'Family': { bg: 'bg-success', text: 'text-white', gradient: 'linear-gradient(135deg, #20c997, #1aa179)' },
    'Fantasy': { bg: 'bg-info', text: 'text-white', gradient: 'linear-gradient(135deg, #8b5cf6, #7c3aed)' },
    'Horror': { bg: 'bg-danger', text: 'text-white', gradient: 'linear-gradient(135deg, #721c24, #dc3545)' },
    'Mystery': { bg: 'bg-dark', text: 'text-white', gradient: 'linear-gradient(135deg, #495057, #343a40)' },
    'Romance': { bg: 'bg-danger', text: 'text-white', gradient: 'linear-gradient(135deg, #e91e63, #ad1457)' },
    'Sci-Fi': { bg: 'bg-info', text: 'text-white', gradient: 'linear-gradient(135deg, #00bcd4, #0097a7)' },
    'Thriller': { bg: 'bg-warning', text: 'text-dark', gradient: 'linear-gradient(135deg, #ff9800, #f57c00)' },
    'War': { bg: 'bg-secondary', text: 'text-white', gradient: 'linear-gradient(135deg, #795548, #5d4037)' },
    'Western': { bg: 'bg-warning', text: 'text-dark', gradient: 'linear-gradient(135deg, #8bc34a, #689f38)' },
    
    // Anime specific
    'Shonen': { bg: 'bg-primary', text: 'text-white', gradient: 'linear-gradient(135deg, #ff5722, #d84315)' },
    'Shojo': { bg: 'bg-danger', text: 'text-white', gradient: 'linear-gradient(135deg, #e91e63, #c2185b)' },
    'Seinen': { bg: 'bg-dark', text: 'text-white', gradient: 'linear-gradient(135deg, #424242, #212121)' },
    'Josei': { bg: 'bg-info', text: 'text-white', gradient: 'linear-gradient(135deg, #9c27b0, #7b1fa2)' },
    'Mecha': { bg: 'bg-secondary', text: 'text-white', gradient: 'linear-gradient(135deg, #607d8b, #455a64)' },
    'Supernatural': { bg: 'bg-primary', text: 'text-white', gradient: 'linear-gradient(135deg, #673ab7, #512da8)' }
  };

  // Default genre style
  const DEFAULT_GENRE = { bg: 'bg-secondary', text: 'text-white', gradient: 'linear-gradient(135deg, #6c757d, #5c636a)' };

  // Initialize genre chips with content data
  window.initGenreChips = function(containerElement, contentData, options = {}) {
    const maxGenres = options.maxGenres || 3;
    const showAll = options.showAll || false;
    const clickable = options.clickable !== false;
    const size = options.size || 'sm'; // sm, md, lg
    
    // Clear existing chips
    containerElement.innerHTML = '';
    
    // Get genres from content data
    let genres = [];
    if (contentData.genres && Array.isArray(contentData.genres)) {
      genres = contentData.genres;
    } else if (contentData.anime_genres && Array.isArray(contentData.anime_genres)) {
      genres = contentData.anime_genres;
    }
    
    // Limit genres if not showing all
    const displayGenres = showAll ? genres : genres.slice(0, maxGenres);
    
    // Create genre chips
    displayGenres.forEach((genre, index) => {
      const chip = createGenreChip(genre, { clickable, size, index });
      containerElement.appendChild(chip);
    });
    
    // Add "show more" chip if there are hidden genres
    if (!showAll && genres.length > maxGenres) {
      const moreCount = genres.length - maxGenres;
      const moreChip = createMoreChip(moreCount, options);
      containerElement.appendChild(moreChip);
    }
    
    // Animate chips
    if (options.animate !== false) {
      animateGenreChips(containerElement);
    }
  };

  // Create individual genre chip
  function createGenreChip(genre, options = {}) {
    const { clickable = true, size = 'sm', index = 0 } = options;
    const genreConfig = GENRE_COLORS[genre] || DEFAULT_GENRE;
    
    const chip = document.createElement('span');
    chip.className = `genre-chip badge ${genreConfig.bg} ${genreConfig.text} fw-normal`;
    chip.textContent = genre;
    
    // Size classes
    const sizeClasses = {
      sm: 'px-2 py-1',
      md: 'px-3 py-2', 
      lg: 'px-4 py-2'
    };
    
    const fontSizes = {
      sm: '0.7rem',
      md: '0.8rem',
      lg: '0.9rem'
    };
    
    chip.classList.add(...sizeClasses[size].split(' '));
    chip.style.fontSize = fontSizes[size];
    chip.style.background = genreConfig.gradient;
    chip.style.borderRadius = '15px';
    chip.style.cursor = clickable ? 'pointer' : 'default';
    chip.style.transition = 'all 0.3s ease';
    chip.style.animationDelay = `${index * 0.1}s`;
    
    // Add hover effects if clickable
    if (clickable) {
      chip.addEventListener('mouseenter', function() {
        this.style.transform = 'scale(1.05) translateY(-2px)';
        this.style.boxShadow = '0 4px 8px rgba(0, 0, 0, 0.2)';
      });
      
      chip.addEventListener('mouseleave', function() {
        this.style.transform = 'scale(1) translateY(0)';
        this.style.boxShadow = '0 2px 4px rgba(0, 0, 0, 0.1)';
      });
      
      chip.addEventListener('click', function() {
        navigateToGenre(genre);
      });
    }
    
    // Add tooltip
    chip.title = `Browse ${genre} content`;
    
    return chip;
  }

  // Create "show more" chip
  function createMoreChip(count, options = {}) {
    const chip = document.createElement('span');
    chip.className = 'genre-chip badge bg-light text-dark fw-normal px-2 py-1';
    chip.textContent = `+${count} more`;
    chip.style.fontSize = '0.7rem';
    chip.style.borderRadius = '15px';
    chip.style.cursor = 'pointer';
    chip.style.transition = 'all 0.3s ease';
    chip.style.border = '1px dashed #6c757d';
    
    chip.addEventListener('click', function() {
      if (options.onShowMore) {
        options.onShowMore();
      }
    });
    
    return chip;
  }

  // Animate genre chips on load
  function animateGenreChips(container) {
    const chips = container.querySelectorAll('.genre-chip');
    chips.forEach((chip, index) => {
      chip.style.opacity = '0';
      chip.style.transform = 'scale(0) rotate(180deg)';
      
      setTimeout(() => {
        chip.style.transition = 'all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55)';
        chip.style.opacity = '1';
        chip.style.transform = 'scale(1) rotate(0deg)';
      }, index * 100);
    });
  }

  // Navigate to genre page
  function navigateToGenre(genre) {
    window.location.href = `/content/genre.html?genre=${encodeURIComponent(genre)}`;
  }

  // Fetch and display real-time genres from content ID
  window.loadGenresFromAPI = async function(containerElement, contentId, options = {}) {
    try {
      const response = await fetch(`${API_ENDPOINTS.BASE_URL}${API_ENDPOINTS.CONTENT_DETAILS}/${contentId}`);
      const contentData = await response.json();
      
      if (contentData) {
        initGenreChips(containerElement, contentData, options);
      }
    } catch (error) {
      console.error('Failed to load genres:', error);
      containerElement.innerHTML = '<span class="badge bg-danger text-white">Error loading genres</span>';
    }
  };

  // Create genre chips container dynamically
  window.createGenreChips = function(contentData, options = {}) {
    const container = document.createElement('div');
    container.className = 'genre-chips-container d-flex flex-wrap gap-1';
    
    initGenreChips(container, contentData, options);
    
    return container;
  };

  // Get all available genres (for filters, etc.)
  window.getAllGenres = function() {
    return Object.keys(GENRE_COLORS);
  };
})();

const genreChipsStyles = `
<style>
.genre-chip {
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  user-select: none;
  white-space: nowrap;
}

.genre-chip:hover {
  z-index: 2;
  filter: brightness(1.1);
}

.genre-chip:active {
  transform: scale(0.95) translateY(0) !important;
}

.genre-chips-container {
  line-height: 1.2;
}

/* Responsive adjustments */
@media (max-width: 576px) {
  .genre-chip {
    font-size: 0.65rem !important;
    padding: 0.25rem 0.5rem !important;
  }
}

/* Animation for genre chips */
@keyframes chipPulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}

.genre-chip.featured {
  animation: chipPulse 2s infinite;
  box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
}
</style>
`;

// Inject genre chips styles
document.head.insertAdjacentHTML('beforeend', genreChipsStyles);
</script>
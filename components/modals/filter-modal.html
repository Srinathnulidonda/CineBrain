<div class="filter-modal" id="filter-modal">
    <div class="filter-header">
        <h3>Advanced Filters</h3>
        <button class="filter-close" onclick="closeFilterModal()">Ã—</button>
    </div>
    
    <div class="filter-content">
        <div class="filter-group">
            <h4>Content Type</h4>
            <div class="filter-options">
                <label class="filter-option">
                    <input type="checkbox" name="type" value="movie" checked>
                    <span>Movies</span>
                </label>
                <label class="filter-option">
                    <input type="checkbox" name="type" value="tv" checked>
                    <span>TV Shows</span>
                </label>
                <label class="filter-option">
                    <input type="checkbox" name="type" value="anime">
                    <span>Anime</span>
                </label>
            </div>
        </div>
        
        <div class="filter-group">
            <h4>Genres</h4>
            <div class="filter-options genres-grid">
                <!-- Genres will be dynamically loaded -->
            </div>
        </div>
        
        <div class="filter-group">
            <h4>Release Year</h4>
            <div class="year-range">
                <input type="number" id="year-from" placeholder="From" min="1900" max="2024">
                <span>to</span>
                <input type="number" id="year-to" placeholder="To" min="1900" max="2024">
            </div>
        </div>
        
        <div class="filter-group">
            <h4>Rating</h4>
            <div class="rating-slider">
                <input type="range" id="rating-min" min="0" max="10" step="0.5" value="0">
                <div class="rating-display">
                    <span id="rating-value">0</span>+ stars
                </div>
            </div>
        </div>
        
        <div class="filter-group">
            <h4>Language</h4>
            <div class="filter-options">
                <label class="filter-option">
                    <input type="checkbox" name="language" value="en">
                    <span>English</span>
                </label>
                <label class="filter-option">
                    <input type="checkbox" name="language" value="hi">
                    <span>Hindi</span>
                </label>
                <label class="filter-option">
                    <input type="checkbox" name="language" value="te">
                    <span>Telugu</span>
                </label>
                <label class="filter-option">
                    <input type="checkbox" name="language" value="ta">
                    <span>Tamil</span>
                </label>
                <label class="filter-option">
                    <input type="checkbox" name="language" value="ja">
                    <span>Japanese</span>
                </label>
            </div>
        </div>
        
        <div class="filter-group">
            <h4>Sort By</h4>
            <select id="sort-by" class="filter-select">
                <option value="popularity.desc">Most Popular</option>
                <option value="vote_average.desc">Highest Rated</option>
                <option value="release_date.desc">Newest First</option>
                <option value="release_date.asc">Oldest First</option>
                <option value="title.asc">Title (A-Z)</option>
                <option value="title.desc">Title (Z-A)</option>
            </select>
        </div>
    </div>
    
    <div class="filter-footer">
        <button class="btn btn-secondary" onclick="resetFilters()">Reset</button>
        <button class="btn btn-primary" onclick="applyFilters()">Apply Filters</button>
    </div>
</div>

<script>
class FilterModal {
    constructor() {
        this.modal = document.getElementById('filter-modal');
        this.filters = {
            types: [],
            genres: [],
            yearFrom: null,
            yearTo: null,
            rating: 0,
            languages: [],
            sortBy: 'popularity.desc'
        };
        this.init();
    }
    
    init() {
        this.loadGenres();
        this.setupEventListeners();
        this.loadSavedFilters();
    }
    
    async loadGenres() {
        const genresGrid = this.modal.querySelector('.genres-grid');
        const allGenres = [
            ...APP_CONFIG.GENRES.movie,
            ...APP_CONFIG.GENRES.tv
        ];
        
        // Remove duplicates
        const uniqueGenres = Array.from(new Set(allGenres.map(g => g.name)));
        
        genresGrid.innerHTML = uniqueGenres.map(genre => `
            <label class="filter-option">
                <input type="checkbox" name="genre" value="${genre}">
                <span>${genre}</span>
            </label>
        `).join('');
    }
    
    setupEventListeners() {
        // Rating slider
        const ratingSlider = this.modal.querySelector('#rating-min');
        const ratingValue = this.modal.querySelector('#rating-value');
        
        ratingSlider.addEventListener('input', (e) => {
            ratingValue.textContent = e.target.value;
        });
        
        // Year inputs
        const yearFrom = this.modal.querySelector('#year-from');
        const yearTo = this.modal.querySelector('#year-to');
        
        yearFrom.max = new Date().getFullYear();
        yearTo.max = new Date().getFullYear();
        
        yearFrom.addEventListener('change', () => {
            if (yearTo.value && yearFrom.value > yearTo.value) {
                yearTo.value = yearFrom.value;
            }
        });
        
        yearTo.addEventListener('change', () => {
            if (yearFrom.value && yearTo.value < yearFrom.value) {
                yearFrom.value = yearTo.value;
            }
        });
    }
    
    open() {
        this.modal.classList.add('open');
        document.body.style.overflow = 'hidden';
    }
    
    close() {
        this.modal.classList.remove('open');
        document.body.style.overflow = '';
    }
    
    getFilters() {
        // Content types
        this.filters.types = Array.from(
            this.modal.querySelectorAll('input[name="type"]:checked')
        ).map(cb => cb.value);
        
        // Genres
        this.filters.genres = Array.from(
            this.modal.querySelectorAll('input[name="genre"]:checked')
        ).map(cb => cb.value);
        
        // Year range
        this.filters.yearFrom = this.modal.querySelector('#year-from').value || null;
        this.filters.yearTo = this.modal.querySelector('#year-to').value || null;
        
        // Rating
        this.filters.rating = parseFloat(this.modal.querySelector('#rating-min').value);
        
        // Languages
        this.filters.languages = Array.from(
            this.modal.querySelectorAll('input[name="language"]:checked')
        ).map(cb => cb.value);
        
        // Sort
        this.filters.sortBy = this.modal.querySelector('#sort-by').value;
        
        return this.filters;
    }
    
    applyFilters() {
        const filters = this.getFilters();
        
        // Save filters
        localStorage.setItem('searchFilters', JSON.stringify(filters));
        
        // Build query string
        const params = new URLSearchParams();
        
        if (filters.types.length > 0) {
            params.set('types', filters.types.join(','));
        }
        if (filters.genres.length > 0) {
            params.set('genres', filters.genres.join(','));
        }
        if (filters.yearFrom) {
            params.set('year_from', filters.yearFrom);
        }
        if (filters.yearTo) {
            params.set('year_to', filters.yearTo);
        }
        if (filters.rating > 0) {
            params.set('rating', filters.rating);
        }
        if (filters.languages.length > 0) {
            params.set('languages', filters.languages.join(','));
        }
        params.set('sort', filters.sortBy);
        
        // Trigger filter event
        window.dispatchEvent(new CustomEvent('filtersApplied', { 
            detail: { filters, queryString: params.toString() } 
        }));
        
        this.close();
    }
    
    resetFilters() {
        // Uncheck all checkboxes
        this.modal.querySelectorAll('input[type="checkbox"]').forEach(cb => {
            cb.checked = false;
        });
        
        // Reset other inputs
        this.modal.querySelector('#year-from').value = '';
        this.modal.querySelector('#year-to').value = '';
        this.modal.querySelector('#rating-min').value = '0';
        this.modal.querySelector('#rating-value').textContent = '0';
        this.modal.querySelector('#sort-by').value = 'popularity.desc';
        
        // Clear saved filters
        localStorage.removeItem('searchFilters');
    }
    
    loadSavedFilters() {
        const saved = localStorage.getItem('searchFilters');
        if (!saved) return;
        
        try {
            const filters = JSON.parse(saved);
            
            // Apply saved filters
            filters.types?.forEach(type => {
                const cb = this.modal.querySelector(`input[name="type"][value="${type}"]`);
                if (cb) cb.checked = true;
            });
            
            filters.genres?.forEach(genre => {
                const cb = this.modal.querySelector(`input[name="genre"][value="${genre}"]`);
                if (cb) cb.checked = true;
            });
            
            if (filters.yearFrom) {
                this.modal.querySelector('#year-from').value = filters.yearFrom;
            }
            if (filters.yearTo) {
                this.modal.querySelector('#year-to').value = filters.yearTo;
            }
            if (filters.rating) {
                this.modal.querySelector('#rating-min').value = filters.rating;
                this.modal.querySelector('#rating-value').textContent = filters.rating;
            }
            
            filters.languages?.forEach(lang => {
                const cb = this.modal.querySelector(`input[name="language"][value="${lang}"]`);
                if (cb) cb.checked = true;
            });
            
            if (filters.sortBy) {
                this.modal.querySelector('#sort-by').value = filters.sortBy;
            }
        } catch (error) {
            console.error('Failed to load saved filters:', error);
        }
    }
}

// Create global instance
window.filterModal = new FilterModal();

// Global functions
function openFilterModal() {
    window.filterModal.open();
}

function closeFilterModal() {
    window.filterModal.close();
}

function applyFilters() {
    window.filterModal.applyFilters();
}

function resetFilters() {
    window.filterModal.resetFilters();
}
</script>

<style>
.filter-modal {
    position: fixed;
    right: 0;
    top: 0;
    bottom: 0;
    width: 400px;
    max-width: 90vw;
    background: var(--theater-dark);
    box-shadow: -4px 0 12px rgba(0, 0, 0, 0.3);
    transform: translateX(100%);
    transition: transform var(--transition-medium);
    z-index: 999;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
}

.filter-modal.open {
    transform: translateX(0);
}

.filter-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--space-lg);
    border-bottom: 1px solid var(--border-primary);
    position: sticky;
    top: 0;
    background: var(--theater-dark);
    z-index: 1;
}

.filter-close {
    background: none;
    border: none;
    color: var(--text-primary);
    font-size: 1.5rem;
    cursor: pointer;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: all var(--transition-fast);
}

.filter-close:hover {
    background: var(--velvet-dark);
}

.filter-content {
    flex: 1;
    padding: var(--space-lg);
}

.filter-group {
    margin-bottom: var(--space-xl);
}

.filter-group h4 {
    margin-bottom: var(--space-md);
    color: var(--text-secondary);
    font-size: 0.875rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.filter-options {
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);
}

.genres-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--space-sm);
}

.filter-option {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    cursor: pointer;
    padding: var(--space-sm);
    border-radius: 4px;
    transition: background var(--transition-fast);
}

.filter-option:hover {
    background: var(--velvet-dark);
}

.filter-option input[type="checkbox"] {
    width: auto;
    margin: 0;
}

.year-range {
    display: flex;
    align-items: center;
    gap: var(--space-md);
}

.year-range input {
    flex: 1;
}

.rating-slider {
    margin-top: var(--space-sm);
}

.rating-display {
    margin-top: var(--space-sm);
    text-align: center;
}

.filter-select {
    width: 100%;
}

.filter-footer {
    display: flex;
    gap: var(--space-md);
    padding: var(--space-lg);
    border-top: 1px solid var(--border-primary);
    background: var(--theater-dark);
}

.filter-footer .btn {
    flex: 1;
}

@media (max-width: 768px) {
    .filter-modal {
        width: 100%;
    }
}
</style>
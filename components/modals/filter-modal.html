<div class="modal fade" id="filterModal" tabindex="-1" aria-labelledby="filterModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content bg-[#1a1a2e] border-[#60a5fa]/20">
            <div class="modal-header border-[#60a5fa]/20">
                <h5 class="modal-title text-[#e0e0ff]" id="filterModalLabel">Filter Content</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                    aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Content Type -->
                <div class="mb-4">
                    <label class="form-label text-[#a78bfa] fw-semibold mb-2">Type</label>
                    <div class="btn-group w-100" role="group">
                        <input type="radio" class="btn-check" name="contentType" id="type-all" value="all" checked>
                        <label class="btn btn-outline-primary" for="type-all">All</label>

                        <input type="radio" class="btn-check" name="contentType" id="type-movie" value="movie">
                        <label class="btn btn-outline-primary" for="type-movie">Movies</label>

                        <input type="radio" class="btn-check" name="contentType" id="type-tv" value="tv">
                        <label class="btn btn-outline-primary" for="type-tv">TV Shows</label>

                        <input type="radio" class="btn-check" name="contentType" id="type-anime" value="anime">
                        <label class="btn btn-outline-primary" for="type-anime">Anime</label>
                    </div>
                </div>

                <!-- Year Range -->
                <div class="mb-4">
                    <label class="form-label text-[#a78bfa] fw-semibold mb-2">
                        Year Range: <span id="year-range-display">2000 - 2024</span>
                    </label>
                    <div class="d-flex gap-3">
                        <input type="range" class="form-range" id="year-min" min="1900" max="2024" value="2000"
                            aria-label="Minimum year">
                        <input type="range" class="form-range" id="year-max" min="1900" max="2024" value="2024"
                            aria-label="Maximum year">
                    </div>
                </div>

                <!-- Rating -->
                <div class="mb-4">
                    <label class="form-label text-[#a78bfa] fw-semibold mb-2">
                        Minimum Rating: <span id="rating-display">0</span>
                    </label>
                    <input type="range" class="form-range" id="rating-min" min="0" max="10" step="0.5" value="0"
                        aria-label="Minimum rating">
                </div>

                <!-- Genres -->
                <div class="mb-4">
                    <label class="form-label text-[#a78bfa] fw-semibold mb-2">Genres</label>
                    <div id="genre-filter-chips"></div>
                </div>

                <!-- Region -->
                <div class="mb-4">
                    <label class="form-label text-[#a78bfa] fw-semibold mb-2">Region</label>
                    <select class="form-select bg-[#0a0a0f] text-[#e0e0ff] border-[#60a5fa]/30" id="region-select">
                        <option value="">All Regions</option>
                        <option value="english">English</option>
                        <option value="hindi">Hindi</option>
                        <option value="telugu">Telugu</option>
                        <option value="tamil">Tamil</option>
                        <option value="kannada">Kannada</option>
                        <option value="malayalam">Malayalam</option>
                    </select>
                </div>

                <!-- Sort -->
                <div class="mb-4">
                    <label class="form-label text-[#a78bfa] fw-semibold mb-2">Sort By</label>
                    <select class="form-select bg-[#0a0a0f] text-[#e0e0ff] border-[#60a5fa]/30" id="sort-select">
                        <option value="popularity">Popularity</option>
                        <option value="rating">Rating</option>
                        <option value="release_date">Release Date</option>
                        <option value="title">Title</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer border-[#60a5fa]/20">
                <button type="button" class="btn btn-secondary" onclick="resetFilters()">Reset</button>
                <button type="button" class="btn btn-primary" onclick="applyFilters()">Apply Filters</button>
            </div>
        </div>
    </div>
</div>

<script>
    // Initialize filter modal
    document.addEventListener('DOMContentLoaded', function () {
        // Load genres
        const genres = ['Action', 'Adventure', 'Animation', 'Comedy', 'Crime', 'Documentary',
            'Drama', 'Fantasy', 'Horror', 'Mystery', 'Romance', 'Sci-Fi', 'Thriller'];

        const genreContainer = document.getElementById('genre-filter-chips');
        genreContainer.innerHTML = genres.map(genre => `
            <button class="btn btn-sm btn-outline-primary rounded-pill me-2 mb-2"
                    data-genre="${genre}"
                    onclick="toggleFilterGenre(this)">
                ${genre}
            </button>
        `).join('');

        // Year range listeners
        document.getElementById('year-min').addEventListener('input', updateYearRange);
        document.getElementById('year-max').addEventListener('input', updateYearRange);

        // Rating listener
        document.getElementById('rating-min').addEventListener('input', function () {
            document.getElementById('rating-display').textContent = this.value;
        });

        // Load saved filters
        loadSavedFilters();
    });

    // Update year range display
    function updateYearRange() {
        const min = document.getElementById('year-min').value;
        const max = document.getElementById('year-max').value;
        document.getElementById('year-range-display').textContent = `${min} - ${max}`;
    }

    // Toggle genre selection
    function toggleFilterGenre(button) {
        button.classList.toggle('btn-outline-primary');
        button.classList.toggle('btn-primary');
    }

    // Apply filters
    function applyFilters() {
        const filters = {
            type: document.querySelector('input[name="contentType"]:checked').value,
            yearMin: document.getElementById('year-min').value,
            yearMax: document.getElementById('year-max').value,
            ratingMin: document.getElementById('rating-min').value,
            genres: Array.from(document.querySelectorAll('#genre-filter-chips .btn-primary'))
                .map(btn => btn.dataset.genre),
            region: document.getElementById('region-select').value,
            sort: document.getElementById('sort-select').value
        };

        // Save filters
        localStorage.setItem('cinebrain_filters', JSON.stringify(filters));

        // Update URL params
        const params = new URLSearchParams();
        Object.entries(filters).forEach(([key, value]) => {
            if (value && (Array.isArray(value) ? value.length > 0 : true)) {
                params.set(key, Array.isArray(value) ? value.join(',') : value);
            }
        });

        // Emit event
        const event = new CustomEvent('filters:changed', { detail: filters });
        document.dispatchEvent(event);

        // Close modal
        bootstrap.Modal.getInstance(document.getElementById('filterModal')).hide();

        // Update URL without reload
        const newUrl = `${window.location.pathname}?${params.toString()}`;
        window.history.pushState({ filters }, '', newUrl);
    }

    // Reset filters
    function resetFilters() {
        document.getElementById('type-all').checked = true;
        document.getElementById('year-min').value = 2000;
        document.getElementById('year-max').value = 2024;
        document.getElementById('rating-min').value = 0;
        document.getElementById('region-select').value = '';
        document.getElementById('sort-select').value = 'popularity';

        document.querySelectorAll('#genre-filter-chips .btn').forEach(btn => {
            btn.classList.remove('btn-primary');
            btn.classList.add('btn-outline-primary');
        });

        updateYearRange();
        document.getElementById('rating-display').textContent = '0';

        localStorage.removeItem('cinebrain_filters');
    }

    // Load saved filters
    function loadSavedFilters() {
        const saved = localStorage.getItem('cinebrain_filters');
        if (saved) {
            const filters = JSON.parse(saved);
            // Apply saved values to controls
            // Implementation depends on page context
        }
    }
</script>

<style>
    #filterModal .form-range {
        accent-color: #60a5fa;
    }

    #filterModal .form-select:focus,
    #filterModal .form-control:focus {
        border-color: #60a5fa;
        box-shadow: 0 0 0 0.25rem rgba(96, 165, 250, 0.25);
    }

    #filterModal .btn-primary {
        background: #60a5fa;
        border-color: #60a5fa;
    }

    #filterModal .btn-outline-primary {
        color: #60a5fa;
        border-color: #60a5fa;
    }

    #filterModal .btn-outline-primary:hover {
        background: #60a5fa;
        border-color: #60a5fa;
    }
</style>
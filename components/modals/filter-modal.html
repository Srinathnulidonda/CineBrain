<!-- CineBrain Advanced Filter Modal - Bootstrap 5 + Tailwind CSS -->
<div class="modal fade" id="filterModal" tabindex="-1" aria-labelledby="filterModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content bg-dark border-secondary">
      <!-- Modal Header -->
      <div class="modal-header border-secondary">
        <h5 class="modal-title text-white d-flex align-items-center" id="filterModalLabel">
          <i class="fas fa-filter text-primary me-2"></i>
          Advanced Filters
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      
      <!-- Modal Body -->
      <div class="modal-body">
        <form id="advancedFilterForm">
          <!-- Content Type Section -->
          <div class="filter-section mb-4">
            <h6 class="text-white fw-semibold mb-3 d-flex align-items-center">
              <i class="fas fa-film text-primary me-2"></i>
              Content Type
            </h6>
            <div class="row g-2">
              <div class="col-6 col-md-3">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="movie" id="filterMovie" name="contentType">
                  <label class="form-check-label text-white" for="filterMovie">
                    <i class="fas fa-film me-1 text-primary"></i>Movies
                  </label>
                </div>
              </div>
              <div class="col-6 col-md-3">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="tv" id="filterTV" name="contentType">
                  <label class="form-check-label text-white" for="filterTV">
                    <i class="fas fa-tv me-1 text-success"></i>TV Series
                  </label>
                </div>
              </div>
              <div class="col-6 col-md-3">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="anime" id="filterAnime" name="contentType">
                  <label class="form-check-label text-white" for="filterAnime">
                    <i class="fas fa-dragon me-1 text-warning"></i>Anime
                  </label>
                </div>
              </div>
              <div class="col-6 col-md-3">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="documentary" id="filterDoc" name="contentType">
                  <label class="form-check-label text-white" for="filterDoc">
                    <i class="fas fa-file-video me-1 text-info"></i>Documentary
                  </label>
                </div>
              </div>
            </div>
          </div>

          <!-- Genre Section -->
          <div class="filter-section mb-4">
            <h6 class="text-white fw-semibold mb-3 d-flex align-items-center">
              <i class="fas fa-masks-theater text-primary me-2"></i>
              Genres
            </h6>
            <div class="row g-2" id="genreCheckboxes">
              <!-- Genre checkboxes will be populated dynamically -->
            </div>
          </div>

          <!-- Rating Section -->
          <div class="filter-section mb-4">
            <h6 class="text-white fw-semibold mb-3 d-flex align-items-center">
              <i class="fas fa-star text-primary me-2"></i>
              Rating Range
            </h6>
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label text-white small">Minimum Rating</label>
                <select class="form-select bg-dark border-secondary text-white" id="minRating" name="minRating">
                  <option value="">Any Rating</option>
                  <option value="9">9.0+ (Masterpiece)</option>
                  <option value="8">8.0+ (Excellent)</option>
                  <option value="7">7.0+ (Very Good)</option>
                  <option value="6">6.0+ (Good)</option>
                  <option value="5">5.0+ (Average)</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label text-white small">Maximum Rating</label>
                <select class="form-select bg-dark border-secondary text-white" id="maxRating" name="maxRating">
                  <option value="">Any Rating</option>
                  <option value="10">10.0 (Perfect)</option>
                  <option value="9">9.0 (Excellent)</option>
                  <option value="8">8.0 (Very Good)</option>
                  <option value="7">7.0 (Good)</option>
                  <option value="6">6.0 (Average)</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Year/Release Date Section -->
          <div class="filter-section mb-4">
            <h6 class="text-white fw-semibold mb-3 d-flex align-items-center">
              <i class="fas fa-calendar text-primary me-2"></i>
              Release Date
            </h6>
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label text-white small">From Year</label>
                <select class="form-select bg-dark border-secondary text-white" id="fromYear" name="fromYear">
                  <option value="">Any Year</option>
                  <!-- Years will be populated dynamically -->
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label text-white small">To Year</label>
                <select class="form-select bg-dark border-secondary text-white" id="toYear" name="toYear">
                  <option value="">Any Year</option>
                  <!-- Years will be populated dynamically -->
                </select>
              </div>
            </div>
            
            <!-- Quick Year Ranges -->
            <div class="mt-2">
              <small class="text-muted">Quick Select:</small>
              <div class="d-flex flex-wrap gap-1 mt-1">
                <button type="button" class="btn btn-outline-secondary btn-sm year-preset" data-from="2024" data-to="2024">2024</button>
                <button type="button" class="btn btn-outline-secondary btn-sm year-preset" data-from="2020" data-to="2024">2020s</button>
                <button type="button" class="btn btn-outline-secondary btn-sm year-preset" data-from="2010" data-to="2019">2010s</button>
                <button type="button" class="btn btn-outline-secondary btn-sm year-preset" data-from="2000" data-to="2009">2000s</button>
                <button type="button" class="btn btn-outline-secondary btn-sm year-preset" data-from="1990" data-to="1999">90s</button>
                <button type="button" class="btn btn-outline-secondary btn-sm year-preset" data-from="" data-to="">All Time</button>
              </div>
            </div>
          </div>

          <!-- Language Section -->
          <div class="filter-section mb-4">
            <h6 class="text-white fw-semibold mb-3 d-flex align-items-center">
              <i class="fas fa-globe text-primary me-2"></i>
              Languages
            </h6>
            <div class="row g-2">
              <div class="col-6 col-md-4">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="english" id="langEn" name="language">
                  <label class="form-check-label text-white" for="langEn">English</label>
                </div>
              </div>
              <div class="col-6 col-md-4">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="hindi" id="langHi" name="language">
                  <label class="form-check-label text-white" for="langHi">Hindi</label>
                </div>
              </div>
              <div class="col-6 col-md-4">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="telugu" id="langTe" name="language">
                  <label class="form-check-label text-white" for="langTe">Telugu</label>
                </div>
              </div>
              <div class="col-6 col-md-4">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="tamil" id="langTa" name="language">
                  <label class="form-check-label text-white" for="langTa">Tamil</label>
                </div>
              </div>
              <div class="col-6 col-md-4">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="kannada" id="langKn" name="language">
                  <label class="form-check-label text-white" for="langKn">Kannada</label>
                </div>
              </div>
              <div class="col-6 col-md-4">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="japanese" id="langJa" name="language">
                  <label class="form-check-label text-white" for="langJa">Japanese</label>
                </div>
              </div>
            </div>
          </div>

          <!-- Sort Options Section -->
          <div class="filter-section mb-4">
            <h6 class="text-white fw-semibold mb-3 d-flex align-items-center">
              <i class="fas fa-sort text-primary me-2"></i>
              Sort By
            </h6>
            <div class="row g-3">
              <div class="col-md-6">
                <select class="form-select bg-dark border-secondary text-white" id="sortBy" name="sortBy">
                  <option value="popularity">Popularity</option>
                  <option value="rating">Rating</option>
                  <option value="release_date">Release Date</option>
                  <option value="title">Title (A-Z)</option>
                  <option value="vote_count">Most Voted</option>
                </select>
              </div>
              <div class="col-md-6">
                <select class="form-select bg-dark border-secondary text-white" id="sortOrder" name="sortOrder">
                  <option value="desc">Descending</option>
                  <option value="asc">Ascending</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Additional Filters -->
          <div class="filter-section mb-4">
            <h6 class="text-white fw-semibold mb-3 d-flex align-items-center">
              <i class="fas fa-sliders-h text-primary me-2"></i>
              Additional Options
            </h6>
            <div class="row g-2">
              <div class="col-md-6">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="onlyWithTrailers" name="onlyWithTrailers">
                  <label class="form-check-label text-white" for="onlyWithTrailers">
                    <i class="fas fa-play-circle me-1"></i>Only with trailers
                  </label>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="criticsChoice" name="criticsChoice">
                  <label class="form-check-label text-white" for="criticsChoice">
                    <i class="fas fa-award me-1"></i>Critics' Choice
                  </label>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="newReleases" name="newReleases">
                  <label class="form-check-label text-white" for="newReleases">
                    <i class="fas fa-sparkles me-1"></i>New Releases
                  </label>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="trending" name="trending">
                  <label class="form-check-label text-white" for="trending">
                    <i class="fas fa-fire me-1"></i>Trending
                  </label>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>
      
      <!-- Modal Footer -->
      <div class="modal-footer border-secondary">
        <div class="flex-grow-1">
          <button type="button" class="btn btn-outline-secondary" onclick="resetAllFilters()">
            <i class="fas fa-undo me-1"></i>Reset All
          </button>
        </div>
        <div class="d-flex gap-2">
          <button type="button" class="btn btn-outline-primary" onclick="previewFilterResults()">
            <i class="fas fa-eye me-1"></i>Preview (<span id="previewCount">0</span>)
          </button>
          <button type="button" class="btn btn-primary" onclick="applyAdvancedFilters()">
            <i class="fas fa-check me-1"></i>Apply Filters
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// Advanced Filter Modal Component JavaScript
(function() {
  let currentFilters = {};
  let previewResults = [];
  
  const modal = document.getElementById('filterModal');
  const form = document.getElementById('advancedFilterForm');
  const genreCheckboxes = document.getElementById('genreCheckboxes');
  const previewCount = document.getElementById('previewCount');

  // Initialize filter modal
  function initFilterModal() {
    setupModalEventListeners();
    populateGenreOptions();
    populateYearOptions();
    setupFilterEventListeners();
  }

  // Setup modal event listeners
  function setupModalEventListeners() {
    modal.addEventListener('shown.bs.modal', function() {
      loadSavedFilters();
    });

    // Year preset buttons
    document.querySelectorAll('.year-preset').forEach(btn => {
      btn.addEventListener('click', function() {
        const fromYear = this.dataset.from;
        const toYear = this.dataset.to;
        
        document.getElementById('fromYear').value = fromYear;
        document.getElementById('toYear').value = toYear;
        
        // Update button styles
        document.querySelectorAll('.year-preset').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        
        updatePreview();
      });
    });
  }

  // Setup filter event listeners
  function setupFilterEventListeners() {
    // Listen for all filter changes
    form.addEventListener('change', updatePreview);
    
    // Real-time updates for checkboxes
    form.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
      checkbox.addEventListener('change', updatePreview);
    });

    // Real-time updates for selects
    form.querySelectorAll('select').forEach(select => {
      select.addEventListener('change', updatePreview);
    });
  }

  // Populate genre options
  function populateGenreOptions() {
    const commonGenres = [
      'Action', 'Adventure', 'Animation', 'Comedy', 'Crime', 'Documentary',
      'Drama', 'Family', 'Fantasy', 'Horror', 'Mystery', 'Romance',
      'Sci-Fi', 'Thriller', 'War', 'Western', 'Biography', 'History',
      'Music', 'Sport', 'Musical'
    ];

    const genreHTML = commonGenres.map(genre => `
      <div class="col-6 col-md-4">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="${genre}" id="genre${genre}" name="genre">
          <label class="form-check-label text-white" for="genre${genre}">${genre}</label>
        </div>
      </div>
    `).join('');

    genreCheckboxes.innerHTML = genreHTML;
  }

  // Populate year options
  function populateYearOptions() {
    const currentYear = new Date().getFullYear();
    const fromYearSelect = document.getElementById('fromYear');
    const toYearSelect = document.getElementById('toYear');

    // Generate years from 1900 to current year
    for (let year = currentYear; year >= 1900; year--) {
      const option1 = document.createElement('option');
      option1.value = year;
      option1.textContent = year;
      fromYearSelect.appendChild(option1);

      const option2 = document.createElement('option');
      option2.value = year;
      option2.textContent = year;
      toYearSelect.appendChild(option2);
    }
  }

  // Update preview count
  async function updatePreview() {
    const filters = collectFilterData();
    
    try {
      // Make API call to get count (you might want to create a dedicated endpoint for this)
      const params = new URLSearchParams(buildQueryParams(filters));
      
      // For now, simulate the count
      const mockCount = Math.floor(Math.random() * 500) + 50;
      previewCount.textContent = mockCount;
      
      // Store current filters
      currentFilters = filters;
    } catch (error) {
      console.error('Preview update failed:', error);
      previewCount.textContent = '?';
    }
  }

  // Collect filter data from form
  function collectFilterData() {
    const formData = new FormData(form);
    const filters = {};

    // Content types
    const contentTypes = formData.getAll('contentType');
    if (contentTypes.length > 0) {
      filters.contentType = contentTypes;
    }

    // Genres
    const genres = formData.getAll('genre');
    if (genres.length > 0) {
      filters.genres = genres;
    }

    // Languages
    const languages = formData.getAll('language');
    if (languages.length > 0) {
      filters.languages = languages;
    }

    // Rating range
    if (formData.get('minRating')) {
      filters.minRating = formData.get('minRating');
    }
    if (formData.get('maxRating')) {
      filters.maxRating = formData.get('maxRating');
    }

    // Year range
    if (formData.get('fromYear')) {
      filters.fromYear = formData.get('fromYear');
    }
    if (formData.get('toYear')) {
      filters.toYear = formData.get('toYear');
    }

    // Sort options
    filters.sortBy = formData.get('sortBy') || 'popularity';
    filters.sortOrder = formData.get('sortOrder') || 'desc';

    // Additional options
    if (formData.get('onlyWithTrailers')) {
      filters.onlyWithTrailers = true;
    }
    if (formData.get('criticsChoice')) {
      filters.criticsChoice = true;
    }
    if (formData.get('newReleases')) {
      filters.newReleases = true;
    }
    if (formData.get('trending')) {
      filters.trending = true;
    }

    return filters;
  }

  // Build query parameters for API
  function buildQueryParams(filters) {
    const params = {};

    if (filters.contentType) {
      params.type = filters.contentType.join(',');
    }
    if (filters.genres) {
      params.genres = filters.genres.join(',');
    }
    if (filters.languages) {
      params.languages = filters.languages.join(',');
    }
    if (filters.minRating) {
      params.min_rating = filters.minRating;
    }
    if (filters.maxRating) {
      params.max_rating = filters.maxRating;
    }
    if (filters.fromYear) {
      params.from_year = filters.fromYear;
    }
    if (filters.toYear) {
      params.to_year = filters.toYear;
    }
    
    params.sort_by = filters.sortBy;
    params.sort_order = filters.sortOrder;

    if (filters.onlyWithTrailers) {
      params.with_trailers = 'true';
    }
    if (filters.criticsChoice) {
      params.critics_choice = 'true';
    }
    if (filters.newReleases) {
      params.new_releases = 'true';
    }
    if (filters.trending) {
      params.trending = 'true';
    }

    return params;
  }

  // Load saved filters from localStorage
  function loadSavedFilters() {
    try {
      const savedFilters = localStorage.getItem('cinebrain_filters');
      if (savedFilters) {
        const filters = JSON.parse(savedFilters);
        applyFiltersToForm(filters);
        currentFilters = filters;
        updatePreview();
      }
    } catch (error) {
      console.error('Failed to load saved filters:', error);
    }
  }

  // Apply filters to form elements
  function applyFiltersToForm(filters) {
    // Reset form first
    form.reset();

    // Content types
    if (filters.contentType) {
      filters.contentType.forEach(type => {
        const checkbox = form.querySelector(`input[name="contentType"][value="${type}"]`);
        if (checkbox) checkbox.checked = true;
      });
    }

    // Genres
    if (filters.genres) {
      filters.genres.forEach(genre => {
        const checkbox = form.querySelector(`input[name="genre"][value="${genre}"]`);
        if (checkbox) checkbox.checked = true;
      });
    }

    // Languages
    if (filters.languages) {
      filters.languages.forEach(lang => {
        const checkbox = form.querySelector(`input[name="language"][value="${lang}"]`);
        if (checkbox) checkbox.checked = true;
      });
    }

    // Rating and year ranges
    ['minRating', 'maxRating', 'fromYear', 'toYear', 'sortBy', 'sortOrder'].forEach(field => {
      if (filters[field]) {
        const element = form.querySelector(`[name="${field}"]`);
        if (element) element.value = filters[field];
      }
    });

    // Additional options
    ['onlyWithTrailers', 'criticsChoice', 'newReleases', 'trending'].forEach(option => {
      if (filters[option]) {
        const checkbox = form.querySelector(`[name="${option}"]`);
        if (checkbox) checkbox.checked = true;
      }
    });
  }

  // Global functions
  window.openFilterModal = function(existingFilters = {}) {
    if (existingFilters && Object.keys(existingFilters).length > 0) {
      applyFiltersToForm(existingFilters);
      currentFilters = existingFilters;
    }
    
    const bootstrapModal = new bootstrap.Modal(modal);
    bootstrapModal.show();
  };

  window.resetAllFilters = function() {
    form.reset();
    currentFilters = {};
    previewCount.textContent = '0';
    
    // Reset year preset buttons
    document.querySelectorAll('.year-preset').forEach(btn => btn.classList.remove('active'));
  };

  window.previewFilterResults = function() {
    if (Object.keys(currentFilters).length === 0) {
      alert('Please select some filters to preview results.');
      return;
    }

    // Close modal and show preview in a new tab/window
    const params = new URLSearchParams(buildQueryParams(currentFilters));
    const previewUrl = `/content/search.html?${params}&preview=true`;
    
    window.open(previewUrl, '_blank');
  };

  window.applyAdvancedFilters = function() {
    // Save filters to localStorage
    try {
      localStorage.setItem('cinebrain_filters', JSON.stringify(currentFilters));
    } catch (error) {
      console.error('Failed to save filters:', error);
    }

    // Close modal
    bootstrap.Modal.getInstance(modal).hide();

    // Navigate to search results with filters
    const params = new URLSearchParams(buildQueryParams(currentFilters));
    window.location.href = `/content/search.html?${params}`;
  };

  // Initialize when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initFilterModal);
  } else {
    initFilterModal();
  }
})();

const filterModalStyles = `
<style>
.filter-section {
  border-bottom: 1px solid rgba(75, 85, 99, 0.3);
  padding-bottom: 1rem;
}

.filter-section:last-child {
  border-bottom: none;
  padding-bottom: 0;
}

.form-check-input:checked {
  background-color: #3b82f6;
  border-color: #3b82f6;
}

.form-check-input:focus {
  border-color: #3b82f6;
  box-shadow: 0 0 0 0.2rem rgba(59, 130, 246, 0.25);
}

.form-select:focus {
  border-color: #3b82f6;
  box-shadow: 0 0 0 0.2rem rgba(59, 130, 246, 0.25);
}

.year-preset {
  font-size: 0.8rem;
  padding: 0.25rem 0.5rem;
  transition: all 0.2s ease;
}

.year-preset:hover {
  background-color: rgba(59, 130, 246, 0.1);
  border-color: #3b82f6;
}

.year-preset.active {
  background-color: #3b82f6;
  border-color: #3b82f6;
  color: white;
}

#previewCount {
  font-weight: bold;
  color: #3b82f6;
}

/* Custom scrollbar for modal body */
.modal-body::-webkit-scrollbar {
  width: 8px;
}

.modal-body::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.1);
}

.modal-body::-webkit-scrollbar-thumb {
  background: rgba(59, 130, 246, 0.5);
  border-radius: 4px;
}

.modal-body::-webkit-scrollbar-thumb:hover {
  background: rgba(59, 130, 246, 0.7);
}

/* Checkbox animations */
.form-check-input {
  transition: all 0.2s ease;
}

.form-check-label {
  transition: color 0.2s ease;
  cursor: pointer;
}

.form-check-input:checked + .form-check-label {
  color: #3b82f6;
}

/* Modal dialog animations */
#filterModal .modal-dialog {
  transition: all 0.3s ease;
}

#filterModal.show .modal-dialog {
  transform: scale(1);
}

/* Section headers */
.filter-section h6 {
  font-size: 1rem;
  margin-bottom: 0.75rem;
}

.filter-section h6 i {
  width: 20px;
  text-align: center;
}
</style>
`;

// Inject filter modal styles
document.head.insertAdjacentHTML('beforeend', filterModalStyles);
</script>
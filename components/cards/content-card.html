<!-- Standard Content Card Component -->
<div class="content-card position-relative overflow-hidden rounded-3 shadow-lg bg-dark border-0 h-100"
    data-content-id="" style="transition: all 0.3s ease; cursor: pointer;">

    <!-- Poster Image -->
    <div class="card-img-wrapper position-relative overflow-hidden" style="aspect-ratio: 2/3;">
        <img class="card-img-top w-100 h-100 object-fit-cover loading-placeholder" src="" alt="" loading="lazy"
            style="transition: transform 0.3s ease;">

        <!-- Hover Overlay -->
        <div class="card-overlay position-absolute top-0 start-0 w-100 h-100 d-flex flex-column justify-content-end p-3 opacity-0"
            style="background: linear-gradient(transparent, rgba(0,0,0,0.9)); transition: opacity 0.3s ease;">

            <!-- Play Button -->
            <button class="btn btn-primary rounded-circle p-2 mb-2 align-self-center play-btn"
                style="width: 50px; height: 50px;">
                <i class="fas fa-play text-white"></i>
            </button>

            <!-- Content Info -->
            <div class="text-white text-center">
                <h6 class="card-title fw-bold mb-1 text-truncate content-title"></h6>
                <div class="d-flex justify-content-center align-items-center gap-2 mb-2">
                    <span class="rating-badge"></span>
                    <span class="type-badge"></span>
                </div>
                <div class="genre-chips d-flex flex-wrap justify-content-center gap-1">
                    <!-- Genres will be populated dynamically -->
                </div>
            </div>
        </div>
    </div>

    <!-- Card Actions -->
    <div class="card-actions position-absolute top-0 end-0 p-2 opacity-0" style="transition: opacity 0.3s ease;">
        <button class="btn btn-outline-light btn-sm rounded-circle p-2 mb-1 watchlist-btn" title="Add to Watchlist">
            <i class="fas fa-plus"></i>
        </button>
        <button class="btn btn-outline-light btn-sm rounded-circle p-2 favorite-btn" title="Add to Favorites">
            <i class="far fa-heart"></i>
        </button>
    </div>
</div>

<script>
    class ContentCard {
        constructor(cardElement, contentData) {
            this.card = cardElement;
            this.data = contentData;
            this.init();
        }

        init() {
            this.populateCard();
            this.attachEventListeners();
        }

        populateCard() {
            // Set content ID
            this.card.dataset.contentId = this.data.id;

            // Set poster image
            const img = this.card.querySelector('.card-img-top');
            const title = this.data.title || 'Unknown Title';
            img.src = this.data.poster_path || '/api/placeholder/300x450';
            img.alt = title;

            // Set title
            this.card.querySelector('.content-title').textContent = title;

            // Set rating badge
            const ratingBadge = this.card.querySelector('.rating-badge');
            if (this.data.rating) {
                ratingBadge.innerHTML = `<span class="badge bg-warning text-dark">‚≠ê ${this.data.rating.toFixed(1)}</span>`;
            }

            // Set type badge
            const typeBadge = this.card.querySelector('.type-badge');
            const typeColor = this.getTypeColor(this.data.content_type);
            typeBadge.innerHTML = `<span class="badge ${typeColor}">${this.data.content_type.toUpperCase()}</span>`;

            // Set genre chips
            const genreContainer = this.card.querySelector('.genre-chips');
            if (this.data.genres && this.data.genres.length > 0) {
                genreContainer.innerHTML = this.data.genres.slice(0, 3).map(genre =>
                    `<span class="badge bg-secondary bg-opacity-75 text-xs">${genre}</span>`
                ).join('');
            }
        }

        getTypeColor(type) {
            const colors = {
                'movie': 'bg-primary',
                'tv': 'bg-success',
                'anime': 'bg-info'
            };
            return colors[type] || 'bg-secondary';
        }

        attachEventListeners() {
            // Card hover effects
            this.card.addEventListener('mouseenter', () => {
                this.card.querySelector('.card-overlay').classList.remove('opacity-0');
                this.card.querySelector('.card-actions').classList.remove('opacity-0');
                this.card.querySelector('.card-img-top').style.transform = 'scale(1.05)';
            });

            this.card.addEventListener('mouseleave', () => {
                this.card.querySelector('.card-overlay').classList.add('opacity-0');
                this.card.querySelector('.card-actions').classList.add('opacity-0');
                this.card.querySelector('.card-img-top').style.transform = 'scale(1)';
            });

            // Play button click
            this.card.querySelector('.play-btn').addEventListener('click', (e) => {
                e.stopPropagation();
                this.playTrailer();
            });

            // Watchlist button
            this.card.querySelector('.watchlist-btn').addEventListener('click', (e) => {
                e.stopPropagation();
                this.addToWatchlist();
            });

            // Favorite button
            this.card.querySelector('.favorite-btn').addEventListener('click', (e) => {
                e.stopPropagation();
                this.addToFavorites();
            });

            // Card click - go to details
            this.card.addEventListener('click', () => {
                window.location.href = `content/details.html?id=${this.data.id}`;
            });
        }

        async playTrailer() {
            if (this.data.youtube_trailer) {
                // Show trailer modal
                const modal = document.querySelector('#trailerModal');
                const iframe = modal.querySelector('iframe');
                iframe.src = `https://www.youtube.com/embed/${this.data.youtube_trailer.split('v=')[1]}?autoplay=1`;
                const bsModal = new bootstrap.Modal(modal);
                bsModal.show();
            } else {
                // Redirect to details page
                window.location.href = `content/details.html?id=${this.data.id}`;
            }
        }

        async addToWatchlist() {
            try {
                const response = await fetch('https://backend-app-970m.onrender.com/api/interactions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: JSON.stringify({
                        content_id: this.data.id,
                        interaction_type: 'watchlist'
                    })
                });

                if (response.ok) {
                    const btn = this.card.querySelector('.watchlist-btn');
                    btn.innerHTML = '<i class="fas fa-check text-success"></i>';
                    btn.classList.add('btn-success');
                    btn.classList.remove('btn-outline-light');
                }
            } catch (error) {
                console.error('Failed to add to watchlist:', error);
            }
        }

        async addToFavorites() {
            try {
                const response = await fetch('https://backend-app-970m.onrender.com/api/interactions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: JSON.stringify({
                        content_id: this.data.id,
                        interaction_type: 'favorite'
                    })
                });

                if (response.ok) {
                    const btn = this.card.querySelector('.favorite-btn');
                    btn.innerHTML = '<i class="fas fa-heart text-danger"></i>';
                    btn.classList.add('btn-danger');
                    btn.classList.remove('btn-outline-light');
                }
            } catch (error) {
                console.error('Failed to add to favorites:', error);
            }
        }
    }

    // Auto-initialize content cards
    document.addEventListener('DOMContentLoaded', () => {
        const cards = document.querySelectorAll('.content-card[data-auto-init="true"]');
        cards.forEach(card => {
            const contentData = JSON.parse(card.dataset.contentData || '{}');
            new ContentCard(card, contentData);
        });
    });
</script>
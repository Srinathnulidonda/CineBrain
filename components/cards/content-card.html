<article
    class="content-card group rounded-2xl overflow-hidden position-relative bg-[#1a1a2e] hover:scale-105 transition-all duration-300"
    data-content-id="${content.id}" onclick="viewContent(${content.id})">

    <a href="#" class="d-block h-100" aria-label="${content.title}" onclick="event.preventDefault()">
        <!-- Poster Image -->
        <div class="poster-container position-relative" style="aspect-ratio: 2/3;">
            <img class="w-100 h-100 object-cover" src="${content.poster_path || '/api/placeholder/300/450'}"
                alt="${content.title} poster" loading="lazy" onerror="this.src='/api/placeholder/300/450'">

            <!-- Type Badge -->
            <span
                class="position-absolute top-2 start-2 badge ${content.content_type === 'movie' ? 'bg-primary' : content.content_type === 'tv' ? 'bg-purple' : 'bg-gradient-to-r from-blue-500 to-purple-500'} text-uppercase"
                style="font-size: 10px;">
                ${content.content_type}
            </span>

            <!-- Rating Badge -->
            ${content.rating ? `
            <span class="position-absolute top-2 end-2 badge bg-warning text-dark d-flex align-items-center gap-1">
                <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                    <path
                        d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                </svg>
                <span>${content.rating}</span>
            </span>
            ` : ''}
        </div>

        <!-- Content Info -->
        <div
            class="position-absolute bottom-0 start-0 end-0 p-3 bg-gradient-to-t from-black/90 via-black/60 to-transparent">
            <h3 class="card-title text-white fw-semibold mb-1 text-truncate" style="font-size: 14px;">
                ${content.title}
            </h3>
            <div class="card-meta text-xs text-gray-300">
                ${content.year || new Date(content.release_date).getFullYear() || ''}
                ${content.genres && content.genres.length > 0 ? 'â€¢ ' + content.genres.slice(0, 2).join(', ') : ''}
            </div>
        </div>
    </a>

    <!-- Quick Actions (Hover) -->
    <div class="quick-actions position-absolute bottom-0 start-0 end-0 p-2 d-none d-md-flex justify-content-center gap-2 opacity-0"
        style="background: linear-gradient(to top, rgba(10, 10, 15, 0.95), transparent); transition: opacity 0.3s;">

        <button class="btn btn-sm btn-ghost text-white"
            onclick="event.stopPropagation(); playTrailer('${content.youtube_trailer}')" aria-label="Play trailer"
            title="Watch Trailer">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z">
                </path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
        </button>

        <button class="btn btn-sm btn-ghost text-white"
            onclick="event.stopPropagation(); toggleWatchlist(${content.id}, this)" aria-label="Add to watchlist"
            aria-pressed="false" title="Add to Watchlist">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
        </button>

        <button class="btn btn-sm btn-ghost text-white"
            onclick="event.stopPropagation(); toggleFavorite(${content.id}, this)" aria-label="Add to favorites"
            aria-pressed="false" title="Add to Favorites">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z">
                </path>
            </svg>
        </button>
    </div>
</article>

<script>
    // View content details
    function viewContent(contentId) {
        window.location.href = `/content/details.html?id=${contentId}`;
    }

    // Play trailer
    function playTrailer(youtubeUrl) {
        if (youtubeUrl) {
            // Could open in modal or new tab
            window.open(youtubeUrl, '_blank');
        } else {
            showToast('Trailer not available', 'warning');
        }
    }

    // Toggle watchlist
    async function toggleWatchlist(contentId, button) {
        const token = localStorage.getItem('cinebrain_token');
        if (!token) {
            window.location.href = '/auth/login.html';
            return;
        }

        try {
            // Optimistic UI update
            button.setAttribute('aria-pressed', 'true');
            button.innerHTML = `
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                </svg>
            `;

            const response = await fetch('https://backend-app-970m.onrender.com/api/interactions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({
                    content_id: contentId,
                    interaction_type: 'watchlist'
                })
            });

            if (!response.ok) throw new Error('Failed to update watchlist');

            showToast('Added to watchlist', 'success');
        } catch (error) {
            // Rollback on error
            button.setAttribute('aria-pressed', 'false');
            button.innerHTML = `
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                          d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
            `;
            showToast('Failed to update watchlist', 'error');
        }
    }

    // Toggle favorite
    async function toggleFavorite(contentId, button) {
        const token = localStorage.getItem('cinebrain_token');
        if (!token) {
            window.location.href = '/auth/login.html';
            return;
        }

        try {
            // Optimistic UI update
            button.setAttribute('aria-pressed', 'true');
            button.innerHTML = `
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                </svg>
            `;

            const response = await fetch('https://backend-app-970m.onrender.com/api/interactions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({
                    content_id: contentId,
                    interaction_type: 'favorite'
                })
            });

            if (!response.ok) throw new Error('Failed to update favorites');

            showToast('Added to favorites', 'success');
        } catch (error) {
            // Rollback on error
            button.setAttribute('aria-pressed', 'false');
            button.innerHTML = `
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                          d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                </svg>
            `;
            showToast('Failed to update favorites', 'error');
        }
    }

    // Toast notification helper
    function showToast(message, type = 'info') {
        // Implementation would go here
        console.log(`Toast: ${message} (${type})`);
    }
</script>

<style>
    .content-card {
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .content-card:hover {
        transform: scale(1.05);
        box-shadow: 0 8px 32px rgba(96, 165, 250, 0.3);
    }

    .content-card:hover .quick-actions {
        opacity: 1 !important;
    }

    .bg-purple {
        background: #a78bfa;
    }

    .bg-gradient-to-r {
        background: linear-gradient(to right, #60a5fa, #a78bfa);
    }

    .btn-ghost {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .btn-ghost:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: scale(1.1);
    }
</style>
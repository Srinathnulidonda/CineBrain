<div class="card-mini" data-content-id="{{contentId}}">
    <a href="/content/details.html?id={{contentId}}" class="card-mini-link">
        <div class="card-mini-poster">
            <img data-src="{{posterUrl}}" alt="{{title}}" class="lazy-image-mini" />
            {{#if progress}}
            <div class="progress-bar">
                <div class="progress-fill" style="width: {{progress}}%"></div>
            </div>
            {{/if}}
        </div>
        <div class="card-mini-info">
            <h4 class="card-mini-title">{{title}}</h4>
            <p class="card-mini-meta">
                {{contentType}} â€¢ {{duration}}
            </p>
            {{#if lastWatched}}
            <p class="card-mini-time">{{lastWatched}}</p>
            {{/if}}
        </div>
    </a>
</div>

<script>
class CardMini {
    constructor(element) {
        this.element = element;
        this.contentId = element.dataset.contentId;
        this.init();
    }
    
    init() {
        this.setupLazyLoading();
        this.loadProgress();
    }
    
    setupLazyLoading() {
        const img = this.element.querySelector('.lazy-image-mini');
        if (!img) return;
        
        const imageObserver = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const img = entry.target;
                    // For mini cards, use smaller image size
                    const posterUrl = img.dataset.src.replace('w500', 'w200');
                    img.src = posterUrl;
                    img.classList.add('loaded');
                    observer.unobserve(img);
                }
            });
        }, {
            rootMargin: '20px'
        });
        
        imageObserver.observe(img);
    }
    
    async loadProgress() {
        if (!Auth.isAuthenticated()) return;
        
        try {
            // In a real app, this would fetch watch progress from backend
            const watchHistory = await API.request(`${API_ENDPOINTS.WATCH_HISTORY}/${this.contentId}`);
            if (watchHistory && watchHistory.progress) {
                const progressBar = this.element.querySelector('.progress-bar');
                if (progressBar) {
                    progressBar.style.display = 'block';
                    const fill = progressBar.querySelector('.progress-fill');
                    fill.style.width = `${watchHistory.progress}%`;
                }
            }
        } catch (error) {
            // Silent fail for progress loading
        }
    }
}

// Auto-initialize
document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.card-mini').forEach(card => {
        new CardMini(card);
    });
});
</script>

<style>
.card-mini {
    display: flex;
    background: var(--theater-dark);
    border-radius: 4px;
    overflow: hidden;
    transition: all var(--transition-fast);
}

.card-mini:hover {
    background: var(--velvet-dark);
    transform: translateX(4px);
}

.card-mini-link {
    display: flex;
    width: 100%;
    text-decoration: none;
    color: inherit;
}

.card-mini-poster {
    position: relative;
    width: 80px;
    height: 120px;
    flex-shrink: 0;
    background: var(--velvet-dark);
}

.card-mini-poster img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    opacity: 0;
    transition: opacity var(--transition-fast);
}

.card-mini-poster img.loaded {
    opacity: 1;
}

.progress-bar {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: rgba(0, 0, 0, 0.5);
    display: none;
}

.progress-fill {
    height: 100%;
    background: var(--platinum-blue);
    transition: width var(--transition-medium);
}

.card-mini-info {
    padding: var(--space-md);
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
}

.card-mini-title {
    font-size: 0.9375rem;
    font-weight: 600;
    margin-bottom: var(--space-xs);
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.card-mini-meta {
    font-size: 0.875rem;
    color: var(--text-secondary);
    margin-bottom: var(--space-xs);
}

.card-mini-time {
    font-size: 0.75rem;
    color: var(--text-tertiary);
}
</style>
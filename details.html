<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Content Details - CineScope</title>
    <script src="auth.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --netflix-red: #e50914;
            --netflix-black: #141414;
            --netflix-gray: #333333;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--netflix-black);
            color: white;
            overflow-x: hidden;
        }

        .hero-section {
            height: 70vh;
            position: relative;
            background-size: cover;
            background-position: center;
            display: flex;
            align-items: end;
        }

        .hero-gradient {
            position: absolute;
            inset: 0;
            background: linear-gradient(180deg, rgba(20,20,20,0.3) 0%, rgba(20,20,20,0.7) 50%, rgba(20,20,20,1) 100%);
        }

        .hero-content {
            position: relative;
            z-index: 10;
            padding: 3rem;
            max-width: 800px;
        }

        .btn-primary {
            background: var(--netflix-red);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary:hover {
            background: #b8070e;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 12px 24px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-secondary:hover {
            background: rgba(255,255,255,0.3);
        }

        .info-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
        }

        .cast-member {
            flex: 0 0 auto;
            width: 150px;
            text-align: center;
            cursor: pointer;
        }

        .cast-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            margin: 0 auto 0.5rem;
            border: 2px solid rgba(255,255,255,0.1);
        }

        .ott-platform-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .ott-platform-card:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .ott-platform-card.free {
            border-color: #4caf50;
        }

        .ott-platform-card.paid {
            border-color: #ff9800;
        }

        .similar-content-card {
            flex: 0 0 auto;
            width: 200px;
            height: 300px;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--netflix-gray);
        }

        .similar-content-card:hover {
            transform: scale(1.05);
            z-index: 10;
        }

        .similar-content-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .rating-stars {
            color: #ffd700;
        }

        .genre-tag {
            background: rgba(229, 9, 20, 0.2);
            color: var(--netflix-red);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin: 2px;
            display: inline-block;
        }

        .scroll-container {
            display: flex;
            overflow-x: auto;
            scroll-behavior: smooth;
            gap: 1rem;
            padding: 0.5rem 0 1rem;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .scroll-container::-webkit-scrollbar {
            display: none;
        }

        .trailer-thumbnail {
            position: relative;
            cursor: pointer;
            border-radius: 8px;
            overflow: hidden;
            transition: transform 0.3s ease;
        }

        .trailer-thumbnail:hover {
            transform: scale(1.05);
        }

        .play-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
        }

        .loading-shimmer {
            background: linear-gradient(90deg, rgba(255,255,255,0.1) 25%, rgba(255,255,255,0.2) 50%, rgba(255,255,255,0.1) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: 8px;
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 50;
            background: rgba(0,0,0,0.8);
            border: none;
            color: white;
            padding: 12px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            background: rgba(0,0,0,1);
            transform: scale(1.1);
        }

        @media (max-width: 768px) {
            .hero-content {
                padding: 2rem 1rem;
            }

            .hero-section {
                height: 50vh;
            }

            .cast-member {
                width: 100px;
            }

            .cast-avatar {
                width: 80px;
                height: 80px;
            }

            .similar-content-card {
                width: 150px;
                height: 225px;
            }
        }
    </style>
</head>
<body>
    <!-- Back Button -->
    <button class="back-button" onclick="goBack()">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
        </svg>
    </button>

    <!-- Hero Section -->
    <section id="heroSection" class="hero-section">
        <div class="hero-gradient"></div>
        <div class="hero-content">
            <div id="heroContent" class="loading-shimmer h-64 w-full mb-4"></div>
        </div>
    </section>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Content Info -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-12">
            <!-- Main Info -->
            <div class="lg:col-span-2">
                <div id="mainInfo" class="info-card">
                    <div class="loading-shimmer h-48 w-full"></div>
                </div>
            </div>
            
            <!-- Side Info -->
            <div class="space-y-6">
                <div id="sideInfo" class="info-card">
                    <div class="loading-shimmer h-32 w-full"></div>
                </div>
                
                <!-- Quick Actions -->
                <div class="info-card">
                    <h3 class="text-lg font-semibold mb-4">Quick Actions</h3>
                    <div class="space-y-3">
                        <button id="addToWatchlistBtn" class="btn-secondary w-full justify-center" onclick="addToWatchlist()">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"></path>
                            </svg>
                            Add to Watchlist
                        </button>
                        <button id="addToFavoritesBtn" class="btn-secondary w-full justify-center" onclick="addToFavorites()">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd"></path>
                            </svg>
                            Add to Favorites
                        </button>
                        <button id="shareBtn" class="btn-secondary w-full justify-center" onclick="shareContent()">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"></path>
                            </svg>
                            Share
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- OTT Platforms -->
        <div class="mb-12">
            <h2 class="text-2xl font-bold mb-6">Where to Watch</h2>
            <div id="ottPlatforms" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                <div class="loading-shimmer h-24 rounded-lg"></div>
                <div class="loading-shimmer h-24 rounded-lg"></div>
                <div class="loading-shimmer h-24 rounded-lg"></div>
                <div class="loading-shimmer h-24 rounded-lg"></div>
            </div>
        </div>

        <!-- Trailers -->
        <div id="trailersSection" class="mb-12 hidden">
            <h2 class="text-2xl font-bold mb-6">Trailers & Videos</h2>
            <div id="trailersContainer" class="scroll-container"></div>
        </div>

        <!-- Cast & Crew -->
        <div id="castSection" class="mb-12 hidden">
            <h2 class="text-2xl font-bold mb-6">Cast</h2>
            <div id="castContainer" class="scroll-container"></div>
        </div>

        <!-- Similar Content -->
        <div id="similarSection" class="mb-12 hidden">
            <h2 class="text-2xl font-bold mb-6">More Like This</h2>
            <div id="similarContainer" class="scroll-container"></div>
        </div>
    </main>

    <!-- Video Modal -->
    <div id="videoModal" class="hidden fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-4">
        <div class="relative w-full max-w-4xl">
            <button id="closeVideoModal" class="absolute -top-12 right-0 text-white text-xl">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
            <div id="videoContainer" class="aspect-video bg-black rounded-lg overflow-hidden"></div>
        </div>
    </div>

    <script>
        // Constants
        const API_BASE = 'https://backend-app-970m.onrender.com/api';
        
        // State
        let currentContent = null;
        let currentUser = window.currentUser;
        let authToken = window.authToken;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeEventListeners();
            loadContentDetails();
        });

        function initializeEventListeners() {
            // Video modal
            document.getElementById('closeVideoModal').addEventListener('click', closeVideoModal);
            
            // Close modal on escape
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeVideoModal();
                }
            });

            // Close modal on outside click
            document.getElementById('videoModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeVideoModal();
                }
            });
        }

        async function loadContentDetails() {
            const urlParams = new URLSearchParams(window.location.search);
            const contentId = urlParams.get('id');

            if (!contentId) {
                showError('Content not found');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/content/${contentId}`);
                const data = await response.json();

                if (response.ok) {
                    currentContent = data;
                    displayContentDetails(data);
                } else {
                    showError(data.error || 'Failed to load content details');
                }
            } catch (error) {
                console.error('Error loading content details:', error);
                showError('Failed to load content details');
            }
        }

        function displayContentDetails(content) {
            // Update hero section
            displayHeroSection(content);
            
            // Update main info
            displayMainInfo(content);
            
            // Update side info
            displaySideInfo(content);
            
            // Update OTT platforms
            displayOTTPlatforms(content.ott_platforms);
            
            // Update trailers
            if (content.trailers && content.trailers.length > 0) {
                displayTrailers(content.trailers);
            }
            
            // Update cast
            if (content.cast && content.cast.length > 0) {
                displayCast(content.cast);
            }
            
            // Update similar content
            if (content.similar_content && content.similar_content.length > 0) {
                displaySimilarContent(content.similar_content);
            }

            // Record view interaction
            recordInteraction('view');
        }

        function displayHeroSection(content) {
            const heroSection = document.getElementById('heroSection');
            const heroContent = document.getElementById('heroContent');

            // Set background image
            if (content.backdrop_path) {
                heroSection.style.backgroundImage = `url(${content.backdrop_path})`;
            }

            // Update hero content
            heroContent.innerHTML = `
                <div class="space-y-4">
                    <h1 class="text-4xl md:text-6xl font-bold">${content.title}</h1>
                    ${content.original_title && content.original_title !== content.title ? 
                        `<p class="text-lg text-gray-300">${content.original_title}</p>` : ''
                    }
                    <div class="flex items-center space-x-4 text-sm">
                        ${content.rating ? `
                            <span class="rating-stars flex items-center">
                                ${'★'.repeat(Math.floor(content.rating / 2))}${'☆'.repeat(5 - Math.floor(content.rating / 2))}
                                <span class="ml-1 text-white">${content.rating.toFixed(1)}</span>
                            </span>
                        ` : ''}
                        ${content.release_date ? `<span>${new Date(content.release_date).getFullYear()}</span>` : ''}
                        ${content.runtime ? `<span>${content.runtime} min</span>` : ''}
                        <span class="capitalize">${content.content_type}</span>
                    </div>
                    <div class="flex flex-wrap gap-2">
                        ${(content.genres || []).map(genre => `<span class="genre-tag">${genre}</span>`).join('')}
                    </div>
                    <p class="text-lg leading-relaxed max-w-2xl">${content.overview || 'No description available.'}</p>
                    <div class="flex flex-wrap gap-4 pt-4">
                        ${content.ott_platforms?.free_platforms?.length > 0 ? `
                            <a href="${content.ott_platforms.free_platforms[0].direct_url || '#'}" target="_blank" class="btn-primary">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"></path>
                                </svg>
                                Watch Free
                            </a>
                        ` : content.ott_platforms?.paid_platforms?.length > 0 ? `
                            <a href="${content.ott_platforms.paid_platforms[0].direct_url || '#'}" target="_blank" class="btn-primary">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"></path>
                                </svg>
                                Watch Now
                            </a>
                        ` : ''}
                        ${content.trailers && content.trailers.length > 0 ? `
                            <button class="btn-secondary" onclick="playTrailer('${content.trailers[0].url}')">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"></path>
                                </svg>
                                Watch Trailer
                            </button>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        function displayMainInfo(content) {
            document.getElementById('mainInfo').innerHTML = `
                <h2 class="text-2xl font-bold mb-4">About ${content.title}</h2>
                <div class="space-y-4">
                    <div>
                        <h3 class="font-semibold text-lg mb-2">Plot</h3>
                        <p class="text-gray-300 leading-relaxed">${content.overview || 'No plot information available.'}</p>
                    </div>
                    
                    ${content.languages && content.languages.length > 0 ? `
                        <div>
                            <h3 class="font-semibold text-lg mb-2">Languages</h3>
                            <div class="flex flex-wrap gap-2">
                                ${content.languages.map(lang => `<span class="genre-tag">${lang}</span>`).join('')}
                            </div>
                        </div>
                    ` : ''}
                    
                    ${content.vote_count ? `
                        <div>
                            <h3 class="font-semibold text-lg mb-2">User Ratings</h3>
                            <p class="text-gray-300">Based on ${content.vote_count.toLocaleString()} votes</p>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function displaySideInfo(content) {
            document.getElementById('sideInfo').innerHTML = `
                <h3 class="text-lg font-semibold mb-4">Details</h3>
                <div class="space-y-3 text-sm">
                    ${content.release_date ? `
                        <div class="flex justify-between">
                            <span class="text-gray-400">Release Date:</span>
                            <span>${new Date(content.release_date).toLocaleDateString()}</span>
                        </div>
                    ` : ''}
                    
                    ${content.runtime ? `
                        <div class="flex justify-between">
                            <span class="text-gray-400">Runtime:</span>
                            <span>${content.runtime} minutes</span>
                        </div>
                    ` : ''}
                    
                    <div class="flex justify-between">
                        <span class="text-gray-400">Type:</span>
                        <span class="capitalize">${content.content_type}</span>
                    </div>
                    
                    ${content.rating ? `
                        <div class="flex justify-between">
                            <span class="text-gray-400">Rating:</span>
                            <span>${content.rating.toFixed(1)}/10</span>
                        </div>
                    ` : ''}
                    
                    ${content.imdb_id ? `
                        <div class="pt-2">
                            <a href="https://www.imdb.com/title/${content.imdb_id}" target="_blank" class="text-red-500 hover:text-red-400">
                                View on IMDb →
                            </a>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function displayOTTPlatforms(ottData) {
            const container = document.getElementById('ottPlatforms');
            
            if (!ottData || (!ottData.free_platforms?.length && !ottData.paid_platforms?.length)) {
                container.innerHTML = `
                    <div class="col-span-full text-center py-8">
                        <p class="text-gray-400">No streaming information available</p>
                    </div>
                `;
                return;
            }

            let platformsHTML = '';

            // Free platforms first
            if (ottData.free_platforms?.length > 0) {
                platformsHTML += ottData.free_platforms.map(platform => `
                    <div class="ott-platform-card free" onclick="openPlatform('${platform.direct_url || platform.url}')">
                        <div class="text-green-500 text-sm font-semibold mb-2">FREE</div>
                        <div class="font-semibold">${platform.name}</div>
                        ${platform.audio_languages ? `
                            <div class="text-xs text-gray-400 mt-1">
                                Audio: ${platform.audio_languages.slice(0, 2).join(', ')}
                            </div>
                        ` : ''}
                    </div>
                `).join('');
            }

            // Paid platforms
            if (ottData.paid_platforms?.length > 0) {
                platformsHTML += ottData.paid_platforms.map(platform => `
                    <div class="ott-platform-card paid" onclick="openPlatform('${platform.direct_url || platform.url}')">
                        <div class="text-orange-500 text-sm font-semibold mb-2">PREMIUM</div>
                        <div class="font-semibold">${platform.name}</div>
                        ${platform.audio_languages ? `
                            <div class="text-xs text-gray-400 mt-1">
                                Audio: ${platform.audio_languages.slice(0, 2).join(', ')}
                            </div>
                        ` : ''}
                    </div>
                `).join('');
            }

            container.innerHTML = platformsHTML;
        }

        function displayTrailers(trailers) {
            const section = document.getElementById('trailersSection');
            const container = document.getElementById('trailersContainer');
            
            section.classList.remove('hidden');
            container.innerHTML = trailers.map(trailer => `
                <div class="trailer-thumbnail flex-shrink-0 w-80" onclick="playTrailer('${trailer.url}')">
                    <img src="${trailer.thumbnail}" alt="${trailer.title}" class="w-full h-48 object-cover rounded-lg">
                    <div class="play-button">▶</div>
                    <h3 class="mt-2 font-semibold text-sm">${trailer.title}</h3>
                </div>
            `).join('');
        }

        function displayCast(cast) {
            const section = document.getElementById('castSection');
            const container = document.getElementById('castContainer');
            
            section.classList.remove('hidden');
            container.innerHTML = cast.map(member => `
                <div class="cast-member">
                    <img src="${member.profile_path ? `https://image.tmdb.org/t/p/w185${member.profile_path}` : 'https://via.placeholder.com/120x120/333/fff?text=No+Photo'}" 
                         alt="${member.name}" class="cast-avatar">
                    <h3 class="font-semibold text-sm">${member.name}</h3>
                    <p class="text-xs text-gray-400">${member.character || member.job || ''}</p>
                </div>
            `).join('');
        }

        function displaySimilarContent(similarContent) {
            const section = document.getElementById('similarSection');
            const container = document.getElementById('similarContainer');
            
            section.classList.remove('hidden');
            container.innerHTML = similarContent.map(item => `
                <div class="similar-content-card" onclick="openContentDetails(${item.id})">
                    <img src="${item.poster_path || 'https://via.placeholder.com/300x450/333/fff?text=No+Image'}" 
                         alt="${item.title}" loading="lazy">
                    <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black to-transparent p-4">
                        <h3 class="font-bold text-sm">${item.title}</h3>
                        ${item.rating ? `<p class="text-xs text-gray-300">⭐ ${item.rating.toFixed(1)}</p>` : ''}
                    </div>
                </div>
            `).join('');
        }

        function playTrailer(url) {
            const modal = document.getElementById('videoModal');
            const container = document.getElementById('videoContainer');
            
            // Extract YouTube video ID
            const videoId = extractYouTubeId(url);
            
            if (videoId) {
                container.innerHTML = `
                    <iframe src="https://www.youtube.com/embed/${videoId}?autoplay=1" 
                            class="w-full h-full" 
                            frameborder="0" 
                            allow="autoplay; encrypted-media" 
                            allowfullscreen>
                    </iframe>
                `;
                modal.classList.remove('hidden');
            } else {
                // Fallback: open in new tab
                window.open(url, '_blank');
            }
        }

        function closeVideoModal() {
            const modal = document.getElementById('videoModal');
            const container = document.getElementById('videoContainer');
            
            modal.classList.add('hidden');
            container.innerHTML = '';
        }

        function extractYouTubeId(url) {
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
            const match = url.match(regExp);
            return (match && match[2].length === 11) ? match[2] : null;
        }

        function openPlatform(url) {
            if (url && url !== '#') {
                window.open(url, '_blank');
            }
        }

        function openContentDetails(contentId) {
            window.location.href = `details.html?id=${contentId}`;
        }

        async function addToWatchlist() {
            if (!currentUser || !authToken) {
                window.location.href = 'login.html?redirect=' + encodeURIComponent(window.location.href);
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/interactions`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        content_id: currentContent.id,
                        interaction_type: 'watchlist'
                    })
                });

                if (response.ok) {
                    showNotification('Added to watchlist!');
                    document.getElementById('addToWatchlistBtn').innerHTML = `
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                        </svg>
                        In Watchlist
                    `;
                    document.getElementById('addToWatchlistBtn').disabled = true;
                }
            } catch (error) {
                console.error('Failed to add to watchlist:', error);
                showNotification('Failed to add to watchlist');
            }
        }

        async function addToFavorites() {
            if (!currentUser || !authToken) {
                window.location.href = 'login.html?redirect=' + encodeURIComponent(window.location.href);
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/interactions`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        content_id: currentContent.id,
                        interaction_type: 'favorite'
                    })
                });

                if (response.ok) {
                    showNotification('Added to favorites!');
                    document.getElementById('addToFavoritesBtn').innerHTML = `
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                        </svg>
                        Favorited
                    `;
                    document.getElementById('addToFavoritesBtn').disabled = true;
                }
            } catch (error) {
                console.error('Failed to add to favorites:', error);
                showNotification('Failed to add to favorites');
            }
        }

        async function recordInteraction(type) {
            if (!currentUser || !authToken || !currentContent) return;

            try {
                await fetch(`${API_BASE}/interactions`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        content_id: currentContent.id,
                        interaction_type: type
                    })
                });
            } catch (error) {
                console.error('Failed to record interaction:', error);
            }
        }

        function shareContent() {
            if (navigator.share && currentContent) {
                navigator.share({
                    title: currentContent.title,
                    text: `Check out ${currentContent.title} on CineScope!`,
                    url: window.location.href
                });
            } else {
                // Fallback: copy to clipboard
                navigator.clipboard.writeText(window.location.href).then(() => {
                    showNotification('Link copied to clipboard!');
                });
            }
        }

        function goBack() {
            if (window.history.length > 1) {
                window.history.back();
            } else {
                window.location.href = 'index.html';
            }
        }

        function showError(message) {
            document.getElementById('heroContent').innerHTML = `
                <div class="text-center py-12">
                    <h1 class="text-4xl font-bold mb-4">Oops!</h1>
                    <p class="text-xl text-gray-300">${message}</p>
                    <button onclick="goBack()" class="btn-primary mt-6">Go Back</button>
                </div>
            `;
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'fixed top-20 right-4 bg-green-600 text-white px-4 py-2 rounded-lg z-50';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
    </script>
</body>
</html>
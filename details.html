<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">Movie Details - CineScope</title>
    <meta name="description" id="pageDescription" content="Detailed information about movies, TV shows, and anime on CineScope.">
    
    <link rel="icon" type="image/x-icon" href="/assets/favicon.ico">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/components.css">
    <link rel="stylesheet" href="/css/responsive.css">
</head>
<body>
    <!-- Preloader -->
    <div id="preloader" class="preloader">
        <div class="flex flex-col items-center">
            <div class="loader"></div>
            <p class="mt-4 text-lg font-medium">Loading Details...</p>
        </div>
    </div>

    <!-- Header -->
    <div id="header-placeholder"></div>

    <!-- Main Content -->
    <main>
        <!-- Hero Section with Backdrop -->
        <section id="contentHero" class="relative">
            <!-- Content will be populated by JavaScript -->
        </section>

        <!-- Content Details -->
        <div class="container py-8">
            <!-- Main Content Info -->
            <div class="grid grid-1 lg:grid-3 gap-8 mb-12">
                <!-- Poster and Actions -->
                <div class="lg:col-span-1">
                    <div class="sticky top-24">
                        <div id="posterContainer" class="mb-6">
                            <!-- Poster will be populated by JavaScript -->
                        </div>
                        
                        <!-- Action Buttons -->
                        <div id="actionButtons" class="space-y-3">
                            <!-- Buttons will be populated by JavaScript -->
                        </div>

                        <!-- Content Stats -->
                        <div id="contentStats" class="mt-6 space-y-3">
                            <!-- Stats will be populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Details and Description -->
                <div class="lg:col-span-2">
                    <div id="contentDetails">
                        <!-- Details will be populated by JavaScript -->
                    </div>

                    <!-- Tabs for additional content -->
                    <div class="tabs mt-8" id="contentTabs">
                        <div class="tab-list">
                            <button class="tab-button active" data-tab="overview">Overview</button>
                            <button class="tab-button" data-tab="cast">Cast & Crew</button>
                            <button class="tab-button" data-tab="reviews">Reviews</button>
                            <button class="tab-button" data-tab="media">Media</button>
                        </div>
                        <div class="tab-content">
                            <!-- Overview Tab -->
                            <div class="tab-panel active" data-panel="overview">
                                <div id="overviewContent">
                                    <!-- Overview content will be populated -->
                                </div>
                            </div>

                            <!-- Cast & Crew Tab -->
                            <div class="tab-panel" data-panel="cast">
                                <div id="castContent">
                                    <!-- Cast content will be populated -->
                                </div>
                            </div>

                            <!-- Reviews Tab -->
                            <div class="tab-panel" data-panel="reviews">
                                <div id="reviewsContent">
                                    <!-- Reviews content will be populated -->
                                </div>
                            </div>

                            <!-- Media Tab -->
                            <div class="tab-panel" data-panel="media">
                                <div id="mediaContent">
                                    <!-- Media content will be populated -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Similar Content -->
            <section class="section">
                <h2 class="section-title">More Like This</h2>
                <div class="content-grid" id="similarContent">
                    <!-- Similar content will be populated -->
                </div>
            </section>
        </div>
    </main>

    <!-- Footer -->
    <div id="footer-placeholder"></div>

    <!-- Rating Modal -->
    <div id="ratingModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Rate this content</h3>
                <button class="modal-close" onclick="closeRatingModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="text-center">
                    <div class="mb-4">
                        <img id="ratingModalPoster" src="" alt="" class="w-24 h-36 object-cover rounded mx-auto mb-4">
                        <h4 id="ratingModalTitle" class="text-lg font-semibold"></h4>
                    </div>
                    
                    <div class="mb-6">
                        <div class="flex justify-center gap-2 mb-4" id="starRating">
                            <!-- Stars will be generated by JavaScript -->
                        </div>
                        <p class="text-sm text-gray-400">Click a star to rate</p>
                    </div>
                    
                    <div class="flex justify-center gap-4">
                        <button class="btn btn-secondary" onclick="closeRatingModal()">Cancel</button>
                        <button class="btn btn-primary" onclick="submitRating()" id="submitRatingBtn" disabled>Submit Rating</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="/js/include.js"></script>
    <script src="/js/main.js"></script>
    <script>
        let currentContent = null;
        let currentRating = 0;

        document.addEventListener('DOMContentLoaded', async () => {
            const urlParams = Utils.getURLParams();
            const contentId = urlParams.id;

            if (!contentId) {
                window.location.href = '/';
                return;
            }

            await loadContentDetails(contentId);
        });

        async function loadContentDetails(contentId) {
            try {
                const response = await api.getContent(contentId);
                currentContent = response;

                updatePageMeta(response);
                renderContentHero(response);
                renderContentDetails(response);
                renderContentTabs(response);
                renderActionButtons(response);
                renderContentStats(response);

                // Initialize tabs
                UI.initTabs(document.getElementById('contentTabs'));

                // Load similar content
                loadSimilarContent(contentId);

                // Record view interaction
                if (appState.isAuthenticated()) {
                    contentManager.recordInteraction(contentId, 'view');
                }

            } catch (error) {
                console.error('Error loading content details:', error);
                document.body.innerHTML = `
                    <div class="container mx-auto px-4 py-20 text-center">
                        <h1 class="text-4xl font-bold text-red-400 mb-4">Content Not Found</h1>
                        <p class="text-gray-400 mb-8">The content you're looking for doesn't exist or has been removed.</p>
                        <a href="/" class="btn btn-primary">Go Home</a>
                    </div>
                `;
            }
        }

        function updatePageMeta(content) {
            document.getElementById('pageTitle').textContent = `${content.title} - CineScope`;
            document.getElementById('pageDescription').content = `${content.title} - ${Utils.truncateText(content.overview, 150)}`;
        }

        function renderContentHero(content) {
            const heroContainer = document.getElementById('contentHero');
            const backdropUrl = content.backdrop_path || content.poster_path || Utils.getPlaceholderImage(1920, 800);

            heroContainer.innerHTML = `
                <div class="relative h-96 md:h-[500px] overflow-hidden">
                    <img src="${backdropUrl}" alt="${Utils.sanitizeHTML(content.title)}" 
                         class="w-full h-full object-cover" 
                         onerror="this.src='${Utils.getPlaceholderImage(1920, 800)}'">
                    <div class="absolute inset-0 bg-gradient-to-t from-black via-black/50 to-transparent"></div>
                    
                    <div class="absolute bottom-0 left-0 right-0 p-8">
                        <div class="container">
                            <div class="max-w-4xl">
                                <h1 class="text-4xl md:text-6xl font-bold text-white mb-4">
                                    ${Utils.sanitizeHTML(content.title)}
                                </h1>
                                ${content.original_title && content.original_title !== content.title ? 
                                    `<p class="text-xl text-gray-300 mb-4">${Utils.sanitizeHTML(content.original_title)}</p>` : ''
                                }
                                <div class="flex flex-wrap items-center gap-4 mb-6">
                                    ${content.rating ? `
                                        <div class="flex items-center gap-2">
                                            <span class="text-yellow-400">⭐</span>
                                            <span class="text-lg font-semibold">${Utils.formatRating(content.rating)}</span>
                                            ${content.vote_count ? `<span class="text-gray-400">(${content.vote_count.toLocaleString()} votes)</span>` : ''}
                                        </div>
                                    ` : ''}
                                    ${content.release_date ? `
                                        <span class="text-gray-300">${Utils.formatDate(content.release_date)}</span>
                                    ` : ''}
                                    ${content.runtime ? `
                                        <span class="text-gray-300">${Utils.formatRuntime(content.runtime)}</span>
                                    ` : ''}
                                    <span class="badge badge-primary">${content.content_type.toUpperCase()}</span>
                                </div>
                                
                                ${content.overview ? `
                                    <p class="text-lg text-gray-200 mb-6 max-w-3xl leading-relaxed">
                                        ${Utils.truncateText(content.overview, 300)}
                                    </p>
                                ` : ''}
                                
                                <div class="flex flex-wrap gap-4">
                                    ${content.youtube_trailer ? `
                                        <a href="${content.youtube_trailer}" target="_blank" class="btn btn-primary btn-lg">
                                            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M8 5v14l11-7z"/>
                                            </svg>
                                            Watch Trailer
                                        </a>
                                    ` : ''}
                                    
                                    <button class="btn btn-secondary btn-lg" onclick="addToWatchlist(${content.id})">
                                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                        </svg>
                                        Add to Watchlist
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderContentDetails(content) {
            const detailsContainer = document.getElementById('contentDetails');
            
            const genres = content.genres || [];
            const languages = content.languages || [];

            detailsContainer.innerHTML = `
                <div class="space-y-6">
                    <!-- Genres -->
                    ${genres.length > 0 ? `
                        <div>
                            <h3 class="text-lg font-semibold mb-3">Genres</h3>
                            <div class="flex flex-wrap gap-2">
                                ${genres.map(genre => `
                                    <a href="/categories/genre/${genre.toLowerCase()}" class="badge badge-secondary">
                                        ${Utils.sanitizeHTML(genre)}
                                    </a>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}

                    <!-- Languages -->
                    ${languages.length > 0 ? `
                        <div>
                            <h3 class="text-lg font-semibold mb-3">Languages</h3>
                            <div class="flex flex-wrap gap-2">
                                ${languages.map(lang => `
                                    <span class="badge badge-ghost">${Utils.sanitizeHTML(lang)}</span>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}

                    <!-- Special Badges -->
                    <div class="flex flex-wrap gap-2">
                        ${content.is_trending ? '<span class="badge badge-warning">🔥 Trending</span>' : ''}
                        ${content.is_new_release ? '<span class="badge badge-success">🆕 New Release</span>' : ''}
                        ${content.is_critics_choice ? '<span class="badge badge-primary">🏆 Critics\' Choice</span>' : ''}
                    </div>
                </div>
            `;
        }

        function renderContentTabs(content) {
            // Overview Tab
            document.getElementById('overviewContent').innerHTML = `
                <div class="prose prose-invert max-w-none">
                    ${content.overview ? `
                        <h3>Synopsis</h3>
                        <p>${content.overview}</p>
                    ` : '<p class="text-gray-400">No synopsis available.</p>'}
                </div>
            `;

            // Cast Tab
            renderCastContent(content.cast || [], content.crew || []);

            // Reviews Tab
            renderReviewsContent();

            // Media Tab
            renderMediaContent(content);
        }

        function renderCastContent(cast, crew) {
            const castContainer = document.getElementById('castContent');
            
            let html = '';

            // Cast
            if (cast.length > 0) {
                html += `
                    <div class="mb-8">
                        <h3 class="text-xl font-semibold mb-4">Cast</h3>
                        <div class="grid grid-2 md:grid-4 lg:grid-6 gap-4">
                            ${cast.slice(0, 12).map(person => `
                                <div class="card">
                                    <div class="aspect-square bg-gray-800 rounded-t-lg overflow-hidden">
                                        ${person.profile_path ? `
                                            <img src="https://image.tmdb.org/t/p/w200${person.profile_path}" 
                                                 alt="${Utils.sanitizeHTML(person.name)}" 
                                                 class="w-full h-full object-cover">
                                        ` : `
                                            <div class="w-full h-full flex items-center justify-center text-gray-500">
                                                <svg class="w-12 h-12" fill="currentColor" viewBox="0 0 24 24">
                                                    <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                                                </svg>
                                            </div>
                                        `}
                                    </div>
                                    <div class="p-3">
                                        <h4 class="font-semibold text-sm">${Utils.sanitizeHTML(person.name)}</h4>
                                        ${person.character ? `
                                            <p class="text-xs text-gray-400">${Utils.sanitizeHTML(person.character)}</p>
                                        ` : ''}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            // Crew
            if (crew.length > 0) {
                const keyCrewJobs = ['Director', 'Producer', 'Writer', 'Screenplay', 'Music', 'Cinematography'];
                const keyCrew = crew.filter(person => keyCrewJobs.includes(person.job));

                if (keyCrew.length > 0) {
                    html += `
                        <div>
                            <h3 class="text-xl font-semibold mb-4">Key Crew</h3>
                            <div class="grid grid-1 md:grid-2 gap-4">
                                ${keyCrew.map(person => `
                                    <div class="flex items-center gap-3 p-3 bg-gray-800 rounded-lg">
                                        <div class="w-12 h-12 bg-gray-700 rounded-full flex items-center justify-center">
                                            <svg class="w-6 h-6 text-gray-400" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                                            </svg>
                                        </div>
                                        <div>
                                            <h4 class="font-semibold">${Utils.sanitizeHTML(person.name)}</h4>
                                            <p class="text-sm text-gray-400">${Utils.sanitizeHTML(person.job)}</p>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }
            }

            if (!html) {
                html = '<div class="text-center text-gray-400 py-8">No cast and crew information available.</div>';
            }

            castContainer.innerHTML = html;
        }

        function renderReviewsContent() {
            const reviewsContainer = document.getElementById('reviewsContent');
            
            // Placeholder for reviews (integrate with actual review system)
            reviewsContainer.innerHTML = `
                <div class="space-y-6">
                    <div class="flex justify-between items-center">
                        <h3 class="text-xl font-semibold">User Reviews</h3>
                        <button class="btn btn-primary btn-sm" onclick="writeReview()">Write Review</button>
                    </div>
                    
                    <div class="text-center text-gray-400 py-8">
                        <div class="text-4xl mb-4">📝</div>
                        <h4 class="text-lg font-semibold mb-2">No reviews yet</h4>
                        <p>Be the first to review this content!</p>
                    </div>
                </div>
            `;
        }

        function renderMediaContent(content) {
            const mediaContainer = document.getElementById('mediaContent');
            
            let html = '';

            // Trailer
            if (content.youtube_trailer) {
                html += `
                    <div class="mb-8">
                        <h3 class="text-xl font-semibold mb-4">Trailer</h3>
                        <div class="aspect-video bg-gray-800 rounded-lg overflow-hidden">
                            <iframe src="https://www.youtube.com/embed/${getYouTubeId(content.youtube_trailer)}" 
                                    class="w-full h-full" 
                                    frameborder="0" 
                                    allowfullscreen></iframe>
                        </div>
                    </div>
                `;
            }

            // Posters and Backdrops
            html += `
                <div>
                    <h3 class="text-xl font-semibold mb-4">Images</h3>
                    <div class="grid grid-2 md:grid-4 gap-4">
                        ${content.poster_path ? `
                            <div class="aspect-[2/3] bg-gray-800 rounded-lg overflow-hidden">
                                <img src="${content.poster_path}" alt="Poster" class="w-full h-full object-cover">
                            </div>
                        ` : ''}
                        ${content.backdrop_path ? `
                            <div class="aspect-video bg-gray-800 rounded-lg overflow-hidden md:col-span-2">
                                <img src="${content.backdrop_path}" alt="Backdrop" class="w-full h-full object-cover">
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;

            if (!html) {
                html = '<div class="text-center text-gray-400 py-8">No media available.</div>';
            }

            mediaContainer.innerHTML = html;
        }

        function renderActionButtons(content) {
            const buttonsContainer = document.getElementById('actionButtons');
            
            buttonsContainer.innerHTML = `
                <div class="space-y-3">
                    <button class="btn btn-primary w-full" onclick="addToWatchlist(${content.id})" id="watchlistBtn">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                        </svg>
                        Add to Watchlist
                    </button>
                    
                    <button class="btn btn-secondary w-full" onclick="addToFavorites(${content.id})" id="favoriteBtn">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                        </svg>
                        Add to Favorites
                    </button>
                    
                    <button class="btn btn-ghost w-full" onclick="openRatingModal()" id="rateBtn">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path>
                        </svg>
                        Rate This
                    </button>
                    
                    <button class="btn btn-ghost w-full" onclick="shareContent()">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"></path>
                        </svg>
                        Share
                    </button>
                </div>
            `;
        }

        function renderContentStats(content) {
            const statsContainer = document.getElementById('contentStats');
            
            statsContainer.innerHTML = `
                <div class="card">
                    <div class="card-content">
                        <h3 class="font-semibold mb-4">Information</h3>
                        <div class="space-y-3 text-sm">
                            ${content.release_date ? `
                                <div class="flex justify-between">
                                    <span class="text-gray-400">Release Date</span>
                                    <span>${new Date(content.release_date).toLocaleDateString()}</span>
                                </div>
                            ` : ''}
                            
                            ${content.runtime ? `
                                <div class="flex justify-between">
                                    <span class="text-gray-400">Runtime</span>
                                    <span>${Utils.formatRuntime(content.runtime)}</span>
                                </div>
                            ` : ''}
                            
                            ${content.rating ? `
                                <div class="flex justify-between">
                                    <span class="text-gray-400">Rating</span>
                                    <span>${Utils.formatRating(content.rating)}/10</span>
                                </div>
                            ` : ''}
                            
                            ${content.content_type ? `
                                <div class="flex justify-between">
                                    <span class="text-gray-400">Type</span>
                                    <span class="capitalize">${content.content_type}</span>
                                </div>
                            ` : ''}
                            
                            ${content.vote_count ? `
                                <div class="flex justify-between">
                                    <span class="text-gray-400">Votes</span>
                                    <span>${content.vote_count.toLocaleString()}</span>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `;
        }

        async function loadSimilarContent(contentId) {
            const container = document.getElementById('similarContent');
            
            try {
                UI.showSkeleton(container, 6);
                const response = await api.getSimilarContent(contentId, 12);
                contentManager.renderMovieGrid(container, response);
            } catch (error) {
                console.error('Error loading similar content:', error);
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">🔍</div>
                        <h3 class="empty-state-title">No similar content found</h3>
                        <p class="empty-state-description">Try exploring other categories.</p>
                    </div>
                `;
            }
        }

        async function addToWatchlist(contentId) {
            if (!appState.isAuthenticated()) {
                UI.showToast('Please sign in to add to watchlist', 'warning');
                setTimeout(() => window.location.href = '/login', 2000);
                return;
            }

            try {
                await contentManager.recordInteraction(contentId, 'watchlist');
                UI.showToast('Added to watchlist!', 'success');
                
                const btn = document.getElementById('watchlistBtn');
                btn.innerHTML = `
                    <svg class="w-4 h-4 mr-2" fill="currentColor" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    In Watchlist
                `;
                btn.disabled = true;
                btn.classList.remove('btn-primary');
                btn.classList.add('btn-ghost');
                
            } catch (error) {
                UI.showToast('Failed to add to watchlist', 'error');
            }
        }

        async function addToFavorites(contentId) {
            if (!appState.isAuthenticated()) {
                UI.showToast('Please sign in to add to favorites', 'warning');
                setTimeout(() => window.location.href = '/login', 2000);
                return;
            }

            try {
                await contentManager.recordInteraction(contentId, 'favorite');
                UI.showToast('Added to favorites!', 'success');
                
                const btn = document.getElementById('favoriteBtn');
                btn.innerHTML = `
                    <svg class="w-4 h-4 mr-2" fill="currentColor" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                    </svg>
                    In Favorites
                `;
                btn.disabled = true;
                btn.classList.remove('btn-secondary');
                btn.classList.add('btn-ghost');
                
            } catch (error) {
                UI.showToast('Failed to add to favorites', 'error');
            }
        }

        function openRatingModal() {
            if (!appState.isAuthenticated()) {
                UI.showToast('Please sign in to rate content', 'warning');
                setTimeout(() => window.location.href = '/login', 2000);
                return;
            }

            const modal = document.getElementById('ratingModal');
            document.getElementById('ratingModalTitle').textContent = currentContent.title;
            document.getElementById('ratingModalPoster').src = currentContent.poster_path || Utils.getPlaceholderImage(100, 150);
            
            // Generate star rating
            const starContainer = document.getElementById('starRating');
            starContainer.innerHTML = '';
            for (let i = 1; i <= 10; i++) {
                const star = document.createElement('button');
                star.className = 'text-2xl text-gray-600 hover:text-yellow-400 transition-colors';
                star.innerHTML = '★';
                star.onclick = () => setRating(i);
                starContainer.appendChild(star);
            }
            
            modal.classList.add('show');
        }

        function closeRatingModal() {
            const modal = document.getElementById('ratingModal');
            modal.classList.remove('show');
            currentRating = 0;
            document.getElementById('submitRatingBtn').disabled = true;
        }

        function setRating(rating) {
            currentRating = rating;
            const stars = document.querySelectorAll('#starRating button');
            
            stars.forEach((star, index) => {
                if (index < rating) {
                    star.classList.remove('text-gray-600');
                    star.classList.add('text-yellow-400');
                } else {
                    star.classList.remove('text-yellow-400');
                    star.classList.add('text-gray-600');
                }
            });
            
            document.getElementById('submitRatingBtn').disabled = false;
        }

        async function submitRating() {
            if (!currentRating) return;

            try {
                await contentManager.recordInteraction(currentContent.id, 'rating', currentRating);
                UI.showToast(`Rated ${currentRating}/10!`, 'success');
                closeRatingModal();
                
            } catch (error) {
                UI.showToast('Failed to submit rating', 'error');
            }
        }

        function shareContent() {
            const shareData = {
                title: currentContent.title,
                text: `Check out ${currentContent.title} on CineScope!`,
                url: window.location.href
            };

            if (navigator.share) {
                navigator.share(shareData);
            } else {
                // Fallback to copying URL
                Utils.copyToClipboard(window.location.href).then(() => {
                    UI.showToast('Link copied to clipboard!', 'success');
                });
            }
        }

        function writeReview() {
            if (!appState.isAuthenticated()) {
                UI.showToast('Please sign in to write a review', 'warning');
                setTimeout(() => window.location.href = '/login', 2000);
                return;
            }

            UI.showModal(`
                <div>
                    <h3 class="text-xl font-semibold mb-4">Write a Review</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="form-label">Rating</label>
                            <div class="flex gap-1 mb-4" id="reviewStars">
                                ${Array(5).fill(0).map((_, i) => `
                                    <button class="text-2xl text-gray-600 hover:text-yellow-400 transition-colors" 
                                            onclick="setReviewRating(${i + 1})">★</button>
                                `).join('')}
                            </div>
                        </div>
                        <div>
                            <label class="form-label">Review</label>
                            <textarea class="form-input h-32" placeholder="Write your review here..." id="reviewText"></textarea>
                        </div>
                        <div class="flex justify-end gap-4">
                            <button class="btn btn-secondary" onclick="UI.hideModal(this.closest('.modal-overlay'))">Cancel</button>
                            <button class="btn btn-primary" onclick="submitReview()">Submit Review</button>
                        </div>
                    </div>
                </div>
            `, 'Write Review');
        }

        function getYouTubeId(url) {
            const match = url.match(/(?:youtu\.be\/|youtube\.com\/(?:embed\/|watch\?v=))([^&\n?#]+)/);
            return match ? match[1] : '';
        }

        // Click outside modal to close
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal-overlay')) {
                e.target.classList.remove('show');
            }
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Profile - CineStream</title>
    
    <!-- CSS Frameworks -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/components.css">
    <link rel="stylesheet" href="../css/pages.css">
</head>
<body class="bg-netflix-dark text-white">
    <!-- Header -->
    <header id="main-header" class="sticky-header"></header>

    <!-- Main Content -->
    <main class="main-content pt-20">
        <div class="container mx-auto px-4 py-8">
            <!-- Profile Header -->
            <section class="profile-header mb-8">
                <div class="profile-banner">
                    <div class="profile-info">
                        <div class="avatar-section">
                            <div class="user-avatar-large" id="user-avatar">
                                <i class="fas fa-user"></i>
                            </div>
                            <button class="btn-secondary btn-sm change-avatar-btn" id="change-avatar-btn">
                                <i class="fas fa-camera"></i> Change
                            </button>
                        </div>
                        
                        <div class="user-details">
                            <h1 class="username" id="username">Loading...</h1>
                            <p class="user-email" id="user-email">Loading...</p>
                            <div class="user-stats">
                                <div class="stat-item">
                                    <span class="stat-number" id="favorites-count">0</span>
                                    <span class="stat-label">Favorites</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-number" id="watchlist-count">0</span>
                                    <span class="stat-label">Watchlist</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-number" id="reviews-count">0</span>
                                    <span class="stat-label">Reviews</span>
                                </div>
                            </div>
                            <div class="user-badges" id="user-badges">
                                <!-- Badges will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Profile Navigation -->
            <section class="profile-navigation mb-6">
                <div class="nav-tabs">
                    <button class="tab-btn active" data-tab="overview">
                        <i class="fas fa-chart-bar"></i> Overview
                    </button>
                    <button class="tab-btn" data-tab="preferences">
                        <i class="fas fa-cog"></i> Preferences
                    </button>
                    <button class="tab-btn" data-tab="activity">
                        <i class="fas fa-history"></i> Activity
                    </button>
                    <button class="tab-btn" data-tab="privacy">
                        <i class="fas fa-shield-alt"></i> Privacy
                    </button>
                    <button class="tab-btn" data-tab="account">
                        <i class="fas fa-user-cog"></i> Account
                    </button>
                </div>
            </section>

            <!-- Tab Content -->
            <div class="tab-content">
                <!-- Overview Tab -->
                <div class="tab-pane active" id="overview-tab">
                    <div class="row">
                        <!-- Viewing Stats -->
                        <div class="col-lg-6 mb-4">
                            <div class="profile-card">
                                <h3 class="card-title">
                                    <i class="fas fa-chart-line text-netflix-red"></i>
                                    Viewing Statistics
                                </h3>
                                <div class="stats-grid">
                                    <div class="stat-card">
                                        <h4 id="total-watched">0</h4>
                                        <p>Total Watched</p>
                                    </div>
                                    <div class="stat-card">
                                        <h4 id="watch-time">0h</h4>
                                        <p>Watch Time</p>
                                    </div>
                                    <div class="stat-card">
                                        <h4 id="avg-rating">0.0</h4>
                                        <p>Avg Rating</p>
                                    </div>
                                    <div class="stat-card">
                                        <h4 id="streak-days">0</h4>
                                        <p>Day Streak</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Favorite Genres -->
                        <div class="col-lg-6 mb-4">
                            <div class="profile-card">
                                <h3 class="card-title">
                                    <i class="fas fa-heart text-netflix-red"></i>
                                    Favorite Genres
                                </h3>
                                <div class="genre-chart" id="genre-chart">
                                    <!-- Genre chart will be rendered here -->
                                </div>
                            </div>
                        </div>

                        <!-- Recent Activity -->
                        <div class="col-12 mb-4">
                            <div class="profile-card">
                                <h3 class="card-title">
                                    <i class="fas fa-clock text-netflix-red"></i>
                                    Recent Activity
                                </h3>
                                <div class="activity-list" id="recent-activity">
                                    <!-- Recent activity will be loaded here -->
                                </div>
                            </div>
                        </div>

                        <!-- Achievements -->
                        <div class="col-12 mb-4">
                            <div class="profile-card">
                                <h3 class="card-title">
                                    <i class="fas fa-trophy text-netflix-red"></i>
                                    Achievements
                                </h3>
                                <div class="achievements-grid" id="achievements-grid">
                                    <!-- Achievements will be loaded here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Preferences Tab -->
                <div class="tab-pane" id="preferences-tab">
                    <div class="profile-card">
                        <h3 class="card-title">
                            <i class="fas fa-sliders-h text-netflix-red"></i>
                            Content Preferences
                        </h3>
                        
                        <form class="preferences-form" id="preferences-form">
                            <!-- Genre Preferences -->
                            <div class="form-section">
                                <h4>Favorite Genres</h4>
                                <p class="form-description">Select your preferred genres to get better recommendations</p>
                                <div class="genre-selection" id="genre-preferences">
                                    <!-- Genre checkboxes will be generated here -->
                                </div>
                            </div>

                            <!-- Language Preferences -->
                            <div class="form-section">
                                <h4>Language Preferences</h4>
                                <div class="language-selection">
                                    <div class="form-group">
                                        <label>Primary Language</label>
                                        <select class="form-control" id="primary-language">
                                            <option value="en">English</option>
                                            <option value="hi">Hindi</option>
                                            <option value="te">Telugu</option>
                                            <option value="ta">Tamil</option>
                                            <option value="kn">Kannada</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Additional Languages</label>
                                        <div class="checkbox-group" id="additional-languages">
                                            <!-- Language checkboxes -->
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Content Type Preferences -->
                            <div class="form-section">
                                <h4>Content Types</h4>
                                <div class="content-type-selection">
                                    <label class="checkbox-card">
                                        <input type="checkbox" name="content_types" value="movie" checked>
                                        <div class="card-content">
                                            <i class="fas fa-film"></i>
                                            <span>Movies</span>
                                        </div>
                                    </label>
                                    <label class="checkbox-card">
                                        <input type="checkbox" name="content_types" value="tv" checked>
                                        <div class="card-content">
                                            <i class="fas fa-tv"></i>
                                            <span>TV Shows</span>
                                        </div>
                                    </label>
                                    <label class="checkbox-card">
                                        <input type="checkbox" name="content_types" value="anime">
                                        <div class="card-content">
                                            <i class="fas fa-dragon"></i>
                                            <span>Anime</span>
                                        </div>
                                    </label>
                                </div>
                            </div>

                            <!-- Notification Preferences -->
                            <div class="form-section">
                                <h4>Notifications</h4>
                                <div class="notification-settings">
                                    <label class="switch-label">
                                        <input type="checkbox" class="switch-input" id="email-notifications">
                                        <span class="switch-slider"></span>
                                        <span class="switch-text">Email Notifications</span>
                                    </label>
                                    <label class="switch-label">
                                        <input type="checkbox" class="switch-input" id="push-notifications">
                                        <span class="switch-slider"></span>
                                        <span class="switch-text">Push Notifications</span>
                                    </label>
                                    <label class="switch-label">
                                        <input type="checkbox" class="switch-input" id="recommendation-emails">
                                        <span class="switch-slider"></span>
                                        <span class="switch-text">Weekly Recommendations</span>
                                    </label>
                                </div>
                            </div>

                            <div class="form-actions">
                                <button type="submit" class="btn-primary">
                                    <i class="fas fa-save"></i> Save Preferences
                                </button>
                                <button type="button" class="btn-secondary" id="reset-preferences">
                                    <i class="fas fa-undo"></i> Reset to Default
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Activity Tab -->
                <div class="tab-pane" id="activity-tab">
                    <div class="profile-card">
                        <h3 class="card-title">
                            <i class="fas fa-list text-netflix-red"></i>
                            Activity History
                        </h3>
                        
                        <div class="activity-filters mb-4">
                            <div class="filter-group">
                                <label>Filter by Type:</label>
                                <select class="filter-select" id="activity-type-filter">
                                    <option value="">All Activity</option>
                                    <option value="view">Views</option>
                                    <option value="favorite">Favorites</option>
                                    <option value="rating">Ratings</option>
                                    <option value="watchlist">Watchlist</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>Time Period:</label>
                                <select class="filter-select" id="activity-period-filter">
                                    <option value="week">Last Week</option>
                                    <option value="month">Last Month</option>
                                    <option value="year">Last Year</option>
                                    <option value="all">All Time</option>
                                </select>
                            </div>
                        </div>

                        <div class="activity-timeline" id="activity-timeline">
                            <!-- Activity timeline will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Privacy Tab -->
                <div class="tab-pane" id="privacy-tab">
                    <div class="profile-card">
                        <h3 class="card-title">
                            <i class="fas fa-user-shield text-netflix-red"></i>
                            Privacy Settings
                        </h3>
                        
                        <form class="privacy-form" id="privacy-form">
                            <div class="form-section">
                                <h4>Profile Visibility</h4>
                                <div class="privacy-options">
                                    <label class="radio-card">
                                        <input type="radio" name="profile_visibility" value="public">
                                        <div class="card-content">
                                            <h5>Public</h5>
                                            <p>Anyone can see your profile and activity</p>
                                        </div>
                                    </label>
                                    <label class="radio-card">
                                        <input type="radio" name="profile_visibility" value="friends" checked>
                                        <div class="card-content">
                                            <h5>Friends Only</h5>
                                            <p>Only your friends can see your profile</p>
                                        </div>
                                    </label>
                                    <label class="radio-card">
                                        <input type="radio" name="profile_visibility" value="private">
                                        <div class="card-content">
                                            <h5>Private</h5>
                                            <p>Your profile is completely private</p>
                                        </div>
                                    </label>
                                </div>
                            </div>

                            <div class="form-section">
                                <h4>Data Sharing</h4>
                                <div class="privacy-switches">
                                    <label class="switch-label">
                                        <input type="checkbox" class="switch-input" id="share-viewing-data">
                                        <span class="switch-slider"></span>
                                        <span class="switch-text">Share viewing data for recommendations</span>
                                    </label>
                                    <label class="switch-label">
                                        <input type="checkbox" class="switch-input" id="share-ratings">
                                        <span class="switch-slider"></span>
                                        <span class="switch-text">Share ratings publicly</span>
                                    </label>
                                    <label class="switch-label">
                                        <input type="checkbox" class="switch-input" id="allow-friend-requests">
                                        <span class="switch-slider"></span>
                                        <span class="switch-text">Allow friend requests</span>
                                    </label>
                                </div>
                            </div>

                            <div class="form-actions">
                                <button type="submit" class="btn-primary">
                                    <i class="fas fa-shield-alt"></i> Update Privacy Settings
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Account Tab -->
                <div class="tab-pane" id="account-tab">
                    <div class="row">
                        <!-- Account Information -->
                        <div class="col-lg-6 mb-4">
                            <div class="profile-card">
                                <h3 class="card-title">
                                    <i class="fas fa-user-edit text-netflix-red"></i>
                                    Account Information
                                </h3>
                                
                                <form class="account-form" id="account-form">
                                    <div class="form-group">
                                        <label for="edit-username">Username</label>
                                        <input type="text" class="form-control" id="edit-username" required>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="edit-email">Email</label>
                                        <input type="email" class="form-control" id="edit-email" required>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="edit-bio">Bio</label>
                                        <textarea class="form-control" id="edit-bio" rows="3" placeholder="Tell us about yourself..."></textarea>
                                    </div>
                                    
                                    <button type="submit" class="btn-primary">
                                        <i class="fas fa-save"></i> Update Information
                                    </button>
                                </form>
                            </div>
                        </div>

                        <!-- Change Password -->
                        <div class="col-lg-6 mb-4">
                            <div class="profile-card">
                                <h3 class="card-title">
                                    <i class="fas fa-key text-netflix-red"></i>
                                    Change Password
                                </h3>
                                
                                <form class="password-form" id="password-form">
                                    <div class="form-group">
                                        <label for="current-password">Current Password</label>
                                        <input type="password" class="form-control" id="current-password" required>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="new-password">New Password</label>
                                        <input type="password" class="form-control" id="new-password" required>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="confirm-password">Confirm New Password</label>
                                        <input type="password" class="form-control" id="confirm-password" required>
                                    </div>
                                    
                                    <button type="submit" class="btn-primary">
                                        <i class="fas fa-lock"></i> Change Password
                                    </button>
                                </form>
                            </div>
                        </div>

                        <!-- Account Actions -->
                        <div class="col-12">
                            <div class="profile-card">
                                <h3 class="card-title">
                                    <i class="fas fa-exclamation-triangle text-netflix-red"></i>
                                    Account Actions
                                </h3>
                                
                                <div class="account-actions">
                                    <div class="action-item">
                                        <div class="action-info">
                                            <h4>Export Data</h4>
                                            <p>Download all your account data and activity</p>
                                        </div>
                                        <button class="btn-secondary" id="export-data-btn">
                                            <i class="fas fa-download"></i> Export
                                        </button>
                                    </div>
                                    
                                    <div class="action-item">
                                        <div class="action-info">
                                            <h4>Deactivate Account</h4>
                                            <p>Temporarily disable your account</p>
                                        </div>
                                        <button class="btn-warning" id="deactivate-btn">
                                            <i class="fas fa-pause"></i> Deactivate
                                        </button>
                                    </div>
                                    
                                    <div class="action-item">
                                        <div class="action-info">
                                            <h4>Delete Account</h4>
                                            <p>Permanently delete your account and all data</p>
                                        </div>
                                        <button class="btn-danger" id="delete-account-btn">
                                            <i class="fas fa-trash"></i> Delete
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Bottom Navigation (Mobile) -->
    <nav id="bottom-nav" class="bottom-navigation d-md-none"></nav>

    <!-- Modal Container -->
    <div id="modal-container"></div>

    <!-- Avatar Upload Modal -->
    <div class="modal" id="avatar-modal">
        <div class="modal-content">
            <h3>Change Profile Picture</h3>
            <div class="avatar-options">
                <input type="file" id="avatar-upload" accept="image/*" style="display: none;">
                <button class="btn-primary" onclick="document.getElementById('avatar-upload').click()">
                    <i class="fas fa-upload"></i> Upload Image
                </button>
                <div class="avatar-presets">
                    <!-- Avatar preset options -->
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../js/services/storage.js"></script>
    <script src="../js/services/auth.js"></script>
    <script src="../js/services/api.js"></script>
    <script src="../js/components/header.js"></script>
    <script src="../js/components/movieCard.js"></script>
    <script src="../js/components/modal.js"></script>
    <script src="../js/components/bottomNav.js"></script>
    <script src="../js/pages/profile.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            // Check authentication
            const token = localStorage.getItem('cinestream_token');
            if (!token) {
                window.location.href = '../pages/login.html?redirect=profile';
                return;
            }

            // Initialize services
            window.storageService = new StorageService();
            window.authService = new AuthService();
            window.apiService = new APIService();

            // Initialize components
            new HeaderComponent();
            new BottomNavComponent();
            window.modalComponent = new ModalComponent();

            // Initialize profile page
            window.profileController = new ProfilePageController();
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Favorites - CineScope</title>
    
    <!-- Stylesheets -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="../css/main.css" rel="stylesheet">
    <link href="../css/components.css" rel="stylesheet">
    <link href="../css/responsive.css" rel="stylesheet">
</head>
<body class="bg-dark text-light">
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-container">
            <div class="loading-logo">
                <i class="fas fa-film"></i>
                <span>CineScope</span>
            </div>
            <div class="loading-spinner"></div>
            <div class="loading-text">Loading your favorites...</div>
        </div>
    </div>

    <!-- Header -->
    <div id="headerContainer"></div>

    <!-- Main Content -->
    <main class="main-content favorites-content">
        <!-- Favorites Header -->
        <section class="favorites-header">
            <div class="container">
                <div class="favorites-header-content">
                    <div class="breadcrumb-nav">
                        <nav class="breadcrumb">
                            <span class="breadcrumb-item"><a href="/">Home</a></span>
                            <span class="breadcrumb-item"><a href="/dashboard">Dashboard</a></span>
                            <span class="breadcrumb-item active">My Favorites</span>
                        </nav>
                    </div>
                    <h1 class="favorites-title">
                        <i class="fas fa-heart text-danger me-3"></i>
                        My Favorites
                    </h1>
                    <p class="favorites-description">
                        Your curated collection of beloved movies, shows, and anime.
                    </p>
                    <div class="favorites-stats">
                        <span id="favoritesCount">0 items</span>
                        <span id="averageRating">0.0 avg rating</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Favorites Controls -->
        <section class="favorites-controls">
            <div class="container">
                <div class="controls-wrapper">
                    <div class="filter-controls">
                        <div class="filter-group">
                            <label>Filter by:</label>
                            <select class="form-select form-select-sm" id="typeFilter">
                                <option value="all">All Content</option>
                                <option value="movie">Movies</option>
                                <option value="tv">TV Shows</option>
                                <option value="anime">Anime</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Genre:</label>
                            <select class="form-select form-select-sm" id="genreFilter">
                                <option value="">All Genres</option>
                                <option value="action">Action</option>
                                <option value="comedy">Comedy</option>
                                <option value="drama">Drama</option>
                                <option value="horror">Horror</option>
                                <option value="romance">Romance</option>
                                <option value="sci-fi">Sci-Fi</option>
                                <option value="thriller">Thriller</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Sort by:</label>
                            <select class="form-select form-select-sm" id="sortFilter">
                                <option value="date_added">Date Added</option>
                                <option value="title">Title</option>
                                <option value="rating">Rating</option>
                                <option value="my_rating">My Rating</option>
                                <option value="release_date">Release Date</option>
                            </select>
                        </div>
                        <div class="search-group">
                            <input type="text" class="form-control form-control-sm" id="searchInput" placeholder="Search favorites...">
                        </div>
                    </div>
                    <div class="action-controls">
                        <button class="btn btn-outline-primary btn-sm" id="exportFavoritesBtn">
                            <i class="fas fa-download me-1"></i>
                            Export
                        </button>
                        <button class="btn btn-outline-danger btn-sm" id="clearFavoritesBtn">
                            <i class="fas fa-trash me-1"></i>
                            Clear All
                        </button>
                        <div class="view-toggle">
                            <button class="btn btn-sm btn-outline-primary active" data-view="grid" id="gridViewBtn">
                                <i class="fas fa-th-large"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-primary" data-view="list" id="listViewBtn">
                                <i class="fas fa-list"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Favorites Content -->
        <section class="favorites-content-section">
            <div class="container">
                <!-- Empty State -->
                <div id="emptyFavorites" class="empty-favorites" style="display: none;">
                    <div class="empty-content">
                        <i class="fas fa-heart fa-3x mb-3 text-danger"></i>
                        <h3>No favorites yet</h3>
                        <p>Start building your collection of favorite content!</p>
                        <div class="empty-actions">
                            <a href="/categories/trending" class="btn btn-primary">
                                <i class="fas fa-fire me-2"></i>
                                Explore Trending
                            </a>
                            <a href="/categories/critic-choices" class="btn btn-outline-primary">
                                <i class="fas fa-crown me-2"></i>
                                Critics Choice
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Favorites Grid -->
                <div class="favorites-grid" id="favoritesGrid">
                    <!-- Loading skeleton -->
                    <div class="loading-skeleton">
                        <div class="skeleton-card skeleton"></div>
                        <div class="skeleton-card skeleton"></div>
                        <div class="skeleton-card skeleton"></div>
                        <div class="skeleton-card skeleton"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Recommendations -->
        <section class="recommendations-section">
            <div class="container">
                <h3>More Like Your Favorites</h3>
                <div class="content-carousel" id="recommendationsCarousel">
                    <div class="carousel-loading">
                        <div class="loading-spinner-small"></div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <div id="footerContainer"></div>

    <!-- Rating Modal -->
    <div class="modal fade" id="ratingModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content bg-dark">
                <div class="modal-header">
                    <h5 class="modal-title">Rate This Content</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="rating-content">
                        <div class="content-info" id="ratingContentInfo"></div>
                        <div class="rating-section">
                            <label class="form-label">Your Rating</label>
                            <div class="rating-stars" id="ratingStars">
                                <i class="fas fa-star rating-star" data-rating="1"></i>
                                <i class="fas fa-star rating-star" data-rating="2"></i>
                                <i class="fas fa-star rating-star" data-rating="3"></i>
                                <i class="fas fa-star rating-star" data-rating="4"></i>
                                <i class="fas fa-star rating-star" data-rating="5"></i>
                            </div>
                            <div class="rating-text" id="ratingText">Click to rate</div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="submitRatingBtn">Save Rating</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../js/main.js"></script>
    <script src="../js/include.js"></script>
    <script>
        let favoritesState = {
            items: [],
            filteredItems: [],
            currentView: 'grid',
            currentRatingContent: null,
            userRating: 0
        };

        document.addEventListener('DOMContentLoaded', function() {
            initializeFavoritesPage();
        });

        async function initializeFavoritesPage() {
            // Check authentication
            if (!AuthManager.requireAuth()) return;

            // Load includes
            await loadIncludes();
            
            // Initialize favorites
            await loadFavorites();
            bindFavoritesEvents();
            await loadRecommendations();

            Utils.hideLoadingScreen();
        }

        async function loadIncludes() {
            try {
                await Promise.all([
                    loadHeader(),
                    loadFooter()
                ]);
            } catch (error) {
                console.error('Failed to load includes:', error);
            }
        }

        async function loadFavorites() {
            try {
                showLoadingSkeleton();

                const response = await ApiService.getFavorites();
                favoritesState.items = response.favorites || [];
                favoritesState.filteredItems = [...favoritesState.items];

                updateFavoritesStats();
                renderFavorites();

                if (favoritesState.items.length === 0) {
                    showEmptyState();
                }

            } catch (error) {
                console.error('Failed to load favorites:', error);
                Utils.showToast('Failed to load favorites', 'error');
                showEmptyState();
            }
        }

        function showLoadingSkeleton() {
            const grid = document.getElementById('favoritesGrid');
            const skeletonHtml = Array(4).fill(0).map(() => 
                '<div class="skeleton-card skeleton"></div>'
            ).join('');
            grid.innerHTML = `<div class="loading-skeleton">${skeletonHtml}</div>`;
        }

        function bindFavoritesEvents() {
            // Filters
            document.getElementById('typeFilter').onchange = applyFilters;
            document.getElementById('genreFilter').onchange = applyFilters;
            document.getElementById('sortFilter').onchange = applyFilters;
            document.getElementById('searchInput').oninput = Utils.debounce(applyFilters, 300);

            // Actions
            document.getElementById('exportFavoritesBtn').onclick = exportFavorites;
            document.getElementById('clearFavoritesBtn').onclick = clearFavorites;

            // View toggle
            document.getElementById('gridViewBtn').onclick = () => switchView('grid');
            document.getElementById('listViewBtn').onclick = () => switchView('list');

            // Rating modal
            bindRatingModal();
        }

        function bindRatingModal() {
            const ratingModal = new bootstrap.Modal(document.getElementById('ratingModal'));
            const ratingStars = document.querySelectorAll('#ratingStars .rating-star');
            const submitRatingBtn = document.getElementById('submitRatingBtn');

            // Rating stars
            ratingStars.forEach((star, index) => {
                star.onclick = () => {
                    favoritesState.userRating = index + 1;
                    updateStars(ratingStars, favoritesState.userRating);
                    updateRatingText();
                };

                star.onmouseover = () => {
                    updateStars(ratingStars, index + 1);
                };
            });

            const ratingContainer = document.getElementById('ratingStars');
            ratingContainer.onmouseleave = () => {
                updateStars(ratingStars, favoritesState.userRating);
            };

            submitRatingBtn.onclick = async () => {
                if (favoritesState.userRating === 0) {
                    Utils.showToast('Please select a rating', 'error');
                    return;
                }

                try {
                    await ApiService.recordInteraction(
                        favoritesState.currentRatingContent.id, 
                        'rating', 
                        favoritesState.userRating
                    );

                    Utils.showToast(`Rated ${favoritesState.userRating} stars!`, 'success');
                    ratingModal.hide();
                    
                    // Update the item in favorites list
                    const item = favoritesState.items.find(
                        item => item.id === favoritesState.currentRatingContent.id
                    );
                    if (item) {
                        item.user_rating = favoritesState.userRating;
                        renderFavorites();
                    }

                } catch (error) {
                    Utils.showToast('Failed to save rating', 'error');
                }
            };

            // Reset on modal close
            document.getElementById('ratingModal').addEventListener('hidden.bs.modal', () => {
                favoritesState.userRating = 0;
                favoritesState.currentRatingContent = null;
                updateStars(ratingStars, 0);
                updateRatingText();
            });
        }

        function updateStars(stars, rating) {
            stars.forEach((star, index) => {
                if (index < rating) {
                    star.classList.add('active');
                } else {
                    star.classList.remove('active');
                }
            });
        }

        function updateRatingText() {
            const ratingText = document.getElementById('ratingText');
            if (favoritesState.userRating === 0) {
                ratingText.textContent = 'Click to rate';
            } else {
                const labels = ['', 'Poor', 'Fair', 'Good', 'Very Good', 'Excellent'];
                ratingText.textContent = `${favoritesState.userRating} - ${labels[favoritesState.userRating]}`;
            }
        }

        function updateFavoritesStats() {
            const count = favoritesState.items.length;
            document.getElementById('favoritesCount').textContent = `${count} item${count !== 1 ? 's' : ''}`;

            // Calculate average rating
            const ratingsSum = favoritesState.items.reduce((sum, item) => sum + (item.rating || 0), 0);
            const avgRating = count > 0 ? (ratingsSum / count).toFixed(1) : '0.0';
            document.getElementById('averageRating').textContent = `${avgRating} avg rating`;
        }

        function applyFilters() {
            let filtered = [...favoritesState.items];

            // Type filter
            const typeFilter = document.getElementById('typeFilter').value;
            if (typeFilter !== 'all') {
                filtered = filtered.filter(item => item.content_type === typeFilter);
            }

            // Genre filter
            const genreFilter = document.getElementById('genreFilter').value;
            if (genreFilter) {
                filtered = filtered.filter(item => 
                    item.genres && item.genres.some(genre => 
                        genre.toLowerCase().includes(genreFilter.toLowerCase())
                    )
                );
            }

            // Search filter
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            if (searchTerm) {
                filtered = filtered.filter(item => 
                    item.title.toLowerCase().includes(searchTerm) ||
                    (item.overview && item.overview.toLowerCase().includes(searchTerm))
                );
            }

            // Sort
            const sortBy = document.getElementById('sortFilter').value;
            filtered.sort((a, b) => {
                switch (sortBy) {
                    case 'title':
                        return a.title.localeCompare(b.title);
                    case 'rating':
                        return (b.rating || 0) - (a.rating || 0);
                    case 'my_rating':
                        return (b.user_rating || 0) - (a.user_rating || 0);
                    case 'release_date':
                        return new Date(b.release_date || 0) - new Date(a.release_date || 0);
                    case 'date_added':
                    default:
                        return new Date(b.added_at || 0) - new Date(a.added_at || 0);
                }
            });

            favoritesState.filteredItems = filtered;
            renderFavorites();
        }

        function renderFavorites() {
            const grid = document.getElementById('favoritesGrid');
            const emptyState = document.getElementById('emptyFavorites');

            if (favoritesState.filteredItems.length === 0) {
                if (favoritesState.items.length === 0) {
                    showEmptyState();
                } else {
                    grid.innerHTML = `
                        <div class="no-results">
                            <i class="fas fa-search fa-2x mb-3"></i>
                            <h4>No results found</h4>
                            <p>Try adjusting your filters</p>
                        </div>
                    `;
                    emptyState.style.display = 'none';
                }
                return;
            }

            emptyState.style.display = 'none';

            const itemsHtml = favoritesState.filteredItems.map(item => {
                if (favoritesState.currentView === 'grid') {
                    return createFavoriteGridCard(item);
                } else {
                    return createFavoriteListCard(item);
                }
            }).join('');

            grid.className = `favorites-grid ${favoritesState.currentView}-view`;
            grid.innerHTML = itemsHtml;
        }

        function createFavoriteGridCard(item) {
            const addedDate = new Date(item.added_at || Date.now()).toLocaleDateString();
            const userRating = item.user_rating || 0;
            
            return `
                <div class="favorite-card" onclick="Utils.navigateToDetails(${item.id})">
                    <div class="card-poster">
                        <img src="${Utils.getImageUrl(item.poster_path)}" 
                             alt="${item.title}" 
                             loading="lazy"
                             onerror="this.src='https://via.placeholder.com/300x450?text=No+Image'">
                        <div class="card-overlay">
                            <button class="play-btn" onclick="event.stopPropagation(); UIComponents.playTrailer('${item.youtube_trailer || ''}')">
                                <i class="fas fa-play"></i>
                            </button>
                            <button class="remove-btn" onclick="event.stopPropagation(); removeFromFavorites(${item.id})" title="Remove from favorites">
                                <i class="fas fa-heart-broken"></i>
                            </button>
                        </div>
                        <div class="favorite-badge">
                            <i class="fas fa-heart"></i>
                        </div>
                    </div>
                    <div class="card-info">
                        <h6 class="card-title">${item.title}</h6>
                        <div class="card-meta">
                            <span class="content-type">${item.content_type.toUpperCase()}</span>
                            <div class="card-rating">
                                <i class="fas fa-star"></i>
                                <span>${Utils.formatRating(item.rating)}</span>
                            </div>
                        </div>
                        <p class="card-overview">${Utils.truncateText(item.overview, 80)}</p>
                        <div class="card-footer">
                            <span class="added-date">Favorited ${addedDate}</span>
                            <div class="user-rating">
                                ${userRating > 0 ? 
                                    `<span class="my-rating" onclick="event.stopPropagation(); openRatingModal(${item.id})">
                                        My Rating: ${userRating} <i class="fas fa-star"></i>
                                    </span>` :
                                    `<button class="btn btn-sm btn-outline-primary" onclick="event.stopPropagation(); openRatingModal(${item.id})">
                                        <i class="fas fa-star me-1"></i> Rate
                                    </button>`
                                }
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function createFavoriteListCard(item) {
            const addedDate = new Date(item.added_at || Date.now()).toLocaleDateString();
            const userRating = item.user_rating || 0;
            
            return `
                <div class="favorite-list-card" onclick="Utils.navigateToDetails(${item.id})">
                    <div class="list-poster">
                        <img src="${Utils.getImageUrl(item.poster_path, 'w154')}" 
                             alt="${item.title}"
                             onerror="this.src='https://via.placeholder.com/154x231?text=No+Image'">
                        <div class="favorite-badge">
                            <i class="fas fa-heart"></i>
                        </div>
                    </div>
                    <div class="list-content">
                        <div class="list-header">
                            <h5 class="list-title">${item.title}</h5>
                            <span class="content-type-badge">${item.content_type.toUpperCase()}</span>
                        </div>
                        <div class="list-meta">
                            <span class="release-date">${Utils.formatDate(item.release_date)}</span>
                            <div class="list-rating">
                                <i class="fas fa-star"></i>
                                <span>${Utils.formatRating(item.rating)}</span>
                            </div>
                            <span class="runtime">${item.runtime ? item.runtime + ' min' : 'N/A'}</span>
                            ${userRating > 0 ? 
                                `<div class="user-rating-display">
                                    My Rating: ${userRating} <i class="fas fa-star text-warning"></i>
                                </div>` : ''
                            }
                        </div>
                        <p class="list-overview">${Utils.truncateText(item.overview, 200)}</p>
                        <div class="list-footer">
                            <span class="added-info">Added to favorites on ${addedDate}</span>
                            <div class="list-genres">
                                ${(item.genres || []).slice(0, 3).map(genre => `<span class="genre-tag">${genre}</span>`).join('')}
                            </div>
                        </div>
                    </div>
                    <div class="list-actions">
                        ${userRating === 0 ? 
                            `<button class="btn btn-sm btn-primary" onclick="event.stopPropagation(); openRatingModal(${item.id})">
                                <i class="fas fa-star me-1"></i>
                                Rate This
                            </button>` :
                            `<button class="btn btn-sm btn-outline-primary" onclick="event.stopPropagation(); openRatingModal(${item.id})">
                                <i class="fas fa-edit me-1"></i>
                                Edit Rating
                            </button>`
                        }
                        <button class="btn btn-sm btn-outline-primary" onclick="event.stopPropagation(); UIComponents.playTrailer('${item.youtube_trailer || ''}')">
                            <i class="fas fa-play me-1"></i>
                            Trailer
                        </button>
                        <button class="btn btn-sm btn-outline-danger" onclick="event.stopPropagation(); removeFromFavorites(${item.id})">
                            <i class="fas fa-heart-broken me-1"></i>
                            Remove
                        </button>
                    </div>
                </div>
            `;
        }

        function showEmptyState() {
            document.getElementById('emptyFavorites').style.display = 'block';
            document.getElementById('favoritesGrid').innerHTML = '';
        }

        function switchView(view) {
            favoritesState.currentView = view;
            
            // Update button states
            document.querySelectorAll('.view-toggle .btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-view="${view}"]`).classList.add('active');
            
            renderFavorites();
        }

        function openRatingModal(contentId) {
            const item = favoritesState.items.find(item => item.id === contentId);
            if (!item) return;

            favoritesState.currentRatingContent = item;
            favoritesState.userRating = item.user_rating || 0;

            // Update modal content
            document.getElementById('ratingContentInfo').innerHTML = `
                <div class="d-flex align-items-center gap-3">
                    <img src="${Utils.getImageUrl(item.poster_path, 'w92')}" 
                         alt="${item.title}" 
                         style="width: 60px; height: 90px; object-fit: cover; border-radius: 8px;">
                    <div>
                        <h6 class="mb-1">${item.title}</h6>
                        <div class="text-muted">${item.content_type.toUpperCase()} â€¢ ${Utils.formatRating(item.rating)}</div>
                    </div>
                </div>
            `;

            // Update stars
            const ratingStars = document.querySelectorAll('#ratingStars .rating-star');
            updateStars(ratingStars, favoritesState.userRating);
            updateRatingText();

            // Show modal
            const ratingModal = new bootstrap.Modal(document.getElementById('ratingModal'));
            ratingModal.show();
        }

        async function removeFromFavorites(contentId) {
            try {
                await ApiService.removeFromFavorites(contentId);
                
                // Remove from local state
                favoritesState.items = favoritesState.items.filter(item => item.id !== contentId);
                favoritesState.filteredItems = favoritesState.filteredItems.filter(item => item.id !== contentId);
                
                updateFavoritesStats();
                renderFavorites();
                
                Utils.showToast('Removed from favorites', 'success');

                if (favoritesState.items.length === 0) {
                    showEmptyState();
                }

            } catch (error) {
                console.error('Failed to remove from favorites:', error);
                Utils.showToast('Failed to remove from favorites', 'error');
            }
        }

        async function clearFavorites() {
            if (!confirm('Are you sure you want to clear all your favorites? This action cannot be undone.')) {
                return;
            }

            try {
                await ApiService.clearFavorites();
                
                favoritesState.items = [];
                favoritesState.filteredItems = [];
                
                updateFavoritesStats();
                showEmptyState();
                
                Utils.showToast('Favorites cleared', 'success');

            } catch (error) {
                console.error('Failed to clear favorites:', error);
                Utils.showToast('Failed to clear favorites', 'error');
            }
        }

        async function exportFavorites() {
            try {
                const exportData = {
                    exported_at: new Date().toISOString(),
                    total_items: favoritesState.items.length,
                    favorites: favoritesState.items.map(item => ({
                        title: item.title,
                        content_type: item.content_type,
                        rating: item.rating,
                        user_rating: item.user_rating,
                        release_date: item.release_date,
                        genres: item.genres,
                        added_at: item.added_at
                    }))
                };

                const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `cinescope-favorites-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                Utils.showToast('Favorites exported successfully!', 'success');

            } catch (error) {
                console.error('Export failed:', error);
                Utils.showToast('Failed to export favorites', 'error');
            }
        }

        async function loadRecommendations() {
            try {
                let recommendations = [];
                
                if (favoritesState.items.length > 0) {
                    // Get similar content based on favorites
                    const randomItem = favoritesState.items[Math.floor(Math.random() * favoritesState.items.length)];
                    const similar = await ApiService.getSimilar(randomItem.id, 10);
                    recommendations = similar.recommendations || [];
                }

                // Fallback to trending if no similar content
                if (recommendations.length === 0) {
                    const trending = await ApiService.getTrending('all', 10);
                    recommendations = trending.recommendations || [];
                }

                UIComponents.createCarousel(recommendations, 'recommendationsCarousel');

            } catch (error) {
                console.error('Failed to load recommendations:', error);
            }
        }

        // Extended API service
        ApiService.removeFromFavorites = async function(contentId) {
            return await this.request(`/user/favorites/${contentId}`, { method: 'DELETE' });
        };

        ApiService.clearFavorites = async function() {
            return await this.request('/user/favorites', { method: 'DELETE' });
        };
    </script>

    <style>
        .favorites-content {
            padding-top: 2rem;
        }

        .favorites-header {
            padding: 2rem 0 3rem;
            background: var(--gradient-dark);
        }

        .favorites-header-content {
            text-align: center;
            max-width: 800px;
            margin: 0 auto;
        }

        .favorites-title {
            font-size: clamp(2rem, 4vw, 3rem);
            font-weight: 700;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .favorites-description {
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
        }

        .favorites-stats {
            display: flex;
            justify-content: center;
            gap: 2rem;
            font-size: 1rem;
            color: var(--text-secondary);
        }

        .favorite-badge {
            position: absolute;
            top: 0.75rem;
            left: 0.75rem;
            width: 30px;
            height: 30px;
            background: var(--danger-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.9rem;
            z-index: 2;
        }

        .favorite-card:hover .favorite-badge {
            animation: heartbeat 1s ease infinite;
        }

        @keyframes heartbeat {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .my-rating {
            color: var(--warning-color);
            font-size: 0.8rem;
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .my-rating:hover {
            color: var(--primary-color);
        }

        .user-rating-display {
            color: var(--warning-color);
            font-size: 0.85rem;
            font-weight: 500;
        }

        .rating-content {
            text-align: center;
        }

        .rating-section {
            margin-top: 2rem;
        }

        .rating-stars {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .rating-star {
            font-size: 2rem;
            color: var(--border-color);
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .rating-star:hover,
        .rating-star.active {
            color: var(--warning-color);
            transform: scale(1.1);
        }

        .rating-text {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .favorites-controls {
            padding: 1.5rem 0;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 80px;
            z-index: 100;
        }

        .favorites-grid {
            display: grid;
            gap: 1.5rem;
        }

        .favorites-grid.grid-view {
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
        }

        .favorites-grid.list-view {
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }

        .favorite-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-lg);
            overflow: hidden;
            transition: var(--transition);
            cursor: pointer;
            position: relative;
        }

        .favorite-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-xl);
            border-color: var(--danger-color);
        }

        .favorite-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, rgba(239, 68, 68, 0.1), transparent);
            opacity: 0;
            transition: var(--transition);
            z-index: 1;
            pointer-events: none;
        }

        .favorite-card:hover::before {
            opacity: 1;
        }

        .favorite-list-card {
            display: flex;
            gap: 1.5rem;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-lg);
            padding: 1.5rem;
            transition: var(--transition);
            cursor: pointer;
            position: relative;
        }

        .favorite-list-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            border-color: var(--danger-color);
        }

        .favorite-list-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, rgba(239, 68, 68, 0.05), transparent);
            opacity: 0;
            transition: var(--transition);
            border-radius: var(--border-radius-lg);
            pointer-events: none;
        }

        .favorite-list-card:hover::before {
            opacity: 1;
        }

        .empty-favorites {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-muted);
        }

        .recommendations-section {
            padding: 3rem 0;
            background: var(--bg-secondary);
        }

        @media (max-width: 768px) {
            .favorites-stats {
                flex-direction: column;
                gap: 0.5rem;
            }

            .favorites-grid.grid-view {
                grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            }

            .favorite-list-card {
                flex-direction: column;
                text-align: center;
            }

            .list-poster img {
                width: 150px;
                height: 225px;
                margin: 0 auto;
            }

            .list-actions {
                flex-direction: row;
                justify-content: center;
                min-width: auto;
            }
        }
    </style>
</body>
</html>
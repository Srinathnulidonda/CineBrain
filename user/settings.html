<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - CineScope</title>

    <!-- CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="/assets/css/base.css" rel="stylesheet">
    <link href="/assets/css/components.css" rel="stylesheet">
    <link href="/assets/css/layouts.css" rel="stylesheet">
    <link href="/assets/css/animations.css" rel="stylesheet">
    <link href="/assets/css/responsive.css" rel="stylesheet">
    <link href="/assets/css/utilities.css" rel="stylesheet">
</head>

<body>
    <div class="app-layout">
        <!-- Navigation -->
        <nav class="navbar">
            <div class="container navbar__container">
                <a href="/" class="navbar__logo">CineScope</a>

                <div class="navbar__menu">
                    <a href="/content/trending.html" class="navbar__link">Trending</a>
                    <a href="/content/search.html" class="navbar__link">Browse</a>
                    <a href="/content/anime.html" class="navbar__link">Anime</a>
                    <a href="/content/regional.html" class="navbar__link">Regional</a>
                </div>

                <div class="navbar__user" id="navbarUser">
                    <!-- Dynamic user menu -->
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="app-layout__main">
            <div class="container">
                <!-- Page Header -->
                <div class="page-header">
                    <div class="page-header__breadcrumb">
                        <a href="/" class="text-muted">Home</a>
                        <span class="page-header__breadcrumb-separator">/</span>
                        <a href="#" onclick="navigateToProfile()" class="text-muted">Profile</a>
                        <span class="page-header__breadcrumb-separator">/</span>
                        <span>Settings</span>
                    </div>
                    <h1 class="page-header__title">Account Settings</h1>
                </div>

                <div class="row">
                    <!-- Settings Sidebar -->
                    <div class="col-lg-3 mb-lg">
                        <div class="sidebar">
                            <nav class="sidebar__nav">
                                <a href="#account" class="sidebar__link sidebar__link--active" data-section="account">
                                    <i class="bi bi-person"></i> Account
                                </a>
                                <a href="#security" class="sidebar__link" data-section="security">
                                    <i class="bi bi-shield-lock"></i> Security
                                </a>
                                <a href="#preferences" class="sidebar__link" data-section="preferences">
                                    <i class="bi bi-sliders"></i> Preferences
                                </a>
                                <a href="#notifications" class="sidebar__link" data-section="notifications">
                                    <i class="bi bi-bell"></i> Notifications
                                </a>
                                <a href="#privacy" class="sidebar__link" data-section="privacy">
                                    <i class="bi bi-eye-slash"></i> Privacy
                                </a>
                            </nav>
                        </div>
                    </div>

                    <!-- Settings Content -->
                    <div class="col-lg-9">
                        <!-- Account Section -->
                        <section class="settings-section active" id="account">
                            <div class="bg-secondary rounded-lg p-lg animate-fadeIn">
                                <h2 class="mb-lg">Account Information</h2>

                                <form id="accountForm">
                                    <div class="row">
                                        <div class="col-md-6 mb-lg">
                                            <label class="auth-form__label">Username</label>
                                            <input type="text" class="form-control" id="username" readonly>
                                        </div>
                                        <div class="col-md-6 mb-lg">
                                            <label class="auth-form__label">Email</label>
                                            <input type="email" class="form-control" id="email" readonly>
                                        </div>
                                    </div>

                                    <div class="mb-lg">
                                        <label class="auth-form__label">Profile Picture</label>
                                        <div class="d-flex align-center gap-md">
                                            <img src="/assets/images/default-avatar.png" alt="Profile"
                                                id="profilePicture"
                                                style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover;">
                                            <button type="button" class="btn btn-secondary">
                                                <i class="bi bi-camera"></i> Change Photo
                                            </button>
                                        </div>
                                    </div>

                                    <button type="submit" class="btn btn-primary">
                                        Save Changes
                                    </button>
                                </form>
                            </div>
                        </section>

                        <!-- Security Section -->
                        <section class="settings-section" id="security" style="display: none;">
                            <div class="bg-secondary rounded-lg p-lg animate-fadeIn">
                                <h2 class="mb-lg">Security Settings</h2>

                                <form id="passwordForm">
                                    <div class="mb-lg">
                                        <label class="auth-form__label">Current Password</label>
                                        <input type="password" class="form-control" id="currentPassword">
                                    </div>

                                    <div class="row">
                                        <div class="col-md-6 mb-lg">
                                            <label class="auth-form__label">New Password</label>
                                            <input type="password" class="form-control" id="newPassword">
                                        </div>
                                        <div class="col-md-6 mb-lg">
                                            <label class="auth-form__label">Confirm Password</label>
                                            <input type="password" class="form-control" id="confirmPassword">
                                        </div>
                                    </div>

                                    <button type="submit" class="btn btn-primary">
                                        Update Password
                                    </button>
                                </form>

                                <hr class="my-xl">

                                <h3 class="mb-lg">Two-Factor Authentication</h3>
                                <p class="text-muted mb-lg">
                                    Add an extra layer of security to your account by enabling two-factor
                                    authentication.
                                </p>
                                <button class="btn btn-secondary">
                                    <i class="bi bi-shield-check"></i> Enable 2FA
                                </button>
                            </div>
                        </section>

                        <!-- Preferences Section -->
                        <section class="settings-section" id="preferences" style="display: none;">
                            <div class="bg-secondary rounded-lg p-lg animate-fadeIn">
                                <h2 class="mb-lg">Content Preferences</h2>

                                <form id="preferencesForm">
                                    <div class="mb-lg">
                                        <label class="auth-form__label mb-sm">Preferred Languages</label>
                                        <div class="filters__options">
                                            <label class="filter-chip cursor-pointer">
                                                <input type="checkbox" value="english" name="language" class="d-none">
                                                English
                                            </label>
                                            <label class="filter-chip cursor-pointer">
                                                <input type="checkbox" value="hindi" name="language" class="d-none">
                                                Hindi
                                            </label>
                                            <label class="filter-chip cursor-pointer">
                                                <input type="checkbox" value="spanish" name="language" class="d-none">
                                                Spanish
                                            </label>
                                            <label class="filter-chip cursor-pointer">
                                                <input type="checkbox" value="french" name="language" class="d-none">
                                                French
                                            </label>
                                            <label class="filter-chip cursor-pointer">
                                                <input type="checkbox" value="japanese" name="language" class="d-none">
                                                Japanese
                                            </label>
                                        </div>
                                    </div>

                                    <div class="mb-lg">
                                        <label class="auth-form__label mb-sm">Favorite Genres</label>
                                        <div class="filters__options">
                                            <label class="filter-chip cursor-pointer">
                                                <input type="checkbox" value="Action" name="genre" class="d-none">
                                                Action
                                            </label>
                                            <label class="filter-chip cursor-pointer">
                                                <input type="checkbox" value="Comedy" name="genre" class="d-none">
                                                Comedy
                                            </label>
                                            <label class="filter-chip cursor-pointer">
                                                <input type="checkbox" value="Drama" name="genre" class="d-none">
                                                Drama
                                            </label>
                                            <label class="filter-chip cursor-pointer">
                                                <input type="checkbox" value="Horror" name="genre" class="d-none">
                                                Horror
                                            </label>
                                            <label class="filter-chip cursor-pointer">
                                                <input type="checkbox" value="Sci-Fi" name="genre" class="d-none">
                                                Sci-Fi
                                            </label>
                                            <label class="filter-chip cursor-pointer">
                                                <input type="checkbox" value="Romance" name="genre" class="d-none">
                                                Romance
                                            </label>
                                        </div>
                                    </div>

                                    <div class="mb-lg">
                                        <label class="auth-form__label">Content Quality</label>
                                        <select class="form-control">
                                            <option value="auto">Auto (Recommended)</option>
                                            <option value="4k">4K Ultra HD</option>
                                            <option value="1080p">1080p HD</option>
                                            <option value="720p">720p</option>
                                            <option value="480p">480p</option>
                                        </select>
                                    </div>

                                    <button type="submit" class="btn btn-primary">
                                        Save Preferences
                                    </button>
                                </form>
                            </div>
                        </section>

                        <!-- Notifications Section -->
                        <section class="settings-section" id="notifications" style="display: none;">
                            <div class="bg-secondary rounded-lg p-lg animate-fadeIn">
                                <h2 class="mb-lg">Notification Settings</h2>

                                <form id="notificationsForm">
                                    <div class="mb-lg">
                                        <h4 class="mb-md">Email Notifications</h4>

                                        <label class="d-flex align-center justify-between mb-md cursor-pointer">
                                            <div>
                                                <p class="font-weight-semibold mb-xs">New Releases</p>
                                                <p class="text-sm text-muted">Get notified about new content in your
                                                    favorite genres</p>
                                            </div>
                                            <input type="checkbox" class="form-check-input" name="newReleases" checked>
                                        </label>

                                        <label class="d-flex align-center justify-between mb-md cursor-pointer">
                                            <div>
                                                <p class="font-weight-semibold mb-xs">Recommendations</p>
                                                <p class="text-sm text-muted">Receive personalized content
                                                    recommendations</p>
                                            </div>
                                            <input type="checkbox" class="form-check-input" name="recommendations"
                                                checked>
                                        </label>

                                        <label class="d-flex align-center justify-between mb-md cursor-pointer">
                                            <div>
                                                <p class="font-weight-semibold mb-xs">Account Updates</p>
                                                <p class="text-sm text-muted">Important updates about your account</p>
                                            </div>
                                            <input type="checkbox" class="form-check-input" name="accountUpdates"
                                                checked>
                                        </label>
                                    </div>

                                    <button type="submit" class="btn btn-primary">
                                        Save Settings
                                    </button>
                                </form>
                            </div>
                        </section>

                        <!-- Privacy Section -->
                        <section class="settings-section" id="privacy" style="display: none;">
                            <div class="bg-secondary rounded-lg p-lg animate-fadeIn">
                                <h2 class="mb-lg">Privacy Settings</h2>

                                <div class="mb-lg">
                                    <h4 class="mb-md">Profile Visibility</h4>
                                    <label class="d-flex align-center justify-between mb-md cursor-pointer">
                                        <div>
                                            <p class="font-weight-semibold mb-xs">Public Profile</p>
                                            <p class="text-sm text-muted">Allow others to see your profile and activity
                                            </p>
                                        </div>
                                        <input type="checkbox" class="form-check-input" name="publicProfile">
                                    </label>
                                </div>

                                <div class="mb-lg">
                                    <h4 class="mb-md">Data & Privacy</h4>
                                    <button class="btn btn-secondary mb-sm w-100">
                                        <i class="bi bi-download"></i> Download My Data
                                    </button>
                                    <button class="btn btn-secondary text-error w-100">
                                        <i class="bi bi-trash"></i> Delete Account
                                    </button>
                                </div>
                            </div>
                        </section>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Scripts -->
    <script src="/assets/js/core/config.js"></script>
    <script src="/assets/js/core/storage.js"></script>
    <script src="/assets/js/core/api.js"></script>
    <script src="/assets/js/core/auth.js"></script>
    <script src="/assets/js/core/router.js"></script>

    <script>
        // Check authentication
        if (!auth.requireAuth()) {
            // Will redirect to login if not authenticated
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', () => {
            updateNavigation();
            loadUserData();
            setupNavigation();
            setupForms();
            setupFilterChips();
        });

        function updateNavigation() {
            const navbarUser = document.getElementById('navbarUser');
            const user = auth.getUser();

            navbarUser.innerHTML = `
                <a href="${auth.getUserUrl('watchlist')}" class="navbar__link">
                    <i class="bi bi-bookmark"></i>
                </a>
                <a href="${auth.getUserUrl('favorites')}" class="navbar__link">
                    <i class="bi bi-heart"></i>
                </a>
                <div class="navbar__avatar">
                    <img src="${user.avatar || '/assets/images/default-avatar.png'}" alt="${user.username}">
                </div>
            `;
        }

        function loadUserData() {
            const user = auth.getUser();

            // Account info
            document.getElementById('username').value = user.username;
            document.getElementById('email').value = user.email;

            // Preferences
            const languages = user.preferred_languages || [];
            const genres = user.preferred_genres || [];

            languages.forEach(lang => {
                const checkbox = document.querySelector(`input[name="language"][value="${lang}"]`);
                if (checkbox) {
                    checkbox.checked = true;
                    checkbox.closest('.filter-chip').classList.add('filter-chip--active');
                }
            });

            genres.forEach(genre => {
                const checkbox = document.querySelector(`input[name="genre"][value="${genre}"]`);
                if (checkbox) {
                    checkbox.checked = true;
                    checkbox.closest('.filter-chip').classList.add('filter-chip--active');
                }
            });
        }

        function setupNavigation() {
            document.querySelectorAll('.sidebar__link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const section = link.dataset.section;

                    // Update active states
                    document.querySelectorAll('.sidebar__link').forEach(l => l.classList.remove('sidebar__link--active'));
                    link.classList.add('sidebar__link--active');

                    // Show/hide sections
                    document.querySelectorAll('.settings-section').forEach(s => {
                        s.style.display = 'none';
                        s.classList.remove('active');
                    });

                    const targetSection = document.getElementById(section);
                    targetSection.style.display = 'block';
                    setTimeout(() => targetSection.classList.add('active'), 10);
                });
            });
        }

        function setupForms() {
            // Account form
            document.getElementById('accountForm').addEventListener('submit', (e) => {
                e.preventDefault();
                showToast('Account information updated', 'success');
            });

            // Password form
            document.getElementById('passwordForm').addEventListener('submit', (e) => {
                e.preventDefault();

                const current = document.getElementById('currentPassword').value;
                const newPass = document.getElementById('newPassword').value;
                const confirm = document.getElementById('confirmPassword').value;

                if (!current || !newPass || !confirm) {
                    showToast('Please fill all password fields', 'warning');
                    return;
                }

                if (newPass !== confirm) {
                    showToast('Passwords do not match', 'error');
                    return;
                }

                if (newPass.length < 6) {
                    showToast('Password must be at least 6 characters', 'error');
                    return;
                }

                // In production, this would call API
                showToast('Password updated successfully', 'success');
                e.target.reset();
            });

            // Preferences form
            document.getElementById('preferencesForm').addEventListener('submit', (e) => {
                e.preventDefault();

                const languages = Array.from(document.querySelectorAll('input[name="language"]:checked')).map(cb => cb.value);
                const genres = Array.from(document.querySelectorAll('input[name="genre"]:checked')).map(cb => cb.value);

                // Update user object
                const user = auth.getUser();
                user.preferred_languages = languages;
                user.preferred_genres = genres;
                Storage.setUser(user);

                showToast('Preferences saved successfully', 'success');
            });

            // Notifications form
            document.getElementById('notificationsForm').addEventListener('submit', (e) => {
                e.preventDefault();
                showToast('Notification settings updated', 'success');
            });
        }

        function setupFilterChips() {
            document.querySelectorAll('.filter-chip').forEach(chip => {
                chip.addEventListener('click', function () {
                    const checkbox = this.querySelector('input[type="checkbox"]');
                    if (checkbox) {
                        checkbox.checked = !checkbox.checked;
                        this.classList.toggle('filter-chip--active', checkbox.checked);
                    }
                });
            });
        }

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast toast--${type} animate-slideInRight`;
            toast.innerHTML = `
                <i class="bi bi-${type === 'success' ? 'check-circle' : type === 'error' ? 'x-circle' : 'info-circle'} toast__icon"></i>
                <span class="toast__message">${message}</span>
                <i class="bi bi-x toast__close" onclick="this.parentElement.remove()"></i>
            `;

            document.getElementById('toastContainer').appendChild(toast);
            setTimeout(() => toast.classList.add('toast--visible'), 10);
            setTimeout(() => toast.remove(), 5000);
        }
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Settings - CineScope</title>

    <!-- CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="/css/base.css" rel="stylesheet">
    <link href="/css/bootstrap-overrides.css" rel="stylesheet">
    <link href="/css/tailwind.css" rel="stylesheet">
    <link href="/css/animation.css" rel="stylesheet">
    <link href="/css/responsive.css" rel="stylesheet">
    <link href="/css/utilities.css" rel="stylesheet">
</head>

<body>
    <div class="app-container">
        <!-- Desktop Sidebar -->
        <div id="sidebar-container"></div>

        <!-- Main Content -->
        <main class="main-content">
            <div class="container-fluid">
                <!-- Header -->
                <div class="mb-4">
                    <h1 class="tw-text-3xl tw-font-bold mb-3">
                        <i class="bi bi-gear text-primary"></i> Settings
                    </h1>
                    <p class="text-muted">Manage your account and preferences</p>
                </div>

                <!-- Settings Tabs -->
                <ul class="nav nav-tabs mb-4" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile"
                            type="button">
                            <i class="bi bi-person"></i> Profile
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="preferences-tab" data-bs-toggle="tab" data-bs-target="#preferences"
                            type="button">
                            <i class="bi bi-sliders"></i> Preferences
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="security-tab" data-bs-toggle="tab" data-bs-target="#security"
                            type="button">
                            <i class="bi bi-shield-lock"></i> Security
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="notifications-tab" data-bs-toggle="tab"
                            data-bs-target="#notifications" type="button">
                            <i class="bi bi-bell"></i> Notifications
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="data-tab" data-bs-toggle="tab" data-bs-target="#data"
                            type="button">
                            <i class="bi bi-database"></i> Data & Privacy
                        </button>
                    </li>
                </ul>

                <!-- Tab Content -->
                <div class="tab-content">
                    <!-- Profile Tab -->
                    <div class="tab-pane fade show active" id="profile" role="tabpanel">
                        <div class="card mb-4">
                            <div class="card-body">
                                <h5 class="card-title mb-4">Profile Information</h5>
                                <form id="profileForm">
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="username" class="form-label">Username</label>
                                            <input type="text" class="form-control" id="username" readonly>
                                            <small class="text-muted">Username cannot be changed</small>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="email" class="form-label">Email</label>
                                            <input type="email" class="form-control" id="email" required>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="displayName" class="form-label">Display Name</label>
                                            <input type="text" class="form-control" id="displayName"
                                                placeholder="Optional">
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="location" class="form-label">Location</label>
                                            <input type="text" class="form-control" id="location"
                                                placeholder="City, Country">
                                        </div>
                                        <div class="col-12 mb-3">
                                            <label for="bio" class="form-label">Bio</label>
                                            <textarea class="form-control" id="bio" rows="3"
                                                placeholder="Tell us about yourself..."></textarea>
                                        </div>
                                    </div>
                                    <button type="submit" class="btn btn-primary">Save Profile</button>
                                </form>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title mb-3">Account Statistics</h5>
                                <div class="row g-3">
                                    <div class="col-6 col-md-3">
                                        <div class="text-center">
                                            <h4 class="text-primary mb-0" id="statWatchlist">0</h4>
                                            <small class="text-muted">Watchlist</small>
                                        </div>
                                    </div>
                                    <div class="col-6 col-md-3">
                                        <div class="text-center">
                                            <h4 class="text-danger mb-0" id="statFavorites">0</h4>
                                            <small class="text-muted">Favorites</small>
                                        </div>
                                    </div>
                                    <div class="col-6 col-md-3">
                                        <div class="text-center">
                                            <h4 class="text-success mb-0" id="statWatched">0</h4>
                                            <small class="text-muted">Watched</small>
                                        </div>
                                    </div>
                                    <div class="col-6 col-md-3">
                                        <div class="text-center">
                                            <h4 class="text-info mb-0" id="memberSince">-</h4>
                                            <small class="text-muted">Member Since</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Preferences Tab -->
                    <div class="tab-pane fade" id="preferences" role="tabpanel">
                        <div class="card mb-4">
                            <div class="card-body">
                                <h5 class="card-title mb-4">Content Preferences</h5>
                                <form id="preferencesForm">
                                    <div class="mb-4">
                                        <label class="form-label">Preferred Languages</label>
                                        <div class="row g-2">
                                            <div class="col-6 col-md-3">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" value="english"
                                                        id="pref-lang-english">
                                                    <label class="form-check-label"
                                                        for="pref-lang-english">English</label>
                                                </div>
                                            </div>
                                            <div class="col-6 col-md-3">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" value="hindi"
                                                        id="pref-lang-hindi">
                                                    <label class="form-check-label" for="pref-lang-hindi">Hindi</label>
                                                </div>
                                            </div>
                                            <div class="col-6 col-md-3">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" value="telugu"
                                                        id="pref-lang-telugu">
                                                    <label class="form-check-label"
                                                        for="pref-lang-telugu">Telugu</label>
                                                </div>
                                            </div>
                                            <div class="col-6 col-md-3">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" value="tamil"
                                                        id="pref-lang-tamil">
                                                    <label class="form-check-label" for="pref-lang-tamil">Tamil</label>
                                                </div>
                                            </div>
                                            <div class="col-6 col-md-3">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" value="malayalam"
                                                        id="pref-lang-malayalam">
                                                    <label class="form-check-label"
                                                        for="pref-lang-malayalam">Malayalam</label>
                                                </div>
                                            </div>
                                            <div class="col-6 col-md-3">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" value="kannada"
                                                        id="pref-lang-kannada">
                                                    <label class="form-check-label"
                                                        for="pref-lang-kannada">Kannada</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="mb-4">
                                        <label class="form-label">Favorite Genres</label>
                                        <div class="row g-2">
                                            <div class="col-6 col-md-3">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" value="Action"
                                                        id="pref-genre-action">
                                                    <label class="form-check-label"
                                                        for="pref-genre-action">Action</label>
                                                </div>
                                            </div>
                                            <div class="col-6 col-md-3">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" value="Comedy"
                                                        id="pref-genre-comedy">
                                                    <label class="form-check-label"
                                                        for="pref-genre-comedy">Comedy</label>
                                                </div>
                                            </div>
                                            <div class="col-6 col-md-3">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" value="Drama"
                                                        id="pref-genre-drama">
                                                    <label class="form-check-label" for="pref-genre-drama">Drama</label>
                                                </div>
                                            </div>
                                            <div class="col-6 col-md-3">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" value="Horror"
                                                        id="pref-genre-horror">
                                                    <label class="form-check-label"
                                                        for="pref-genre-horror">Horror</label>
                                                </div>
                                            </div>
                                            <div class="col-6 col-md-3">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" value="Romance"
                                                        id="pref-genre-romance">
                                                    <label class="form-check-label"
                                                        for="pref-genre-romance">Romance</label>
                                                </div>
                                            </div>
                                            <div class="col-6 col-md-3">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" value="Thriller"
                                                        id="pref-genre-thriller">
                                                    <label class="form-check-label"
                                                        for="pref-genre-thriller">Thriller</label>
                                                </div>
                                            </div>
                                            <div class="col-6 col-md-3">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" value="Sci-Fi"
                                                        id="pref-genre-scifi">
                                                    <label class="form-check-label"
                                                        for="pref-genre-scifi">Sci-Fi</label>
                                                </div>
                                            </div>
                                            <div class="col-6 col-md-3">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" value="Animation"
                                                        id="pref-genre-animation">
                                                    <label class="form-check-label"
                                                        for="pref-genre-animation">Animation</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <button type="submit" class="btn btn-primary">Save Preferences</button>
                                </form>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title mb-4">Display Settings</h5>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Default View</label>
                                        <select class="form-select" id="defaultView">
                                            <option value="grid">Grid View</option>
                                            <option value="list">List View</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Items Per Page</label>
                                        <select class="form-select" id="itemsPerPage">
                                            <option value="12">12</option>
                                            <option value="20" selected>20</option>
                                            <option value="40">40</option>
                                            <option value="60">60</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="autoplayTrailers">
                                    <label class="form-check-label" for="autoplayTrailers">
                                        Autoplay trailers on hover
                                    </label>
                                </div>
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="showAdultContent">
                                    <label class="form-check-label" for="showAdultContent">
                                        Show adult content
                                    </label>
                                </div>
                                <button class="btn btn-primary" onclick="saveDisplaySettings()">Save Display
                                    Settings</button>
                            </div>
                        </div>
                    </div>

                    <!-- Security Tab -->
                    <div class="tab-pane fade" id="security" role="tabpanel">
                        <div class="card mb-4">
                            <div class="card-body">
                                <h5 class="card-title mb-4">Change Password</h5>
                                <form id="passwordForm">
                                    <div class="mb-3">
                                        <label for="currentPassword" class="form-label">Current Password</label>
                                        <input type="password" class="form-control" id="currentPassword" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="newPassword" class="form-label">New Password</label>
                                        <input type="password" class="form-control" id="newPassword" required
                                            minlength="6">
                                        <div class="form-text">At least 6 characters</div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="confirmPassword" class="form-label">Confirm New Password</label>
                                        <input type="password" class="form-control" id="confirmPassword" required>
                                    </div>
                                    <button type="submit" class="btn btn-primary">Update Password</button>
                                </form>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title mb-4">Two-Factor Authentication</h5>
                                <p class="text-muted">Add an extra layer of security to your account</p>
                                <button class="btn btn-outline-primary"
                                    onclick="UI.showToast('2FA coming soon!', 'info')">
                                    <i class="bi bi-shield-check"></i> Enable 2FA
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Notifications Tab -->
                    <div class="tab-pane fade" id="notifications" role="tabpanel">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title mb-4">Email Notifications</h5>
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="emailNewReleases" checked>
                                    <label class="form-check-label" for="emailNewReleases">
                                        New releases in my preferred genres
                                    </label>
                                </div>
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="emailRecommendations" checked>
                                    <label class="form-check-label" for="emailRecommendations">
                                        Weekly personalized recommendations
                                    </label>
                                </div>
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="emailUpdates">
                                    <label class="form-check-label" for="emailUpdates">
                                        Product updates and announcements
                                    </label>
                                </div>
                                <div class="form-check mb-4">
                                    <input class="form-check-input" type="checkbox" id="emailNewsletter">
                                    <label class="form-check-label" for="emailNewsletter">
                                        Monthly newsletter
                                    </label>
                                </div>
                                <button class="btn btn-primary" onclick="saveNotificationSettings()">Save Notification
                                    Settings</button>
                            </div>
                        </div>
                    </div>

                    <!-- Data & Privacy Tab -->
                    <div class="tab-pane fade" id="data" role="tabpanel">
                        <div class="card mb-4">
                            <div class="card-body">
                                <h5 class="card-title mb-4">Data Management</h5>
                                <div class="mb-4">
                                    <h6>Export Your Data</h6>
                                    <p class="text-muted">Download all your CineScope data including watchlist,
                                        favorites, and preferences</p>
                                    <button class="btn btn-outline-primary" onclick="exportAllData()">
                                        <i class="bi bi-download"></i> Export All Data
                                    </button>
                                </div>
                                <div class="mb-4">
                                    <h6>Clear Watch History</h6>
                                    <p class="text-muted">Remove all your viewing history and interactions</p>
                                    <button class="btn btn-outline-warning" onclick="clearHistory()">
                                        <i class="bi bi-clock-history"></i> Clear History
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="card border-danger">
                            <div class="card-body">
                                <h5 class="card-title text-danger mb-4">Danger Zone</h5>
                                <div class="mb-4">
                                    <h6>Delete Account</h6>
                                    <p class="text-muted">Permanently delete your account and all associated data</p>
                                    <button class="btn btn-danger" onclick="deleteAccount()">
                                        <i class="bi bi-trash"></i> Delete Account
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Mobile Navigation -->
        <div id="mobile-nav-container"></div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/config.js"></script>
    <script src="/js/storage.js"></script>
    <script src="/js/http.js"></script>
    <script src="/js/ui.js"></script>
    <script src="/js/app.js"></script>

    <!-- Page specific JS -->
    <script>
        // Initialize page
        async function pageInit() {
            const user = Storage.getUser();

            if (!user) {
                window.location.href = CONFIG.ROUTES.LOGIN;
                return;
            }

            // Load user data
            loadUserData(user);

            // Set up form handlers
            setupFormHandlers();

            // Load statistics
            loadStatistics();
        }

        function loadUserData(user) {
            // Profile tab
            document.getElementById('username').value = user.username || '';
            document.getElementById('email').value = user.email || '';

            // Preferences tab - Languages
            const languages = user.preferred_languages || [];
            languages.forEach(lang => {
                const checkbox = document.getElementById(`pref-lang-${lang}`);
                if (checkbox) checkbox.checked = true;
            });

            // Preferences tab - Genres
            const genres = user.preferred_genres || [];
            genres.forEach(genre => {
                const genreId = genre.toLowerCase().replace(' ', '').replace('-', '');
                const checkbox = document.getElementById(`pref-genre-${genreId}`);
                if (checkbox) checkbox.checked = true;
            });

            // Member since
            if (user.created_at) {
                const date = new Date(user.created_at);
                document.getElementById('memberSince').textContent = date.getFullYear();
            }
        }

        async function loadStatistics() {
            const user = Storage.getUser();

            // Watchlist count
            const watchlist = JSON.parse(localStorage.getItem(`user_${user.id}_watchlist`) || '[]');
            document.getElementById('statWatchlist').textContent = watchlist.length;

            // Favorites count
            const favorites = JSON.parse(localStorage.getItem(`user_${user.id}_favorites`) || '[]');
            document.getElementById('statFavorites').textContent = favorites.length;

            // Watched count (would come from backend)
            document.getElementById('statWatched').textContent = '0';
        }

        function setupFormHandlers() {
            // Profile form
            document.getElementById('profileForm').addEventListener('submit', async (e) => {
                e.preventDefault();

                // This would normally update via API
                UI.showToast('Profile updated successfully', 'success');
            });

            // Preferences form
            document.getElementById('preferencesForm').addEventListener('submit', async (e) => {
                e.preventDefault();

                // Get selected languages
                const languages = [];
                document.querySelectorAll('input[id^="pref-lang-"]:checked').forEach(checkbox => {
                    languages.push(checkbox.value);
                });

                // Get selected genres
                const genres = [];
                document.querySelectorAll('input[id^="pref-genre-"]:checked').forEach(checkbox => {
                    genres.push(checkbox.value);
                });

                // Update user object
                const user = Storage.getUser();
                user.preferred_languages = languages;
                user.preferred_genres = genres;
                Storage.setUser(user);

                UI.showToast('Preferences updated successfully', 'success');
            });

            // Password form
            document.getElementById('passwordForm').addEventListener('submit', async (e) => {
                e.preventDefault();

                const newPassword = document.getElementById('newPassword').value;
                const confirmPassword = document.getElementById('confirmPassword').value;

                if (newPassword !== confirmPassword) {
                    UI.showToast('Passwords do not match', 'error');
                    return;
                }

                // This would normally update via API
                UI.showToast('Password updated successfully', 'success');
                e.target.reset();
            });
        }

        function saveDisplaySettings() {
            const settings = {
                defaultView: document.getElementById('defaultView').value,
                itemsPerPage: document.getElementById('itemsPerPage').value,
                autoplayTrailers: document.getElementById('autoplayTrailers').checked,
                showAdultContent: document.getElementById('showAdultContent').checked
            };

            localStorage.setItem('display_settings', JSON.stringify(settings));
            UI.showToast('Display settings saved', 'success');
        }

        function saveNotificationSettings() {
            const settings = {
                emailNewReleases: document.getElementById('emailNewReleases').checked,
                emailRecommendations: document.getElementById('emailRecommendations').checked,
                emailUpdates: document.getElementById('emailUpdates').checked,
                emailNewsletter: document.getElementById('emailNewsletter').checked
            };

            // This would normally update via API
            UI.showToast('Notification settings saved', 'success');
        }

        async function exportAllData() {
            const user = Storage.getUser();

            const data = {
                user: user,
                watchlist: JSON.parse(localStorage.getItem(`user_${user.id}_watchlist`) || '[]'),
                favorites: JSON.parse(localStorage.getItem(`user_${user.id}_favorites`) || '[]'),
                preferences: {
                    languages: user.preferred_languages || [],
                    genres: user.preferred_genres || []
                },
                exportDate: new Date().toISOString()
            };

            const json = JSON.stringify(data, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `cinescope_data_${user.username}_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            UI.showToast('Data exported successfully', 'success');
        }

        function clearHistory() {
            if (!confirm('Are you sure you want to clear all your watch history?')) {
                return;
            }

            // This would normally clear via API
            UI.showToast('Watch history cleared', 'success');
        }

        function deleteAccount() {
            if (!confirm('Are you sure you want to delete your account? This action cannot be undone.')) {
                return;
            }

            const confirmText = prompt('Type "DELETE" to confirm account deletion:');
            if (confirmText !== 'DELETE') {
                return;
            }

            // This would normally delete via API
            Storage.clearAll();
            window.location.href = CONFIG.ROUTES.HOME;
        }

        // Set pageInit for App.js
        window.pageInit = pageInit;
    </script>
</body>

</html>
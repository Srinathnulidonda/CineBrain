<!DOCTYPE html>
<html lang="en" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Manage your CineBrain account settings and preferences">
    <meta name="robots" content="noindex, nofollow">

    <title>Settings - CineBrain</title>

    <!-- CSS Files -->
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/components.css">
    <link rel="stylesheet" href="/css/layouts.css">
    <link rel="stylesheet" href="/css/animations.css">
    <link rel="stylesheet" href="/css/responsive.css">
    <link rel="stylesheet" href="/css/theme.css">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/assets/favicon.svg">
</head>

<body>
    <!-- Fixed Topbar -->
    <div id="topbarContainer"></div>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Settings Header -->
        <section class="py-5"
            style="background: linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, rgba(59, 130, 246, 0.1) 100%);">
            <div class="container">
                <h1 class="display-4 fw-bold text-white mb-3">
                    <i class="fas fa-cog text-primary me-3 spin-animation"></i>
                    Settings
                </h1>
                <p class="lead text-muted mb-4">Customize your CineBrain experience</p>
            </div>
        </section>

        <!-- Settings Content -->
        <section class="py-5">
            <div class="container">
                <div class="row g-4">
                    <!-- Sidebar Navigation -->
                    <div class="col-lg-3">
                        <div class="settings-sidebar sticky-top">
                            <ul class="nav nav-pills flex-column">
                                <li class="nav-item">
                                    <a class="nav-link active" href="#account" data-bs-toggle="pill">
                                        <i class="fas fa-user me-2"></i>Account
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#preferences" data-bs-toggle="pill">
                                        <i class="fas fa-heart me-2"></i>Preferences
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#notifications" data-bs-toggle="pill">
                                        <i class="fas fa-bell me-2"></i>Notifications
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#privacy" data-bs-toggle="pill">
                                        <i class="fas fa-lock me-2"></i>Privacy
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#subscription" data-bs-toggle="pill">
                                        <i class="fas fa-credit-card me-2"></i>Subscription
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link text-danger" href="#delete" data-bs-toggle="pill">
                                        <i class="fas fa-trash me-2"></i>Delete Account
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <!-- Tab Content -->
                    <div class="col-lg-9">
                        <div class="tab-content">
                            <!-- Account Tab -->
                            <div class="tab-pane fade show active" id="account">
                                <div class="card bg-dark border-secondary mb-4">
                                    <div class="card-body">
                                        <h4 class="text-white mb-4">
                                            <i class="fas fa-user-edit me-2 text-primary"></i>
                                            Account Information
                                        </h4>
                                        <form id="accountForm">
                                            <div class="row g-3">
                                                <div class="col-md-6">
                                                    <label for="username" class="form-label text-white">Username</label>
                                                    <input type="text" class="form-control" id="username"
                                                        name="username" required>
                                                </div>
                                                <div class="col-md-6">
                                                    <label for="email" class="form-label text-white">Email</label>
                                                    <input type="email" class="form-control" id="email" name="email"
                                                        required>
                                                </div>
                                            </div>
                                            <button type="submit" class="btn btn-primary mt-3">
                                                <i class="fas fa-save me-1"></i>Update Account
                                            </button>
                                        </form>
                                    </div>
                                </div>

                                <div class="card bg-dark border-secondary">
                                    <div class="card-body">
                                        <h4 class="text-white mb-4">
                                            <i class="fas fa-key me-2 text-primary"></i>
                                            Change Password
                                        </h4>
                                        <form id="passwordForm">
                                            <div class="row g-3">
                                                <div class="col-md-6">
                                                    <label for="currentPassword" class="form-label text-white">Current
                                                        Password</label>
                                                    <input type="password" class="form-control" id="currentPassword"
                                                        name="currentPassword" required>
                                                </div>
                                                <div class="col-md-6">
                                                    <label for="newPassword" class="form-label text-white">New
                                                        Password</label>
                                                    <input type="password" class="form-control" id="newPassword"
                                                        name="newPassword" required minlength="6">
                                                </div>
                                                <div class="col-12">
                                                    <label for="confirmPassword" class="form-label text-white">Confirm
                                                        New Password</label>
                                                    <input type="password" class="form-control" id="confirmPassword"
                                                        name="confirmPassword" required>
                                                </div>
                                            </div>
                                            <button type="submit" class="btn btn-primary mt-3">
                                                <i class="fas fa-lock me-1"></i>Change Password
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>

                            <!-- Preferences Tab -->
                            <div class="tab-pane fade" id="preferences">
                                <div class="card bg-dark border-secondary">
                                    <div class="card-body">
                                        <h4 class="text-white mb-4">
                                            <i class="fas fa-sliders-h me-2 text-primary"></i>
                                            Content Preferences
                                        </h4>
                                        <form id="preferencesForm">
                                            <div class="mb-4">
                                                <label class="form-label text-white">Preferred Languages</label>
                                                <div class="row g-2">
                                                    <div class="col-6 col-md-4">
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="checkbox"
                                                                value="english" id="prefEnglish" name="languages">
                                                            <label class="form-check-label text-white"
                                                                for="prefEnglish">English</label>
                                                        </div>
                                                    </div>
                                                    <div class="col-6 col-md-4">
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="checkbox"
                                                                value="hindi" id="prefHindi" name="languages">
                                                            <label class="form-check-label text-white"
                                                                for="prefHindi">Hindi</label>
                                                        </div>
                                                    </div>
                                                    <div class="col-6 col-md-4">
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="checkbox"
                                                                value="telugu" id="prefTelugu" name="languages">
                                                            <label class="form-check-label text-white"
                                                                for="prefTelugu">Telugu</label>
                                                        </div>
                                                    </div>
                                                    <div class="col-6 col-md-4">
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="checkbox"
                                                                value="tamil" id="prefTamil" name="languages">
                                                            <label class="form-check-label text-white"
                                                                for="prefTamil">Tamil</label>
                                                        </div>
                                                    </div>
                                                    <div class="col-6 col-md-4">
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="checkbox"
                                                                value="kannada" id="prefKannada" name="languages">
                                                            <label class="form-check-label text-white"
                                                                for="prefKannada">Kannada</label>
                                                        </div>
                                                    </div>
                                                    <div class="col-6 col-md-4">
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="checkbox"
                                                                value="malayalam" id="prefMalayalam" name="languages">
                                                            <label class="form-check-label text-white"
                                                                for="prefMalayalam">Malayalam</label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="mb-4">
                                                <label class="form-label text-white">Favorite Genres</label>
                                                <div class="row g-2">
                                                    <div class="col-6 col-md-4">
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="checkbox"
                                                                value="action" id="genreAction" name="genres">
                                                            <label class="form-check-label text-white"
                                                                for="genreAction">Action</label>
                                                        </div>
                                                    </div>
                                                    <div class="col-6 col-md-4">
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="checkbox"
                                                                value="comedy" id="genreComedy" name="genres">
                                                            <label class="form-check-label text-white"
                                                                for="genreComedy">Comedy</label>
                                                        </div>
                                                    </div>
                                                    <div class="col-6 col-md-4">
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="checkbox"
                                                                value="drama" id="genreDrama" name="genres">
                                                            <label class="form-check-label text-white"
                                                                for="genreDrama">Drama</label>
                                                        </div>
                                                    </div>
                                                    <div class="col-6 col-md-4">
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="checkbox"
                                                                value="horror" id="genreHorror" name="genres">
                                                            <label class="form-check-label text-white"
                                                                for="genreHorror">Horror</label>
                                                        </div>
                                                    </div>
                                                    <div class="col-6 col-md-4">
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="checkbox"
                                                                value="romance" id="genreRomance" name="genres">
                                                            <label class="form-check-label text-white"
                                                                for="genreRomance">Romance</label>
                                                        </div>
                                                    </div>
                                                    <div class="col-6 col-md-4">
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="checkbox"
                                                                value="sci-fi" id="genreSciFi" name="genres">
                                                            <label class="form-check-label text-white"
                                                                for="genreSciFi">Sci-Fi</label>
                                                        </div>
                                                    </div>
                                                    <div class="col-6 col-md-4">
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="checkbox"
                                                                value="thriller" id="genreThriller" name="genres">
                                                            <label class="form-check-label text-white"
                                                                for="genreThriller">Thriller</label>
                                                        </div>
                                                    </div>
                                                    <div class="col-6 col-md-4">
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="checkbox"
                                                                value="animation" id="genreAnimation" name="genres">
                                                            <label class="form-check-label text-white"
                                                                for="genreAnimation">Animation</label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <button type="submit" class="btn btn-primary">
                                                <i class="fas fa-save me-1"></i>Save Preferences
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>

                            <!-- Notifications Tab -->
                            <div class="tab-pane fade" id="notifications">
                                <div class="card bg-dark border-secondary">
                                    <div class="card-body">
                                        <h4 class="text-white mb-4">
                                            <i class="fas fa-bell me-2 text-primary"></i>
                                            Notification Settings
                                        </h4>
                                        <form id="notificationsForm">
                                            <div class="form-check mb-3">
                                                <input class="form-check-input" type="checkbox" id="emailNotifications"
                                                    checked>
                                                <label class="form-check-label text-white" for="emailNotifications">
                                                    Email notifications for new recommendations
                                                </label>
                                            </div>
                                            <div class="form-check mb-3">
                                                <input class="form-check-input" type="checkbox" id="pushNotifications"
                                                    checked>
                                                <label class="form-check-label text-white" for="pushNotifications">
                                                    Push notifications for updates
                                                </label>
                                            </div>
                                            <div class="form-check mb-3">
                                                <input class="form-check-input" type="checkbox" id="weeklyDigest"
                                                    checked>
                                                <label class="form-check-label text-white" for="weeklyDigest">
                                                    Weekly digest of trending content
                                                </label>
                                            </div>
                                            <div class="form-check mb-3">
                                                <input class="form-check-input" type="checkbox" id="releaseAlerts"
                                                    checked>
                                                <label class="form-check-label text-white" for="releaseAlerts">
                                                    Alerts for new releases in favorites
                                                </label>
                                            </div>
                                            <button type="submit" class="btn btn-primary">
                                                <i class="fas fa-save me-1"></i>Save Notification Settings
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>

                            <!-- Privacy Tab -->
                            <div class="tab-pane fade" id="privacy">
                                <div class="card bg-dark border-secondary">
                                    <div class="card-body">
                                        <h4 class="text-white mb-4">
                                            <i class="fas fa-shield-alt me-2 text-primary"></i>
                                            Privacy Settings
                                        </h4>
                                        <form id="privacyForm">
                                            <div class="form-check mb-3">
                                                <input class="form-check-input" type="checkbox" id="publicProfile"
                                                    checked>
                                                <label class="form-check-label text-white" for="publicProfile">
                                                    Make profile public
                                                </label>
                                            </div>
                                            <div class="form-check mb-3">
                                                <input class="form-check-input" type="checkbox" id="shareActivity"
                                                    checked>
                                                <label class="form-check-label text-white" for="shareActivity">
                                                    Share activity with friends
                                                </label>
                                            </div>
                                            <div class="form-check mb-3">
                                                <input class="form-check-input" type="checkbox" id="dataSharing"
                                                    checked>
                                                <label class="form-check-label text-white" for="dataSharing">
                                                    Allow data sharing for better recommendations
                                                </label>
                                            </div>
                                            <button type="submit" class="btn btn-primary">
                                                <i class="fas fa-save me-1"></i>Save Privacy Settings
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>

                            <!-- Subscription Tab -->
                            <div class="tab-pane fade" id="subscription">
                                <div class="card bg-dark border-secondary">
                                    <div class="card-body">
                                        <h4 class="text-white mb-4">
                                            <i class="fas fa-crown me-2 text-warning"></i>
                                            Subscription
                                        </h4>
                                        <div class="current-subscription mb-4">
                                            <h5 class="text-white">Current Plan: Basic (Free)</h5>
                                            <p class="text-muted">Unlimited recommendations, basic features</p>
                                        </div>
                                        <div class="subscription-plans">
                                            <div class="row g-3">
                                                <div class="col-md-6">
                                                    <div class="plan-card basic-plan p-4 rounded text-center">
                                                        <h5 class="text-white mb-3">Basic</h5>
                                                        <p class="price text-primary mb-3">$0/month</p>
                                                        <ul class="list-unstyled text-muted small">
                                                            <li><i class="fas fa-check text-success me-2"></i>Unlimited
                                                                searches</li>
                                                            <li><i class="fas fa-check text-success me-2"></i>Basic
                                                                recommendations</li>
                                                            <li><i class="fas fa-check text-success me-2"></i>Watchlist
                                                                & Favorites</li>
                                                        </ul>
                                                        <button class="btn btn-outline-primary w-100" disabled>Current
                                                            Plan</button>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="plan-card premium-plan p-4 rounded text-center">
                                                        <h5 class="text-white mb-3">Premium</h5>
                                                        <p class="price text-warning mb-3">$4.99/month</p>
                                                        <ul class="list-unstyled text-muted small">
                                                            <li><i class="fas fa-check text-success me-2"></i>All Basic
                                                                features</li>
                                                            <li><i class="fas fa-check text-success me-2"></i>Advanced
                                                                ML recommendations</li>
                                                            <li><i class="fas fa-check text-success me-2"></i>Ad-free
                                                                experience</li>
                                                            <li><i class="fas fa-check text-success me-2"></i>Priority
                                                                support</li>
                                                            <li><i class="fas fa-check text-success me-2"></i>Exclusive
                                                                content</li>
                                                        </ul>
                                                        <button class="btn btn-warning w-100"
                                                            onclick="upgradeSubscription()">
                                                            <i class="fas fa-crown me-1"></i>Upgrade to Premium
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Delete Account Tab -->
                            <div class="tab-pane fade" id="delete">
                                <div class="card bg-dark border-danger">
                                    <div class="card-body">
                                        <h4 class="text-danger mb-4">
                                            <i class="fas fa-trash-alt me-2"></i>
                                            Delete Account
                                        </h4>
                                        <p class="text-muted mb-4">
                                            Deleting your account will remove all your data, including watchlist,
                                            favorites, and preferences. This action cannot be undone.
                                        </p>
                                        <div class="form-check mb-3">
                                            <input class="form-check-input" type="checkbox" id="confirmDelete" required>
                                            <label class="form-check-label text-white" for="confirmDelete">
                                                I understand that this action is permanent
                                            </label>
                                        </div>
                                        <button type="button" class="btn btn-danger" onclick="deleteAccount()">
                                            <i class="fas fa-trash me-1"></i>Delete My Account
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Mobile Navigation -->
    <div id="mobileNavContainer"></div>

    <!-- JavaScript Files -->
    <script src="/js/config.js"></script>
    <script src="/js/api.js"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/app.js"></script>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Page-specific JavaScript -->
    <script>
        (function () {
            let currentUser = null;

            // Initialize settings page
            async function initSettingsPage() {
                try {
                    // Check authentication
                    if (!window.auth || !window.auth.requireAuth()) {
                        return;
                    }

                    currentUser = window.auth.getCurrentUser();

                    await loadComponents();
                    loadAccountInfo();
                    loadPreferences();
                } catch (error) {
                    console.error('Settings page initialization failed:', error);
                }
            }

            // Load reusable components
            async function loadComponents() {
                try {
                    // Load topbar
                    const topbarResponse = await fetch('/components/layout/topbar.html');
                    const topbarHTML = await topbarResponse.text();
                    document.getElementById('topbarContainer').innerHTML = topbarHTML;

                    // Load mobile navigation
                    const mobileNavResponse = await fetch('/components/layout/mobile-nav.html');
                    const mobileNavHTML = await mobileNavResponse.text();
                    document.getElementById('mobileNavContainer').innerHTML = mobileNavHTML;

                    // Execute component scripts
                    const scripts = document.querySelectorAll('#topbarContainer script, #mobileNavContainer script');
                    scripts.forEach(script => {
                        const newScript = document.createElement('script');
                        newScript.textContent = script.textContent;
                        document.head.appendChild(newScript);
                    });
                } catch (error) {
                    console.error('Failed to load components:', error);
                }
            }

            // Load account info
            function loadAccountInfo() {
                if (!currentUser) return;

                document.getElementById('username').value = currentUser.username;
                document.getElementById('email').value = currentUser.email;
            }

            // Load preferences
            function loadPreferences() {
                if (!currentUser) return;

                // Languages
                const languages = currentUser.preferred_languages || [];
                document.querySelectorAll('[name="languages"]').forEach(checkbox => {
                    checkbox.checked = languages.includes(checkbox.value);
                });

                // Genres
                const genres = currentUser.preferred_genres || [];
                document.querySelectorAll('[name="genres"]').forEach(checkbox => {
                    checkbox.checked = genres.includes(checkbox.value);
                });
            }

            // Global functions
            window.upgradeSubscription = function () {
                if (window.showToast) {
                    window.showToast('Subscription upgrade coming soon!', 'info');
                }
            };

            window.deleteAccount = function () {
                const confirmCheckbox = document.getElementById('confirmDelete');
                if (!confirmCheckbox.checked) {
                    if (window.showToast) {
                        window.showToast('Please confirm you understand this action is permanent', 'warning');
                    }
                    return;
                }

                if (confirm('Are you absolutely sure you want to delete your account? This cannot be undone.')) {
                    // In production, call backend to delete account
                    window.auth.logout();
                    window.location.href = '/';
                    if (window.showToast) {
                        window.showToast('Account deleted successfully', 'success');
                    }
                }
            };

            // Form submissions
            document.getElementById('accountForm').addEventListener('submit', async function (e) {
                e.preventDefault();
                const formData = new FormData(this);
                const updatedData = {
                    username: formData.get('username'),
                    email: formData.get('email')
                };

                // Update local user
                currentUser.username = updatedData.username;
                currentUser.email = updatedData.email;
                window.auth.updateStoredUserData(currentUser);

                if (window.showToast) {
                    window.showToast('Account information updated', 'success');
                }
            });

            document.getElementById('passwordForm').addEventListener('submit', function (e) {
                e.preventDefault();
                const formData = new FormData(this);
                const currentPassword = formData.get('currentPassword');
                const newPassword = formData.get('newPassword');
                const confirmPassword = formData.get('confirmPassword');

                if (newPassword !== confirmPassword) {
                    if (window.showToast) {
                        window.showToast('Passwords do not match', 'error');
                    }
                    return;
                }

                if (newPassword.length < 6) {
                    if (window.showToast) {
                        window.showToast('Password must be at least 6 characters', 'error');
                    }
                    return;
                }

                // In production, call backend to change password
                if (window.showToast) {
                    window.showToast('Password changed successfully', 'success');
                }
            });

            document.getElementById('preferencesForm').addEventListener('submit', function (e) {
                e.preventDefault();
                const formData = new FormData(this);
                const languages = formData.getAll('languages');
                const genres = formData.getAll('genres');

                currentUser.preferred_languages = languages;
                currentUser.preferred_genres = genres;
                window.auth.updateStoredUserData(currentUser);

                if (window.showToast) {
                    window.showToast('Preferences updated', 'success');
                }
            });

            document.getElementById('notificationsForm').addEventListener('submit', function (e) {
                e.preventDefault();
                if (window.showToast) {
                    window.showToast('Notification settings updated', 'success');
                }
            });

            document.getElementById('privacyForm').addEventListener('submit', function (e) {
                e.preventDefault();
                if (window.showToast) {
                    window.showToast('Privacy settings updated', 'success');
                }
            });

            // Initialize when DOM is ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initSettingsPage);
            } else {
                initSettingsPage();
            }
        })();
    </script>

    <!-- Settings-specific Styles -->
    <style>
        .settings-sidebar {
            background: rgba(20, 20, 24, 0.8);
            border-radius: 1rem;
            padding: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .settings-sidebar .nav-link {
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 0.5rem;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
        }

        .settings-sidebar .nav-link:hover {
            color: white;
            background: rgba(59, 130, 246, 0.1);
        }

        .settings-sidebar .nav-link.active {
            color: white;
            background: var(--platinum-blue);
        }

        .plan-card {
            background: rgba(20, 20, 24, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .plan-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }

        .premium-plan {
            border-color: var(--vip-gold);
        }

        .premium-plan:hover {
            box-shadow: 0 8px 20px rgba(245, 158, 11, 0.3);
        }

        .price {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .spin-animation {
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        @media (max-width: 992px) {
            .settings-sidebar {
                margin-bottom: 2rem;
            }

            .settings-sidebar .nav-pills {
                flex-direction: row;
                overflow-x: auto;
            }

            .settings-sidebar .nav-item {
                flex: 0 0 auto;
            }
        }
    </style>
</body>

</html>
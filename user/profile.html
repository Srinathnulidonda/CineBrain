<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Your CineScope profile - Manage your movie preferences and viewing history">

    <title>Profile - CineScope</title>

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/base.css">
    <link rel="stylesheet" href="/css/bootstrap-overrides.css">
    <link rel="stylesheet" href="/css/animation.css">
    <link rel="stylesheet" href="/css/responsive.css">
</head>

<body class="bg-black">
    <!-- Layout Container -->
    <div id="app-container">
        <!-- Top Bar Container (Desktop) -->
        <div id="topbar-container" class="d-none d-lg-block"></div>

        <!-- Main Content -->
        <main class="main-content">
            <div class="container-fluid">
                <!-- Profile Header -->
                <div class="profile-header py-5 position-relative">
                    <div class="row align-items-center">
                        <div class="col-md-3 text-center">
                            <div class="profile-avatar-container position-relative d-inline-block">
                                <div class="profile-avatar bg-gradient rounded-circle d-flex align-items-center justify-content-center"
                                    style="width: 120px; height: 120px; background: var(--cs-gradient-primary);">
                                    <i class="bi bi-person-fill text-white" style="font-size: 3rem;"></i>
                                </div>
                                <div class="position-absolute bottom-0 end-0">
                                    <span class="badge bg-success rounded-pill p-2">
                                        <i class="bi bi-check-circle-fill"></i>
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-9">
                            <div class="profile-info">
                                <h1 class="display-5 fw-bold text-white mb-2" id="profile-username">
                                    <!-- Username will be populated -->
                                </h1>
                                <p class="lead text-muted mb-3" id="profile-email">
                                    <!-- Email will be populated -->
                                </p>
                                <div class="profile-stats d-flex flex-wrap gap-4 mb-3">
                                    <div class="stat-item">
                                        <div class="stat-value text-primary fw-bold h4 mb-0" id="watchlist-count">0
                                        </div>
                                        <div class="stat-label text-muted small">Watchlist</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value text-danger fw-bold h4 mb-0" id="favorites-count">0</div>
                                        <div class="stat-label text-muted small">Favorites</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value text-success fw-bold h4 mb-0" id="views-count">0</div>
                                        <div class="stat-label text-muted small">Viewed</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value text-warning fw-bold h4 mb-0" id="member-since">0</div>
                                        <div class="stat-label text-muted small">Member Since</div>
                                    </div>
                                </div>
                                <div class="profile-actions d-flex flex-wrap gap-2">
                                    <a href="#" class="btn btn-primary" id="edit-profile-btn">
                                        <i class="bi bi-pencil me-2"></i>Edit Profile
                                    </a>
                                    <a href="#" class="btn btn-outline-primary" id="watchlist-link">
                                        <i class="bi bi-bookmark me-2"></i>My Watchlist
                                    </a>
                                    <a href="#" class="btn btn-outline-danger" id="favorites-link">
                                        <i class="bi bi-heart me-2"></i>My Favorites
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Profile Content -->
                <div class="row">
                    <!-- Sidebar -->
                    <div class="col-lg-3 mb-4">
                        <div class="card bg-dark border-secondary">
                            <div class="card-header">
                                <h6 class="text-white mb-0">
                                    <i class="bi bi-gear me-2"></i>Quick Settings
                                </h6>
                            </div>
                            <div class="card-body">
                                <!-- Preferences Summary -->
                                <div class="mb-4">
                                    <h6 class="text-white mb-2">Preferred Languages</h6>
                                    <div id="preferred-languages-display" class="d-flex flex-wrap gap-1">
                                        <!-- Languages will be populated -->
                                    </div>
                                </div>

                                <div class="mb-4">
                                    <h6 class="text-white mb-2">Favorite Genres</h6>
                                    <div id="preferred-genres-display" class="d-flex flex-wrap gap-1">
                                        <!-- Genres will be populated -->
                                    </div>
                                </div>

                                <div class="d-grid">
                                    <a href="#" class="btn btn-outline-primary btn-sm" id="settings-link">
                                        <i class="bi bi-sliders me-2"></i>Manage Preferences
                                    </a>
                                </div>
                            </div>
                        </div>

                        <!-- Admin Panel Link (if admin) -->
                        <div id="admin-panel-card" class="card bg-dark border-warning mt-3 d-none">
                            <div class="card-body text-center">
                                <i class="bi bi-shield-check text-warning display-6 mb-2"></i>
                                <h6 class="text-warning">Admin Access</h6>
                                <p class="text-muted small mb-3">Manage content and recommendations</p>
                                <a href="/admin" class="btn btn-warning btn-sm">
                                    <i class="bi bi-gear-fill me-2"></i>Admin Panel
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Main Content -->
                    <div class="col-lg-9">
                        <!-- Personalized Recommendations -->
                        <section class="mb-5">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h3 class="text-white mb-0">
                                    <i class="bi bi-robot text-primary me-2"></i>Recommended for You
                                </h3>
                                <button class="btn btn-outline-primary btn-sm" id="refresh-recommendations">
                                    <i class="bi bi-arrow-clockwise me-2"></i>Refresh
                                </button>
                            </div>
                            <div id="personalized-recommendations" class="content-grid-container">
                                <!-- Loading state -->
                                <div class="d-flex justify-content-center py-5">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Loading recommendations...</span>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <!-- Recently Viewed -->
                        <section class="mb-5">
                            <h3 class="text-white mb-4">
                                <i class="bi bi-clock-history text-success me-2"></i>Continue Watching
                            </h3>
                            <div id="recently-viewed" class="content-grid-container">
                                <!-- Recently viewed content will be populated -->
                            </div>
                        </section>

                        <!-- Quick Actions -->
                        <section class="mb-5">
                            <h3 class="text-white mb-4">
                                <i class="bi bi-lightning text-warning me-2"></i>Quick Discover
                            </h3>
                            <div class="row g-3">
                                <div class="col-md-6 col-lg-4">
                                    <a href="/?section=trending"
                                        class="card bg-gradient text-white h-100 text-decoration-none quick-action-card"
                                        style="background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);">
                                        <div class="card-body text-center p-4">
                                            <i class="bi bi-fire display-4 mb-3"></i>
                                            <h6 class="card-title">Trending Now</h6>
                                            <p class="card-text small">What's popular today</p>
                                        </div>
                                    </a>
                                </div>
                                <div class="col-md-6 col-lg-4">
                                    <a href="/?section=new-releases"
                                        class="card bg-gradient text-white h-100 text-decoration-none quick-action-card"
                                        style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%);">
                                        <div class="card-body text-center p-4">
                                            <i class="bi bi-star display-4 mb-3"></i>
                                            <h6 class="card-title">New Releases</h6>
                                            <p class="card-text small">Fresh content</p>
                                        </div>
                                    </a>
                                </div>
                                <div class="col-md-6 col-lg-4">
                                    <a href="#"
                                        class="card bg-gradient text-white h-100 text-decoration-none quick-action-card"
                                        style="background: linear-gradient(135deg, #6f42c1 0%, #e83e8c 100%);"
                                        id="search-link">
                                        <div class="card-body text-center p-4">
                                            <i class="bi bi-search display-4 mb-3"></i>
                                            <h6 class="card-title">Search</h6>
                                            <p class="card-text small">Find anything</p>
                                        </div>
                                    </a>
                                </div>
                            </div>
                        </section>
                    </div>
                </div>
            </div>
        </main>

        <!-- Mobile Navigation Container -->
        <div id="mobile-nav-container" class="d-lg-none"></div>
    </div>

    <!-- Edit Profile Modal -->
    <div class="modal fade" id="editProfileModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content bg-dark border-secondary">
                <div class="modal-header border-secondary">
                    <h5 class="modal-title text-white">
                        <i class="bi bi-pencil me-2"></i>Edit Profile
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="edit-profile-form">
                        <div class="mb-3">
                            <label for="edit-email" class="form-label text-white">Email Address</label>
                            <input type="email" class="form-control bg-dark border-secondary text-white" id="edit-email"
                                name="email">
                        </div>

                        <div class="mb-3">
                            <label for="edit-languages" class="form-label text-white">Preferred Languages</label>
                            <select class="form-select bg-dark border-secondary text-white" id="edit-languages"
                                name="languages" multiple size="4">
                                <option value="english">English</option>
                                <option value="hindi">Hindi</option>
                                <option value="telugu">Telugu</option>
                                <option value="tamil">Tamil</option>
                                <option value="kannada">Kannada</option>
                                <option value="malayalam">Malayalam</option>
                            </select>
                            <div class="form-text text-muted">Hold Ctrl/Cmd to select multiple</div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label text-white">Favorite Genres</label>
                            <div class="row g-2">
                                <div class="col-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="action"
                                            id="edit-genre-action">
                                        <label class="form-check-label text-muted"
                                            for="edit-genre-action">Action</label>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="comedy"
                                            id="edit-genre-comedy">
                                        <label class="form-check-label text-muted"
                                            for="edit-genre-comedy">Comedy</label>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="drama"
                                            id="edit-genre-drama">
                                        <label class="form-check-label text-muted" for="edit-genre-drama">Drama</label>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="horror"
                                            id="edit-genre-horror">
                                        <label class="form-check-label text-muted"
                                            for="edit-genre-horror">Horror</label>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="romance"
                                            id="edit-genre-romance">
                                        <label class="form-check-label text-muted"
                                            for="edit-genre-romance">Romance</label>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="sci-fi"
                                            id="edit-genre-sci-fi">
                                        <label class="form-check-label text-muted"
                                            for="edit-genre-sci-fi">Sci-Fi</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer border-secondary">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="save-profile-btn">
                        <i class="bi bi-check me-2"></i>Save Changes
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Include Widget Templates -->
    <div id="widget-templates" class="d-none">
        <template id="content-card-template">
            <div class="col-6 col-md-4 col-lg-3 col-xl-2 mb-4">
                <div class="card content-card bg-dark border-0 h-100 position-relative" data-content-id="">
                    <div class="card-img-wrapper position-relative overflow-hidden">
                        <img src="" class="card-img-top" alt="" loading="lazy"
                            onerror="this.src='/assets/placeholder-poster.jpg'">
                        <div
                            class="card-overlay position-absolute w-100 h-100 d-flex align-items-center justify-content-center">
                            <div class="d-flex gap-2">
                                <button class="btn btn-primary btn-sm rounded-circle p-2 play-trailer-btn"
                                    title="Play Trailer">
                                    <i class="bi bi-play-fill"></i>
                                </button>
                                <button class="btn btn-outline-light btn-sm rounded-circle p-2 quick-view-btn"
                                    title="Quick View">
                                    <i class="bi bi-eye-fill"></i>
                                </button>
                            </div>
                        </div>
                        <div class="position-absolute top-0 end-0 m-2 rating-badge">
                            <span class="badge bg-primary rounded-pill">
                                <i class="bi bi-star-fill me-1"></i><span class="rating-value">0.0</span>
                            </span>
                        </div>
                        <div class="position-absolute top-0 start-0 m-2 content-type-badge">
                            <span class="badge bg-secondary">MOVIE</span>
                        </div>
                        <div class="position-absolute bottom-0 start-0 m-2 special-badges"></div>
                    </div>
                    <div class="card-body p-3">
                        <h6 class="card-title text-white mb-2 text-truncate" title=""></h6>
                        <p class="card-text text-muted small mb-2 genres-text"></p>
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="text-muted small release-date"></span>
                            <div class="btn-group" role="group">
                                <button class="btn btn-outline-light btn-sm watchlist-btn" title="Add to Watchlist">
                                    <i class="bi bi-bookmark"></i>
                                </button>
                                <button class="btn btn-outline-light btn-sm favorite-btn" title="Add to Favorites">
                                    <i class="bi bi-heart"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </template>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Core JavaScript -->
    <script src="/js/config.js"></script>
    <script src="/js/storage.js"></script>
    <script src="/js/http.js"></script>
    <script src="/js/ui.js"></script>
    <script src="/js/app.js"></script>

    <!-- Widget Scripts -->
    <script src="/widgets/content-card.html"></script>

    <!-- Page Script -->
    <script>
        document.addEventListener('DOMContentLoaded', async function () {
            console.log('👤 Loading Profile Page...');

            // Ensure user is authenticated
            if (!CineScope.App.requireAuth()) {
                return;
            }

            const currentUser = CineScope.App.getCurrentUser();
            const currentUsername = CineScope.utils.getCurrentUsername();

            // Verify username matches current user
            if (currentUsername !== currentUser.username) {
                console.log('🚫 Username mismatch, redirecting...');
                window.location.href = `/${currentUser.username}/profile`;
                return;
            }

            // Set page title
            CineScope.UI.updatePageTitle(`${currentUser.username}'s Profile`);

            // Load profile data
            await loadProfileData(currentUser);

            // Load profile content
            await loadProfileContent(currentUser);

            // Initialize edit profile functionality
            initializeEditProfile(currentUser);

            console.log('✅ Profile page loaded');
        });

        async function loadProfileData(user) {
            try {
                // Populate basic info
                document.getElementById('profile-username').textContent = user.username;
                document.getElementById('profile-email').textContent = user.email;

                // Set member since
                const memberSince = new Date(user.created_at || Date.now()).getFullYear();
                document.getElementById('member-since').textContent = memberSince;

                // Update navigation links
                const username = user.username;
                document.getElementById('watchlist-link').href = `/${username}/watchlist`;
                document.getElementById('favorites-link').href = `/${username}/favorites`;
                document.getElementById('settings-link').href = `/${username}/settings`;
                document.getElementById('search-link').href = `/${username}/search`;

                // Show admin panel if admin
                if (user.is_admin) {
                    document.getElementById('admin-panel-card').classList.remove('d-none');
                }

                // Display preferences
                displayPreferences(user);

                // Load stats
                await loadUserStats(user);

            } catch (error) {
                console.error('❌ Failed to load profile data:', error);
                CineScope.UI.toast.error('Failed to load profile data');
            }
        }

        function displayPreferences(user) {
            // Display preferred languages
            const languagesContainer = document.getElementById('preferred-languages-display');
            const languages = user.preferred_languages || [];

            if (languages.length > 0) {
                languagesContainer.innerHTML = languages.map(lang =>
                    `<span class="badge bg-primary me-1 mb-1">${lang.charAt(0).toUpperCase() + lang.slice(1)}</span>`
                ).join('');
            } else {
                languagesContainer.innerHTML = '<span class="text-muted small">None selected</span>';
            }

            // Display preferred genres
            const genresContainer = document.getElementById('preferred-genres-display');
            const genres = user.preferred_genres || [];

            if (genres.length > 0) {
                genresContainer.innerHTML = genres.map(genre =>
                    `<span class="badge bg-outline-secondary me-1 mb-1">${genre.charAt(0).toUpperCase() + genre.slice(1)}</span>`
                ).join('');
            } else {
                genresContainer.innerHTML = '<span class="text-muted small">None selected</span>';
            }
        }

        async function loadUserStats(user) {
            try {
                // Load watchlist count
                const watchlistData = await CineScope.HTTP.user.getWatchlist();
                document.getElementById('watchlist-count').textContent = watchlistData.watchlist?.length || 0;

                // Load favorites count
                const favoritesData = await CineScope.HTTP.user.getFavorites();
                document.getElementById('favorites-count').textContent = favoritesData.favorites?.length || 0;

                // Views count (from last viewed)
                const lastViewed = CineScope.Storage.lastViewed.get();
                document.getElementById('views-count').textContent = lastViewed.length;

            } catch (error) {
                console.warn('⚠️ Failed to load some user stats:', error);
            }
        }

        async function loadProfileContent(user) {
            // Load personalized recommendations
            await loadPersonalizedRecommendations();

            // Load recently viewed content
            loadRecentlyViewed();

            // Set up refresh functionality
            document.getElementById('refresh-recommendations').addEventListener('click', async function () {
                this.disabled = true;
                this.innerHTML = '<i class="bi bi-arrow-clockwise me-2"></i>Refreshing...';

                await loadPersonalizedRecommendations();

                this.disabled = false;
                this.innerHTML = '<i class="bi bi-arrow-clockwise me-2"></i>Refresh';

                CineScope.UI.toast.success('Recommendations refreshed');
            });
        }

        async function loadPersonalizedRecommendations() {
            const container = document.getElementById('personalized-recommendations');

            try {
                console.log('🤖 Loading personalized recommendations...');

                // Show loading state
                container.innerHTML = `
                    <div class="d-flex justify-content-center py-5">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading recommendations...</span>
                        </div>
                    </div>
                `;

                const response = await CineScope.HTTP.user.getPersonalized({ limit: 12 });
                const recommendations = response.recommendations || [];

                if (recommendations.length > 0) {
                    CineScope.Widgets.ContentCard.createGrid(recommendations, container, {
                        showTrailer: true,
                        showRating: true,
                        showGenres: true
                    });
                    console.log(`✅ Loaded ${recommendations.length} personalized recommendations`);
                } else {
                    container.innerHTML = `
                        <div class="text-center py-5">
                            <i class="bi bi-robot display-1 text-muted mb-3"></i>
                            <h5 class="text-muted">Building Your Recommendations</h5>
                            <p class="text-muted">Watch some content to get personalized recommendations!</p>
                            <a href="/?section=trending" class="btn btn-primary">
                                <i class="bi bi-fire me-2"></i>Explore Trending
                            </a>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('❌ Failed to load personalized recommendations:', error);
                container.innerHTML = `
                    <div class="text-center py-5">
                        <i class="bi bi-exclamation-triangle display-1 text-danger mb-3"></i>
                        <h5 class="text-danger">Failed to Load Recommendations</h5>
                        <p class="text-muted">${error.message}</p>
                        <button class="btn btn-primary" onclick="loadPersonalizedRecommendations()">
                            <i class="bi bi-arrow-clockwise me-2"></i>Try Again
                        </button>
                    </div>
                `;
            }
        }

        function loadRecentlyViewed() {
            const container = document.getElementById('recently-viewed');
            const lastViewed = CineScope.Storage.lastViewed.get();

            if (lastViewed.length > 0) {
                const recentContent = lastViewed.slice(0, 8); // Show last 8 items

                const contentHtml = recentContent.map(item => {
                    const posterUrl = item.poster_path && item.poster_path.startsWith('http') ?
                        item.poster_path :
                        `https://image.tmdb.org/t/p/w300${item.poster_path}`;

                    return `
                        <div class="col-6 col-md-4 col-lg-3 col-xl-2 mb-3">
                            <div class="card bg-dark border-0 h-100 position-relative content-card" 
                                 onclick="CineScope.Widgets.ContentCard.navigateToDetails(${JSON.stringify(item).replace(/"/g, '&quot;')})">
                                <img src="${posterUrl}" 
                                     class="card-img-top" 
                                     alt="${item.title}"
                                     style="height: 300px; object-fit: cover;"
                                     onerror="this.src='/assets/placeholder-poster.jpg'">
                                <div class="card-body p-2">
                                    <h6 class="card-title text-white text-truncate small mb-1" title="${item.title}">
                                        ${item.title}
                                    </h6>
                                    <small class="text-muted">
                                        Viewed ${new Date(item.viewedAt).toLocaleDateString()}
                                    </small>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');

                container.innerHTML = `<div class="row">${contentHtml}</div>`;
            } else {
                container.innerHTML = `
                    <div class="text-center py-4">
                        <i class="bi bi-clock-history display-1 text-muted mb-3"></i>
                        <h6 class="text-muted">No Recent Activity</h6>
                        <p class="text-muted">Start watching to see your recent activity here</p>
                    </div>
                `;
            }
        }

        function initializeEditProfile(user) {
            const editBtn = document.getElementById('edit-profile-btn');
            const saveBtn = document.getElementById('save-profile-btn');
            const form = document.getElementById('edit-profile-form');

            // Open edit modal
            editBtn.addEventListener('click', function (e) {
                e.preventDefault();

                // Populate form with current data
                document.getElementById('edit-email').value = user.email;

                // Set selected languages
                const languageSelect = document.getElementById('edit-languages');
                Array.from(languageSelect.options).forEach(option => {
                    option.selected = user.preferred_languages.includes(option.value);
                });

                // Set selected genres
                user.preferred_genres.forEach(genre => {
                    const checkbox = document.getElementById(`edit-genre-${genre}`);
                    if (checkbox) checkbox.checked = true;
                });

                // Show modal
                const modal = new bootstrap.Modal(document.getElementById('editProfileModal'));
                modal.show();
            });

            // Save changes
            saveBtn.addEventListener('click', async function () {
                try {
                    this.disabled = true;
                    this.innerHTML = '<i class="bi bi-arrow-clockwise me-2"></i>Saving...';

                    // Collect form data
                    const formData = new FormData(form);
                    const selectedLanguages = Array.from(document.getElementById('edit-languages').selectedOptions)
                        .map(option => option.value);
                    const selectedGenres = Array.from(document.querySelectorAll('#editProfileModal input[type="checkbox"]:checked'))
                        .map(cb => cb.value);

                    const updatedData = {
                        email: formData.get('email'),
                        preferred_languages: selectedLanguages,
                        preferred_genres: selectedGenres
                    };

                    // TODO: Implement API call to update profile
                    // await CineScope.HTTP.put('/user/profile', updatedData);

                    // Update local storage
                    const updatedUser = { ...user, ...updatedData };
                    CineScope.Storage.user.set(updatedUser);

                    // Update display
                    displayPreferences(updatedUser);
                    document.getElementById('profile-email').textContent = updatedUser.email;

                    // Close modal
                    const modal = bootstrap.Modal.getInstance(document.getElementById('editProfileModal'));
                    modal.hide();

                    CineScope.UI.toast.success('Profile updated successfully');

                } catch (error) {
                    console.error('❌ Failed to update profile:', error);
                    CineScope.UI.toast.error('Failed to update profile');
                } finally {
                    this.disabled = false;
                    this.innerHTML = '<i class="bi bi-check me-2"></i>Save Changes';
                }
            });
        }

        // Quick action card hover effects
        document.addEventListener('DOMContentLoaded', function () {
            const quickActionCards = document.querySelectorAll('.quick-action-card');
            quickActionCards.forEach(card => {
                card.addEventListener('mouseenter', function () {
                    this.style.transform = 'translateY(-4px) scale(1.02)';
                });

                card.addEventListener('mouseleave', function () {
                    this.style.transform = 'translateY(0) scale(1)';
                });
            });
        });
    </script>
</body>

</html>
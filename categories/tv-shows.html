<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TV Shows - CineScope</title>
    <meta name="description" content="Discover binge-worthy TV series from around the world on CineScope.">
    
    <link rel="icon" type="image/x-icon" href="/assets/favicon.ico">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/components.css">
    <link rel="stylesheet" href="/css/responsive.css">
</head>
<body>
    <div id="preloader" class="preloader">
        <div class="flex flex-col items-center">
            <div class="loader"></div>
            <p class="mt-4 text-lg font-medium">Loading TV Shows...</p>
        </div>
    </div>

    <div id="header-placeholder"></div>

    <main class="container py-8">
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold mb-4">üì∫ TV Shows</h1>
            <p class="text-gray-400 text-lg">Binge-worthy series for every mood</p>
        </div>

        <!-- Category Tabs -->
        <div class="tabs mb-8" id="categoryTabs">
            <div class="tab-list">
                <button class="tab-button active" data-tab="all">All Shows</button>
                <button class="tab-button" data-tab="trending">Trending Series</button>
                <button class="tab-button" data-tab="completed">Completed</button>
                <button class="tab-button" data-tab="ongoing">Currently Airing</button>
                <button class="tab-button" data-tab="miniseries">Mini Series</button>
            </div>
        </div>

        <!-- Filters -->
        <div class="card mb-8">
            <div class="card-content">
                <div class="grid grid-1 md:grid-5 gap-6">
                    <div>
                        <label class="form-label">Genre</label>
                        <select id="genreFilter" class="form-input">
                            <option value="">All Genres</option>
                            <option value="drama">Drama</option>
                            <option value="comedy">Comedy</option>
                            <option value="thriller">Thriller</option>
                            <option value="sci-fi">Sci-Fi</option>
                            <option value="fantasy">Fantasy</option>
                            <option value="crime">Crime</option>
                            <option value="documentary">Documentary</option>
                            <option value="reality">Reality</option>
                        </select>
                    </div>
                    <div>
                        <label class="form-label">Network/Platform</label>
                        <select id="networkFilter" class="form-input">
                            <option value="">All Networks</option>
                            <option value="netflix">Netflix</option>
                            <option value="hbo">HBO</option>
                            <option value="amazon">Amazon Prime</option>
                            <option value="disney">Disney+</option>
                            <option value="apple">Apple TV+</option>
                            <option value="hulu">Hulu</option>
                            <option value="bbc">BBC</option>
                        </select>
                    </div>
                    <div>
                        <label class="form-label">Episodes</label>
                        <select id="episodeFilter" class="form-input">
                            <option value="">Any Length</option>
                            <option value="mini">Mini (1-10 eps)</option>
                            <option value="short">Short (11-25 eps)</option>
                            <option value="medium">Medium (26-50 eps)</option>
                            <option value="long">Long (50+ eps)</option>
                        </select>
                    </div>
                    <div>
                        <label class="form-label">Year</label>
                        <select id="yearFilter" class="form-input">
                            <option value="">All Years</option>
                            <option value="2024">2024</option>
                            <option value="2023">2023</option>
                            <option value="2022">2022</option>
                            <option value="2021">2021</option>
                            <option value="2020">2020</option>
                            <option value="2010s">2010s</option>
                            <option value="2000s">2000s</option>
                        </select>
                    </div>
                    <div>
                        <label class="form-label">Sort By</label>
                        <select id="sortBy" class="form-input">
                            <option value="popularity">Popularity</option>
                            <option value="rating">Rating</option>
                            <option value="newest">Newest First</option>
                            <option value="alphabetical">A-Z</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- TV Shows Grid -->
        <div class="content-grid" id="tvShowsContent">
            <!-- Content will be loaded here -->
        </div>

        <div class="text-center mt-12">
            <button id="loadMoreBtn" class="btn btn-secondary" onclick="loadMore()" style="display: none;">
                Load More TV Shows
            </button>
        </div>

        <!-- Featured Sections -->
        <section class="section mt-16">
            <h2 class="section-title">Must-Watch Series</h2>
            <div class="horizontal-scroll" id="mustWatchContent">
                <!-- Will be populated by JavaScript -->
            </div>
        </section>

        <section class="section">
            <h2 class="section-title">Award Winners</h2>
            <div class="horizontal-scroll" id="awardWinnersContent">
                <!-- Will be populated by JavaScript -->
            </div>
        </section>

        <!-- Network Showcases -->
        <section class="section">
            <h2 class="section-title">Browse by Network</h2>
            <div class="grid grid-2 md:grid-4 lg:grid-6 gap-4">
                <button class="card hover:scale-105 transition-transform" onclick="filterByNetwork('netflix')">
                    <div class="card-content text-center">
                        <div class="text-2xl mb-2 text-red-600">N</div>
                        <h3 class="font-semibold">Netflix</h3>
                        <p class="text-sm text-gray-400">Originals</p>
                    </div>
                </button>
                <button class="card hover:scale-105 transition-transform" onclick="filterByNetwork('hbo')">
                    <div class="card-content text-center">
                        <div class="text-2xl mb-2">HBO</div>
                        <h3 class="font-semibold">HBO</h3>
                        <p class="text-sm text-gray-400">Premium Series</p>
                    </div>
                </button>
                <button class="card hover:scale-105 transition-transform" onclick="filterByNetwork('amazon')">
                    <div class="card-content text-center">
                        <div class="text-2xl mb-2 text-blue-500">‚¨°</div>
                        <h3 class="font-semibold">Prime Video</h3>
                        <p class="text-sm text-gray-400">Exclusives</p>
                    </div>
                </button>
                <button class="card hover:scale-105 transition-transform" onclick="filterByNetwork('disney')">
                    <div class="card-content text-center">
                        <div class="text-2xl mb-2">D+</div>
                        <h3 class="font-semibold">Disney+</h3>
                        <p class="text-sm text-gray-400">Family & Marvel</p>
                    </div>
                </button>
                <button class="card hover:scale-105 transition-transform" onclick="filterByNetwork('apple')">
                    <div class="card-content text-center">
                        <div class="text-2xl mb-2">üçé</div>
                        <h3 class="font-semibold">Apple TV+</h3>
                        <p class="text-sm text-gray-400">Originals</p>
                    </div>
                </button>
                <button class="card hover:scale-105 transition-transform" onclick="filterByNetwork('bbc')">
                    <div class="card-content text-center">
                        <div class="text-2xl mb-2">BBC</div>
                        <h3 class="font-semibold">BBC</h3>
                        <p class="text-sm text-gray-400">British TV</p>
                    </div>
                </button>
            </div>
        </section>
    </main>

    <div id="footer-placeholder"></div>

    <script src="/js/include.js"></script>
    <script src="/js/main.js"></script>
    <script>
        let currentCategory = 'all';
        let currentPage = 1;
        let allResults = [];
        let isLoading = false;

        document.addEventListener('DOMContentLoaded', () => {
            UI.initTabs(document.getElementById('categoryTabs'));
            setupEventListeners();
            loadTVShows();
            loadFeaturedSections();
        });

        function setupEventListeners() {
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', () => {
                    currentCategory = button.dataset.tab;
                    resetAndLoad();
                });
            });

            ['genreFilter', 'networkFilter', 'episodeFilter', 'yearFilter', 'sortBy'].forEach(id => {
                document.getElementById(id).addEventListener('change', resetAndLoad);
            });
        }

        function resetAndLoad() {
            currentPage = 1;
            allResults = [];
            loadTVShows();
        }

        async function loadTVShows() {
            if (isLoading) return;

            try {
                isLoading = true;
                const container = document.getElementById('tvShowsContent');
                
                if (currentPage === 1) {
                    UI.showSkeleton(container, 20);
                }

                const response = await api.getTrending('tv', 20);
                const content = response.recommendations || [];

                // Apply filters
                const filteredContent = applyTVShowFilters(content);

                if (currentPage === 1) {
                    allResults = filteredContent;
                } else {
                    allResults = [...allResults, ...filteredContent];
                }

                renderTVShows(container, allResults);
                
                const loadMoreBtn = document.getElementById('loadMoreBtn');
                loadMoreBtn.style.display = content.length >= 20 ? 'block' : 'none';

            } catch (error) {
                console.error('Error loading TV shows:', error);
                showErrorState();
            } finally {
                isLoading = false;
            }
        }

        function applyTVShowFilters(content) {
            let filtered = [...content];
            
            const genre = document.getElementById('genreFilter').value;
            const network = document.getElementById('networkFilter').value;
            const episodes = document.getElementById('episodeFilter').value;
            const year = document.getElementById('yearFilter').value;
            const sortBy = document.getElementById('sortBy').value;

            // Category filter
            if (currentCategory !== 'all') {
                switch (currentCategory) {
                    case 'trending':
                        // Already trending, no additional filter needed
                        break;
                    case 'completed':
                        filtered = filtered.filter(item => item.status === 'completed' || item.status === 'ended');
                        break;
                    case 'ongoing':
                        filtered = filtered.filter(item => item.status === 'ongoing' || item.status === 'returning');
                        break;
                    case 'miniseries':
                        filtered = filtered.filter(item => item.episode_count && item.episode_count <= 10);
                        break;
                }
            }

            // Genre filter
            if (genre) {
                filtered = filtered.filter(item => {
                    const genres = item.genres || [];
                    return genres.some(g => g.toLowerCase().includes(genre.toLowerCase()));
                });
            }

            // Year filter
            if (year) {
                filtered = filtered.filter(item => {
                    if (!item.release_date && !item.first_air_date) return false;
                    const showYear = new Date(item.release_date || item.first_air_date).getFullYear();
                    
                    if (year === '2010s') return showYear >= 2010 && showYear < 2020;
                    if (year === '2000s') return showYear >= 2000 && showYear < 2010;
                    return showYear.toString() === year;
                });
            }

            // Sort
            switch (sortBy) {
                case 'rating':
                    filtered.sort((a, b) => (b.rating || 0) - (a.rating || 0));
                    break;
                case 'newest':
                    filtered.sort((a, b) => new Date(b.release_date || b.first_air_date || 0) - new Date(a.release_date || a.first_air_date || 0));
                    break;
                case 'alphabetical':
                    filtered.sort((a, b) => a.title.localeCompare(b.title));
                    break;
                default: // popularity
                    filtered.sort((a, b) => (b.popularity || 0) - (a.popularity || 0));
            }

            return filtered;
        }

        function renderTVShows(container, content) {
            if (!content || content.length === 0) {
                container.innerHTML = `
                    <div class="col-span-full">
                        <div class="empty-state">
                            <div class="empty-state-icon">üì∫</div>
                            <h3 class="empty-state-title">No TV shows found</h3>
                            <p class="empty-state-description">Try adjusting your filters or check back later.</p>
                        </div>
                    </div>
                `;
                return;
            }

            container.innerHTML = content.map(item => {
                const card = UI.createMovieCard(item);
                
                // Add TV-specific badges
                const badges = getTVShowBadges(item);
                card.innerHTML = `
                    <div class="relative">
                        <div class="absolute top-2 left-2 z-10 space-y-1">
                            ${badges}
                        </div>
                        ${card.innerHTML}
                    </div>
                `;
                
                return card.outerHTML;
            }).join('');

            Utils.lazyLoadImages();
        }

        function getTVShowBadges(show) {
            let badges = '';
            
            if (show.status === 'ongoing' || show.status === 'returning') {
                badges += '<div class="bg-green-600 text-white text-xs px-2 py-1 rounded-full">ONGOING</div>';
            }
            
            if (show.rating && show.rating >= 8.0) {
                badges += '<div class="bg-purple-600 text-white text-xs px-2 py-1 rounded-full mt-1">TOP RATED</div>';
            }
            
            if (show.seasons && show.seasons > 5) {
                badges += `<div class="bg-blue-600 text-white text-xs px-2 py-1 rounded-full mt-1">${show.seasons} SEASONS</div>`;
            }
            
            return badges;
        }

        async function loadFeaturedSections() {
            // Load must-watch series
            try {
                const response = await api.getCriticsChoice('tv', 10);
                const mustWatch = response.recommendations || [];
                
                const container = document.getElementById('mustWatchContent');
                container.innerHTML = mustWatch.slice(0, 10).map(item => {
                    const card = UI.createMovieCard(item);
                    card.classList.add('horizontal-scroll-item');
                    return card.outerHTML;
                }).join('');

            } catch (error) {
                console.error('Error loading must-watch series:', error);
            }

            // Load award winners (high-rated shows)
            try {
                const response = await api.getTrending('tv', 10);
                const awardWinners = (response.recommendations || [])
                    .filter(item => item.rating && item.rating >= 8.5)
                    .slice(0, 10);
                
                const container = document.getElementById('awardWinnersContent');
                container.innerHTML = awardWinners.map(item => {
                    const card = UI.createMovieCard(item);
                    card.classList.add('horizontal-scroll-item');
                    return card.outerHTML;
                }).join('');

            } catch (error) {
                console.error('Error loading award winners:', error);
            }

            Utils.lazyLoadImages();
        }

        function filterByNetwork(network) {
            document.getElementById('networkFilter').value = network;
            resetAndLoad();
        }

        function loadMore() {
            currentPage++;
            loadTVShows();
        }

        function showErrorState() {
            const container = document.getElementById('tvShowsContent');
            container.innerHTML = `
                <div class="col-span-full">
                    <div class="empty-state">
                        <div class="empty-state-icon">‚ùå</div>
                        <h3 class="empty-state-title">Failed to load TV shows</h3>
                        <p class="empty-state-description">Please try again later.</p>
                        <button class="btn btn-primary mt-4" onclick="loadTVShows()">Retry</button>
                    </div>
                </div>
            `;
        }
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <script>document.write('<script src="/includes/head.html"><\/script>');</script>
    <title>TV Shows | CineScope</title>
</head>
<body>
    <div data-include="header"></div>
    
    <main class="container py-8 pt-24">
        <section class="category-header mb-8">
            <h1 class="text-4xl font-bold mb-4">
                <i class="fas fa-tv text-blue-500 mr-3"></i>
                TV <span class="text-gradient">Shows</span>
            </h1>
            <p class="text-gray-400 text-lg">Binge-watch the best series and episodes</p>
        </section>

        <div class="category-filters mb-8">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <select id="genre" class="filter-select" onchange="loadTVShows()">
                    <option value="">All Genres</option>
                    <option value="action">Action & Adventure</option>
                    <option value="comedy">Comedy</option>
                    <option value="crime">Crime</option>
                    <option value="documentary">Documentary</option>
                    <option value="drama">Drama</option>
                    <option value="family">Family</option>
                    <option value="mystery">Mystery</option>
                    <option value="reality">Reality</option>
                    <option value="sci-fi">Sci-Fi & Fantasy</option>
                    <option value="thriller">Thriller</option>
                </select>
                <select id="status" class="filter-select" onchange="loadTVShows()">
                    <option value="">All Status</option>
                    <option value="airing">Currently Airing</option>
                    <option value="ended">Ended</option>
                    <option value="new">New Series</option>
                </select>
                <select id="language" class="filter-select" onchange="loadTVShows()">
                    <option value="">All Languages</option>
                    <option value="english">English</option>
                    <option value="hindi">Hindi</option>
                    <option value="telugu">Telugu</option>
                    <option value="tamil">Tamil</option>
                    <option value="kannada">Kannada</option>
                    <option value="malayalam">Malayalam</option>
                </select>
                <select id="sortBy" class="filter-select" onchange="loadTVShows()">
                    <option value="popularity">Popularity</option>
                    <option value="rating">Rating</option>
                    <option value="first_air_date">Air Date</option>
                    <option value="title">Title A-Z</option>
                </select>
            </div>
        </div>

        <div class="tv-sections">
            <!-- Show Types -->
            <section class="mb-12">
                <h2 class="section-title mb-6">Browse by Type</h2>
                <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
                    <button class="show-type-btn" onclick="quickFilter('drama')">
                        <i class="fas fa-theater-masks"></i>
                        <span>Drama Series</span>
                    </button>
                    <button class="show-type-btn" onclick="quickFilter('comedy')">
                        <i class="fas fa-laugh-squint"></i>
                        <span>Comedy Shows</span>
                    </button>
                    <button class="show-type-btn" onclick="quickFilter('crime')">
                        <i class="fas fa-user-secret"></i>
                        <span>Crime Thriller</span>
                    </button>
                    <button class="show-type-btn" onclick="quickFilter('documentary')">
                        <i class="fas fa-camera"></i>
                        <span>Documentaries</span>
                    </button>
                    <button class="show-type-btn" onclick="quickFilter('reality')">
                        <i class="fas fa-microphone"></i>
                        <span>Reality TV</span>
                    </button>
                </div>
            </section>

            <!-- TV Shows Grid -->
            <section>
                <div id="tvShowsContent">
                    <div class="loading"><div class="spinner"></div></div>
                </div>
            </section>
        </div>
    </main>

    <div data-include="footer"></div>

    <script src="/js/auth.js"></script>
    <script src="/js/api.js"></script>
    <script src="/js/main.js"></script>
    <script>
        let allTVShows = [];

        async function loadTVShows() {
            const container = document.getElementById('tvShowsContent');
            const genre = document.getElementById('genre').value;
            const language = document.getElementById('language').value;
            
            container.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
            
            try {
                let response;
                if (genre) {
                    response = await APIService.getGenreRecommendations(genre, 'tv', 50);
                } else if (language) {
                    response = await APIService.getRegionalContent(language, 'tv', 50);
                } else {
                    response = await APIService.getTrending('tv', 50);
                }
                
                allTVShows = response.recommendations || [];
                
                // Apply status filter
                const status = document.getElementById('status').value;
                if (status) {
                    allTVShows = allTVShows.filter(show => {
                        switch (status) {
                            case 'new':
                                return show.release_date && new Date(show.release_date) > new Date(Date.now() - 365 * 24 * 60 * 60 * 1000);
                            case 'airing':
                            case 'ended':
                                // Would need additional data from API
                                return true;
                            default:
                                return true;
                        }
                    });
                }

                sortTVShows();
                displayTVShows();
            } catch (error) {
                container.innerHTML = '<p class="text-center text-red-400 py-8">Failed to load TV shows</p>';
            }
        }

        function sortTVShows() {
            const sortBy = document.getElementById('sortBy').value;
            
            allTVShows.sort((a, b) => {
                switch (sortBy) {
                    case 'rating':
                        return (b.rating || 0) - (a.rating || 0);
                    case 'first_air_date':
                        const dateA = a.release_date ? new Date(a.release_date) : new Date(0);
                        const dateB = b.release_date ? new Date(b.release_date) : new Date(0);
                        return dateB - dateA;
                    case 'title':
                        return a.title.localeCompare(b.title);
                    default: // popularity
                        return (b.popularity || 0) - (a.popularity || 0);
                }
            });
        }

        function displayTVShows() {
            const container = document.getElementById('tvShowsContent');
            
            if (allTVShows.length > 0) {
                const showsHTML = allTVShows.map(show => {
                    const airYear = show.release_date ? new Date(show.release_date).getFullYear() : '';
                    
                    return `
                        <div class="content-card cursor-pointer" onclick="window.location.href='/details?id=${show.id}'">
                            <div class="content-card-image">
                                <img src="${show.poster_path || '/assets/images/placeholder.jpg'}" alt="${show.title}" loading="lazy">
                                <div class="absolute top-2 right-2">
                                    <span class="badge badge-tv">TV</span>
                                </div>
                                <div class="content-card-overlay"></div>
                                <div class="content-card-actions">
                                    <button class="btn btn-primary btn-sm" onclick="event.stopPropagation(); ContentManager.addToWatchlist(${show.id})">
                                        <i class="fas fa-bookmark"></i>
                                    </button>
                                    <button class="btn btn-ghost btn-sm" onclick="event.stopPropagation(); ContentManager.addToFavorites(${show.id})">
                                        <i class="fas fa-heart"></i>
                                    </button>
                                    ${show.youtube_trailer ? `
                                        <button class="btn btn-ghost btn-sm" onclick="event.stopPropagation(); ContentManager.playTrailer('${show.youtube_trailer}')">
                                            <i class="fas fa-play"></i>
                                        </button>
                                    ` : ''}
                                </div>
                            </div>
                            <div class="content-card-info">
                                <div class="content-card-title">${show.title}</div>
                                <div class="content-card-meta">
                                    <span class="rating">
                                        <i class="fas fa-star"></i> ${show.rating ? show.rating.toFixed(1) : 'N/A'}
                                    </span>
                                    ${airYear ? `<span class="year">${airYear}</span>` : ''}
                                </div>
                                <div class="text-xs text-gray-400 mt-2">
                                    ${show.genres ? show.genres.slice(0, 2).join(', ') : ''}
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
                
                container.innerHTML = `<div class="content-grid">${showsHTML}</div>`;
            } else {
                container.innerHTML = '<p class="text-center text-gray-400 py-8">No TV shows found with current filters</p>';
            }
        }

        function quickFilter(genre) {
            document.getElementById('genre').value = genre;
            loadTVShows();
        }

        document.addEventListener('DOMContentLoaded', loadTVShows);
    </script>

    <style>
        .show-type-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 16px;
            background: var(--dark-surface);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            color: var(--text-primary);
            transition: all 0.3s ease;
            cursor: pointer;
            text-align: center;
        }
        .show-type-btn:hover {
            border-color: var(--primary);
            background: var(--dark-hover);
        }
        .show-type-btn i {
            font-size: 20px;
            color: var(--primary);
        }
        .show-type-btn span {
            font-size: 12px;
        }
        .badge-tv {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        }
    </style>
</body>
</html>
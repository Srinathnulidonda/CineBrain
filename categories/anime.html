<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <script>document.write('<script src="/includes/head.html"><\/script>');</script>
    <title>Anime | CineScope</title>
</head>
<body>
    <div data-include="header"></div>
    
    <main class="container py-8 pt-24">
        <section class="category-header mb-8">
            <h1 class="text-4xl font-bold mb-4">
                <i class="fas fa-mask text-pink-500 mr-3"></i>
                <span class="text-gradient">Anime</span>
            </h1>
            <p class="text-gray-400 text-lg">Discover amazing anime series and movies from Japan</p>
        </section>

        <div class="category-filters mb-8">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <select id="genre" class="filter-select" onchange="loadAnime()">
                    <option value="">All Genres</option>
                    <option value="shonen">Shonen</option>
                    <option value="shojo">Shojo</option>
                    <option value="seinen">Seinen</option>
                    <option value="josei">Josei</option>
                    <option value="kodomomuke">Kodomomuke</option>
                </select>
                <select id="type" class="filter-select" onchange="loadAnime()">
                    <option value="">All Types</option>
                    <option value="tv">TV Series</option>
                    <option value="movie">Movies</option>
                    <option value="ova">OVA</option>
                    <option value="special">Specials</option>
                </select>
                <select id="status" class="filter-select" onchange="loadAnime()">
                    <option value="">All Status</option>
                    <option value="airing">Currently Airing</option>
                    <option value="completed">Completed</option>
                    <option value="upcoming">Upcoming</option>
                </select>
                <select id="sortBy" class="filter-select" onchange="loadAnime()">
                    <option value="popularity">Popularity</option>
                    <option value="rating">Rating</option>
                    <option value="start_date">Release Date</option>
                    <option value="title">Title A-Z</option>
                </select>
            </div>
        </div>

        <div class="anime-sections">
            <!-- Anime Categories -->
            <section class="mb-12">
                <h2 class="section-title mb-6">Popular Categories</h2>
                <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
                    <button class="anime-category-btn" onclick="quickFilter('shonen')">
                        <div class="anime-category-icon">‚öîÔ∏è</div>
                        <span>Shonen</span>
                        <small>Action & Adventure</small>
                    </button>
                    <button class="anime-category-btn" onclick="quickFilter('shojo')">
                        <div class="anime-category-icon">üíï</div>
                        <span>Shojo</span>
                        <small>Romance & Drama</small>
                    </button>
                    <button class="anime-category-btn" onclick="quickFilter('seinen')">
                        <div class="anime-category-icon">üî•</div>
                        <span>Seinen</span>
                        <small>Mature Themes</small>
                    </button>
                    <button class="anime-category-btn" onclick="quickFilter('josei')">
                        <div class="anime-category-icon">üå∏</div>
                        <span>Josei</span>
                        <small>Adult Romance</small>
                    </button>
                    <button class="anime-category-btn" onclick="quickFilter('kodomomuke')">
                        <div class="anime-category-icon">üé®</div>
                        <span>Kids</span>
                        <small>Family Friendly</small>
                    </button>
                </div>
            </section>

            <!-- Anime Grid -->
            <section>
                <div id="animeContent">
                    <div class="loading"><div class="spinner"></div></div>
                </div>
            </section>
        </div>
    </main>

    <div data-include="footer"></div>

    <script src="/js/auth.js"></script>
    <script src="/js/api.js"></script>
    <script src="/js/main.js"></script>
    <script>
        let allAnime = [];

        async function loadAnime() {
            const container = document.getElementById('animeContent');
            const genre = document.getElementById('genre').value;
            
            container.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
            
            try {
                const response = await APIService.getAnimeRecommendations(genre, 50);
                allAnime = response.recommendations || [];
                
                // Apply additional filters
                const type = document.getElementById('type').value;
                const status = document.getElementById('status').value;
                
                if (type) {
                    // This would require additional API data about anime type
                    // For now, we'll keep all results
                }
                
                if (status) {
                    // This would require additional API data about anime status
                    // For now, we'll keep all results
                }

                sortAnime();
                displayAnime();
            } catch (error) {
                container.innerHTML = '<p class="text-center text-red-400 py-8">Failed to load anime</p>';
            }
        }

        function sortAnime() {
            const sortBy = document.getElementById('sortBy').value;
            
            allAnime.sort((a, b) => {
                switch (sortBy) {
                    case 'rating':
                        return (b.rating || 0) - (a.rating || 0);
                    case 'start_date':
                        const dateA = a.release_date ? new Date(a.release_date) : new Date(0);
                        const dateB = b.release_date ? new Date(b.release_date) : new Date(0);
                        return dateB - dateA;
                    case 'title':
                        return a.title.localeCompare(b.title);
                    default: // popularity
                        return (b.popularity || 0) - (a.popularity || 0);
                }
            });
        }

        function displayAnime() {
            const container = document.getElementById('animeContent');
            
            if (allAnime.length > 0) {
                const animeHTML = allAnime.map(anime => {
                    const year = anime.release_date ? new Date(anime.release_date).getFullYear() : '';
                    const genres = anime.anime_genres || anime.genres || [];
                    
                    return `
                        <div class="content-card cursor-pointer" onclick="window.location.href='/details?id=${anime.id}'">
                            <div class="content-card-image">
                                <img src="${anime.poster_path || '/assets/images/placeholder.jpg'}" alt="${anime.title}" loading="lazy">
                                <div class="absolute top-2 right-2">
                                    <span class="badge badge-anime">ANIME</span>
                                </div>
                                <div class="content-card-overlay"></div>
                                <div class="content-card-actions">
                                    <button class="btn btn-primary btn-sm" onclick="event.stopPropagation(); ContentManager.addToWatchlist(${anime.id})">
                                        <i class="fas fa-bookmark"></i>
                                    </button>
                                    <button class="btn btn-ghost btn-sm" onclick="event.stopPropagation(); ContentManager.addToFavorites(${anime.id})">
                                        <i class="fas fa-heart"></i>
                                    </button>
                                    ${anime.youtube_trailer ? `
                                        <button class="btn btn-ghost btn-sm" onclick="event.stopPropagation(); ContentManager.playTrailer('${anime.youtube_trailer}')">
                                            <i class="fas fa-play"></i>
                                        </button>
                                    ` : ''}
                                </div>
                            </div>
                            <div class="content-card-info">
                                <div class="content-card-title">${anime.title}</div>
                                <div class="content-card-meta">
                                    <span class="rating">
                                        <i class="fas fa-star"></i> ${anime.rating ? anime.rating.toFixed(1) : 'N/A'}
                                    </span>
                                    ${year ? `<span class="year">${year}</span>` : ''}
                                </div>
                                <div class="text-xs text-gray-400 mt-2">
                                    ${genres.slice(0, 2).join(', ')}
                                </div>
                                ${anime.original_title && anime.original_title !== anime.title ? `
                                    <div class="text-xs text-gray-500 mt-1">${anime.original_title}</div>
                                ` : ''}
                            </div>
                        </div>
                    `;
                }).join('');
                
                container.innerHTML = `<div class="content-grid">${animeHTML}</div>`;
            } else {
                container.innerHTML = '<p class="text-center text-gray-400 py-8">No anime found with current filters</p>';
            }
        }

        function quickFilter(genre) {
            document.getElementById('genre').value = genre;
            loadAnime();
        }

        document.addEventListener('DOMContentLoaded', loadAnime);
    </script>

    <style>
        .anime-category-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 16px 12px;
            background: var(--dark-surface);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            color: var(--text-primary);
            transition: all 0.3s ease;
            cursor: pointer;
            text-align: center;
        }
        .anime-category-btn:hover {
            border-color: var(--primary);
            background: var(--dark-hover);
            transform: translateY(-2px);
        }
        .anime-category-icon {
            font-size: 24px;
            margin-bottom: 4px;
        }
        .anime-category-btn span {
            font-weight: 600;
            color: var(--primary);
        }
        .anime-category-btn small {
            font-size: 11px;
            color: var(--text-muted);
            line-height: 1.2;
        }
        .badge-anime {
            background: linear-gradient(135deg, #ec4899, #be185d);
            color: white;
            font-size: 10px;
            padding: 2px 6px;
        }
    </style>
</body>
</html>
<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <script>document.write('<script src="/includes/head.html"><\/script>');</script>
    <title>All Time Hits | CineScope</title>
</head>
<body>
    <div data-include="header"></div>
    
    <main class="container py-8 pt-24">
        <section class="category-header mb-8">
            <h1 class="text-4xl font-bold mb-4">
                <i class="fas fa-trophy text-yellow-500 mr-3"></i>
                All Time <span class="text-gradient">Hits</span>
            </h1>
            <p class="text-gray-400 text-lg">Timeless classics and highest-rated content of all time</p>
        </section>

        <div class="category-filters mb-8">
            <div class="flex flex-wrap gap-4">
                <select id="contentType" class="filter-select" onchange="loadAllTimeHits()">
                    <option value="movie">Movies</option>
                    <option value="tv">TV Shows</option>
                </select>
                <select id="decade" class="filter-select" onchange="loadAllTimeHits()">
                    <option value="">All Decades</option>
                    <option value="2020s">2020s</option>
                    <option value="2010s">2010s</option>
                    <option value="2000s">2000s</option>
                    <option value="1990s">1990s</option>
                    <option value="1980s">1980s</option>
                    <option value="1970s">1970s & Earlier</option>
                </select>
                <select id="minRating" class="filter-select" onchange="loadAllTimeHits()">
                    <option value="8.0">8.0+ Rating</option>
                    <option value="7.5">7.5+ Rating</option>
                    <option value="7.0">7.0+ Rating</option>
                </select>
            </div>
        </div>

        <div id="allTimeHitsContent">
            <div class="loading"><div class="spinner"></div></div>
        </div>
    </main>

    <div data-include="footer"></div>

    <script src="/js/auth.js"></script>
    <script src="/js/api.js"></script>
    <script src="/js/main.js"></script>
    <script>
        async function loadAllTimeHits() {
            const container = document.getElementById('allTimeHitsContent');
            const contentType = document.getElementById('contentType').value;
            const decade = document.getElementById('decade').value;
            const minRating = parseFloat(document.getElementById('minRating').value);
            
            container.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
            
            try {
                const response = await APIService.getCriticsChoice(contentType, 100);
                let content = response.recommendations || [];
                
                // Filter by rating
                content = content.filter(item => (item.rating || 0) >= minRating);
                
                // Filter by decade if selected
                if (decade) {
                    const startYear = parseInt(decade);
                    const endYear = startYear + 9;
                    content = content.filter(item => {
                        if (!item.release_date) return false;
                        const year = new Date(item.release_date).getFullYear();
                        return year >= startYear && year <= endYear;
                    });
                }

                // Sort by rating (highest first)
                content.sort((a, b) => (b.rating || 0) - (a.rating || 0));

                if (content.length > 0) {
                    const contentHTML = content.map((item, index) => `
                        <div class="content-card cursor-pointer relative" onclick="window.location.href='/details?id=${item.id}'">
                            <div class="absolute top-2 left-2 z-10">
                                <span class="rank-badge">#${index + 1}</span>
                            </div>
                            <div class="content-card-image">
                                <img src="${item.poster_path || '/assets/images/placeholder.jpg'}" alt="${item.title}" loading="lazy">
                                <div class="content-card-overlay"></div>
                                <div class="content-card-actions">
                                    <button class="btn btn-primary btn-sm" onclick="event.stopPropagation(); ContentManager.addToWatchlist(${item.id})">
                                        <i class="fas fa-bookmark"></i>
                                    </button>
                                    <button class="btn btn-ghost btn-sm" onclick="event.stopPropagation(); ContentManager.addToFavorites(${item.id})">
                                        <i class="fas fa-heart"></i>
                                    </button>
                                    ${item.youtube_trailer ? `
                                        <button class="btn btn-ghost btn-sm" onclick="event.stopPropagation(); ContentManager.playTrailer('${item.youtube_trailer}')">
                                            <i class="fas fa-play"></i>
                                        </button>
                                    ` : ''}
                                </div>
                            </div>
                            <div class="content-card-info">
                                <div class="content-card-title">${item.title}</div>
                                <div class="content-card-meta">
                                    <span class="rating rating-gold">
                                        <i class="fas fa-star"></i> ${item.rating.toFixed(1)}
                                    </span>
                                    <span class="badge">${item.content_type.toUpperCase()}</span>
                                </div>
                                <div class="text-xs text-gray-400 mt-2">
                                    ${item.release_date ? new Date(item.release_date).getFullYear() : 'Unknown'}
                                </div>
                            </div>
                        </div>
                    `).join('');
                    
                    container.innerHTML = `<div class="content-grid">${contentHTML}</div>`;
                } else {
                    container.innerHTML = '<p class="text-center text-gray-400 py-8">No all-time hits found with current filters</p>';
                }
            } catch (error) {
                container.innerHTML = '<p class="text-center text-red-400 py-8">Failed to load all-time hits</p>';
            }
        }

        document.addEventListener('DOMContentLoaded', loadAllTimeHits);
    </script>

    <style>
        .rank-badge {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: #000;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 700;
        }
        .rating-gold {
            color: #fbbf24 !important;
        }
    </style>
</body>
</html>
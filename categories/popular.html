<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Popular - CineScope</title>
  
  <!-- CSS -->
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/components.css">
  <link rel="stylesheet" href="/css/responsive.css">
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
  <!-- Loading Overlay -->
  <div class="loading-overlay" style="display: none;">
    <div class="spinner spinner-lg"></div>
  </div>
  
  <!-- Navigation -->
  <nav class="navbar">
    <div class="container navbar-content">
      <a href="/" class="navbar-brand gradient-text">CineScope</a>
      
      <button class="mobile-menu-toggle md:hidden">
        <i class="fas fa-bars"></i>
      </button>
      
      <div class="navbar-menu hidden md:flex">
        <a href="/" class="navbar-link">Home</a>
        <a href="/categories/movies.html" class="navbar-link">Movies</a>
        <a href="/categories/tv-shows.html" class="navbar-link">TV Shows</a>
        <a href="/categories/anime.html" class="navbar-link">Anime</a>
        
        <div class="search-container">
          <input type="text" class="search-input" placeholder="Search...">
          <i class="fas fa-search search-icon"></i>
          <div class="search-suggestions" style="display: none;"></div>
        </div>
        
        <div class="auth-buttons flex gap-sm">
          <a href="/login.html" class="btn btn-ghost btn-sm">Login</a>
          <a href="/login.html#register" class="btn btn-primary btn-sm">Sign Up</a>
        </div>
        
        <div class="user-menu" style="display: none;"></div>
      </div>
    </div>
  </nav>
  
  <!-- Page Header -->
  <header class="bg-gradient-primary p-xl mb-xl" style="margin-top: 60px;">
    <div class="container">
      <h1 class="text-white mb-sm">
        <i class="fas fa-fire mr-sm"></i> Popular Now
      </h1>
      <p class="text-white opacity-80">Most watched content across all platforms</p>
    </div>
  </header>
  
  <!-- Filters -->
  <div class="container mb-lg">
    <div class="filter-container">
      <select class="form-select filter-select" id="content-type-filter">
        <option value="all">All Content</option>
        <option value="movie">Movies</option>
        <option value="tv">TV Shows</option>
        <option value="anime">Anime</option>
      </select>
      
      <select class="form-select filter-select" id="region-filter">
        <option value="">All Regions</option>
        <option value="US">United States</option>
        <option value="IN">India</option>
        <option value="GB">United Kingdom</option>
        <option value="JP">Japan</option>
      </select>
      
      <select class="form-select filter-select" id="time-filter">
        <option value="week">This Week</option>
        <option value="month">This Month</option>
        <option value="all">All Time</option>
      </select>
    </div>
  </div>
  
  <!-- Main Content -->
  <main class="container">
    <div id="category-content">
      <!-- Loading skeleton -->
      <div class="grid">
        <div class="skeleton" style="height: 300px;"></div>
        <div class="skeleton" style="height: 300px;"></div>
        <div class="skeleton" style="height: 300px;"></div>
        <div class="skeleton" style="height: 300px;"></div>
        <div class="skeleton" style="height: 300px;"></div>
        <div class="skeleton" style="height: 300px;"></div>
      </div>
    </div>
    
    <!-- Load More -->
    <div class="text-center mt-xl" id="load-more-container" style="display: none;">
      <button class="btn btn-secondary" onclick="loadMore()">
        <i class="fas fa-plus mr-sm"></i> Load More
      </button>
    </div>
  </main>
  
  <!-- Toast Container -->
  <div class="toast-container"></div>
  
  <!-- Scripts -->
  <script src="/js/main.js"></script>
  <script>
    let currentPage = 1;
    let currentFilters = {
      type: 'all',
      region: '',
      time: 'week'
    };
    let allContent = [];
    
    // Filter handlers
    document.getElementById('content-type-filter').addEventListener('change', (e) => {
      currentFilters.type = e.target.value;
      currentPage = 1;
      loadContent();
    });
    
    document.getElementById('region-filter').addEventListener('change', (e) => {
      currentFilters.region = e.target.value;
      currentPage = 1;
      loadContent();
    });
    
    document.getElementById('time-filter').addEventListener('change', (e) => {
      currentFilters.time = e.target.value;
      currentPage = 1;
      loadContent();
    });
    
    // Load popular content
    async function loadContent() {
      const container = document.getElementById('category-content');
      
      if (currentPage === 1) {
        container.innerHTML = `
          <div class="grid">
            ${Array(6).fill('<div class="skeleton" style="height: 300px;"></div>').join('')}
          </div>
        `;
        allContent = [];
      }
      
      try {
        // Get popular content from multiple sources
        const [movies, tvShows] = await Promise.all([
          currentFilters.type === 'all' || currentFilters.type === 'movie' 
            ? ApiService.getTrending('movie', 10) 
            : Promise.resolve({ recommendations: [] }),
          currentFilters.type === 'all' || currentFilters.type === 'tv' 
            ? ApiService.getTrending('tv', 10) 
            : Promise.resolve({ recommendations: [] })
        ]);
        
        // Combine and sort by popularity
        const newContent = [
          ...(movies.recommendations || []),
          ...(tvShows.recommendations || [])
        ].sort((a, b) => (b.popularity || 0) - (a.popularity || 0));
        
        allContent = currentPage === 1 ? newContent : [...allContent, ...newContent];
        
        renderContentGrid(container, allContent);
        
        // Show/hide load more
        const loadMoreContainer = document.getElementById('load-more-container');
        loadMoreContainer.style.display = newContent.length > 0 ? 'block' : 'none';
        
      } catch (error) {
        console.error('Failed to load content:', error);
        container.innerHTML = '<div class="text-center text-secondary p-xl">Failed to load popular content</div>';
      }
    }
    
    function loadMore() {
      currentPage++;
      loadContent();
    }
    
    // Initialize
    updateAuthUI();
    loadContent();
  </script>
</body>
</html>
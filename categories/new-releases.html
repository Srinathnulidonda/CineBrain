<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Releases - CineScope</title>

    <!-- CSS Files -->
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/components.css">
    <link rel="stylesheet" href="/css/responsive.css">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap"
        rel="stylesheet">
</head>

<body>
    <!-- Include Header -->
    <div id="header-include"></div>

    <!-- Main Content -->
    <main style="padding-top: 80px;">
        <!-- Page Header -->
        <section class="bg-secondary py-12">
            <div class="container text-center">
                <h1 class="text-4xl font-bold mb-4">✨ New Releases</h1>
                <p class="text-lg text-secondary mb-6">Fresh content added to our platform</p>

                <!-- Release countdown -->
                <div class="flex justify-center items-center gap-4 text-sm">
                    <div class="bg-bg-card rounded-lg p-3">
                        <div class="text-lg font-bold text-primary-blue" id="releases-today">0</div>
                        <div class="text-xs text-muted">Today</div>
                    </div>
                    <div class="bg-bg-card rounded-lg p-3">
                        <div class="text-lg font-bold text-primary-purple" id="releases-week">0</div>
                        <div class="text-xs text-muted">This Week</div>
                    </div>
                    <div class="bg-bg-card rounded-lg p-3">
                        <div class="text-lg font-bold text-success" id="coming-soon">0</div>
                        <div class="text-xs text-muted">Coming Soon</div>
                    </div>
                </div>
            </div>
        </section>

        <div class="container py-8">
            <!-- Time Period Tabs -->
            <div class="tabs mb-8">
                <div class="tab-list">
                    <button class="tab-button active" data-period="today">Today</button>
                    <button class="tab-button" data-period="week">This Week</button>
                    <button class="tab-button" data-period="month">This Month</button>
                    <button class="tab-button" data-period="upcoming">Coming Soon</button>
                </div>
            </div>

            <!-- Content Type Filter -->
            <div class="flex justify-center mb-6">
                <div class="flex gap-2 bg-bg-card rounded-lg p-1">
                    <button class="type-filter-btn active" data-type="all">All</button>
                    <button class="type-filter-btn" data-type="movie">Movies</button>
                    <button class="type-filter-btn" data-type="tv">TV Shows</button>
                    <button class="type-filter-btn" data-type="anime">Anime</button>
                </div>
            </div>

            <!-- Language Filter -->
            <div class="flex justify-center mb-8">
                <select id="language-filter" class="form-input w-auto">
                    <option value="">All Languages</option>
                    <option value="english">English</option>
                    <option value="hindi">Hindi</option>
                    <option value="telugu">Telugu</option>
                    <option value="tamil">Tamil</option>
                    <option value="kannada">Kannada</option>
                    <option value="malayalam">Malayalam</option>
                    <option value="japanese">Japanese</option>
                    <option value="korean">Korean</option>
                </select>
            </div>

            <!-- Live Release Feed -->
            <section id="live-releases" class="mb-8" style="display: none;">
                <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">
                    <div class="w-2 h-2 bg-success rounded-full animate-pulse"></div>
                    Live Releases
                </h2>
                <div id="live-releases-content" class="bg-bg-card rounded-lg p-4">
                    <!-- Live updates will appear here -->
                </div>
            </section>

            <!-- Content Grid -->
            <section id="content-grid">
                <div class="flex justify-center p-8">
                    <div class="spinner"></div>
                </div>
            </section>

            <!-- Release Calendar -->
            <section class="mt-12">
                <h2 class="text-2xl font-semibold mb-6">Release Calendar</h2>
                <div id="release-calendar" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- Calendar will be populated dynamically -->
                </div>
            </section>
        </div>
    </main>

    <!-- Include Footer -->
    <div id="footer-include"></div>

    <!-- JavaScript -->
    <script src="/js/main.js"></script>
    <script src="/js/include.js"></script>
    <script src="/js/category-base.js"></script>
    <script>
        class NewReleasesPage extends CategoryBasePage {
            constructor() {
                super('new-releases', 'New Releases');
                this.currentPeriod = 'today';
                this.currentLanguage = '';
                this.liveUpdates = [];
                this.init();
            }

            init() {
                super.init();
                this.setupPeriodFilters();
                this.setupLanguageFilter();
                this.loadReleaseStats();
                this.loadReleaseCalendar();
                this.startLiveUpdates();
            }

            setupPeriodFilters() {
                document.querySelectorAll('.tab-button').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        this.currentPeriod = e.target.dataset.period;
                        this.switchActiveTab(e.target);
                        this.loadContent();
                    });
                });
            }

            setupLanguageFilter() {
                document.getElementById('language-filter').addEventListener('change', (e) => {
                    this.currentLanguage = e.target.value;
                    this.loadContent();
                });
            }

            async loadContent() {
                const container = document.getElementById('content-grid');
                UIComponents.showLoading(container);

                try {
                    const params = {
                        type: this.currentType,
                        period: this.currentPeriod,
                        limit: 24
                    };

                    if (this.currentLanguage) {
                        params.language = this.currentLanguage;
                    }

                    const response = await ApiService.get('/recommendations/new-releases', params);
                    this.renderContent(response.recommendations, container);
                } catch (error) {
                    UIComponents.showError(container, 'Failed to load new releases');
                }
            }

            async loadReleaseStats() {
                try {
                    // Simulate real-time release stats
                    const stats = {
                        today: Math.floor(Math.random() * 20) + 5,
                        week: Math.floor(Math.random() * 100) + 50,
                        upcoming: Math.floor(Math.random() * 200) + 100
                    };

                    document.getElementById('releases-today').textContent = stats.today;
                    document.getElementById('releases-week').textContent = stats.week;
                    document.getElementById('coming-soon').textContent = stats.upcoming;
                } catch (error) {
                    console.error('Failed to load release stats:', error);
                }
            }

            async loadReleaseCalendar() {
                const container = document.getElementById('release-calendar');

                try {
                    // Simulate upcoming releases
                    const upcomingReleases = this.generateUpcomingReleases();

                    container.innerHTML = upcomingReleases.map(release => `
                        <div class="card p-4">
                            <div class="flex items-center gap-3">
                                <div class="text-center">
                                    <div class="text-lg font-bold text-primary-blue">${release.date}</div>
                                    <div class="text-xs text-muted">${release.month}</div>
                                </div>
                                <div class="flex-1">
                                    <h4 class="font-semibold">${release.title}</h4>
                                    <p class="text-sm text-secondary">${release.type} • ${release.genre}</p>
                                </div>
                                <div class="text-right">
                                    <div class="text-sm font-semibold text-success">${release.countdown}</div>
                                </div>
                            </div>
                        </div>
                    `).join('');
                } catch (error) {
                    console.error('Failed to load release calendar:', error);
                }
            }

            generateUpcomingReleases() {
                const releases = [];
                const today = new Date();

                for (let i = 1; i <= 9; i++) {
                    const releaseDate = new Date(today);
                    releaseDate.setDate(today.getDate() + i);

                    releases.push({
                        date: releaseDate.getDate(),
                        month: releaseDate.toLocaleDateString('en', { month: 'short' }),
                        title: `Upcoming Title ${i}`,
                        type: ['Movie', 'TV Show', 'Anime'][Math.floor(Math.random() * 3)],
                        genre: ['Action', 'Comedy', 'Drama', 'Thriller'][Math.floor(Math.random() * 4)],
                        countdown: `${i} day${i > 1 ? 's' : ''}`
                    });
                }

                return releases;
            }

            startLiveUpdates() {
                // Simulate live release notifications
                setInterval(() => {
                    this.simulateLiveRelease();
                }, 45000); // Every 45 seconds

                // Update stats every 2 minutes
                setInterval(() => {
                    this.loadReleaseStats();
                }, 2 * 60 * 1000);
            }

            simulateLiveRelease() {
                const titles = [
                    'New Blockbuster Movie',
                    'Popular TV Series S2',
                    'Trending Anime Episode',
                    'Award-Winning Documentary'
                ];

                const types = ['Movie', 'TV Show', 'Anime', 'Documentary'];
                const randomTitle = titles[Math.floor(Math.random() * titles.length)];
                const randomType = types[Math.floor(Math.random() * types.length)];

                this.showLiveReleaseNotification(randomTitle, randomType);
            }

            showLiveReleaseNotification(title, type) {
                const liveSection = document.getElementById('live-releases');
                const liveContent = document.getElementById('live-releases-content');

                liveSection.style.display = 'block';

                const notification = document.createElement('div');
                notification.className = 'flex items-center gap-3 p-3 bg-bg-tertiary rounded-lg mb-2 opacity-0 transform translate-x-4';
                notification.innerHTML = `
                    <div class="w-2 h-2 bg-success rounded-full animate-pulse"></div>
                    <div class="flex-1">
                        <div class="font-semibold">${title}</div>
                        <div class="text-sm text-muted">${type} • Just released</div>
                    </div>
                    <div class="text-xs text-success">NEW</div>
                `;

                liveContent.insertBefore(notification, liveContent.firstChild);

                // Animate in
                setTimeout(() => {
                    notification.classList.remove('opacity-0', 'translate-x-4');
                }, 100);

                // Remove old notifications (keep only 3)
                const notifications = liveContent.children;
                if (notifications.length > 3) {
                    for (let i = 3; i < notifications.length; i++) {
                        notifications[i].remove();
                    }
                }

                // Auto-hide after 10 seconds if no notifications
                setTimeout(() => {
                    if (liveContent.children.length === 0) {
                        liveSection.style.display = 'none';
                    }
                }, 10000);
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            new NewReleasesPage();
        });
    </script>
</body>

</html>
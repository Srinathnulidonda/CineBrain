<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Critics Choice - CineScope</title>
    <link rel="icon" type="image/x-icon" href="/assets/favicon.ico">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/main.css">
</head>
<body>
    <!-- Header -->
    <div data-include="/includes/header.html"></div>

    <main class="container py-8">
        <!-- Page Header -->
        <div class="mb-8">
            <div class="flex items-center gap-4 mb-4">
                <div class="text-6xl">üèÜ</div>
                <div>
                    <h1 class="text-4xl font-bold mb-2">Critics Choice</h1>
                    <p class="text-gray-400">Highly rated content with exceptional reviews and critical acclaim</p>
                </div>
            </div>
        </div>

        <!-- Rating Info -->
        <div class="card p-6 mb-8">
            <h2 class="text-xl font-bold mb-4">What Makes Critics Choice?</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="text-center">
                    <div class="text-3xl font-bold text-yellow-400 mb-2">7.5+</div>
                    <div class="text-sm text-gray-400">Minimum Rating</div>
                </div>
                <div class="text-center">
                    <div class="text-3xl font-bold text-green-400 mb-2">100+</div>
                    <div class="text-sm text-gray-400">Minimum Votes</div>
                </div>
                <div class="text-center">
                    <div class="text-3xl font-bold text-purple-400 mb-2">Expert</div>
                    <div class="text-sm text-gray-400">Curated Selection</div>
                </div>
            </div>
        </div>

        <!-- Filters -->
        <div class="flex flex-wrap gap-4 mb-8 p-4 bg-gray-800 rounded-lg">
            <select id="type-filter" class="form-select">
                <option value="all">All Types</option>
                <option value="movie">Movies</option>
                <option value="tv">TV Shows</option>
                <option value="anime">Anime</option>
            </select>

            <select id="genre-filter" class="form-select">
                <option value="">All Genres</option>
                <option value="drama">Drama</option>
                <option value="thriller">Thriller</option>
                <option value="comedy">Comedy</option>
                <option value="action">Action</option>
                <option value="romance">Romance</option>
                <option value="sci-fi">Sci-Fi</option>
                <option value="horror">Horror</option>
                <option value="documentary">Documentary</option>
            </select>

            <select id="year-filter" class="form-select">
                <option value="">All Years</option>
                <option value="2024">2024</option>
                <option value="2023">2023</option>
                <option value="2022">2022</option>
                <option value="2021">2021</option>
                <option value="2020">2020</option>
                <option value="older">Older</option>
            </select>

            <select id="sort-filter" class="form-select">
                <option value="rating">Highest Rated</option>
                <option value="votes">Most Voted</option>
                <option value="recent">Most Recent</option>
                <option value="title">Title A-Z</option>
            </select>

            <button id="reset-filters" class="btn btn-outline">Reset Filters</button>
        </div>

        <!-- Content Sections -->
        <div id="content-sections">
            <!-- All-Time Classics -->
            <section id="classics-section" class="mb-12">
                <h2 class="text-2xl font-bold mb-6">üé≠ All-Time Classics</h2>
                <div id="classics-content" class="grid-responsive">
                    <!-- Loading skeletons -->
                    <div class="skeleton h-80 rounded-lg"></div>
                    <div class="skeleton h-80 rounded-lg"></div>
                    <div class="skeleton h-80 rounded-lg"></div>
                    <div class="skeleton h-80 rounded-lg"></div>
                    <div class="skeleton h-80 rounded-lg"></div>
                </div>
            </section>

            <!-- Critics Choice Movies -->
            <section id="movies-section" class="mb-12">
                <h2 class="text-2xl font-bold mb-6">üé¨ Critics Choice Movies</h2>
                <div id="movies-content" class="grid-responsive">
                    <!-- Loading skeletons -->
                    <div class="skeleton h-80 rounded-lg"></div>
                    <div class="skeleton h-80 rounded-lg"></div>
                    <div class="skeleton h-80 rounded-lg"></div>
                    <div class="skeleton h-80 rounded-lg"></div>
                    <div class="skeleton h-80 rounded-lg"></div>
                </div>
            </section>

            <!-- Critics Choice TV Shows -->
            <section id="tv-section" class="mb-12">
                <h2 class="text-2xl font-bold mb-6">üì∫ Critics Choice TV Shows</h2>
                <div id="tv-content" class="grid-responsive">
                    <!-- Loading skeletons -->
                    <div class="skeleton h-80 rounded-lg"></div>
                    <div class="skeleton h-80 rounded-lg"></div>
                    <div class="skeleton h-80 rounded-lg"></div>
                    <div class="skeleton h-80 rounded-lg"></div>
                    <div class="skeleton h-80 rounded-lg"></div>
                </div>
            </section>

            <!-- Award Winners -->
            <section id="awards-section" class="mb-12">
                <h2 class="text-2xl font-bold mb-6">üèÖ Award Winners</h2>
                <div id="awards-content" class="grid-responsive">
                    <!-- Awards content -->
                </div>
            </section>
        </div>

        <!-- Load More Button -->
        <div class="text-center mt-12">
            <button id="load-more-btn" class="btn btn-outline btn-lg">
                Load More Critics Choice
            </button>
        </div>
    </main>

    <!-- Footer -->
    <div data-include="/includes/footer.html"></div>

    <script src="/js/main.js"></script>
    <script>
        let currentPage = 1;
        let currentFilters = {
            type: 'all',
            genre: '',
            year: '',
            sort: 'rating'
        };
        let isLoading = false;

        document.addEventListener('DOMContentLoaded', function() {
            setupFilters();
            loadCriticsChoiceContent();
        });

        function setupFilters() {
            const filters = ['type-filter', 'genre-filter', 'year-filter', 'sort-filter'];
            
            filters.forEach(filterId => {
                const filter = document.getElementById(filterId);
                if (filter) {
                    filter.addEventListener('change', (e) => {
                        const filterType = filterId.replace('-filter', '');
                        currentFilters[filterType] = e.target.value;
                        currentPage = 1;
                        loadCriticsChoiceContent(true);
                    });
                }
            });

            document.getElementById('reset-filters').addEventListener('click', resetFilters);
            document.getElementById('load-more-btn').addEventListener('click', loadMore);
        }

        function resetFilters() {
            document.getElementById('type-filter').value = 'all';
            document.getElementById('genre-filter').value = '';
            document.getElementById('year-filter').value = '';
            document.getElementById('sort-filter').value = 'rating';
            
            currentFilters = { type: 'all', genre: '', year: '', sort: 'rating' };
            currentPage = 1;
            loadCriticsChoiceContent(true);
        }

        async function loadCriticsChoiceContent(reset = true) {
            if (isLoading) return;
            isLoading = true;

            try {
                if (currentFilters.type === 'all' && reset) {
                    await loadAllSections();
                } else {
                    await loadFilteredContent();
                }
            } catch (error) {
                console.error('Failed to load critics choice content:', error);
                app.showToast('Failed to load content', 'error');
            } finally {
                isLoading = false;
            }
        }

        async function loadAllSections() {
            const sections = [
                { 
                    id: 'classics-content', 
                    loader: () => apiClient.getCriticsChoice('movie', 10),
                    sectionId: 'classics-section'
                },
                { 
                    id: 'movies-content', 
                    loader: () => apiClient.getCriticsChoice('movie', 10),
                    sectionId: 'movies-section'
                },
                { 
                    id: 'tv-content', 
                    loader: () => apiClient.getCriticsChoice('tv', 10),
                    sectionId: 'tv-section'
                },
                { 
                    id: 'awards-content', 
                    loader: () => apiClient.getCriticsChoice('movie', 8),
                    sectionId: 'awards-section'
                }
            ];

            for (const section of sections) {
                const container = document.getElementById(section.id);
                const sectionElement = document.getElementById(section.sectionId);
                
                if (!container) continue;

                try {
                    const content = await section.loader();
                    
                    if (content && content.length > 0) {
                        // Apply additional sorting for classics
                        if (section.id === 'classics-content') {
                            content.sort((a, b) => (b.rating || 0) - (a.rating || 0));
                        }
                        
                        container.innerHTML = content.map(item => createCriticsChoiceCard(item)).join('');
                        sectionElement.style.display = 'block';
                    } else {
                        sectionElement.style.display = 'none';
                    }
                } catch (error) {
                    console.error(`Failed to load section ${section.id}:`, error);
                    container.innerHTML = '<div class="col-span-full text-center py-8 text-red-400">Failed to load content</div>';
                }
            }

            document.getElementById('load-more-btn').style.display = 'block';
        }

        async function loadFilteredContent() {
            // Hide all sections first
            document.getElementById('classics-section').style.display = 'none';
            document.getElementById('movies-section').style.display = 'none';
            document.getElementById('tv-section').style.display = 'none';
            document.getElementById('awards-section').style.display = 'none';

            let content = [];
            let containerId = '';
            let sectionId = '';

            switch (currentFilters.type) {
                case 'movie':
                    content = await apiClient.getCriticsChoice('movie', 20);
                    containerId = 'movies-content';
                    sectionId = 'movies-section';
                    break;
                case 'tv':
                    content = await apiClient.getCriticsChoice('tv', 20);
                    containerId = 'tv-content';
                    sectionId = 'tv-section';
                    break;
                case 'anime':
                    content = await apiClient.getAnimeRecommendations('', 20);
                    // Filter for high ratings
                    content = content.filter(item => item.rating && item.rating >= 7.5);
                    containerId = 'movies-content';
                    sectionId = 'movies-section';
                    break;
                default:
                    await loadAllSections();
                    return;
            }

            // Apply additional filters
            if (currentFilters.genre && content.length > 0) {
                content = content.filter(item => {
                    if (item.genres) {
                        const genres = typeof item.genres === 'string' ? JSON.parse(item.genres) : item.genres;
                        return genres.some(genre => genre.toLowerCase().includes(currentFilters.genre.toLowerCase()));
                    }
                    return false;
                });
            }

            // Apply sorting
            if (content.length > 0) {
                content.sort((a, b) => {
                    switch (currentFilters.sort) {
                        case 'rating':
                            return (b.rating || 0) - (a.rating || 0);
                        case 'votes':
                            return (b.vote_count || 0) - (a.vote_count || 0);
                        case 'recent':
                            return new Date(b.release_date || 0) - new Date(a.release_date || 0);
                        case 'title':
                            return a.title.localeCompare(b.title);
                        default:
                            return 0;
                    }
                });
            }

            if (content && content.length > 0) {
                const container = document.getElementById(containerId);
                container.innerHTML = content.map(item => createCriticsChoiceCard(item)).join('');
                document.getElementById(sectionId).style.display = 'block';
            }

            document.getElementById('load-more-btn').style.display = content.length >= 20 ? 'block' : 'none';
        }

        function createCriticsChoiceCard(item) {
            const card = UIComponents.createContentCard(item);
            
            // Add critics choice badge
            const ratingBadge = item.rating ? `
                <div class="absolute top-2 left-2 bg-yellow-600 text-white px-2 py-1 rounded text-xs font-bold">
                    ${item.rating.toFixed(1)} ‚≠ê
                </div>
            ` : '';
            
            // Insert rating badge into the card
            return card.replace(
                '<div class="content-card-actions">',
                ratingBadge + '<div class="content-card-actions">'
            );
        }

        async function loadMore() {
            currentPage++;
            await loadCriticsChoiceContent(false);
        }
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <script>document.write('<script src="/includes/head.html"><\/script>');</script>
    <title>Movies | CineScope</title>
</head>
<body>
    <div data-include="header"></div>
    
    <main class="container py-8 pt-24">
        <section class="category-header mb-8">
            <h1 class="text-4xl font-bold mb-4">
                <i class="fas fa-film text-purple-500 mr-3"></i>
                <span class="text-gradient">Movies</span>
            </h1>
            <p class="text-gray-400 text-lg">Explore our vast collection of movies from around the world</p>
        </section>

        <div class="category-filters mb-8">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <select id="genre" class="filter-select" onchange="loadMovies()">
                    <option value="">All Genres</option>
                    <option value="action">Action</option>
                    <option value="adventure">Adventure</option>
                    <option value="comedy">Comedy</option>
                    <option value="drama">Drama</option>
                    <option value="fantasy">Fantasy</option>
                    <option value="horror">Horror</option>
                    <option value="mystery">Mystery</option>
                    <option value="romance">Romance</option>
                    <option value="sci-fi">Sci-Fi</option>
                    <option value="thriller">Thriller</option>
                    <option value="western">Western</option>
                </select>
                <select id="year" class="filter-select" onchange="loadMovies()">
                    <option value="">All Years</option>
                    <option value="2024">2024</option>
                    <option value="2023">2023</option>
                    <option value="2022">2022</option>
                    <option value="2021">2021</option>
                    <option value="2020">2020</option>
                    <option value="2010s">2010-2019</option>
                    <option value="2000s">2000-2009</option>
                    <option value="1990s">1990-1999</option>
                </select>
                <select id="language" class="filter-select" onchange="loadMovies()">
                    <option value="">All Languages</option>
                    <option value="english">English</option>
                    <option value="hindi">Hindi</option>
                    <option value="telugu">Telugu</option>
                    <option value="tamil">Tamil</option>
                    <option value="kannada">Kannada</option>
                    <option value="malayalam">Malayalam</option>
                </select>
                <select id="sortBy" class="filter-select" onchange="loadMovies()">
                    <option value="popularity">Popularity</option>
                    <option value="rating">Rating</option>
                    <option value="release_date">Release Date</option>
                    <option value="title">Title A-Z</option>
                </select>
            </div>
        </div>

        <div class="movie-sections">
            <!-- Quick Categories -->
            <section class="mb-12">
                <h2 class="section-title mb-6">Quick Categories</h2>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <button class="category-quick-btn" onclick="quickFilter('action')">
                        <i class="fas fa-fist-raised"></i>
                        <span>Action</span>
                    </button>
                    <button class="category-quick-btn" onclick="quickFilter('comedy')">
                        <i class="fas fa-laugh"></i>
                        <span>Comedy</span>
                    </button>
                    <button class="category-quick-btn" onclick="quickFilter('horror')">
                        <i class="fas fa-ghost"></i>
                        <span>Horror</span>
                    </button>
                    <button class="category-quick-btn" onclick="quickFilter('romance')">
                        <i class="fas fa-heart"></i>
                        <span>Romance</span>
                    </button>
                </div>
            </section>

            <!-- Movies Grid -->
            <section>
                <div id="moviesContent">
                    <div class="loading"><div class="spinner"></div></div>
                </div>
            </section>
        </div>
    </main>

    <div data-include="footer"></div>

    <script src="/js/auth.js"></script>
    <script src="/js/api.js"></script>
    <script src="/js/main.js"></script>
    <script>
        let allMovies = [];

        async function loadMovies() {
            const container = document.getElementById('moviesContent');
            const genre = document.getElementById('genre').value;
            const year = document.getElementById('year').value;
            const language = document.getElementById('language').value;
            
            container.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
            
            try {
                let response;
                if (genre) {
                    response = await APIService.getGenreRecommendations(genre, 'movie', 50);
                } else if (language) {
                    response = await APIService.getRegionalContent(language, 'movie', 50);
                } else {
                    response = await APIService.getTrending('movie', 50);
                }
                
                allMovies = response.recommendations || [];
                
                // Apply additional filters
                if (year) {
                    allMovies = allMovies.filter(movie => {
                        if (!movie.release_date) return false;
                        const movieYear = new Date(movie.release_date).getFullYear();
                        
                        if (year.includes('s')) {
                            const decade = parseInt(year);
                            return movieYear >= decade && movieYear < decade + 10;
                        } else {
                            return movieYear === parseInt(year);
                        }
                    });
                }

                sortMovies();
                displayMovies();
            } catch (error) {
                container.innerHTML = '<p class="text-center text-red-400 py-8">Failed to load movies</p>';
            }
        }

        function sortMovies() {
            const sortBy = document.getElementById('sortBy').value;
            
            allMovies.sort((a, b) => {
                switch (sortBy) {
                    case 'rating':
                        return (b.rating || 0) - (a.rating || 0);
                    case 'release_date':
                        const dateA = a.release_date ? new Date(a.release_date) : new Date(0);
                        const dateB = b.release_date ? new Date(b.release_date) : new Date(0);
                        return dateB - dateA;
                    case 'title':
                        return a.title.localeCompare(b.title);
                    default: // popularity
                        return (b.popularity || 0) - (a.popularity || 0);
                }
            });
        }

        function displayMovies() {
            const container = document.getElementById('moviesContent');
            
            if (allMovies.length > 0) {
                const moviesHTML = allMovies.map(movie => `
                    <div class="content-card cursor-pointer" onclick="window.location.href='/details?id=${movie.id}'">
                        <div class="content-card-image">
                            <img src="${movie.poster_path || '/assets/images/placeholder.jpg'}" alt="${movie.title}" loading="lazy">
                            <div class="content-card-overlay"></div>
                            <div class="content-card-actions">
                                <button class="btn btn-primary btn-sm" onclick="event.stopPropagation(); ContentManager.addToWatchlist(${movie.id})">
                                    <i class="fas fa-bookmark"></i>
                                </button>
                                <button class="btn btn-ghost btn-sm" onclick="event.stopPropagation(); ContentManager.addToFavorites(${movie.id})">
                                    <i class="fas fa-heart"></i>
                                </button>
                                ${movie.youtube_trailer ? `
                                    <button class="btn btn-ghost btn-sm" onclick="event.stopPropagation(); ContentManager.playTrailer('${movie.youtube_trailer}')">
                                        <i class="fas fa-play"></i>
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                        <div class="content-card-info">
                            <div class="content-card-title">${movie.title}</div>
                            <div class="content-card-meta">
                                <span class="rating">
                                    <i class="fas fa-star"></i> ${movie.rating ? movie.rating.toFixed(1) : 'N/A'}
                                </span>
                                <span class="year">${movie.release_date ? new Date(movie.release_date).getFullYear() : ''}</span>
                            </div>
                            <div class="text-xs text-gray-400 mt-2">
                                ${movie.genres ? movie.genres.slice(0, 2).join(', ') : ''}
                            </div>
                        </div>
                    </div>
                `).join('');
                
                container.innerHTML = `<div class="content-grid">${moviesHTML}</div>`;
            } else {
                container.innerHTML = '<p class="text-center text-gray-400 py-8">No movies found with current filters</p>';
            }
        }

        function quickFilter(genre) {
            document.getElementById('genre').value = genre;
            loadMovies();
        }

        document.addEventListener('DOMContentLoaded', loadMovies);
    </script>

    <style>
        .category-quick-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 20px 16px;
            background: var(--dark-surface);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            color: var(--text-primary);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .category-quick-btn:hover {
            border-color: var(--primary);
            background: var(--dark-hover);
        }
        .category-quick-btn i {
            font-size: 24px;
            color: var(--primary);
        }
    </style>
</body>
</html>
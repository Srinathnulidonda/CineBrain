<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics - CineScope Admin</title>

    <!-- CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="/assets/css/base.css" rel="stylesheet">
    <link href="/assets/css/components.css" rel="stylesheet">
    <link href="/assets/css/layouts.css" rel="stylesheet">
    <link href="/assets/css/animations.css" rel="stylesheet">
    <link href="/assets/css/responsive.css" rel="stylesheet">
    <link href="/assets/css/utilities.css" rel="stylesheet">
</head>

<body>
    <div class="app-layout">
        <!-- Navigation -->
        <nav class="navbar">
            <div class="container navbar__container">
                <a href="/" class="navbar__logo">CineScope Admin</a>

                <div class="navbar__menu">
                    <a href="/admin/index.html" class="navbar__link">Dashboard</a>
                    <a href="/admin/content.html" class="navbar__link">Content</a>
                    <a href="/admin/recommendations.html" class="navbar__link">Recommendations</a>
                    <a href="/admin/analytics.html" class="navbar__link navbar__link--active">Analytics</a>
                </div>

                <div class="navbar__user">
                    <span class="text-sm text-muted me-md">Admin Panel</span>
                    <button class="btn btn-sm btn-secondary" onclick="auth.logout()">
                        <i class="bi bi-box-arrow-right"></i> Logout
                    </button>
                </div>
            </div>
        </nav>

        <!-- Admin Layout -->
        <div class="admin-layout">
            <!-- Sidebar -->
            <aside class="admin-sidebar">
                <div class="sidebar__section">
                    <h3 class="sidebar__title">Analytics Period</h3>
                    <nav class="sidebar__nav">
                        <a href="#" class="sidebar__link sidebar__link--active" data-period="week">
                            <i class="bi bi-calendar-week"></i> Last 7 Days
                        </a>
                        <a href="#" class="sidebar__link" data-period="month">
                            <i class="bi bi-calendar-month"></i> Last 30 Days
                        </a>
                        <a href="#" class="sidebar__link" data-period="year">
                            <i class="bi bi-calendar"></i> Last Year
                        </a>
                    </nav>
                </div>

                <div class="sidebar__section">
                    <h3 class="sidebar__title">Navigation</h3>
                    <nav class="sidebar__nav">
                        <a href="/admin/index.html" class="sidebar__link">
                            <i class="bi bi-speedometer2"></i> Dashboard
                        </a>
                        <a href="/admin/content.html" class="sidebar__link">
                            <i class="bi bi-collection-play"></i> Content Management
                        </a>
                        <a href="/admin/recommendations.html" class="sidebar__link">
                            <i class="bi bi-award"></i> Recommendations
                        </a>
                        <a href="/admin/analytics.html" class="sidebar__link sidebar__link--active">
                            <i class="bi bi-graph-up"></i> Analytics
                        </a>
                    </nav>
                </div>
            </aside>

            <!-- Main Content -->
            <main class="admin-content">
                <div class="admin-header">
                    <h1>Analytics Dashboard</h1>
                    <div class="d-flex gap-sm">
                        <button class="btn btn-secondary" onclick="exportAnalytics()">
                            <i class="bi bi-download"></i> Export Report
                        </button>
                        <button class="btn btn-primary" onclick="refreshAnalytics()">
                            <i class="bi bi-arrow-clockwise"></i> Refresh
                        </button>
                    </div>
                </div>

                <!-- Key Metrics -->
                <div class="row mb-lg">
                    <div class="col-md-3">
                        <div class="admin-stat-card">
                            <div class="admin-stat-card__label">Total Views</div>
                            <div class="admin-stat-card__value">124.5K</div>
                            <div class="admin-stat-card__change text-success">
                                <i class="bi bi-arrow-up"></i> +15%
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="admin-stat-card">
                            <div class="admin-stat-card__label">Unique Users</div>
                            <div class="admin-stat-card__value">8,234</div>
                            <div class="admin-stat-card__change text-success">
                                <i class="bi bi-arrow-up"></i> +8%
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="admin-stat-card">
                            <div class="admin-stat-card__label">Avg. Session</div>
                            <div class="admin-stat-card__value">12m 34s</div>
                            <div class="admin-stat-card__change text-success">
                                <i class="bi bi-arrow-up"></i> +3%
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="admin-stat-card">
                            <div class="admin-stat-card__label">Bounce Rate</div>
                            <div class="admin-stat-card__value">24.3%</div>
                            <div class="admin-stat-card__change text-success">
                                <i class="bi bi-arrow-down"></i> -2%
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts Row -->
                <div class="row mb-lg">
                    <!-- User Activity Chart -->
                    <div class="col-lg-8">
                        <div class="bg-secondary rounded-lg p-lg">
                            <h3 class="mb-lg">User Activity</h3>
                            <div class="chart-container" style="height: 300px;">
                                <canvas id="activityChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Device Breakdown -->
                    <div class="col-lg-4">
                        <div class="bg-secondary rounded-lg p-lg">
                            <h3 class="mb-lg">Device Breakdown</h3>
                            <div class="device-stats">
                                <div class="mb-md">
                                    <div class="d-flex justify-between mb-xs">
                                        <span><i class="bi bi-display"></i> Desktop</span>
                                        <span class="font-weight-semibold">45%</span>
                                    </div>
                                    <div class="progress" style="height: 8px;">
                                        <div class="progress-bar bg-gradient-primary" style="width: 45%"></div>
                                    </div>
                                </div>
                                <div class="mb-md">
                                    <div class="d-flex justify-between mb-xs">
                                        <span><i class="bi bi-phone"></i> Mobile</span>
                                        <span class="font-weight-semibold">40%</span>
                                    </div>
                                    <div class="progress" style="height: 8px;">
                                        <div class="progress-bar bg-gradient-primary" style="width: 40%"></div>
                                    </div>
                                </div>
                                <div class="mb-md">
                                    <div class="d-flex justify-between mb-xs">
                                        <span><i class="bi bi-tablet"></i> Tablet</span>
                                        <span class="font-weight-semibold">15%</span>
                                    </div>
                                    <div class="progress" style="height: 8px;">
                                        <div class="progress-bar bg-gradient-primary" style="width: 15%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Content Performance -->
                <div class="row mb-lg">
                    <div class="col-lg-6">
                        <div class="bg-secondary rounded-lg p-lg">
                            <h3 class="mb-lg">Top Performing Content</h3>
                            <div class="table-responsive">
                                <table class="table table-dark table-sm">
                                    <thead>
                                        <tr>
                                            <th>Title</th>
                                            <th>Views</th>
                                            <th>Rating</th>
                                            <th>Trend</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>Avatar: The Way of Water</td>
                                            <td>12,345</td>
                                            <td><i class="bi bi-star-fill text-gold"></i> 8.2</td>
                                            <td class="text-success">↑ 15%</td>
                                        </tr>
                                        <tr>
                                            <td>The Last of Us</td>
                                            <td>10,234</td>
                                            <td><i class="bi bi-star-fill text-gold"></i> 8.9</td>
                                            <td class="text-success">↑ 8%</td>
                                        </tr>
                                        <tr>
                                            <td>Oppenheimer</td>
                                            <td>9,876</td>
                                            <td><i class="bi bi-star-fill text-gold"></i> 8.5</td>
                                            <td class="text-success">↑ 12%</td>
                                        </tr>
                                        <tr>
                                            <td>Attack on Titan</td>
                                            <td>8,765</td>
                                            <td><i class="bi bi-star-fill text-gold"></i> 9.0</td>
                                            <td class="text-error">↓ 3%</td>
                                        </tr>
                                        <tr>
                                            <td>Breaking Bad</td>
                                            <td>7,654</td>
                                            <td><i class="bi bi-star-fill text-gold"></i> 9.5</td>
                                            <td class="text-success">↑ 5%</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- User Engagement -->
                    <div class="col-lg-6">
                        <div class="bg-secondary rounded-lg p-lg">
                            <h3 class="mb-lg">User Engagement</h3>
                            <div class="engagement-metrics">
                                <div class="metric-item mb-lg">
                                    <div class="d-flex justify-between align-center mb-sm">
                                        <div>
                                            <p class="font-weight-semibold mb-xs">Watchlist Additions</p>
                                            <p class="text-sm text-muted">Last 7 days</p>
                                        </div>
                                        <div class="text-end">
                                            <p class="text-2xl font-weight-bold text-success">+1,234</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="metric-item mb-lg">
                                    <div class="d-flex justify-between align-center mb-sm">
                                        <div>
                                            <p class="font-weight-semibold mb-xs">Favorites Added</p>
                                            <p class="text-sm text-muted">Last 7 days</p>
                                        </div>
                                        <div class="text-end">
                                            <p class="text-2xl font-weight-bold text-success">+876</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="metric-item mb-lg">
                                    <div class="d-flex justify-between align-center mb-sm">
                                        <div>
                                            <p class="font-weight-semibold mb-xs">Reviews Posted</p>
                                            <p class="text-sm text-muted">Last 7 days</p>
                                        </div>
                                        <div class="text-end">
                                            <p class="text-2xl font-weight-bold text-success">+234</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="metric-item">
                                    <div class="d-flex justify-between align-center mb-sm">
                                        <div>
                                            <p class="font-weight-semibold mb-xs">Shares</p>
                                            <p class="text-sm text-muted">Last 7 days</p>
                                        </div>
                                        <div class="text-end">
                                            <p class="text-2xl font-weight-bold text-success">+567</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Geographic Distribution -->
                <div class="bg-secondary rounded-lg p-lg">
                    <h3 class="mb-lg">Geographic Distribution</h3>
                    <div class="row">
                        <div class="col-md-8">
                            <div class="map-placeholder"
                                style="height: 300px; background: var(--bg-tertiary); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                <p class="text-muted">World Map Visualization</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <h4 class="mb-md">Top Countries</h4>
                            <div class="country-list">
                                <div class="mb-sm d-flex justify-between">
                                    <span>🇺🇸 United States</span>
                                    <span class="font-weight-semibold">35%</span>
                                </div>
                                <div class="mb-sm d-flex justify-between">
                                    <span>🇮🇳 India</span>
                                    <span class="font-weight-semibold">22%</span>
                                </div>
                                <div class="mb-sm d-flex justify-between">
                                    <span>🇬🇧 United Kingdom</span>
                                    <span class="font-weight-semibold">12%</span>
                                </div>
                                <div class="mb-sm d-flex justify-between">
                                    <span>🇯🇵 Japan</span>
                                    <span class="font-weight-semibold">8%</span>
                                </div>
                                <div class="mb-sm d-flex justify-between">
                                    <span>🇩🇪 Germany</span>
                                    <span class="font-weight-semibold">6%</span>
                                </div>
                                <div class="d-flex justify-between">
                                    <span>Others</span>
                                    <span class="font-weight-semibold">17%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Chart.js for visualization (simplified) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Scripts -->
    <script src="/assets/js/core/config.js"></script>
    <script src="/assets/js/core/storage.js"></script>
    <script src="/assets/js/core/api.js"></script>
    <script src="/assets/js/core/auth.js"></script>
    <script src="/assets/js/core/router.js"></script>

    <script>
        // Check admin authentication
        if (!auth.requireAdmin()) {
            // Will redirect if not admin
        }

        let currentPeriod = 'week';
        let activityChart = null;

        // Initialize page
        document.addEventListener('DOMContentLoaded', () => {
            loadAnalytics();
            setupPeriodSelector();
            initializeCharts();
        });

        async function loadAnalytics() {
            try {
                const response = await api.getAnalytics();
                // Update UI with analytics data
                console.log('Analytics loaded:', response);
            } catch (error) {
                console.error('Failed to load analytics:', error);
            }
        }

        function setupPeriodSelector() {
            document.querySelectorAll('[data-period]').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();

                    // Update active state
                    document.querySelectorAll('[data-period]').forEach(l => l.classList.remove('sidebar__link--active'));
                    link.classList.add('sidebar__link--active');

                    currentPeriod = link.dataset.period;
                    refreshAnalytics();
                });
            });
        }

        function initializeCharts() {
            // Initialize activity chart
            const ctx = document.getElementById('activityChart');
            if (ctx) {
                activityChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                        datasets: [{
                            label: 'User Activity',
                            data: [1200, 1900, 1500, 2100, 2300, 1800, 2500],
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.05)'
                                },
                                ticks: {
                                    color: '#9ca3af'
                                }
                            },
                            x: {
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.05)'
                                },
                                ticks: {
                                    color: '#9ca3af'
                                }
                            }
                        }
                    }
                });
            }
        }

        function refreshAnalytics() {
            showToast(`Loading ${currentPeriod} analytics...`, 'info');

            // Update chart data based on period
            if (activityChart) {
                const newData = generateMockData(currentPeriod);
                activityChart.data.labels = newData.labels;
                activityChart.data.datasets[0].data = newData.data;
                activityChart.update();
            }

            loadAnalytics();
        }

        function generateMockData(period) {
            if (period === 'week') {
                return {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    data: [1200, 1900, 1500, 2100, 2300, 1800, 2500]
                };
            } else if (period === 'month') {
                return {
                    labels: Array.from({ length: 30 }, (_, i) => i + 1),
                    data: Array.from({ length: 30 }, () => Math.floor(Math.random() * 3000) + 1000)
                };
            } else {
                return {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                    data: [15000, 18000, 16000, 20000, 22000, 24000, 26000, 25000, 23000, 21000, 19000, 17000]
                };
            }
        }

        function exportAnalytics() {
            showToast('Preparing analytics export...', 'info');

            // Simulate export
            setTimeout(() => {
                const data = {
                    period: currentPeriod,
                    exported_at: new Date().toISOString(),
                    metrics: {
                        total_views: 124500,
                        unique_users: 8234,
                        avg_session: '12m 34s',
                        bounce_rate: '24.3%'
                    }
                };

                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `cinescope-analytics-${currentPeriod}-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);

                showToast('Analytics exported successfully', 'success');
            }, 1000);
        }

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast toast--${type} animate-slideInRight`;
            toast.innerHTML = `
                <i class="bi bi-${type === 'success' ? 'check-circle' : type === 'error' ? 'x-circle' : 'info-circle'} toast__icon"></i>
                <span class="toast__message">${message}</span>
                <i class="bi bi-x toast__close" onclick="this.parentElement.remove()"></i>
            `;

            document.getElementById('toastContainer').appendChild(toast);
            setTimeout(() => toast.classList.add('toast--visible'), 10);
            setTimeout(() => toast.remove(), 5000);
        }
    </script>
</body>

</html>
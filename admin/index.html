<!DOCTYPE html>
<html lang="en" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="CineBrain Admin Dashboard - Manage content and users">
    <meta name="robots" content="noindex, nofollow">

    <title>Admin Dashboard - CineBrain</title>

    <!-- CSS Files -->
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/components.css">
    <link rel="stylesheet" href="/css/layouts.css">
    <link rel="stylesheet" href="/css/animations.css">
    <link rel="stylesheet" href="/css/responsive.css">
    <link rel="stylesheet" href="/css/theme.css">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/assets/favicon.svg">
</head>

<body>
    <!-- Fixed Topbar -->
    <div id="topbarContainer"></div>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Admin Header -->
        <section class="py-5"
            style="background: linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, rgba(59, 130, 246, 0.1) 100%);">
            <div class="container">
                <h1 class="display-4 fw-bold text-white mb-3">
                    <i class="fas fa-dashboard text-primary me-3"></i>
                    Admin Dashboard
                </h1>
                <p class="lead text-muted mb-4">Manage CineBrain platform</p>
            </div>
        </section>

        <!-- Dashboard Content -->
        <section class="py-5">
            <div class="container">
                <div class="row g-4">
                    <!-- Sidebar Navigation -->
                    <div class="col-lg-3">
                        <div class="admin-sidebar sticky-top">
                            <ul class="nav nav-pills flex-column">
                                <li class="nav-item">
                                    <a class="nav-link active" href="/admin/index.html">
                                        <i class="fas fa-home me-2"></i>Overview
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="/admin/content.html">
                                        <i class="fas fa-film me-2"></i>Content Management
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="/admin/users.html">
                                        <i class="fas fa-users me-2"></i>User Management
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="/admin/analytics.html">
                                        <i class="fas fa-chart-bar me-2"></i>Analytics
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link text-danger" href="#" onclick="logoutAdmin()">
                                        <i class="fas fa-sign-out-alt me-2"></i>Logout
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <!-- Dashboard Overview -->
                    <div class="col-lg-9">
                        <h2 class="text-white mb-4">
                            <i class="fas fa-tachometer-alt me-2 text-primary"></i>
                            Platform Overview
                        </h2>

                        <!-- Key Metrics -->
                        <div class="row g-3 mb-4">
                            <div class="col-md-3">
                                <div class="metric-card p-3 bg-dark rounded text-center">
                                    <i class="fas fa-users text-primary mb-2" style="font-size: 2rem;"></i>
                                    <h3 class="text-white mb-0" id="totalUsers">0</h3>
                                    <small class="text-muted">Total Users</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="metric-card p-3 bg-dark rounded text-center">
                                    <i class="fas fa-film text-success mb-2" style="font-size: 2rem;"></i>
                                    <h3 class="text-white mb-0" id="totalContent">0</h3>
                                    <small class="text-muted">Total Content</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="metric-card p-3 bg-dark rounded text-center">
                                    <i class="fas fa-star text-warning mb-2" style="font-size: 2rem;"></i>
                                    <h3 class="text-white mb-0" id="totalInteractions">0</h3>
                                    <small class="text-muted">Total Interactions</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="metric-card p-3 bg-dark rounded text-center">
                                    <i class="fas fa-user-check text-info mb-2" style="font-size: 2rem;"></i>
                                    <h3 class="text-white mb-0" id="activeUsers">0</h3>
                                    <small class="text-muted">Active Users (Week)</small>
                                </div>
                            </div>
                        </div>

                        <!-- Recent Activity -->
                        <div class="card bg-dark border-secondary mb-4">
                            <div class="card-body">
                                <h4 class="text-white mb-3">
                                    <i class="fas fa-history me-2 text-primary"></i>
                                    Recent Platform Activity
                                </h4>
                                <div id="recentActivityContainer">
                                    <div class="text-center py-4">
                                        <div class="loading-spinner mx-auto mb-3"></div>
                                        <p class="text-muted">Loading recent activity...</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- System Status -->
                        <div class="card bg-dark border-secondary">
                            <div class="card-body">
                                <h4 class="text-white mb-3">
                                    <i class="fas fa-server me-2 text-primary"></i>
                                    System Status
                                </h4>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="status-item d-flex align-items-center p-3 bg-dark rounded">
                                            <i class="fas fa-database text-success me-3" style="font-size: 1.5rem;"></i>
                                            <div>
                                                <h6 class="text-white mb-1">Database</h6>
                                                <p class="text-muted mb-0" id="databaseStatus">Operational</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="status-item d-flex align-items-center p-3 bg-dark rounded">
                                            <i class="fas fa-brain text-info me-3" style="font-size: 1.5rem;"></i>
                                            <div>
                                                <h6 class="text-white mb-1">ML Service</h6>
                                                <p class="text-muted mb-0" id="mlStatus">Checking...</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="status-item d-flex align-items-center p-3 bg-dark rounded">
                                            <i class="fas fa-cloud text-primary me-3" style="font-size: 1.5rem;"></i>
                                            <div>
                                                <h6 class="text-white mb-1">API Status</h6>
                                                <p class="text-muted mb-0" id="apiStatus">Operational</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="status-item d-flex align-items-center p-3 bg-dark rounded">
                                            <i class="fas fa-bell text-warning me-3" style="font-size: 1.5rem;"></i>
                                            <div>
                                                <h6 class="text-white mb-1">Notifications</h6>
                                                <p class="text-muted mb-0" id="notificationsStatus">Operational</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Mobile Navigation -->
    <div id="mobileNavContainer"></div>

    <!-- JavaScript Files -->
    <script src="/js/config.js"></script>
    <script src="/js/api.js"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/app.js"></script>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Page-specific JavaScript -->
    <script>
        (function () {
            // Initialize admin dashboard
            async function initAdminDashboard() {
                try {
                    // Check admin access
                    if (!window.auth || !window.auth.requireAdmin()) {
                        return;
                    }

                    await loadComponents();
                    await loadAnalytics();
                    await loadRecentActivity();
                    await checkSystemStatus();
                } catch (error) {
                    console.error('Admin dashboard initialization failed:', error);
                }
            }

            // Load reusable components
            async function loadComponents() {
                try {
                    // Load topbar
                    const topbarResponse = await fetch('/components/layout/topbar.html');
                    const topbarHTML = await topbarResponse.text();
                    document.getElementById('topbarContainer').innerHTML = topbarHTML;

                    // Load mobile navigation
                    const mobileNavResponse = await fetch('/components/layout/mobile-nav.html');
                    const mobileNavHTML = await mobileNavResponse.text();
                    document.getElementById('mobileNavContainer').innerHTML = mobileNavHTML;

                    // Execute component scripts
                    const scripts = document.querySelectorAll('#topbarContainer script, #mobileNavContainer script');
                    scripts.forEach(script => {
                        const newScript = document.createElement('script');
                        newScript.textContent = script.textContent;
                        document.head.appendChild(newScript);
                    });
                } catch (error) {
                    console.error('Failed to load components:', error);
                }
            }

            // Load analytics
            async function loadAnalytics() {
                try {
                    const response = await window.api.fetch(API_ENDPOINTS.ADMIN_ANALYTICS);
                    const data = response;

                    document.getElementById('totalUsers').textContent = data.total_users || 0;
                    document.getElementById('totalContent').textContent = data.total_content || 0;
                    document.getElementById('totalInteractions').textContent = data.total_interactions || 0;
                    document.getElementById('activeUsers').textContent = data.active_users_last_week || 0;
                } catch (error) {
                    console.error('Failed to load analytics:', error);
                }
            }

            // Load recent activity
            async function loadRecentActivity() {
                const container = document.getElementById('recentActivityContainer');

                try {
                    // Simulated recent activity
                    const activities = [
                        { user: 'user1', action: 'registered', time: '2 minutes ago' },
                        { user: 'user2', action: 'watched Inception', time: '5 minutes ago' },
                        { user: 'user3', action: 'rated The Matrix 9/10', time: '10 minutes ago' },
                        { user: 'user4', action: 'added to favorites', time: '15 minutes ago' },
                        { user: 'user5', action: 'logged in', time: '20 minutes ago' }
                    ];

                    const activityHTML = activities.map(activity => `
                    <div class="activity-log-item p-3 mb-2 bg-dark rounded d-flex align-items-center">
                        <i class="fas fa-user-circle text-primary me-3" style="font-size: 1.5rem;"></i>
                        <div class="flex-grow-1">
                            <p class="text-white mb-0">${activity.user} ${activity.action}</p>
                        </div>
                        <small class="text-muted">${activity.time}</small>
                    </div>
                `).join('');

                    container.innerHTML = activityHTML;
                } catch (error) {
                    console.error('Failed to load recent activity:', error);
                    container.innerHTML = '<p class="text-muted text-center py-4">Failed to load activity</p>';
                }
            }

            // Check system status
            async function checkSystemStatus() {
                try {
                    const response = await window.api.fetch(API_ENDPOINTS.HEALTH);
                    document.getElementById('databaseStatus').textContent = response.status === 'healthy' ? 'Operational' : 'Error';
                    document.getElementById('databaseStatus').className = response.status === 'healthy' ? 'text-success' : 'text-danger';

                    // ML status
                    const mlResponse = await window.api.fetch('/admin/ml-service-check');
                    document.getElementById('mlStatus').textContent = mlResponse.status === 'healthy' ? 'Operational' : 'Error';
                    document.getElementById('mlStatus').className = mlResponse.status === 'healthy' ? 'text-success' : 'text-danger';

                    // API status
                    document.getElementById('apiStatus').textContent = 'Operational';
                    document.getElementById('apiStatus').className = 'text-success';

                    // Notifications status
                    document.getElementById('notificationsStatus').textContent = 'Operational';
                    document.getElementById('notificationsStatus').className = 'text-success';
                } catch (error) {
                    console.error('Failed to check system status:', error);
                    document.querySelectorAll('.status-item p').forEach(p => {
                        p.textContent = 'Error';
                        p.className = 'text-danger';
                    });
                }
            }

            // Logout admin
            window.logoutAdmin = function () {
                window.auth.logout();
            };

            // Initialize when DOM is ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initAdminDashboard);
            } else {
                initAdminDashboard();
            }
        })();
    </script>

    <!-- Admin-specific Styles -->
    <style>
        .admin-sidebar {
            background: rgba(20, 20, 24, 0.8);
            border-radius: 1rem;
            padding: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .admin-sidebar .nav-link {
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 0.5rem;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
        }

        .admin-sidebar .nav-link:hover {
            color: white;
            background: rgba(59, 130, 246, 0.1);
        }

        .admin-sidebar .nav-link.active {
            color: white;
            background: var(--platinum-blue);
        }

        .metric-card {
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .metric-card:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }

        .status-item {
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .status-item:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .activity-log-item {
            transition: all 0.3s ease;
        }

        .activity-log-item:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.2);
        }

        @media (max-width: 992px) {
            .admin-sidebar {
                margin-bottom: 2rem;
            }

            .admin-sidebar .nav-pills {
                flex-direction: row;
                overflow-x: auto;
            }

            .admin-sidebar .nav-item {
                flex: 0 0 auto;
            }
        }
    </style>
</body>

</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Recommendations - Admin - CineScope</title>
    
    <!-- Stylesheets -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="../css/main.css" rel="stylesheet">
    <link href="../css/components.css" rel="stylesheet">
    <link href="../css/responsive.css" rel="stylesheet">
</head>
<body class="bg-dark text-light">
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-container">
            <div class="loading-logo">
                <i class="fas fa-film"></i>
                <span>CineScope</span>
            </div>
            <div class="loading-spinner"></div>
            <div class="loading-text">Loading recommendations manager...</div>
        </div>
    </div>

    <!-- Header -->
    <div id="headerContainer"></div>

    <!-- Main Content -->
    <main class="main-content admin-content">
        <!-- Admin Header -->
        <section class="admin-header">
            <div class="container">
                <div class="admin-header-content">
                    <div class="breadcrumb-nav">
                        <nav class="breadcrumb">
                            <span class="breadcrumb-item"><a href="/">Home</a></span>
                            <span class="breadcrumb-item"><a href="/admin/dashboard">Admin</a></span>
                            <span class="breadcrumb-item active">Recommendations</span>
                        </nav>
                    </div>
                    <h1 class="admin-title">
                        <i class="fas fa-bullhorn text-warning me-3"></i>
                        Manage Recommendations
                    </h1>
                    <p class="admin-subtitle">
                        Create and manage admin recommendations to showcase content
                    </p>
                </div>
            </div>
        </section>

        <!-- Create Recommendation Section -->
        <section class="create-recommendation-section">
            <div class="container">
                <div class="create-card">
                    <div class="card-header">
                        <h3>Create New Recommendation</h3>
                        <button class="btn btn-outline-primary btn-sm" id="searchContentBtn">
                            <i class="fas fa-search me-2"></i>
                            Search Content
                        </button>
                    </div>
                    <div class="card-body">
                        <form id="recommendationForm">
                            <div class="row">
                                <div class="col-md-8">
                                    <div class="mb-3">
                                        <label class="form-label">Select Content</label>
                                        <div class="content-selector" id="contentSelector">
                                            <div class="empty-selector">
                                                <i class="fas fa-plus-circle fa-2x mb-2"></i>
                                                <p>Click "Search Content" to select a movie or show</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Recommendation Type</label>
                                        <select class="form-select" id="recommendationType" required>
                                            <option value="">Select Type</option>
                                            <option value="admin_choice">Admin's Choice</option>
                                            <option value="trending">Trending Pick</option>
                                            <option value="hidden_gem">Hidden Gem</option>
                                            <option value="must_watch">Must Watch</option>
                                            <option value="weekend_special">Weekend Special</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Description</label>
                                        <textarea class="form-control" id="recommendationDescription" rows="4" 
                                                  placeholder="Why are you recommending this content?" required></textarea>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Tags (comma separated)</label>
                                        <input type="text" class="form-control" id="recommendationTags" 
                                               placeholder="action, thriller, must-watch">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="recommendation-preview">
                                        <h5>Preview</h5>
                                        <div class="preview-card" id="previewCard">
                                            <div class="preview-empty">
                                                <i class="fas fa-eye fa-2x mb-2"></i>
                                                <p>Preview will appear here</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-paper-plane me-2"></i>
                                    Create Recommendation
                                </button>
                                <button type="button" class="btn btn-secondary" id="clearFormBtn">
                                    <i class="fas fa-times me-2"></i>
                                    Clear
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </section>

        <!-- Active Recommendations -->
        <section class="active-recommendations-section">
            <div class="container">
                <div class="section-header">
                    <h3>Active Recommendations</h3>
                    <div class="filter-controls">
                        <select class="form-select form-select-sm" id="typeFilter">
                            <option value="">All Types</option>
                            <option value="admin_choice">Admin's Choice</option>
                            <option value="trending">Trending Pick</option>
                            <option value="hidden_gem">Hidden Gem</option>
                            <option value="must_watch">Must Watch</option>
                            <option value="weekend_special">Weekend Special</option>
                        </select>
                        <button class="btn btn-outline-primary btn-sm" id="refreshRecommendationsBtn">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                </div>
                
                <div class="recommendations-grid" id="recommendationsGrid">
                    <div class="loading-skeleton">
                        <div class="skeleton-card skeleton"></div>
                        <div class="skeleton-card skeleton"></div>
                        <div class="skeleton-card skeleton"></div>
                        <div class="skeleton-card skeleton"></div>
                    </div>
                </div>

                <!-- Pagination -->
                <div class="pagination-container" id="paginationContainer"></div>
            </div>
        </section>

        <!-- Telegram Integration Status -->
        <section class="telegram-status-section">
            <div class="container">
                <div class="telegram-card">
                    <div class="telegram-header">
                        <h4>
                            <i class="fab fa-telegram text-info me-2"></i>
                            Telegram Channel Integration
                        </h4>
                        <div class="telegram-status" id="telegramStatus">
                            <span class="status-indicator"></span>
                            <span class="status-text">Checking...</span>
                        </div>
                    </div>
                    <div class="telegram-info">
                        <p>Recommendations are automatically posted to the Telegram channel when created.</p>
                        <div class="telegram-stats">
                            <div class="stat-item">
                                <span class="stat-label">Channel ID:</span>
                                <span class="stat-value" id="channelId">Loading...</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Posts Today:</span>
                                <span class="stat-value" id="postsToday">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Total Posts:</span>
                                <span class="stat-value" id="totalPosts">0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <div id="footerContainer"></div>

    <!-- Content Search Modal -->
    <div class="modal fade" id="contentSearchModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content bg-dark">
                <div class="modal-header">
                    <h5 class="modal-title">Search Content</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="search-input-group mb-3">
                        <input type="text" class="form-control" id="modalSearchInput" 
                               placeholder="Search for content...">
                        <button class="btn btn-primary" id="modalSearchBtn">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                    <div class="search-results" id="modalSearchResults">
                        <p class="text-muted text-center">Enter a search term to find content</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Recommendation Modal -->
    <div class="modal fade" id="editRecommendationModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content bg-dark">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Recommendation</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editRecommendationForm">
                        <div class="mb-3">
                            <label class="form-label">Recommendation Type</label>
                            <select class="form-select" id="editRecommendationType" required>
                                <option value="admin_choice">Admin's Choice</option>
                                <option value="trending">Trending Pick</option>
                                <option value="hidden_gem">Hidden Gem</option>
                                <option value="must_watch">Must Watch</option>
                                <option value="weekend_special">Weekend Special</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Description</label>
                            <textarea class="form-control" id="editRecommendationDescription" rows="4" required></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveEditBtn">
                        <i class="fas fa-save me-2"></i>
                        Save Changes
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../js/main.js"></script>
    <script src="../js/include.js"></script>
    <script>
        let recommendationState = {
            selectedContent: null,
            currentPage: 1,
            totalPages: 1,
            recommendations: [],
            editingRecommendation: null
        };

        document.addEventListener('DOMContentLoaded', function() {
            initializeRecommendationsManager();
        });

        async function initializeRecommendationsManager() {
            // Check admin authentication
            if (!AuthManager.requireAuth()) return;
            
            if (!AppState.user || !AppState.user.is_admin) {
                Utils.showToast('Admin access required', 'error');
                window.location.href = '/dashboard';
                return;
            }

            // Load includes
            await loadIncludes();
            
            // Initialize manager
            bindRecommendationEvents();
            await loadActiveRecommendations();
            checkTelegramStatus();
            
            // Check if content_id is passed in URL
            checkUrlParams();

            Utils.hideLoadingScreen();
        }

        async function loadIncludes() {
            try {
                await Promise.all([
                    loadHeader(),
                    loadFooter()
                ]);
            } catch (error) {
                console.error('Failed to load includes:', error);
            }
        }

        function bindRecommendationEvents() {
            // Form submission
            document.getElementById('recommendationForm').onsubmit = handleRecommendationSubmit;
            
            // Content search
            document.getElementById('searchContentBtn').onclick = openContentSearch;
            
            // Modal search
            document.getElementById('modalSearchBtn').onclick = performModalSearch;
            document.getElementById('modalSearchInput').onkeypress = (e) => {
                if (e.key === 'Enter') performModalSearch();
            };
            
            // Clear form
            document.getElementById('clearFormBtn').onclick = clearForm;
            
            // Filters
            document.getElementById('typeFilter').onchange = loadActiveRecommendations;
            document.getElementById('refreshRecommendationsBtn').onclick = loadActiveRecommendations;
            
            // Edit modal save
            document.getElementById('saveEditBtn').onclick = saveEditedRecommendation;
            
            // Preview updates
            document.getElementById('recommendationType').onchange = updatePreview;
            document.getElementById('recommendationDescription').oninput = updatePreview;
        }

        function checkUrlParams() {
            const urlParams = new URLSearchParams(window.location.search);
            const contentId = urlParams.get('content_id');
            
            if (contentId) {
                // Load content details and pre-fill form
                loadContentById(contentId);
            }
        }

        async function loadContentById(contentId) {
            try {
                const response = await ApiService.getContentDetails(contentId);
                selectContent(response);
            } catch (error) {
                console.error('Failed to load content:', error);
                Utils.showToast('Failed to load content details', 'error');
            }
        }

        function openContentSearch() {
            const modal = new bootstrap.Modal(document.getElementById('contentSearchModal'));
            modal.show();
        }

        async function performModalSearch() {
            const query = document.getElementById('modalSearchInput').value.trim();
            if (!query) return;

            const searchBtn = document.getElementById('modalSearchBtn');
            const originalText = searchBtn.innerHTML;
            const resultsDiv = document.getElementById('modalSearchResults');

            try {
                searchBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                searchBtn.disabled = true;

                const response = await ApiService.search(query, 'multi', 1);
                const results = response.results || [];

                if (results.length === 0) {
                    resultsDiv.innerHTML = '<p class="text-muted text-center">No results found</p>';
                    return;
                }

                const resultsHtml = results.slice(0, 10).map(item => `
                    <div class="search-result-item" onclick='selectContent(${JSON.stringify(item).replace(/'/g, "&apos;")})'>
                        <img src="${Utils.getImageUrl(item.poster_path, 'w92')}" 
                             alt="${item.title}"
                             onerror="this.src='https://via.placeholder.com/92x138?text=No+Image'">
                        <div class="result-details">
                            <h6>${item.title}</h6>
                            <p>${item.content_type.toUpperCase()} • ${Utils.formatRating(item.rating)}</p>
                        </div>
                    </div>
                `).join('');

                resultsDiv.innerHTML = resultsHtml;

            } catch (error) {
                console.error('Search failed:', error);
                Utils.showToast('Search failed', 'error');
            } finally {
                searchBtn.innerHTML = originalText;
                searchBtn.disabled = false;
            }
        }

        function selectContent(content) {
            recommendationState.selectedContent = content;
            
            // Update content selector
            const selector = document.getElementById('contentSelector');
            selector.innerHTML = `
                <div class="selected-content">
                    <img src="${Utils.getImageUrl(content.poster_path, 'w154')}" 
                         alt="${content.title}">
                    <div class="content-details">
                        <h6>${content.title}</h6>
                        <p>${content.content_type.toUpperCase()} • ${Utils.formatRating(content.rating)}</p>
                        <p class="text-muted">${Utils.truncateText(content.overview, 100)}</p>
                    </div>
                    <button class="btn btn-sm btn-outline-danger" onclick="clearContent()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('contentSearchModal'));
            if (modal) modal.hide();
            
            // Update preview
            updatePreview();
        }

        function clearContent() {
            recommendationState.selectedContent = null;
            document.getElementById('contentSelector').innerHTML = `
                <div class="empty-selector">
                    <i class="fas fa-plus-circle fa-2x mb-2"></i>
                    <p>Click "Search Content" to select a movie or show</p>
                </div>
            `;
            updatePreview();
        }

        function updatePreview() {
            const previewCard = document.getElementById('previewCard');
            const content = recommendationState.selectedContent;
            const type = document.getElementById('recommendationType').value;
            const description = document.getElementById('recommendationDescription').value;

            if (!content || !type || !description) {
                previewCard.innerHTML = `
                    <div class="preview-empty">
                        <i class="fas fa-eye fa-2x mb-2"></i>
                        <p>Preview will appear here</p>
                    </div>
                `;
                return;
            }

            const typeLabels = {
                'admin_choice': "Admin's Choice",
                'trending': 'Trending Pick',
                'hidden_gem': 'Hidden Gem',
                'must_watch': 'Must Watch',
                'weekend_special': 'Weekend Special'
            };

            previewCard.innerHTML = `
                <div class="preview-content">
                    <div class="preview-header">
                        <span class="preview-type">${typeLabels[type]}</span>
                        <span class="preview-date">${new Date().toLocaleDateString()}</span>
                    </div>
                    <img src="${Utils.getImageUrl(content.poster_path, 'w200')}" 
                         alt="${content.title}" class="preview-poster">
                    <h6 class="preview-title">${content.title}</h6>
                    <p class="preview-description">${description}</p>
                    <div class="preview-footer">
                        <span><i class="fas fa-star"></i> ${Utils.formatRating(content.rating)}</span>
                        <span>${content.content_type.toUpperCase()}</span>
                    </div>
                </div>
            `;
        }

        async function handleRecommendationSubmit(e) {
            e.preventDefault();

            if (!recommendationState.selectedContent) {
                Utils.showToast('Please select content first', 'error');
                return;
            }

            const submitBtn = e.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;

            try {
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Creating...';
                submitBtn.disabled = true;

                const data = {
                    content_id: recommendationState.selectedContent.id,
                    recommendation_type: document.getElementById('recommendationType').value,
                    description: document.getElementById('recommendationDescription').value,
                    tags: document.getElementById('recommendationTags').value.split(',').map(t => t.trim()).filter(t => t)
                };

                await ApiService.createAdminRecommendation(data);
                Utils.showToast('Recommendation created and posted to Telegram!', 'success');
                
                // Clear form and reload recommendations
                clearForm();
                await loadActiveRecommendations();

            } catch (error) {
                console.error('Failed to create recommendation:', error);
                Utils.showToast('Failed to create recommendation', 'error');
            } finally {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        }

        function clearForm() {
            document.getElementById('recommendationForm').reset();
            clearContent();
            updatePreview();
        }

        async function loadActiveRecommendations() {
            try {
                const grid = document.getElementById('recommendationsGrid');
                grid.innerHTML = '<div class="loading-skeleton"><div class="skeleton-card skeleton"></div><div class="skeleton-card skeleton"></div><div class="skeleton-card skeleton"></div><div class="skeleton-card skeleton"></div></div>';

                const typeFilter = document.getElementById('typeFilter').value;
                const response = await ApiService.getAdminRecommendations(recommendationState.currentPage);
                
                let recommendations = response.recommendations || [];
                
                // Apply filter
                if (typeFilter) {
                    recommendations = recommendations.filter(rec => rec.recommendation_type === typeFilter);
                }
                
                recommendationState.recommendations = recommendations;
                recommendationState.totalPages = response.pages || 1;

                if (recommendations.length === 0) {
                    grid.innerHTML = '<p class="text-muted text-center">No recommendations found</p>';
                    return;
                }

                const recommendationsHtml = recommendations.map(rec => `
                    <div class="recommendation-card">
                        <div class="recommendation-header">
                            <span class="recommendation-type">${formatRecommendationType(rec.recommendation_type)}</span>
                            <div class="recommendation-actions">
                                <button class="btn btn-sm btn-outline-primary" onclick="editRecommendation(${rec.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-danger" onclick="deleteRecommendation(${rec.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <div class="recommendation-content">
                            <img src="${Utils.getImageUrl(rec.content.poster_path)}" 
                                 alt="${rec.content.title}" class="recommendation-poster">
                            <div class="recommendation-details">
                                <h6 class="recommendation-title">${rec.content.title}</h6>
                                <p class="recommendation-description">${rec.description}</p>
                                <div class="recommendation-meta">
                                    <span><i class="fas fa-user"></i> ${rec.admin_name}</span>
                                    <span><i class="fas fa-calendar"></i> ${new Date(rec.created_at).toLocaleDateString()}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');

                grid.innerHTML = recommendationsHtml;
                updatePagination();

            } catch (error) {
                console.error('Failed to load recommendations:', error);
                document.getElementById('recommendationsGrid').innerHTML = '<p class="text-danger text-center">Failed to load recommendations</p>';
            }
        }

        function formatRecommendationType(type) {
            const types = {
                'admin_choice': "Admin's Choice",
                'trending': 'Trending Pick',
                'hidden_gem': 'Hidden Gem',
                'must_watch': 'Must Watch',
                'weekend_special': 'Weekend Special'
            };
            return types[type] || type;
        }

        function updatePagination() {
            const container = document.getElementById('paginationContainer');
            if (recommendationState.totalPages <= 1) {
                container.innerHTML = '';
                return;
            }

            let paginationHtml = '';
            for (let i = 1; i <= recommendationState.totalPages; i++) {
                paginationHtml += `
                    <button class="btn btn-sm ${i === recommendationState.currentPage ? 'btn-primary' : 'btn-outline-primary'}" 
                            onclick="goToPage(${i})">${i}</button>
                `;
            }
            container.innerHTML = paginationHtml;
        }

        async function goToPage(page) {
            recommendationState.currentPage = page;
            await loadActiveRecommendations();
        }

        function editRecommendation(id) {
            const rec = recommendationState.recommendations.find(r => r.id === id);
            if (!rec) return;

            recommendationState.editingRecommendation = rec;
            
            // Populate edit form
            document.getElementById('editRecommendationType').value = rec.recommendation_type;
            document.getElementById('editRecommendationDescription').value = rec.description;
            
            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('editRecommendationModal'));
            modal.show();
        }

        async function saveEditedRecommendation() {
            if (!recommendationState.editingRecommendation) return;

            const saveBtn = document.getElementById('saveEditBtn');
            const originalText = saveBtn.innerHTML;

            try {
                saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Saving...';
                saveBtn.disabled = true;

                const data = {
                    recommendation_type: document.getElementById('editRecommendationType').value,
                    description: document.getElementById('editRecommendationDescription').value
                };

                await ApiService.updateAdminRecommendation(recommendationState.editingRecommendation.id, data);
                Utils.showToast('Recommendation updated successfully!', 'success');
                
                // Close modal and reload
                const modal = bootstrap.Modal.getInstance(document.getElementById('editRecommendationModal'));
                modal.hide();
                await loadActiveRecommendations();

            } catch (error) {
                console.error('Failed to update recommendation:', error);
                Utils.showToast('Failed to update recommendation', 'error');
            } finally {
                saveBtn.innerHTML = originalText;
                saveBtn.disabled = false;
            }
        }

        async function deleteRecommendation(id) {
            if (!confirm('Are you sure you want to delete this recommendation?')) return;

            try {
                await ApiService.deleteAdminRecommendation(id);
                Utils.showToast('Recommendation deleted successfully!', 'success');
                await loadActiveRecommendations();
            } catch (error) {
                console.error('Failed to delete recommendation:', error);
                Utils.showToast('Failed to delete recommendation', 'error');
            }
        }

        async function checkTelegramStatus() {
            try {
                // Mock data - in real implementation, this would come from API
                const status = {
                    connected: true,
                    channel_id: '-1002850793757',
                    posts_today: 5,
                    total_posts: 127
                };

                const statusElement = document.getElementById('telegramStatus');
                const statusIndicator = statusElement.querySelector('.status-indicator');
                const statusText = statusElement.querySelector('.status-text');

                if (status.connected) {
                    statusIndicator.style.background = 'var(--success-color)';
                    statusText.textContent = 'Connected';
                } else {
                    statusIndicator.style.background = 'var(--danger-color)';
                    statusText.textContent = 'Disconnected';
                }

                document.getElementById('channelId').textContent = status.channel_id;
                document.getElementById('postsToday').textContent = status.posts_today;
                document.getElementById('totalPosts').textContent = status.total_posts;

            } catch (error) {
                console.error('Failed to check Telegram status:', error);
            }
        }

        // Extended API service
        ApiService.createAdminRecommendation = async function(data) {
            return await this.request('/admin/recommendations', {
                method: 'POST',
                body: JSON.stringify(data)
            });
        };

        ApiService.getAdminRecommendations = async function(page = 1) {
            return await this.request(`/admin/recommendations?page=${page}`);
        };

        ApiService.updateAdminRecommendation = async function(id, data) {
            return await this.request(`/admin/recommendations/${id}`, {
                method: 'PUT',
                body: JSON.stringify(data)
            });
        };

        ApiService.deleteAdminRecommendation = async function(id) {
            return await this.request(`/admin/recommendations/${id}`, {
                method: 'DELETE'
            });
        };
    </script>

    <style>
        .create-recommendation-section {
            padding: 2rem 0;
        }

        .create-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-lg);
            overflow: hidden;
        }

        .create-card .card-header {
            background: var(--bg-tertiary);
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .create-card .card-header h3 {
            margin: 0;
        }

        .create-card .card-body {
            padding: 2rem;
        }

        .content-selector {
            background: var(--bg-tertiary);
            border: 2px dashed var(--border-color);
            border-radius: var(--border-radius);
            min-height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .content-selector:hover {
            border-color: var(--primary-color);
        }

        .empty-selector {
            text-align: center;
            color: var(--text-muted);
        }

        .selected-content {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            width: 100%;
        }

        .selected-content img {
            width: 100px;
            height: 150px;
            object-fit: cover;
            border-radius: var(--border-radius);
        }

        .content-details {
            flex: 1;
        }

        .content-details h6 {
            margin-bottom: 0.5rem;
        }

        .content-details p {
            margin-bottom: 0.25rem;
            font-size: 0.9rem;
        }

        .recommendation-preview {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            height: 100%;
        }

        .preview-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            min-height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .preview-empty {
            text-align: center;
            color: var(--text-muted);
        }

        .preview-content {
            width: 100%;
            padding: 1rem;
        }

        .preview-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
            font-size: 0.85rem;
        }

        .preview-type {
            color: var(--primary-color);
            font-weight: 600;
        }

        .preview-date {
            color: var(--text-muted);
        }

        .preview-poster {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
        }

        .preview-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .preview-description {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
            line-height: 1.4;
        }

        .preview-footer {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .form-actions {
            margin-top: 2rem;
            display: flex;
            gap: 1rem;
        }

        .active-recommendations-section {
            padding: 3rem 0;
            background: var(--bg-secondary);
        }

        .filter-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .recommendations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .recommendation-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-lg);
            overflow: hidden;
            transition: var(--transition);
        }

        .recommendation-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .recommendation-header {
            background: var(--bg-tertiary);
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .recommendation-type {
            font-weight: 600;
            color: var(--primary-color);
        }

        .recommendation-actions {
            display: flex;
            gap: 0.5rem;
        }

        .recommendation-content {
            padding: 1.5rem;
            display: flex;
            gap: 1rem;
        }

        .recommendation-poster {
            width: 80px;
            height: 120px;
            object-fit: cover;
            border-radius: var(--border-radius);
            flex-shrink: 0;
        }

        .recommendation-details {
            flex: 1;
        }

        .recommendation-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .recommendation-description {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
            line-height: 1.4;
        }

        .recommendation-meta {
            display: flex;
            gap: 1rem;
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .telegram-status-section {
            padding: 3rem 0;
        }

        .telegram-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-lg);
            padding: 2rem;
        }

        .telegram-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .telegram-header h4 {
            margin: 0;
        }

        .telegram-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .telegram-info {
            color: var(--text-secondary);
        }

        .telegram-stats {
            display: flex;
            gap: 2rem;
            margin-top: 1rem;
        }

        .telegram-stats .stat-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .telegram-stats .stat-label {
            color: var(--text-muted);
        }

        .telegram-stats .stat-value {
            font-weight: 600;
            color: var(--text-primary);
        }

        .search-input-group {
            display: flex;
            gap: 0.5rem;
        }

        .search-input-group .form-control {
            flex: 1;
        }

        .search-result-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--bg-tertiary);
            border-radius: var(--border-radius);
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .search-result-item:hover {
            background: var(--bg-hover);
        }

        .search-result-item img {
            width: 60px;
            height: 90px;
            object-fit: cover;
            border-radius: var(--border-radius);
        }

        .result-details h6 {
            margin-bottom: 0.25rem;
        }

        .result-details p {
            margin: 0;
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        @media (max-width: 768px) {
            .create-card .card-header {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }

            .selected-content {
                flex-direction: column;
                text-align: center;
            }

            .recommendations-grid {
                grid-template-columns: 1fr;
            }

            .telegram-stats {
                flex-direction: column;
                gap: 0.5rem;
            }

            .filter-controls {
                flex-direction: column;
                align-items: stretch;
                gap: 0.5rem;
            }
        }
    </style>
</body>
</html>
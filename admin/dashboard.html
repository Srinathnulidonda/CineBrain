<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - CineScope</title>

    <!-- CSS Files -->
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/components.css">
    <link rel="stylesheet" href="/css/responsive.css">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap"
        rel="stylesheet">
</head>

<body>
    <!-- Admin Header -->
    <header class="header bg-bg-secondary">
        <nav class="container">
            <div class="nav">
                <div class="nav-brand">
                    <a href="/admin/dashboard">CineScope Admin</a>
                </div>

                <ul class="nav-menu">
                    <li><a href="/admin/dashboard" class="nav-link active">Dashboard</a></li>
                    <li><a href="/admin/content-browser" class="nav-link">Content</a></li>
                    <li><a href="/admin/posts" class="nav-link">Posts</a></li>
                    <li><a href="/admin/analytics" class="nav-link">Analytics</a></li>
                    <li><a href="/" class="nav-link">View Site</a></li>
                </ul>

                <div class="nav-actions">
                    <div id="user-menu" class="dropdown">
                        <button class="btn btn-secondary">
                            <span id="admin-name">Admin</span>
                        </button>
                        <div class="dropdown-menu">
                            <a href="/profile" class="dropdown-item">Profile</a>
                            <button onclick="AuthManager.logout()" class="dropdown-item">Logout</button>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main style="padding-top: 80px;">
        <div class="container py-8">
            <!-- Dashboard Header -->
            <section class="mb-8">
                <h1 class="text-3xl font-bold mb-2">Admin Dashboard</h1>
                <p class="text-secondary">Manage content, users, and platform analytics</p>
            </section>

            <!-- Real-time Stats -->
            <section class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="card p-6">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="text-sm font-medium text-muted">Total Users</h3>
                            <p class="text-2xl font-bold text-primary-blue" id="total-users">0</p>
                        </div>
                        <div class="w-8 h-8 bg-primary-blue/20 rounded-full flex items-center justify-center">
                            üë•
                        </div>
                    </div>
                    <div class="flex items-center gap-2 text-sm">
                        <span class="text-success">‚ÜóÔ∏è +12%</span>
                        <span class="text-muted">vs last month</span>
                    </div>
                </div>

                <div class="card p-6">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="text-sm font-medium text-muted">Total Content</h3>
                            <p class="text-2xl font-bold text-primary-purple" id="total-content">0</p>
                        </div>
                        <div class="w-8 h-8 bg-primary-purple/20 rounded-full flex items-center justify-center">
                            üé¨
                        </div>
                    </div>
                    <div class="flex items-center gap-2 text-sm">
                        <span class="text-success">‚ÜóÔ∏è +8%</span>
                        <span class="text-muted">vs last month</span>
                    </div>
                </div>

                <div class="card p-6">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="text-sm font-medium text-muted">Active Today</h3>
                            <p class="text-2xl font-bold text-success" id="active-today">0</p>
                        </div>
                        <div class="w-8 h-8 bg-success/20 rounded-full flex items-center justify-center">
                            üìä
                        </div>
                    </div>
                    <div class="flex items-center gap-2 text-sm">
                        <span class="text-success">‚ÜóÔ∏è +5%</span>
                        <span class="text-muted">vs yesterday</span>
                    </div>
                </div>

                <div class="card p-6">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="text-sm font-medium text-muted">ML Service</h3>
                            <p class="text-lg font-bold" id="ml-status">
                                <span class="text-success">Healthy</span>
                            </p>
                        </div>
                        <div class="w-8 h-8 bg-success/20 rounded-full flex items-center justify-center">
                            ü§ñ
                        </div>
                    </div>
                    <div class="flex items-center gap-2 text-sm">
                        <div class="w-2 h-2 bg-success rounded-full animate-pulse"></div>
                        <span class="text-muted">Last check: <span id="ml-last-check">now</span></span>
                    </div>
                </div>
            </section>

            <!-- Quick Actions -->
            <section class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="card p-6">
                    <h3 class="font-semibold mb-4">Content Management</h3>
                    <div class="space-y-3">
                        <button onclick="AdminManager.showAddContentModal()" class="btn btn-primary w-full">
                            ‚ûï Add New Content
                        </button>
                        <button onclick="AdminManager.syncExternalContent()" class="btn btn-secondary w-full">
                            üîÑ Sync External APIs
                        </button>
                        <a href="/admin/content-browser" class="btn btn-ghost w-full">
                            üìö Browse Content
                        </a>
                    </div>
                </div>

                <div class="card p-6">
                    <h3 class="font-semibold mb-4">Recommendations</h3>
                    <div class="space-y-3">
                        <button onclick="AdminManager.showRecommendationModal()" class="btn btn-primary w-full">
                            ‚≠ê Create Recommendation
                        </button>
                        <button onclick="AdminManager.updateMLModels()" class="btn btn-secondary w-full">
                            ü§ñ Update ML Models
                        </button>
                        <a href="/admin/analytics" class="btn btn-ghost w-full">
                            üìä View Analytics
                        </a>
                    </div>
                </div>

                <div class="card p-6">
                    <h3 class="font-semibold mb-4">System Status</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-sm">API Status</span>
                            <span class="text-success text-sm">‚úÖ Online</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm">Database</span>
                            <span class="text-success text-sm">‚úÖ Connected</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm">ML Service</span>
                            <span class="text-success text-sm" id="ml-service-status">‚úÖ Running</span>
                        </div>
                        <button onclick="AdminManager.runSystemCheck()" class="btn btn-ghost w-full">
                            üîç Full System Check
                        </button>
                    </div>
                </div>
            </section>

            <!-- Recent Activity -->
            <section class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="card p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-semibold">Recent User Activity</h3>
                        <button onclick="AdminManager.refreshActivity()" class="btn btn-ghost btn-sm">üîÑ</button>
                    </div>
                    <div id="recent-activity" class="space-y-3">
                        <!-- Activity items will be populated -->
                    </div>
                </div>

                <div class="card p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-semibold">System Alerts</h3>
                        <button onclick="AdminManager.clearAlerts()" class="btn btn-ghost btn-sm">Clear All</button>
                    </div>
                    <div id="system-alerts" class="space-y-3">
                        <!-- Alerts will be populated -->
                    </div>
                </div>
            </section>

            <!-- Content Performance -->
            <section class="mt-8">
                <div class="card p-6">
                    <h3 class="font-semibold mb-4">Top Performing Content</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead>
                                <tr class="border-b border-white/10">
                                    <th class="text-left p-3">Title</th>
                                    <th class="text-left p-3">Type</th>
                                    <th class="text-left p-3">Views</th>
                                    <th class="text-left p-3">Rating</th>
                                    <th class="text-left p-3">Interactions</th>
                                    <th class="text-left p-3">Trend</th>
                                </tr>
                            </thead>
                            <tbody id="top-content-table">
                                <!-- Table rows will be populated -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Modals -->
    <!-- Add Content Modal -->
    <div id="add-content-modal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3>Add New Content</h3>
                <button class="modal-close" onclick="UIComponents.closeModal('add-content-modal')">√ó</button>
            </div>
            <div class="modal-body">
                <form id="add-content-form" class="space-y-4">
                    <div class="form-group">
                        <label class="form-label">Content Source</label>
                        <select id="content-source" class="form-input">
                            <option value="tmdb">TMDB (Movies & TV)</option>
                            <option value="anime">Jikan (Anime)</option>
                            <option value="manual">Manual Entry</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Search Query or ID</label>
                        <input type="text" id="content-query" class="form-input"
                            placeholder="Enter title or external ID">
                    </div>

                    <div id="search-results-modal" class="hidden">
                        <h4 class="font-medium mb-3">Search Results</h4>
                        <div id="modal-search-results" class="space-y-2 max-h-60 overflow-y-auto">
                            <!-- Search results will be populated -->
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button onclick="AdminManager.searchContent()" class="btn btn-secondary">Search</button>
                <button onclick="AdminManager.addSelectedContent()" class="btn btn-primary">Add Content</button>
            </div>
        </div>
    </div>

    <!-- Create Recommendation Modal -->
    <div id="recommendation-modal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3>Create Admin Recommendation</h3>
                <button class="modal-close" onclick="UIComponents.closeModal('recommendation-modal')">√ó</button>
            </div>
            <div class="modal-body">
                <form id="recommendation-form" class="space-y-4">
                    <div class="form-group">
                        <label class="form-label">Content</label>
                        <input type="text" id="rec-content-search" class="form-input"
                            placeholder="Search for content...">
                        <div id="rec-content-results" class="mt-2"></div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Recommendation Type</label>
                        <select id="rec-type" class="form-input">
                            <option value="admin_choice">Admin's Choice</option>
                            <option value="trending">Trending</option>
                            <option value="critics_choice">Critics' Choice</option>
                            <option value="featured">Featured</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <textarea id="rec-description" class="form-input" rows="3"
                            placeholder="Why are you recommending this?"></textarea>
                    </div>

                    <div class="flex items-center gap-2">
                        <input type="checkbox" id="send-telegram" checked>
                        <label for="send-telegram" class="text-sm">Send to Telegram channel</label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button onclick="UIComponents.closeModal('recommendation-modal')"
                    class="btn btn-secondary">Cancel</button>
                <button onclick="AdminManager.createRecommendation()" class="btn btn-primary">Create
                    Recommendation</button>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="/js/main.js"></script>
    <script src="/js/admin.js"></script>
    <script>
        // Check admin access
        document.addEventListener('DOMContentLoaded', () => {
            if (!appState.user || !appState.user.is_admin) {
                window.location.href = '/login';
                return;
            }

            // Initialize admin dashboard
            new AdminDashboard();
        });
    </script>
</body>

</html>
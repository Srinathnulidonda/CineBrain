1. index.html 
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">

  <title>CineBrain - AI-Powered Movie, TV Show & Anime Recommendations</title>

  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://fonts.googleapis.com https://fonts.gstatic.com https://www.googletagmanager.com https://www.google-analytics.com;
    style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://fonts.googleapis.com;
    font-src 'self' https://fonts.gstatic.com;
    img-src 'self' data: blob: https: http:;
    connect-src 'self' https://cinebrain.onrender.com https://api.themoviedb.org https://image.tmdb.org https://api.jikan.moe https://www.omdbapi.com https://www.googleapis.com https://cdn.jsdelivr.net https://www.google-analytics.com;
    base-uri 'self';
    form-action 'self';
    form-action 'self';
    frame-ancestors 'none';
    object-src 'none';
  ">

  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
  <meta http-equiv="Permissions-Policy" content="geolocation=(), microphone=(), camera=(), payment=()">

  <!-- Enhanced SEO Meta Tags -->
  <meta name="description"
    content="Discover your next favorite movie, TV show, or anime with CineBrain's AI-powered recommendations. Get personalized suggestions based on your taste with our intelligent entertainment platform.">
  <meta name="keywords"
    content="movie recommendations, TV shows, anime, AI recommendations, entertainment, streaming, movies, television, personalized recommendations, CineBrain">
  <meta name="author" content="CineBrain">
  <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
  <meta name="googlebot" content="index, follow">

  <!-- Open Graph Meta Tags -->
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="CineBrain">
  <meta property="og:title" content="CineBrain - AI-Powered Entertainment Recommendations">
  <meta property="og:description"
    content="Discover your next favorite movie, TV show, or anime with AI-powered personalized recommendations on CineBrain.">
  <meta property="og:url" content="https://cinebrain.vercel.app/">
  <meta property="og:image" content="/assets/images/og-image.jpg">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:locale" content="en_US">

  <!-- Twitter Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CineBrainApp">
  <meta name="twitter:creator" content="@CineBrainApp">
  <meta name="twitter:title" content="CineBrain - AI-Powered Entertainment Recommendations">
  <meta name="twitter:description"
    content="Discover your next favorite movie, TV show, or anime with AI-powered personalized recommendations.">
  <meta name="twitter:image" content="/assets/images/twitter-card.jpg">

  <!-- PWA Meta Tags -->
  <meta name="application-name" content="CineBrain">
  <meta name="apple-mobile-web-app-title" content="CineBrain">
  <meta name="theme-color" content="#113CCF">
  <meta name="msapplication-TileColor" content="#113CCF">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Canonical URL -->
  <link rel="canonical" href="https://cinebrain.vercel.app/">

  <!-- Favicons -->
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicon-32x32.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/apple-icon-180x180.png">
  <link rel="manifest" href="/site.webmanifest">

  <!-- Performance Optimizations -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="preconnect" href="https://image.tmdb.org" crossorigin>
  <link rel="dns-prefetch" href="https://api.themoviedb.org">
  <link rel="dns-prefetch" href="https://cinebrain.onrender.com">

  <!-- Critical CSS -->
  <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Inter:wght@300;400;500;600;700&display=swap"
    rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">

  <!-- Component CSS -->
  <link rel="stylesheet" href="/assets/css/components/theme.css">
  <link rel="stylesheet" href="/assets/css/components/topbar.css">
  <link rel="stylesheet" href="/assets/css/components/mobile-nav.css">
  <link rel="stylesheet" href="/assets/css/components/footer.css">
  <link rel="stylesheet" href="/assets/css/home/content-card.css">
  <link rel="stylesheet" href="/assets/css/home/hero.css">
  <script src="/assets/js/analytics.js"></script>

  <!-- Enhanced Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@graph": [
      {
        "@type": "WebSite",
        "@id": "https://cinebrain.vercel.app/#website",
        "url": "https://cinebrain.vercel.app/",
        "name": "CineBrain",
        "description": "AI-powered movie, TV show, and anime recommendation platform",
        "potentialAction": [
          {
            "@type": "SearchAction",
            "target": {
              "@type": "EntryPoint",
              "urlTemplate": "https://cinebrain.vercel.app/search?q={search_term_string}"
            },
            "query-input": "required name=search_term_string"
          }
        ],
        "inLanguage": "en-US"
      },
      {
        "@type": "WebApplication",
        "@id": "https://cinebrain.vercel.app/#webapp",
        "url": "https://cinebrain.vercel.app/",
        "name": "CineBrain",
        "description": "Discover your next favorite movie, TV show, or anime with AI-powered personalized recommendations",
        "applicationCategory": "Entertainment",
        "operatingSystem": "Web Browser",
        "browserRequirements": "Requires JavaScript. Requires HTML5.",
        "softwareVersion": "2.0.0",
        "offers": {
          "@type": "Offer",
          "price": "0",
          "priceCurrency": "USD"
        },
        "aggregateRating": {
          "@type": "AggregateRating",
          "ratingValue": "4.8",
          "ratingCount": "1000",
          "bestRating": "5",
          "worstRating": "1"
        }
      },
      {
        "@type": "Organization",
        "@id": "https://cinebrain.vercel.app/#organization",
        "name": "CineBrain",
        "url": "https://cinebrain.vercel.app/",
        "logo": {
          "@type": "ImageObject",
          "url": "https://cinebrain.vercel.app/assets/images/logo.png",
          "width": "512",
          "height": "512"
        },
        "sameAs": [
          "https://twitter.com/CineBrainApp",
          "https://facebook.com/CineBrainApp"
        ]
      }
    ]
  }
  </script>

  <!-- Theme Initialization -->
  <script>
    (function () {
      try {
        const savedTheme = localStorage.getItem('cinebrain-theme');
        const theme = (savedTheme === 'light' || savedTheme === 'dark') ? savedTheme : 'dark';
        document.documentElement.setAttribute('data-theme', theme);
        document.documentElement.setAttribute('data-bs-theme', theme);
      } catch (e) {
        document.documentElement.setAttribute('data-theme', 'dark');
        document.documentElement.setAttribute('data-bs-theme', 'dark');
      }
    })();
  </script>

  <!-- Preload Critical Resources -->
  <link rel="preload" href="/assets/js/config.js" as="script">
  <link rel="preload" href="/assets/js/components/theme-manager.js" as="script">
</head>

<body>
  <!-- Skip Link for Accessibility -->
  <a href="#main-content" class="visually-hidden-focusable">Skip to main content</a>

  <!-- Loading Indicator -->
  <div id="page-loading-indicator"
    style="position: fixed; top: 0; left: 0; width: 100%; height: 3px; background: var(--cinebrain-primary); z-index: 9999; transform: scaleX(0); transform-origin: left; transition: transform 0.3s ease;">
  </div>

  <header>
    <nav class="navbar navbar-expand-lg navbar-cinebrain fixed-top" role="navigation" aria-label="Main navigation">
      <div class="container-fluid">
        <div class="navbar-brand-wrapper">
          <a href="/" style="text-decoration: none;" aria-label="CineBrain Home">
            <div class="navbar-brand-cinebrain">CineBrain</div>
            <div class="tagline">
              <span class="tagline-full">The Mind Behind Your Next Favorite</span>
              <span class="tagline-medium" style="display: none;">Your Next Favorite</span>
              <span class="tagline-short" style="display: none;">Next Favorite</span>
            </div>
          </a>
        </div>

        <div class="search-container desktop-search" id="desktopSearchContainer">
          <div class="search-wrapper">
            <div class="search-bar-wrapper">
              <div class="search-input-wrapper">
                <i data-feather="search" class="search-icon" aria-hidden="true"></i>
                <input type="text" class="form-control search-input" id="desktopSearchInput"
                  placeholder="Search movies, shows, anime..." autocomplete="off"
                  aria-label="Search for movies, TV shows, and anime" maxlength="100" role="combobox"
                  aria-expanded="false" aria-haspopup="listbox">
                <button class="search-clear" id="searchClear" aria-label="Clear search" style="display: none;">
                  <i data-feather="x" aria-hidden="true"></i>
                </button>
              </div>
              <div class="search-results" id="desktopSearchResults" role="listbox" aria-live="polite"
                aria-label="Search results">
              </div>
            </div>
          </div>
        </div>

        <div class="nav-icons-section">
          <button class="icon-button mobile-search-trigger" id="mobileSearchTrigger" aria-label="Open search">
            <i data-feather="search" aria-hidden="true"></i>
          </button>

          <button class="icon-button theme-toggle" id="themeToggle" aria-label="Toggle dark/light theme">
            <i data-feather="sun" class="theme-icon theme-icon-light" aria-hidden="true"></i>
            <i data-feather="moon" class="theme-icon theme-icon-dark" aria-hidden="true"></i>
          </button>

          <div class="dropdown">
            <button class="avatar-menu" data-bs-toggle="dropdown" aria-expanded="false" id="avatarMenu"
              aria-label="User menu">
              <i data-feather="user" aria-hidden="true"></i>
            </button>
            <ul class="dropdown-menu dropdown-menu-end dropdown-menu-cinebrain" id="userDropdown"
              aria-labelledby="avatarMenu">
            </ul>
          </div>
        </div>
      </div>
    </nav>
  </header>

  <!-- Mobile Search Overlay -->
  <div class="mobile-search-overlay" id="mobileSearchOverlay" aria-hidden="true" role="dialog" aria-modal="true"
    aria-label="Mobile search">
    <div class="container">
      <div class="mobile-search-header">
        <button class="btn-back" id="closeMobileSearch" aria-label="Close search">
          <i data-feather="arrow-left" aria-hidden="true"></i>
        </button>
        <div class="mobile-search-input-wrapper">
          <i data-feather="search" class="search-icon" aria-hidden="true"></i>
          <input type="text" class="form-control search-input" id="mobileSearchInput"
            placeholder="Search movies, shows, anime..." autocomplete="off" autofocus
            aria-label="Search for entertainment content" maxlength="100" role="combobox" aria-expanded="false"
            aria-haspopup="listbox">
        </div>
      </div>
      <div class="search-results mobile-results" id="mobileSearchResults" role="listbox" aria-live="polite"
        aria-label="Mobile search results">
      </div>
    </div>
  </div>

  <main id="main-content" role="main">
    <!-- Hero Section with Enhanced Accessibility -->
    <section class="hero-section" id="heroSection" tabindex="0" role="banner" aria-label="Featured content">
      <div class="hero-background">
        <img id="heroImage" class="hero-image" alt="" role="presentation">
      </div>
      <div class="hero-overlay" aria-hidden="true"></div>

      <!-- Loading State -->
      <div class="hero-loading" id="heroLoading" aria-hidden="true">
        <div class="skeleton skeleton-badge">
          <div class="skeleton-shimmer"></div>
        </div>
        <div class="skeleton skeleton-title">
          <div class="skeleton-shimmer"></div>
        </div>
        <div class="skeleton-info">
          <div class="skeleton skeleton-info-item">
            <div class="skeleton-shimmer"></div>
          </div>
          <div class="skeleton skeleton-info-item">
            <div class="skeleton-shimmer"></div>
          </div>
          <div class="skeleton skeleton-info-item">
            <div class="skeleton-shimmer"></div>
          </div>
        </div>
        <div class="skeleton-description">
          <div class="skeleton skeleton-description-line">
            <div class="skeleton-shimmer"></div>
          </div>
          <div class="skeleton skeleton-description-line">
            <div class="skeleton-shimmer"></div>
          </div>
          <div class="skeleton skeleton-description-line">
            <div class="skeleton-shimmer"></div>
          </div>
        </div>
        <div class="skeleton-actions">
          <div class="skeleton skeleton-btn">
            <div class="skeleton-shimmer"></div>
          </div>
          <div class="skeleton skeleton-btn">
            <div class="skeleton-shimmer"></div>
          </div>
          <div class="skeleton skeleton-btn">
            <div class="skeleton-shimmer"></div>
          </div>
        </div>
      </div>

      <!-- Hero Content -->
      <div class="hero-content" id="heroContent" aria-live="polite">
        <div class="hero-badge">
          <span id="heroType">TRENDING</span>
        </div>

        <h1 class="hero-title" id="heroTitle">Discover Amazing Entertainment</h1>

        <div class="hero-info" role="group" aria-label="Content information">
          <span class="hero-rating" id="heroRating" aria-label="Rating">
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z" />
            </svg>
            <span>--</span>
          </span>
          <span id="heroYear" aria-label="Release year">----</span>
          <span id="heroGenres" aria-label="Genres">Loading...</span>
        </div>

        <p class="hero-description" id="heroDescription">
          Get personalized AI-powered recommendations for movies, TV shows, and anime tailored to your taste.
        </p>

        <div class="hero-actions" role="group" aria-label="Content actions">
          <button class="hero-btn hero-btn-primary" id="heroWatchBtn" type="button">
            <i data-feather="play" aria-hidden="true"></i>
            <span class="btn-text">View Details</span>
          </button>
          <button class="hero-btn hero-btn-secondary" id="heroWishlistBtn" type="button">
            <i data-feather="heart" aria-hidden="true"></i>
            <span class="btn-text">Add to List</span>
          </button>
          <button class="hero-btn hero-btn-tertiary" id="heroInfoBtn" type="button">
            <i data-feather="info" aria-hidden="true"></i>
            <span class="btn-text">More Info</span>
          </button>
        </div>
      </div>
    </section>

    <!-- Content Container -->
    <div class="container">
      <div id="content-container" aria-label="Entertainment recommendations" role="region">
        <!-- Content will be dynamically loaded here -->
      </div>
    </div>
  </main>

  <!-- Mobile Navigation -->
  <nav class="mobile-bottom-nav" id="mobileBottomNav" aria-label="Mobile navigation" role="navigation">
    <div class="mobile-nav-container" id="mobileNavContainer">
    </div>
  </nav>

  <!-- Mobile Menu -->
  <aside class="mobile-menu-overlay" id="mobileMenuOverlay" aria-hidden="true" role="dialog" aria-modal="true"
    aria-label="Mobile menu">
    <div class="menu-handle" role="presentation"></div>
    <div class="menu-header">
      <h3 class="menu-title">CineBrain Menu</h3>
      <button class="menu-close-btn" id="mobileMenuClose" aria-label="Close menu" type="button">
        <i data-feather="x" aria-hidden="true"></i>
      </button>
    </div>

    <section class="menu-section">
      <!-- Removed: <h4 class="menu-section-title">Browse Categories</h4> -->
      <div class="mobile-menu-grid" id="mobileMenuGrid" role="list">
      </div>
    </section>

    <section class="menu-section">
      <h4 class="menu-section-title" id="userSectionTitle">Account</h4>
      <div class="mobile-menu-list" id="mobileMenuList" role="list">
      </div>
    </section>
  </aside>

  <!-- Enhanced Footer -->
  <footer class="footer-cinebrain" role="contentinfo">
    <div class="footer-container">
      <div class="footer-main">
        <div class="footer-brand">
          <div class="footer-logo">
            <h3>CineBrain</h3>
            <span class="footer-tagline">The Mind Behind Your Next Favorite</span>
          </div>
          <p class="footer-description">
            AI-powered movie, TV show, and anime recommendations tailored just for you.
            Discover your next binge-watch with personalized suggestions.
          </p>

          <div class="footer-social" role="group" aria-label="Social media links">
            <a href="https://twitter.com/cinebrain" class="footer-social-link" aria-label="Follow CineBrain on Twitter"
              rel="noopener noreferrer" target="_blank">
              <i data-feather="twitter" aria-hidden="true"></i>
            </a>
            <a href="https://facebook.com/cinebrain" class="footer-social-link"
              aria-label="Follow CineBrain on Facebook" rel="noopener noreferrer" target="_blank">
              <i data-feather="facebook" aria-hidden="true"></i>
            </a>
            <a href="https://instagram.com/cinebrain" class="footer-social-link"
              aria-label="Follow CineBrain on Instagram" rel="noopener noreferrer" target="_blank">
              <i data-feather="instagram" aria-hidden="true"></i>
            </a>
          </div>
        </div>

        <div class="footer-links">
          <div class="footer-section">
            <h4 class="footer-section-title">Support</h4>
            <ul class="footer-list" role="list">
              <li role="listitem"><a href="/support/help-center.html" class="footer-link">Help Center</a></li>
              <li role="listitem"><a href="/support/contact.html" class="footer-link">Contact Us</a></li>
              <li role="listitem"><a href="/support/faq.html" class="footer-link">FAQ</a></li>
              <li role="listitem"><a href="/support/feedback.html" class="footer-link">Feedback</a></li>
              <li role="listitem"><a href="/support/report-issue.html" class="footer-link">Report Issue</a></li>
            </ul>
          </div>

          <div class="footer-section">
            <h4 class="footer-section-title">Discover</h4>
            <ul class="footer-list" role="list">
              <li role="listitem"><a href="/explore/trending.html" class="footer-link">Trending Now</a></li>
              <li role="listitem"><a href="/explore/new-releases.html" class="footer-link">New Releases</a></li>
              <li role="listitem"><a href="/explore/top-rated.html" class="footer-link">Top Rated</a></li>
              <li role="listitem"><a href="/explore/genres.html" class="footer-link">Browse Genres</a></li>
              <li role="listitem"><a href="/explore/regional.html" class="footer-link">Regional Content</a></li>
            </ul>
          </div>

          <div class="footer-section">
            <h4 class="footer-section-title">About</h4>
            <ul class="footer-list" role="list">
              <li role="listitem"><a href="/pages/about.html" class="footer-link">About CineBrain</a></li>
              <li role="listitem"><a href="/pages/how-it-works.html" class="footer-link">How It Works</a></li>
              <li role="listitem"><a href="/pages/blog.html" class="footer-link">Blog</a></li>
              <li role="listitem"><a href="/pages/press.html" class="footer-link">Press</a></li>
              <li role="listitem"><a href="/pages/careers.html" class="footer-link">Careers</a></li>
            </ul>
          </div>
        </div>
      </div>

      <div class="footer-bottom">
        <div class="footer-bottom-content">
          <div class="footer-copyright">
            <p>
              <span class="copyright-line">© 2025 CineBrain.</span>
              <span class="copyright-line">All rights reserved. Made with <span class="heart"
                  aria-label="love">❤️</span> for movie lovers.</span>
            </p>
          </div>

          <div class="footer-legal">
            <span class="legal-line">
              <a href="/legal/privacy-policy.html" class="footer-legal-link">Privacy</a>
              <a href="/legal/terms-of-service.html" class="footer-legal-link">Terms of Service</a>
              <a href="/legal/cookie-policy.html" class="footer-legal-link">Cookies</a>
            </span>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <!-- Mobile Backdrop -->
  <div class="mobile-backdrop" id="mobileBackdrop" aria-hidden="true"></div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>

  <!-- Security and Utility Scripts -->
  <script>
    // Enhanced secure storage with encryption-like obfuscation
    window.secureStorage = {
      encode: function (str) {
        try {
          return btoa(unescape(encodeURIComponent(str)));
        } catch (e) {
          return str;
        }
      },
      decode: function (str) {
        try {
          return decodeURIComponent(escape(atob(str)));
        } catch (e) {
          return str;
        }
      },
      getItem: function (key) {
        try {
          const item = localStorage.getItem(`cb_${key}`);
          return item ? this.decode(item) : null;
        } catch (e) {
          console.error('Storage access error:', e);
          return null;
        }
      },
      setItem: function (key, value) {
        try {
          if (typeof value === 'string' && value.length < 5000) {
            localStorage.setItem(`cb_${key}`, this.encode(value));
          }
        } catch (e) {
          console.error('Storage write error:', e);
        }
      },
      removeItem: function (key) {
        try {
          localStorage.removeItem(`cb_${key}`);
        } catch (e) {
          console.error('Storage remove error:', e);
        }
      }
    };

    // Enhanced input sanitization
    window.sanitizeInput = function (str) {
      if (typeof str !== 'string') return '';
      return str
        .replace(/[<>]/g, '')
        .replace(/javascript:/gi, '')
        .replace(/on\w+\s*=/gi, '')
        .trim()
        .substring(0, 1000);
    };

    // Loading indicator
    window.showLoadingIndicator = function () {
      const indicator = document.getElementById('page-loading-indicator');
      if (indicator) {
        indicator.style.transform = 'scaleX(1)';
      }
    };

    window.hideLoadingIndicator = function () {
      const indicator = document.getElementById('page-loading-indicator');
      if (indicator) {
        indicator.style.transform = 'scaleX(0)';
      }
    };

    // Performance monitoring
    window.addEventListener('load', function () {
      if ('performance' in window) {
        const loadTime = performance.now();
        console.log('CineBrain page load time:', Math.round(loadTime), 'ms');

        // Send performance data (you can implement analytics here)
        if (loadTime > 3000) {
          console.warn('CineBrain: Slow page load detected');
        }
      }
    });

    // Error boundary
    window.addEventListener('error', function (e) {
      console.error('CineBrain global error:', e.error);
      // You can implement error reporting here
    });

    // Enhanced connection awareness
    if ('connection' in navigator) {
      const connection = navigator.connection;
      if (connection.effectiveType === 'slow-2g' || connection.effectiveType === '2g') {
        document.documentElement.classList.add('slow-connection');
        console.log('CineBrain: Slow connection detected, optimizing experience');
      }
    }
  </script>

  <!-- Core Application Scripts -->
  <script src="/assets/js/config.js"></script>
  <script src="/assets/js/components/theme-manager.js"></script>
  <script src="/assets/js/components/opening.js"></script>
  <script src="/assets/js/components/topbar.js"></script>
  <script src="/assets/js/components/mobile-nav.js"></script>
  <script src="/assets/js/home/hero.js"></script>
  <script src="/assets/js/home/content-card.js"></script>

  <!-- Service Worker Registration -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function () {
        navigator.serviceWorker.register('/sw.js')
          .then(function (registration) {
            console.log('CineBrain ServiceWorker registered');
          })
          .catch(function (error) {
            console.log('CineBrain ServiceWorker registration failed');
          });
      });
    }
  </script>
</body>

</html>

2. topbar.css
:root {
    --cinebrain-primary: #113CCF;
    --cinebrain-primary-light: #1E4FE5;
    --cinebrain-primary-dark: #0A2A9F;
    --cinebrain-dark: #0E0E0E;
    --cinebrain-darker: #000000;
    --cinebrain-gray-dark: #1A1D29;
    --cinebrain-gray-medium: #2A2D3A;
    --cinebrain-accent: #1E4FE5;
    --cinebrain-text-secondary: #9CA3AF;

    --navbar-height: clamp(58px, 10vw, 70px);
    --icon-size: clamp(16px, 4vw, 18px);
    --avatar-size: clamp(31px, 7vw, 39px);
    --brand-font-size: clamp(1.1rem, 5vw, 2rem);
    --tagline-font-size: clamp(0.48rem, 2vw, 0.75rem);
    --icon-button-padding: 8px;
    --mobile-icon-gap: clamp(8px, 2vw, 14px);
    --search-bar-height: clamp(36px, 8vw, 42px);
    --search-bar-width: min(600px, 90vw);

    --text-base: clamp(0.875rem, 2.5vw, 1rem);
    --text-small: clamp(0.75rem, 2vw, 0.875rem);
    --text-xs: clamp(0.65rem, 1.8vw, 0.75rem);
    --search-input-font: clamp(0.825rem, 2.5vw, 0.925rem);
    --dropdown-font: clamp(0.8rem, 2.2vw, 0.9rem);
    --badge-font: clamp(0.6rem, 1.5vw, 0.7rem);
    --recent-header-font: clamp(0.7rem, 2vw, 0.8rem);
}

[data-theme="dark"] {
    --bs-body-bg: #000000;
    --bs-body-color: #ffffff;
    --bs-navbar-bg: rgba(0, 0, 0, 0.95);
    --bs-dropdown-bg: #0a0a0a;
    --bs-dropdown-link-color: #ffffff;
    --bs-dropdown-link-hover-bg: rgba(255, 255, 255, 0.08);
    --tagline-color: #888888;
    --search-bg: rgba(255, 255, 255, 0.08);
    --search-border: rgba(255, 255, 255, 0.15);
    --search-text: #ffffff;
    --search-placeholder: rgba(255, 255, 255, 0.5);
    --search-icon-color: rgba(255, 255, 255, 0.7);
    --search-focus-bg: rgba(255, 255, 255, 0.1);
    --search-focus-border: rgba(255, 255, 255, 0.3);
    --search-focus-shadow: rgba(255, 255, 255, 0.05);
    --suggestion-hover-bg: rgba(255, 255, 255, 0.1);
    --theme-icon-color: #ffffff;
    --text-primary: #ffffff;
    --text-secondary: #888888;
    --text-muted: #666666;
    --icon-stroke-color: #ffffff;
    --icon-fill-color: #ffffff;
    --badge-bg: #1a1a1a;
    --badge-color: #ffffff;
    --badge-border: rgba(255, 255, 255, 0.1);
    --recent-bg: rgba(255, 255, 255, 0.05);
    --recent-hover: rgba(255, 255, 255, 0.08);
    --poster-bg: #1a1a1a;
    --poster-border: rgba(255, 255, 255, 0.1);
    --dropdown-border: rgba(255, 255, 255, 0.1);
}

[data-theme="light"] {
    --bs-body-bg: #ffffff;
    --bs-body-color: #000000;
    --bs-navbar-bg: rgba(255, 255, 255, 0.95);
    --bs-dropdown-bg: #ffffff;
    --bs-dropdown-link-color: #000000;
    --bs-dropdown-link-hover-bg: rgba(0, 0, 0, 0.05);
    --tagline-color: #666666;
    --search-bg: rgba(0, 0, 0, 0.05);
    --search-border: rgba(0, 0, 0, 0.1);
    --search-text: #000000;
    --search-placeholder: rgba(0, 0, 0, 0.5);
    --search-icon-color: rgba(0, 0, 0, 0.6);
    --search-focus-bg: rgba(0, 0, 0, 0.03);
    --search-focus-border: rgba(0, 0, 0, 0.2);
    --search-focus-shadow: rgba(0, 0, 0, 0.05);
    --suggestion-hover-bg: rgba(0, 0, 0, 0.05);
    --theme-icon-color: #000000;
    --text-primary: #000000;
    --text-secondary: #666666;
    --text-muted: #999999;
    --icon-stroke-color: #000000;
    --icon-fill-color: #000000;
    --badge-bg: #f0f0f0;
    --badge-color: #000000;
    --badge-border: rgba(0, 0, 0, 0.1);
    --recent-bg: rgba(0, 0, 0, 0.03);
    --recent-hover: rgba(0, 0, 0, 0.05);
    --poster-bg: #f0f0f0;
    --poster-border: rgba(0, 0, 0, 0.1);
    --dropdown-border: rgba(0, 0, 0, 0.1);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

h1.navbar-brand-cinebrain {
    margin: 0 !important;
    padding: 0 !important;
    font-size: var(--brand-font-size) !important;
    line-height: 1 !important;
    font-weight: normal !important;
    display: block !important;
}

h1.navbar-brand-cinebrain {
    font-family: 'Bangers', cursive !important;
    letter-spacing: clamp(0.5px, 0.1vw, 1px) !important;
    background: linear-gradient(135deg, var(--cinebrain-primary) 0%, var(--cinebrain-primary-light) 50%, var(--cinebrain-accent) 100%) !important;
    -webkit-background-clip: text !important;
    -webkit-text-fill-color: transparent !important;
    background-clip: text !important;
    text-shadow: 0 2px 10px rgba(17, 60, 207, 0.3) !important;
    white-space: nowrap !important;
    text-decoration: none !important;
}

body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: var(--bs-body-bg);
    color: var(--bs-body-color);
    padding-top: var(--navbar-height);
    font-size: var(--text-base);
}

.navbar-cinebrain {
    background: var(--bs-navbar-bg);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-bottom: 1px solid var(--search-border);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    min-height: var(--navbar-height);
    height: var(--navbar-height);
    z-index: 1040;
}

.navbar-cinebrain .container-fluid {
    padding-left: clamp(12px, 3vw, 20px);
    padding-right: clamp(12px, 3vw, 20px);
    height: 100%;
    display: grid;
    grid-template-columns: auto 1fr auto;
    align-items: center;
    gap: clamp(10px, 3vw, 20px);
}

@media (max-width: 767px) {
    .navbar-cinebrain .container-fluid {
        display: flex;
        justify-content: space-between;
    }
}

.navbar-brand-wrapper {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    justify-content: center;
    flex-shrink: 0;
    min-width: 0;
}

.navbar-brand-cinebrain {
    font-family: 'Bangers', cursive;
    letter-spacing: clamp(0.5px, 0.1vw, 1px);
    background: linear-gradient(135deg, var(--cinebrain-primary) 0%, var(--cinebrain-primary-light) 50%, var(--cinebrain-accent) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    text-shadow: 0 2px 10px rgba(17, 60, 207, 0.3);
    font-size: var(--brand-font-size);
    line-height: 1;
    white-space: nowrap;
    display: block;
    text-decoration: none;
}

.tagline {
    font-size: var(--tagline-font-size);
    font-weight: 500;
    letter-spacing: clamp(0.2px, 0.05vw, 0.5px);
    color: var(--tagline-color) !important;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    line-height: 1.2;
    margin-top: 2px;
    display: block;
    max-width: 100%;
}

.search-container.desktop-search {
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
    max-width: var(--search-bar-width);
    margin: 0 auto;
}

@media (max-width: 767px) {
    .search-container.desktop-search {
        display: none !important;
    }
}

.search-wrapper {
    position: relative;
    width: 100%;
}

.search-bar-wrapper {
    position: relative;
    width: 100%;
}

.search-input-wrapper {
    position: relative;
    width: 100%;
}

.search-icon {
    position: absolute;
    left: clamp(16px, 3vw, 20px);
    top: 50%;
    transform: translateY(-50%);
    width: var(--icon-size);
    height: var(--icon-size);
    stroke: var(--icon-stroke-color) !important;
    color: var(--icon-stroke-color) !important;
    pointer-events: none;
    z-index: 1;
    transition: color 0.3s ease;
}

.search-input {
    background: var(--search-bg);
    border: 1px solid var(--search-border);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    height: var(--search-bar-height);
    font-size: var(--search-input-font);
    padding-left: clamp(40px, 10vw, 52px);
    padding-right: clamp(36px, 8vw, 44px);
    width: 100%;
    border-radius: calc(var(--search-bar-height) / 2);
    color: var(--search-text) !important;
    font-weight: 400;
    box-shadow: none;
}

.search-input:hover {
    border-color: var(--search-focus-border);
    background: var(--search-focus-bg);
}

.search-input::placeholder {
    color: var(--search-placeholder);
    font-weight: 400;
    font-size: var(--search-input-font);
}

.search-input:focus {
    background: var(--search-focus-bg);
    border-color: var(--search-focus-border);
    box-shadow: 0 0 0 3px var(--search-focus-shadow);
    outline: none;
    color: var(--search-text) !important;
}

.search-clear {
    position: absolute;
    right: clamp(8px, 2vw, 10px);
    top: 50%;
    transform: translateY(-50%);
    width: clamp(24px, 6vw, 28px);
    height: clamp(24px, 6vw, 28px);
    border-radius: 50%;
    background: transparent;
    border: none;
    display: none;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s ease;
    padding: 0;
    z-index: 2;
}

.search-clear:hover {
    background: var(--search-focus-bg);
}

.search-clear svg {
    width: clamp(14px, 3.5vw, 16px);
    height: clamp(14px, 3.5vw, 16px);
    stroke: var(--icon-stroke-color) !important;
}

.search-results {
    position: absolute;
    top: calc(100% + clamp(8px, 2vw, 12px));
    left: 0;
    right: 0;
    background: var(--bs-dropdown-bg);
    border-radius: clamp(16px, 4vw, 20px);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    max-height: clamp(300px, 60vh, 400px);
    overflow-y: auto;
    z-index: 1050;
    display: none;
    border: 1px solid var(--search-border);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
}

.search-results.show {
    display: block;
    animation: slideDownFade 0.15s cubic-bezier(0.4, 0, 0.2, 1);
}

.search-result-item {
    padding: clamp(10px, 2.5vw, 14px) clamp(16px, 4vw, 20px);
    cursor: pointer;
    transition: all 0.15s ease;
    border-bottom: 1px solid var(--search-border);
    color: var(--text-primary) !important;
    position: relative;
    will-change: transform;
    display: flex !important;
    align-items: center !important;
    gap: 12px;
}

.search-result-item:first-child {
    border-top-left-radius: clamp(15px, 3.8vw, 19px);
    border-top-right-radius: clamp(15px, 3.8vw, 19px);
}

.search-result-item:last-child {
    border-bottom-left-radius: clamp(15px, 3.8vw, 19px);
    border-bottom-right-radius: clamp(15px, 3.8vw, 19px);
    border-bottom: none;
}

.search-result-item:hover {
    background: var(--suggestion-hover-bg);
    padding-left: clamp(20px, 5vw, 24px);
}

.search-result-item.active {
    background: var(--suggestion-hover-bg);
    padding-left: clamp(20px, 5vw, 24px);
}

.poster-wrapper {
    width: 40px;
    height: 60px;
    flex-shrink: 0;
    background: var(--poster-bg);
    border-radius: 4px;
    overflow: hidden;
    border: 1px solid var(--poster-border);
    position: relative;
}

.search-poster {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
}

.poster-placeholder {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--poster-bg);
    color: var(--text-muted);
    font-size: 10px;
    text-align: center;
    padding: 4px;
}

.search-result-content {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.search-result-title {
    font-weight: 600;
    color: var(--text-primary) !important;
    font-size: var(--text-base);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.search-result-meta {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: var(--text-small);
    color: var(--text-secondary) !important;
}

.search-result-item .badge {
    background-color: var(--badge-bg) !important;
    color: var(--badge-color) !important;
    border: 1px solid var(--badge-border) !important;
    font-size: var(--badge-font);
    padding: clamp(2px, 0.5vw, 3px) clamp(4px, 1vw, 6px);
}

.search-indicator {
    text-align: center;
    padding: 8px;
    font-size: var(--text-small);
    color: var(--text-secondary);
    border-top: 1px solid var(--search-border);
    margin-top: 8px;
}

.search-loading {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: clamp(16px, 4vw, 20px);
    color: var(--text-primary) !important;
}

.spinner-cinebrain {
    width: clamp(18px, 4.5vw, 20px);
    height: clamp(18px, 4.5vw, 20px);
    border: 2px solid var(--search-border);
    border-top-color: var(--text-primary);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    margin-right: 8px;
}

@keyframes spin {
    to {
        transform: rotate(360deg);
    }
}

.search-empty {
    text-align: center;
    padding: clamp(32px, 8vw, 40px) clamp(16px, 4vw, 20px);
    color: var(--text-primary) !important;
}

.search-empty svg {
    width: clamp(40px, 10vw, 48px);
    height: clamp(40px, 10vw, 48px);
    stroke: var(--icon-stroke-color) !important;
    opacity: 0.5;
    margin-bottom: clamp(12px, 3vw, 16px);
}

.search-empty p {
    font-size: var(--text-base);
    color: var(--text-primary) !important;
    margin-bottom: clamp(4px, 1vw, 8px);
}

.search-empty p.small {
    font-size: var(--text-small);
    color: var(--text-secondary) !important;
}

.nav-icons-section {
    display: flex;
    align-items: center;
    gap: var(--mobile-icon-gap);
    flex-shrink: 0;
    justify-self: end;
}

.icon-button {
    width: var(--avatar-size);
    height: var(--avatar-size);
    min-width: var(--avatar-size);
    min-height: var(--avatar-size);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    background: transparent;
    border: 2px solid var(--search-border);
    padding: 0;
    position: relative;
    -webkit-tap-highlight-color: transparent;
    transition: transform 0.2s ease, background 0.2s ease, border-color 0.2s ease;
}

.icon-button svg {
    width: var(--icon-size);
    height: var(--icon-size);
    stroke-width: 2;
    stroke: var(--icon-stroke-color) !important;
    color: var(--icon-stroke-color) !important;
}

.icon-button:hover {
    background: var(--suggestion-hover-bg);
    transform: scale(1.05);
    border-color: var(--search-focus-border);
}

.theme-toggle {
    background: transparent;
    border: 2px solid var(--search-border);
    position: relative;
    overflow: hidden;
}

.theme-icon {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    stroke: var(--icon-stroke-color) !important;
}

.theme-icon-light {
    opacity: 1;
    display: block;
}

.theme-icon-dark {
    opacity: 0;
    display: none;
}

[data-theme="dark"] .theme-icon-light {
    opacity: 0;
    display: none;
}

[data-theme="dark"] .theme-icon-dark {
    opacity: 1;
    display: block;
}

.mobile-search-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--bs-navbar-bg);
    z-index: 1100;
    display: none;
    padding: 0;
    overflow-y: auto;
}

.mobile-search-overlay.show {
    display: block;
    animation: slideInFromRight 0.3s ease;
}

.mobile-search-header {
    display: flex;
    align-items: center;
    gap: clamp(10px, 2.5vw, 12px);
    padding: clamp(10px, 2.5vw, 12px) clamp(12px, 3vw, 16px);
    border-bottom: 1px solid var(--search-border);
    position: sticky;
    top: 0;
    background: var(--bs-navbar-bg);
    z-index: 10;
}

.btn-back {
    width: clamp(32px, 8vw, 36px);
    height: clamp(32px, 8vw, 36px);
    border-radius: 50%;
    background: transparent;
    border: none;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    padding: 0;
}

.btn-back svg {
    width: clamp(18px, 4.5vw, 20px);
    height: clamp(18px, 4.5vw, 20px);
    stroke: var(--icon-stroke-color) !important;
}

.mobile-search-input-wrapper {
    position: relative;
    flex: 1;
}

.mobile-search-overlay .search-input {
    height: clamp(36px, 9vw, 40px);
    font-size: var(--search-input-font);
    padding-left: clamp(40px, 10vw, 44px);
    padding-right: clamp(14px, 3.5vw, 16px);
}

.mobile-search-overlay .search-results {
    position: relative;
    top: 0;
    margin-top: clamp(12px, 3vw, 16px);
    background: transparent;
    box-shadow: none;
    border: none;
    padding: 0 clamp(12px, 3vw, 16px);
}

.mobile-results .search-result-item {
    background: var(--search-bg);
    border-radius: clamp(10px, 2.5vw, 12px);
    border: 1px solid var(--search-border);
    margin-bottom: clamp(6px, 1.5vw, 8px);
}

.mobile-search-trigger {
    display: none;
}

@media (max-width: 767px) {
    .mobile-search-trigger {
        display: flex;
    }
}

.avatar-menu {
    width: var(--avatar-size);
    height: var(--avatar-size);
    min-width: var(--avatar-size);
    min-height: var(--avatar-size);
    border-radius: 50%;
    background: var(--search-bg);
    border: 2px solid var(--search-border);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    font-size: calc(var(--avatar-size) * 0.45);
    font-weight: 600;
    color: var(--text-primary);
}

.avatar-menu:hover {
    transform: scale(1.1);
    background: var(--suggestion-hover-bg);
    border-color: var(--search-focus-border);
}

.avatar-menu svg {
    width: calc(var(--icon-size) * 0.9);
    height: calc(var(--icon-size) * 0.9);
    stroke: var(--icon-stroke-color) !important;
}

.dropdown-menu-cinebrain {
    background: var(--bs-dropdown-bg);
    border: 1px solid var(--dropdown-border);
    border-radius: clamp(10px, 2.5vw, 12px);
    box-shadow: 0 4px 24px rgba(0, 0, 0, 0.1);
    padding: clamp(6px, 1.5vw, 8px);
    min-width: clamp(180px, 45vw, 200px);
    font-size: var(--dropdown-font);
}

.dropdown-item-cinebrain {
    border-radius: clamp(6px, 1.5vw, 8px);
    padding: clamp(8px, 2vw, 10px) clamp(14px, 3.5vw, 16px);
    transition: all 0.2s;
    display: flex;
    align-items: center;
    color: var(--text-primary) !important;
    text-decoration: none;
    font-size: var(--dropdown-font);
}

.dropdown-item-cinebrain svg {
    width: clamp(14px, 3.5vw, 16px);
    height: clamp(14px, 3.5vw, 16px);
    margin-right: clamp(8px, 2vw, 10px);
    stroke: var(--icon-stroke-color) !important;
}

.dropdown-item-cinebrain:hover {
    background: var(--bs-dropdown-link-hover-bg);
    transform: translateX(4px);
}

.dropdown-header {
    font-size: var(--text-small);
    color: var(--text-secondary) !important;
    font-weight: 600;
    padding: clamp(8px, 2vw, 10px) clamp(14px, 3.5vw, 16px);
    margin: 0;
}

.dropdown-divider {
    margin: clamp(4px, 1vw, 6px) 0;
    border-color: var(--search-border);
    opacity: 0.5;
}

.recent-searches-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: clamp(10px, 2.5vw, 12px) clamp(16px, 4vw, 20px);
    border-bottom: 1px solid var(--search-border);
    margin-bottom: 8px;
}

.recent-title {
    font-size: var(--text-small);
    font-weight: 600;
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.clear-recent-btn {
    background: transparent;
    border: none;
    color: var(--text-secondary);
    font-size: var(--text-xs);
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 4px;
    padding: 4px 8px;
    border-radius: 4px;
    transition: all 0.2s ease;
}

.clear-recent-btn:hover {
    background: var(--search-focus-bg);
    color: var(--text-primary);
}

.clear-recent-btn svg {
    width: 12px;
    height: 12px;
}

.recent-search-item {
    border-bottom: 1px solid var(--search-border) !important;
}

.recent-search-content {
    display: flex;
    align-items: center;
    gap: 12px;
    width: 100%;
}

.recent-icon {
    width: 16px;
    height: 16px;
    stroke: var(--text-secondary);
    flex-shrink: 0;
}

.recent-search-details {
    flex: 1;
    min-width: 0;
}

.recent-search-query {
    font-weight: 500;
    color: var(--text-primary);
    font-size: var(--text-base);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.recent-search-meta {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-top: 2px;
}

.recent-time {
    font-size: var(--text-xs);
    color: var(--text-muted);
}

.recent-result-info {
    font-size: var(--text-xs);
    color: var(--text-secondary);
}

.remove-recent-btn {
    background: transparent;
    border: none;
    padding: 4px;
    cursor: pointer;
    border-radius: 50%;
    transition: all 0.2s ease;
    opacity: 0;
}

.recent-search-item:hover .remove-recent-btn {
    opacity: 1;
}

.remove-recent-btn:hover {
    background: var(--search-focus-bg);
}

.remove-recent-btn svg {
    width: 14px;
    height: 14px;
    stroke: var(--text-secondary);
}

.search-suggestions {
    padding: clamp(12px, 3vw, 16px) clamp(16px, 4vw, 20px);
    border-top: 1px solid var(--search-border);
    margin-top: 8px;
}

.suggestions-title {
    display: block;
    font-size: var(--text-xs);
    color: var(--text-secondary);
    margin-bottom: 8px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.suggestion-chips {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.suggestion-chip {
    padding: 6px 12px;
    background: var(--search-bg);
    border: 1px solid var(--search-border);
    border-radius: 16px;
    font-size: var(--text-small);
    color: var(--text-primary);
    cursor: pointer;
    transition: all 0.2s ease;
}

.suggestion-chip:hover {
    background: var(--search-focus-bg);
    border-color: var(--search-focus-border);
    transform: translateY(-1px);
}

@keyframes slideDownFade {
    from {
        opacity: 0;
        transform: translateY(-8px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes slideInFromRight {
    from {
        transform: translateX(100%);
    }

    to {
        transform: translateX(0);
    }
}

.search-results::-webkit-scrollbar {
    width: clamp(6px, 1.5vw, 8px);
}

.search-results::-webkit-scrollbar-track {
    background: transparent;
}

.search-results::-webkit-scrollbar-thumb {
    background: var(--search-border);
    border-radius: 4px;
}

.search-results::-webkit-scrollbar-thumb:hover {
    background: var(--search-focus-border);
}

@media (max-width: 359px) {

    .tagline-full,
    .tagline-medium {
        display: none !important;
    }

    .tagline-short {
        display: block !important;
    }
}

@media (min-width: 360px) and (max-width: 479px) {

    .tagline-full,
    .tagline-short {
        display: none !important;
    }

    .tagline-medium {
        display: block !important;
    }
}

@media (min-width: 480px) {

    .tagline-medium,
    .tagline-short {
        display: none !important;
    }

    .tagline-full {
        display: block !important;
    }
}

@media (max-width: 767px) {
    .recent-searches-header {
        padding: 8px 12px;
    }

    .recent-search-item {
        padding: 10px 12px;
    }

    .suggestion-chips {
        gap: 6px;
    }

    .suggestion-chip {
        padding: 4px 10px;
        font-size: var(--text-xs);
    }
}

.icon-button:focus-visible,
.search-input:focus-visible,
.btn-back:focus-visible {
    outline: 2px solid var(--search-focus-border);
    outline-offset: 2px;
}

@media (prefers-reduced-motion: reduce) {

    *,
    *::before,
    *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }
}

@media print {

    .navbar-cinebrain,
    .mobile-search-overlay {
        display: none !important;
    }

    body {
        padding-top: 0 !important;
    }
}



3. topbar.js 
if (typeof feather !== 'undefined') {
    feather.replace();
}

class SearchEngine {
    constructor(apiBase) {
        this.apiBase = apiBase;
        this.cache = new Map();
        this.activeRequest = null;
        this.maxCacheSize = 50;
        this.cacheTimeout = 60000;
        this.recentSearches = this.loadRecentSearches();
        this.maxRecentSearches = 10;
    }

    loadRecentSearches() {
        try {
            const stored = localStorage.getItem('cinebrain-recent-searches');
            if (!stored) return [];
            const searches = JSON.parse(stored);
            return searches.filter(item =>
                item &&
                typeof item === 'object' &&
                item.query &&
                typeof item.query === 'string'
            );
        } catch (e) {
            console.error('Error loading recent searches:', e);
            localStorage.removeItem('cinebrain-recent-searches');
            return [];
        }
    }

    saveRecentSearches() {
        try {
            localStorage.setItem('cinebrain-recent-searches', JSON.stringify(this.recentSearches));
        } catch (e) {
            console.error('Failed to save recent searches:', e);
        }
    }

    addRecentSearch(query, result = null) {
        if (!query || typeof query !== 'string' || query.length < 2) return;

        this.recentSearches = this.recentSearches.filter(item => {
            return item && item.query && item.query.toLowerCase() !== query.toLowerCase();
        });

        const recentItem = {
            query: query,
            timestamp: Date.now(),
            resultCount: result ? result.length : 0,
            firstResult: result && result[0] ? {
                title: result[0].title || 'Unknown',
                type: result[0].content_type || 'unknown',
                slug: result[0].slug || this.generateSlug(result[0].title, result[0].release_date)
            } : null
        };

        this.recentSearches.unshift(recentItem);

        if (this.recentSearches.length > this.maxRecentSearches) {
            this.recentSearches = this.recentSearches.slice(0, this.maxRecentSearches);
        }

        this.saveRecentSearches();
    }

    getRecentSearches() {
        return this.recentSearches.filter(item =>
            item && item.query && typeof item.query === 'string'
        );
    }

    clearRecentSearches() {
        this.recentSearches = [];
        this.saveRecentSearches();
    }

    removeRecentSearch(query) {
        if (!query || typeof query !== 'string') return;
        this.recentSearches = this.recentSearches.filter(item =>
            item && item.query && item.query.toLowerCase() !== query.toLowerCase()
        );
        this.saveRecentSearches();
    }

    generateSlug(title, releaseDate) {
        if (!title) return '';
        let slug = title.toLowerCase()
            .replace(/[^\w\s-]/g, '')
            .replace(/\s+/g, '-')
            .replace(/-+/g, '-')
            .replace(/^-+|-+$/g, '')
            .trim();

        if (releaseDate) {
            const year = this.extractYear(releaseDate);
            if (year) {
                slug += `-${year}`;
            }
        }

        if (slug.length > 100) {
            slug = slug.substring(0, 100).replace(/-[^-]*$/, '');
        }

        return slug;
    }

    extractYear(dateString) {
        if (!dateString) return '';
        try {
            return new Date(dateString).getFullYear();
        } catch {
            return '';
        }
    }

    async search(query, signal) {
        const cacheKey = query.toLowerCase().trim();

        if (this.cache.has(cacheKey)) {
            const cached = this.cache.get(cacheKey);
            if (Date.now() - cached.timestamp < this.cacheTimeout) {
                return { results: cached.results, fromCache: true };
            }
            this.cache.delete(cacheKey);
        }

        if (this.activeRequest) {
            this.activeRequest.abort();
        }

        const controller = new AbortController();
        this.activeRequest = controller;

        try {
            const headers = {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            };

            const token = localStorage.getItem('cinebrain-token');
            if (token) {
                headers['Authorization'] = `Bearer ${token}`;
            }

            const response = await fetch(
                `${this.apiBase}/search?query=${encodeURIComponent(query)}&type=multi&page=1`,
                {
                    signal: signal || controller.signal,
                    headers
                }
            );

            if (!response.ok) {
                if (response.status === 401) {
                    localStorage.removeItem('cinebrain-token');
                    localStorage.removeItem('cinebrain-user');
                    window.dispatchEvent(new CustomEvent('userLoggedOut'));
                }
                throw new Error(`Search failed: ${response.status}`);
            }

            const data = await response.json();
            const results = data.results || [];

            if (results.length > 0) {
                this.addRecentSearch(query, results);
            }

            this.cache.set(cacheKey, {
                results,
                timestamp: Date.now()
            });

            if (this.cache.size > this.maxCacheSize) {
                const firstKey = this.cache.keys().next().value;
                this.cache.delete(firstKey);
            }

            return { results, fromCache: false };
        } catch (error) {
            if (error.name === 'AbortError') {
                throw error;
            }
            console.error('Search error:', error);
            throw error;
        } finally {
            if (this.activeRequest === controller) {
                this.activeRequest = null;
            }
        }
    }

    clearCache() {
        this.cache.clear();
    }
}

class NotificationSystem {
    constructor() {
        this.container = null;
        this.init();
    }

    init() {
        if (!document.getElementById('notification-container')) {
            this.container = document.createElement('div');
            this.container.id = 'notification-container';

            const isMobile = window.innerWidth <= 768;

            this.container.style.cssText = `
                position: fixed;
                ${isMobile ? 'top: 10px; left: 10px; right: 10px;' : 'top: 70px; right: 20px;'}
                z-index: 9999;
                display: flex;
                flex-direction: column;
                gap: 10px;
                pointer-events: none;
                max-width: ${isMobile ? '100%' : '400px'};
            `;
            document.body.appendChild(this.container);
        } else {
            this.container = document.getElementById('notification-container');
        }
    }

    show(message, type = 'info', duration = 3000) {
        const notification = document.createElement('div');
        notification.className = `notification notification-${type}`;

        const isMobile = window.innerWidth <= 768;

        const colors = {
            success: 'linear-gradient(135deg, #10b981, #059669)',
            error: 'linear-gradient(135deg, #ef4444, #dc2626)',
            warning: 'linear-gradient(135deg, #f59e0b, #d97706)',
            info: 'linear-gradient(135deg, #3b82f6, #2563eb)',
            admin: 'linear-gradient(135deg, #e50914, #991b1b)'
        };

        const icons = {
            success: 'check-circle',
            error: 'x-circle',
            warning: 'alert-triangle',
            info: 'info',
            admin: 'shield'
        };

        notification.style.cssText = `
            background: ${colors[type] || colors.info};
            color: white;
            padding: ${isMobile ? 'clamp(12px, 3vw, 16px) clamp(14px, 3.5vw, 18px)' : '16px 20px'};
            border-radius: ${isMobile ? 'clamp(8px, 2vw, 12px)' : '12px'};
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            gap: ${isMobile ? 'clamp(8px, 2vw, 12px)' : '12px'};
            min-width: ${isMobile ? 'auto' : '300px'};
            max-width: 100%;
            pointer-events: auto;
            cursor: pointer;
            animation: ${isMobile ? 'slideDown' : 'slideInRight'} 0.3s ease;
            font-size: ${isMobile ? 'clamp(12px, 3.5vw, 14px)' : '14px'};
            font-weight: 500;
            position: relative;
            overflow: hidden;
            width: ${isMobile ? '100%' : 'auto'};
        `;

        const iconElement = document.createElement('i');
        iconElement.setAttribute('data-feather', icons[type] || icons.info);
        iconElement.style.cssText = `
            width: ${isMobile ? 'clamp(18px, 5vw, 20px)' : '20px'};
            height: ${isMobile ? 'clamp(18px, 5vw, 20px)' : '20px'};
            flex-shrink: 0;
        `;

        const messageElement = document.createElement('span');
        messageElement.textContent = message;
        messageElement.style.cssText = 'flex: 1; line-height: 1.4;';

        const closeBtn = document.createElement('button');
        closeBtn.innerHTML = '×';
        closeBtn.style.cssText = `
            background: none;
            border: none;
            color: white;
            font-size: ${isMobile ? 'clamp(20px, 6vw, 24px)' : '24px'};
            line-height: 1;
            cursor: pointer;
            padding: 0;
            margin-left: ${isMobile ? 'clamp(8px, 2vw, 12px)' : '12px'};
            opacity: 0.8;
            transition: opacity 0.2s;
            min-width: ${isMobile ? '24px' : 'auto'};
        `;

        const progressBar = document.createElement('div');
        progressBar.style.cssText = `
            position: absolute;
            bottom: 0;
            left: 0;
            height: 3px;
            background: rgba(255, 255, 255, 0.5);
            animation: progress ${duration}ms linear;
            width: 100%;
            transform-origin: left;
        `;

        notification.appendChild(iconElement);
        notification.appendChild(messageElement);
        notification.appendChild(closeBtn);
        notification.appendChild(progressBar);

        this.container.appendChild(notification);

        if (typeof feather !== 'undefined') {
            feather.replace();
        }

        const removeNotification = () => {
            notification.style.animation = `${isMobile ? 'slideDown' : 'slideOutRight'} 0.3s ease reverse`;
            setTimeout(() => {
                notification.remove();
            }, 300);
        };

        const timeoutId = setTimeout(removeNotification, duration);

        notification.addEventListener('click', () => {
            clearTimeout(timeoutId);
            removeNotification();
        });

        if (!document.getElementById('notification-styles')) {
            const style = document.createElement('style');
            style.id = 'notification-styles';
            style.textContent = `
                @keyframes slideInRight {
                    from {
                        transform: translateX(100%);
                        opacity: 0;
                    }
                    to {
                        transform: translateX(0);
                        opacity: 1;
                    }
                }
                @keyframes slideOutRight {
                    from {
                        transform: translateX(0);
                        opacity: 1;
                    }
                    to {
                        transform: translateX(100%);
                        opacity: 0;
                    }
                }
                @keyframes slideDown {
                    from {
                        transform: translateY(-100%);
                        opacity: 0;
                    }
                    to {
                        transform: translateY(0);
                        opacity: 1;
                    }
                }
                @keyframes progress {
                    from {
                        transform: scaleX(1);
                    }
                    to {
                        transform: scaleX(0);
                    }
                }
            `;
            document.head.appendChild(style);
        }
    }
}

class TopbarComponent {
    constructor() {
        this.apiBase = window.CineBrainConfig.apiBase;
        this.searchEngine = new SearchEngine(this.apiBase);
        this.notificationSystem = new NotificationSystem();
        this.searchDebounceTimer = null;
        this.currentUser = this.getCurrentUser();
        this.currentSearchQuery = '';
        this.searchController = null;
        this.lastSearchResults = [];
        this.searchInProgress = false;
        this.showingRecentSearches = false;

        // Admin specific properties
        this.adminData = {
            pendingTickets: 0,
            newReports: 0,
            systemAlerts: 0
        };
        this.adminRefreshInterval = null;

        this.SEARCH_DEBOUNCE_MS = 150;
        this.MIN_SEARCH_LENGTH = 1;

        if (window.themeManager) {
            window.themeManager.register((theme) => this.onThemeChange(theme));
        }

        this.init();
    }

    init() {
        this.initTheme();
        this.initOptimizedSearch();
        this.initUserMenu();
        this.initMobileSearch();
        this.setupEventListeners();
        this.handleResponsive();
        this.initKeyboardShortcuts();

        // Initialize admin features if user is admin
        if (this.currentUser?.is_admin) {
            this.initAdminFeatures();
        }

        if (typeof feather !== 'undefined') {
            feather.replace();
        }
    }

    initAdminFeatures() {
        // Add admin mode indicator to topbar
        const topbar = document.querySelector('.topbar');
        if (topbar && this.isAdminMode()) {
            topbar.classList.add('admin-mode');

            // Add admin badge next to logo
            const logo = topbar.querySelector('.logo');
            if (logo && !logo.querySelector('.admin-indicator')) {
                const adminBadge = document.createElement('span');
                adminBadge.className = 'admin-indicator';
                adminBadge.innerHTML = '<i data-feather="shield"></i> Admin';
                adminBadge.style.cssText = `
                    background: linear-gradient(135deg, #e50914, #991b1b);
                    color: white;
                    padding: 4px 10px;
                    border-radius: 20px;
                    font-size: 11px;
                    font-weight: 600;
                    margin-left: 10px;
                    display: inline-flex;
                    align-items: center;
                    gap: 4px;
                `;
                logo.appendChild(adminBadge);

                if (typeof feather !== 'undefined') {
                    feather.replace();
                }
            }
        }

        // Load admin data
        this.loadAdminData();

        // Set up periodic refresh for admin data
        this.adminRefreshInterval = setInterval(() => {
            this.loadAdminData();
        }, 30000); // Refresh every 30 seconds
    }

    async loadAdminData() {
        if (!this.currentUser?.is_admin) return;

        try {
            const token = localStorage.getItem('cinebrain-token');
            if (!token) return;

            const response = await fetch(`${this.apiBase}/admin/dashboard/stats`, {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });

            if (response.ok) {
                const data = await response.json();
                this.adminData = {
                    pendingTickets: data.pending_tickets || 0,
                    newReports: data.new_reports || 0,
                    systemAlerts: data.system_alerts || 0
                };

                this.updateAdminBadges();
            }
        } catch (error) {
            console.error('Error loading admin data:', error);
        }
    }

    updateAdminBadges() {
        // Update support menu item badge
        const supportMenuItem = document.querySelector('a[href*="Support Dashboard.html"] .admin-badge');
        if (supportMenuItem && this.adminData.pendingTickets > 0) {
            supportMenuItem.textContent = this.adminData.pendingTickets;
            supportMenuItem.style.display = 'inline-block';
        } else if (supportMenuItem) {
            supportMenuItem.style.display = 'none';
        }

        // Update reports menu item badge  
        const reportsMenuItem = document.querySelector('a[href*="reports.html"] .admin-badge');
        if (reportsMenuItem && this.adminData.newReports > 0) {
            reportsMenuItem.textContent = this.adminData.newReports;
            reportsMenuItem.style.display = 'inline-block';
        } else if (reportsMenuItem) {
            reportsMenuItem.style.display = 'none';
        }
    }

    isAdminMode() {
        return sessionStorage.getItem('adminMode') !== 'false';
    }

    toggleAdminMode() {
        const isCurrentlyAdmin = this.isAdminMode();
        sessionStorage.setItem('adminMode', !isCurrentlyAdmin);

        this.notificationSystem.show(
            isCurrentlyAdmin ? 'Switched to User Mode' : 'Switched to Admin Mode',
            isCurrentlyAdmin ? 'info' : 'admin'
        );

        setTimeout(() => {
            location.reload();
        }, 500);
    }

    onThemeChange(theme) {
        this.updateThemeUI(theme);
    }

    updateThemeUI(theme) {
        if (typeof feather !== 'undefined') {
            feather.replace();
        }
        this.updateIconColors();
    }

    initKeyboardShortcuts() {
        document.addEventListener('keydown', (e) => {
            // Search shortcut
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                e.preventDefault();
                if (window.innerWidth > 767) {
                    const desktopInput = document.getElementById('desktopSearchInput');
                    desktopInput?.focus();
                } else {
                    document.getElementById('mobileSearchTrigger')?.click();
                }
            }

            // Admin shortcuts
            if (this.currentUser?.is_admin && e.altKey) {
                switch (e.key) {
                    case 'a':
                        e.preventDefault();
                        window.location.href = '/admin/index.html';
                        break;
                    case 'c':
                        e.preventDefault();
                        window.location.href = '/admin/content.html';
                        break;
                    case 's':
                        e.preventDefault();
                        window.location.href = '/admin/Support Dashboard.html';
                        break;
                    case 'm':
                        e.preventDefault();
                        this.toggleAdminMode();
                        break;
                }
            }

            // Escape key handling
            if (e.key === 'Escape') {
                const desktopInput = document.getElementById('desktopSearchInput');
                const clearBtn = document.getElementById('searchClear');
                if (desktopInput && desktopInput.value) {
                    desktopInput.value = '';
                    this.currentSearchQuery = '';
                    if (clearBtn) clearBtn.style.display = 'none';
                    this.closeSearchResults('desktop');
                } else if (this.showingRecentSearches) {
                    this.closeSearchResults('desktop');
                    this.closeSearchResults('mobile');
                }
            }

            // Enter key for search
            if (e.key === 'Enter' && this.currentSearchQuery) {
                const activeResult = document.querySelector('.search-result-item.active');
                if (activeResult) {
                    activeResult.click();
                } else {
                    const firstResult = document.querySelector('.search-result-item');
                    if (firstResult) {
                        firstResult.click();
                    }
                }
            }
        });
    }

    initOptimizedSearch() {
        const desktopInput = document.getElementById('desktopSearchInput');
        const mobileInput = document.getElementById('mobileSearchInput');
        const clearBtn = document.getElementById('searchClear');

        if (desktopInput) {
            desktopInput.addEventListener('input', (e) => {
                this.handleSearchInput(e.target.value, 'desktop');
                if (clearBtn) {
                    clearBtn.style.display = e.target.value ? 'flex' : 'none';
                }
            });

            desktopInput.addEventListener('paste', (e) => {
                setTimeout(() => {
                    this.handleSearchInput(e.target.value, 'desktop');
                }, 0);
            });

            desktopInput.addEventListener('focus', (e) => {
                if (!e.target.value.trim()) {
                    this.showRecentSearches('desktop');
                } else if (e.target.value.trim().length >= this.MIN_SEARCH_LENGTH && this.lastSearchResults.length > 0) {
                    this.displaySearchResults(this.lastSearchResults, 'desktop', e.target.value.trim());
                }
            });

            desktopInput.addEventListener('blur', (e) => {
                setTimeout(() => {
                    if (!e.target.value.trim() && !this.searchInProgress) {
                        this.closeSearchResults('desktop');
                    }
                }, 200);
            });
        }

        if (clearBtn) {
            clearBtn.addEventListener('click', () => {
                if (desktopInput) {
                    desktopInput.value = '';
                    this.currentSearchQuery = '';
                    this.lastSearchResults = [];
                    clearBtn.style.display = 'none';
                    this.closeSearchResults('desktop');
                    desktopInput.focus();
                    this.showRecentSearches('desktop');
                }
            });
        }

        if (mobileInput) {
            mobileInput.addEventListener('input', (e) => {
                this.handleSearchInput(e.target.value, 'mobile');
            });

            mobileInput.addEventListener('paste', (e) => {
                setTimeout(() => {
                    this.handleSearchInput(e.target.value, 'mobile');
                }, 0);
            });

            mobileInput.addEventListener('focus', (e) => {
                if (!e.target.value.trim()) {
                    this.showRecentSearches('mobile');
                }
            });
        }
    }

    showRecentSearches(mode) {
        const recentSearches = this.searchEngine.getRecentSearches();
        const resultsContainer = document.getElementById(`${mode}SearchResults`);

        if (!resultsContainer) {
            return;
        }

        this.showingRecentSearches = true;

        let html = '';

        if (recentSearches.length > 0) {
            html += `
                <div class="recent-searches-header">
                    <span class="recent-title">Recent Searches</span>
                    <button class="clear-recent-btn" onclick="topbar.clearRecentSearches('${mode}')">
                        <i data-feather="trash-2"></i> Clear
                    </button>
                </div>
            `;

            recentSearches.forEach((item, index) => {
                if (!item || !item.query) return;

                const timeAgo = this.getTimeAgo(item.timestamp || Date.now());
                const resultInfo = item.firstResult
                    ? `<span class="recent-result-info">${item.firstResult.type || 'unknown'} • ${item.resultCount || 0} results</span>`
                    : '';

                html += `
                    <div class="search-result-item recent-search-item" data-query="${this.escapeHtml(item.query)}">
                        <div class="recent-search-content">
                            <i data-feather="clock" class="recent-icon"></i>
                            <div class="recent-search-details">
                                <div class="recent-search-query">${this.escapeHtml(item.query)}</div>
                                <div class="recent-search-meta">
                                    <span class="recent-time">${timeAgo}</span>
                                    ${resultInfo}
                                </div>
                            </div>
                            <button class="remove-recent-btn" data-query="${this.escapeHtml(item.query)}" onclick="event.stopPropagation(); topbar.removeRecentSearch('${this.escapeHtml(item.query)}', '${mode}')">
                                <i data-feather="x"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
        }

        // Add admin quick actions if in admin mode
        if (this.currentUser?.is_admin && this.isAdminMode()) {
            html += `
                <div class="admin-quick-actions">
                    <span class="suggestions-title">Admin Quick Actions</span>
                    <div class="suggestion-chips">
                        <span class="suggestion-chip admin-chip" onclick="window.location.href='/admin/content.html'">
                            <i data-feather="film"></i> Content Manager
                        </span>
                        <span class="suggestion-chip admin-chip" onclick="window.location.href='/admin/users.html'">
                            <i data-feather="users"></i> User Management
                        </span>
                        <span class="suggestion-chip admin-chip" onclick="window.location.href='/admin/reports.html'">
                            <i data-feather="file-text"></i> Reports
                        </span>
                    </div>
                </div>
            `;
        }

        html += `
            <div class="search-suggestions">
                <span class="suggestions-title">Try searching for:</span>
                <div class="suggestion-chips">
                    <span class="suggestion-chip" data-query="Avengers">Avengers</span>
                    <span class="suggestion-chip" data-query="Spider-Man">Spider-Man</span>
                    <span class="suggestion-chip" data-query="Batman">Batman</span>
                    <span class="suggestion-chip" data-query="Anime">Anime</span>
                </div>
            </div>
        `;

        resultsContainer.innerHTML = html;
        resultsContainer.classList.add('show');

        if (typeof feather !== 'undefined') {
            feather.replace();
        }

        resultsContainer.querySelectorAll('.recent-search-item').forEach(item => {
            item.addEventListener('click', (e) => {
                if (!e.target.closest('.remove-recent-btn')) {
                    const query = item.dataset.query;
                    const input = document.getElementById(`${mode}SearchInput`);
                    if (input && query) {
                        input.value = query;
                        this.handleSearchInput(query, mode);
                        if (mode === 'desktop') {
                            const clearBtn = document.getElementById('searchClear');
                            if (clearBtn) clearBtn.style.display = 'flex';
                        }
                    }
                }
            });
        });

        resultsContainer.querySelectorAll('.suggestion-chip[data-query]').forEach(chip => {
            chip.addEventListener('click', () => {
                const query = chip.dataset.query;
                const input = document.getElementById(`${mode}SearchInput`);
                if (input && query) {
                    input.value = query;
                    this.handleSearchInput(query, mode);
                    if (mode === 'desktop') {
                        const clearBtn = document.getElementById('searchClear');
                        if (clearBtn) clearBtn.style.display = 'flex';
                    }
                }
            });
        });
    }

    clearRecentSearches(mode) {
        this.searchEngine.clearRecentSearches();
        this.closeSearchResults(mode);
        const input = document.getElementById(`${mode}SearchInput`);
        if (input && !input.value.trim()) {
            this.showRecentSearches(mode);
        }
    }

    removeRecentSearch(query, mode) {
        this.searchEngine.removeRecentSearch(query);
        const input = document.getElementById(`${mode}SearchInput`);
        if (input && !input.value.trim()) {
            this.showRecentSearches(mode);
        }
    }

    getTimeAgo(timestamp) {
        if (!timestamp || typeof timestamp !== 'number') return 'Recently';

        const now = Date.now();
        const diff = now - timestamp;
        const seconds = Math.floor(diff / 1000);
        const minutes = Math.floor(seconds / 60);
        const hours = Math.floor(minutes / 60);
        const days = Math.floor(hours / 24);

        if (days > 0) return `${days}d ago`;
        if (hours > 0) return `${hours}h ago`;
        if (minutes > 0) return `${minutes}m ago`;
        return 'Just now';
    }

    handleSearchInput(value, mode) {
        const query = value ? value.trim() : '';
        this.currentSearchQuery = query;
        this.showingRecentSearches = false;

        clearTimeout(this.searchDebounceTimer);

        if (query.length < this.MIN_SEARCH_LENGTH) {
            this.closeSearchResults(mode);
            this.lastSearchResults = [];
            if (query.length === 0) {
                this.showRecentSearches(mode);
            }
            return;
        }

        this.showLoadingState(mode, query);

        this.searchDebounceTimer = setTimeout(() => {
            this.performSearch(query, mode);
        }, this.SEARCH_DEBOUNCE_MS);
    }

    async performSearch(query, mode) {
        if (query !== this.currentSearchQuery || query.length < this.MIN_SEARCH_LENGTH) {
            return;
        }

        try {
            this.searchInProgress = true;

            if (this.searchController) {
                this.searchController.abort();
            }

            this.searchController = new AbortController();

            const startTime = performance.now();
            const { results, fromCache } = await this.searchEngine.search(query, this.searchController.signal);
            const responseTime = performance.now() - startTime;

            if (query === this.currentSearchQuery) {
                this.lastSearchResults = results;
                this.displaySearchResults(results, mode, query, fromCache ? 'cache' : 'backend', responseTime);
            }

        } catch (error) {
            if (error.name !== 'AbortError') {
                console.error('Search error:', error);
                if (query === this.currentSearchQuery) {
                    this.displaySearchError(mode, query);
                }
            }
        } finally {
            this.searchInProgress = false;
            this.searchController = null;
        }
    }

    showLoadingState(mode, query) {
        const resultsContainer = document.getElementById(`${mode}SearchResults`);
        if (!resultsContainer) return;

        if (this.lastSearchResults.length === 0 || this.currentSearchQuery !== query) {
            resultsContainer.innerHTML = `
                <div class="search-loading">
                    <div class="spinner-cinebrain"></div>
                    <span>Searching for "${this.escapeHtml(query)}"...</span>
                </div>
            `;
            resultsContainer.classList.add('show');
        }
    }

    displaySearchResults(results, mode, query, source = 'backend', responseTime = 0) {
        const resultsContainer = document.getElementById(`${mode}SearchResults`);
        if (!resultsContainer) return;

        if (query !== this.currentSearchQuery) {
            return;
        }

        this.showingRecentSearches = false;

        if (!results || results.length === 0) {
            resultsContainer.innerHTML = `
                <div class="search-empty">
                    <i data-feather="search"></i>
                    <p>No results found for "${this.escapeHtml(query)}"</p>
                    <p class="small">Try different keywords or check spelling</p>
                </div>
            `;
            if (typeof feather !== 'undefined') {
                feather.replace();
            }
            resultsContainer.classList.add('show');
            return;
        }

        let html = '';
        const isMobile = window.innerWidth <= 480;

        results.forEach((item, index) => {
            if (!item) return;

            const posterUrl = item.poster_path
                ? (item.poster_path.startsWith('http')
                    ? item.poster_path
                    : `https://image.tmdb.org/t/p/w92${item.poster_path}`)
                : 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy82MDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjYwIiBmaWxsPSIjMzMzIi8+PC9zdmc+';

            const year = item.release_date ? new Date(item.release_date).getFullYear() : '';
            const rating = item.rating ? `⭐ ${item.rating.toFixed(1)}` : '';
            const title = item.title || 'Unknown Title';
            const displayTitle = isMobile && title.length > 30
                ? title.substring(0, 30) + '...'
                : title;

            const contentType = item.content_type || 'movie';
            const typeColor = contentType === 'movie' ? 'primary' :
                contentType === 'tv' ? 'success' :
                    contentType === 'anime' ? 'warning' : 'secondary';

            const slug = item.slug || this.generateSlug(title, item.release_date);

            html += `
                <div class="search-result-item d-flex ${index === 0 ? 'active' : ''}" 
                     data-id="${item.id || ''}" 
                     data-slug="${this.escapeHtml(slug)}">
                    <div class="poster-wrapper">
                        <img src="${posterUrl}" 
                             alt="${this.escapeHtml(title)}" 
                             class="search-poster"
                             onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy82MDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjYwIiBmaWxsPSIjMzMzIi8+PC9zdmc+'"
                             loading="lazy">
                    </div>
                    <div class="search-result-content">
                        <div class="search-result-title">${this.escapeHtml(displayTitle)}</div>
                        <div class="search-result-meta">
                            <span class="badge bg-${typeColor}">${contentType}</span>
                            ${year ? `<span>${year}</span>` : ''}
                            ${rating ? `<span>${rating}</span>` : ''}
                        </div>
                    </div>
                </div>
            `;
        });

        if (source === 'backend' && responseTime > 0) {
            html += `
                <div class="search-indicator">
                    <small>Found ${results.length} results in ${responseTime.toFixed(0)}ms</small>
                </div>
            `;
        } else if (source === 'cache') {
            html += `
                <div class="search-indicator">
                    <small>⚡ Cached results • ${results.length} items</small>
                </div>
            `;
        }

        resultsContainer.innerHTML = html;
        resultsContainer.classList.add('show');

        resultsContainer.querySelectorAll('.search-result-item').forEach(item => {
            item.addEventListener('click', () => {
                const slug = item.dataset.slug;
                const contentId = item.dataset.id;

                if (slug) {
                    window.location.href = `/explore/details.html?${encodeURIComponent(slug)}`;
                } else if (contentId) {
                    console.warn('No slug available, using ID-based navigation');
                    window.location.href = `/explore/details.html?id=${contentId}`;
                } else {
                    console.error('No slug or ID available for navigation');
                    if (this.notificationSystem) {
                        this.notificationSystem.show('Unable to view details', 'error');
                    }
                }
            });
        });
    }

    generateSlug(title, releaseDate) {
        if (!title) return '';
        let slug = title.toLowerCase()
            .replace(/[^\w\s-]/g, '')
            .replace(/\s+/g, '-')
            .replace(/-+/g, '-')
            .replace(/^-+|-+$/g, '')
            .trim();

        if (releaseDate) {
            const year = this.extractYear(releaseDate);
            if (year) {
                slug += `-${year}`;
            }
        }

        if (slug.length > 100) {
            slug = slug.substring(0, 100).replace(/-[^-]*$/, '');
        }

        return slug;
    }

    extractYear(dateString) {
        if (!dateString) return '';
        try {
            return new Date(dateString).getFullYear();
        } catch {
            return '';
        }
    }

    displaySearchError(mode, query) {
        const resultsContainer = document.getElementById(`${mode}SearchResults`);
        if (!resultsContainer) return;

        resultsContainer.innerHTML = `
            <div class="search-empty">
                <i data-feather="wifi-off"></i>
                <p>Search failed</p>
                <p class="small">Unable to search for "${this.escapeHtml(query)}"</p>
                <p class="small">Please check your connection and try again</p>
            </div>
        `;

        if (typeof feather !== 'undefined') {
            feather.replace();
        }

        resultsContainer.classList.add('show');
    }

    closeSearchResults(mode = null) {
        if (mode) {
            const resultsContainer = document.getElementById(`${mode}SearchResults`);
            if (resultsContainer) {
                resultsContainer.classList.remove('show');
            }
        } else {
            document.querySelectorAll('.search-results').forEach(container => {
                container.classList.remove('show');
            });
        }
        this.showingRecentSearches = false;
    }

    escapeHtml(text) {
        if (!text || typeof text !== 'string') {
            return '';
        }

        const map = {
            '&': '&amp;',
            '<': '&lt;',
            '>': '&gt;',
            '"': '&quot;',
            "'": '&#039;'
        };
        return text.replace(/[&<>"']/g, m => map[m]);
    }

    handleResponsive() {
        let resizeTimer;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(() => {
                this.adjustForScreenSize();
            }, 250);
        });
        this.adjustForScreenSize();
    }

    adjustForScreenSize() {
        const width = window.innerWidth;
        const taglineFull = document.querySelector('.tagline-full');
        const taglineMedium = document.querySelector('.tagline-medium');
        const taglineShort = document.querySelector('.tagline-short');

        if (width <= 359) {
            if (taglineFull) taglineFull.style.display = 'none';
            if (taglineMedium) taglineMedium.style.display = 'none';
            if (taglineShort) taglineShort.style.display = 'block';
        } else if (width <= 479) {
            if (taglineFull) taglineFull.style.display = 'none';
            if (taglineMedium) taglineMedium.style.display = 'block';
            if (taglineShort) taglineShort.style.display = 'none';
        } else {
            if (taglineFull) taglineFull.style.display = 'block';
            if (taglineMedium) taglineMedium.style.display = 'none';
            if (taglineShort) taglineShort.style.display = 'none';
        }

        const dropdown = document.querySelector('.dropdown-menu-cinebrain.show');
        if (dropdown) {
            const rect = dropdown.getBoundingClientRect();
            if (rect.right > window.innerWidth) {
                dropdown.style.right = '4px';
                dropdown.style.left = 'auto';
            }
        }
    }

    initTheme() {
        if (window.themeManager) {
            const theme = window.themeManager.getCurrentTheme();
            this.updateThemeUI(theme);
        } else {
            const savedTheme = localStorage.getItem('cinebrain-theme') || 'dark';
            this.setTheme(savedTheme);
        }
    }

    setTheme(theme) {
        if (window.themeManager) {
            window.themeManager.applyTheme(theme);
        } else {
            document.documentElement.setAttribute('data-theme', theme);
            document.documentElement.setAttribute('data-bs-theme', theme);
            document.body.setAttribute('data-theme', theme);
            document.body.setAttribute('data-bs-theme', theme);

            localStorage.setItem('cinebrain-theme', theme);

            window.dispatchEvent(new CustomEvent('themeChanged', {
                detail: { theme: theme },
                bubbles: true
            }));

            setTimeout(() => {
                if (typeof feather !== 'undefined') {
                    feather.replace();
                }
                this.updateIconColors();
            }, 0);
        }
    }

    updateIconColors() {
        const allIcons = document.querySelectorAll('svg');
        allIcons.forEach(icon => {
            if (!icon.closest('.avatar-menu')) {
                const parent = icon.parentElement;
                if (parent) {
                    const display = parent.style.display;
                    parent.style.display = 'none';
                    parent.offsetHeight;
                    parent.style.display = display;
                }
            }
        });
    }

    toggleTheme() {
        if (window.themeManager) {
            window.themeManager.toggleTheme();
        } else {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            this.setTheme(newTheme);
        }

        if (navigator.vibrate) {
            navigator.vibrate(10);
        }
    }

    getCurrentUser() {
        const token = localStorage.getItem('cinebrain-token');
        const userStr = localStorage.getItem('cinebrain-user');

        if (token && userStr) {
            try {
                return JSON.parse(userStr);
            } catch (e) {
                return null;
            }
        }
        return null;
    }

    updateTopbarAvatar(avatarUrl) {
        const avatarMenu = document.getElementById('avatarMenu');
        if (!avatarMenu || !this.currentUser) return;

        try {
            if (avatarUrl) {
                avatarMenu.innerHTML = `
                    <img src="${avatarUrl}" 
                         alt="${this.currentUser.username}'s avatar" 
                         style="width: 32px; height: 32px; border-radius: 50%; object-fit: cover;"
                         onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                    <span style="display: none;">${this.currentUser.username.charAt(0).toUpperCase()}</span>
                `;
            } else {
                const initial = this.currentUser.username ?
                    this.currentUser.username.charAt(0).toUpperCase() : 'U';
                avatarMenu.innerHTML = `<span>${initial}</span>`;
            }

            avatarMenu.style.transform = 'scale(1.1)';
            setTimeout(() => {
                avatarMenu.style.transform = 'scale(1)';
            }, 200);

            console.log('CineBrain: Topbar avatar updated successfully');
        } catch (error) {
            console.error('CineBrain: Error updating topbar avatar:', error);
        }
    }

    initUserMenu() {
        const dropdown = document.getElementById('userDropdown');
        if (!dropdown) return;

        if (this.currentUser) {
            const avatarMenu = document.getElementById('avatarMenu');

            if (this.currentUser.avatar_url) {
                avatarMenu.innerHTML = `
                    <img src="${this.currentUser.avatar_url}" 
                         alt="${this.currentUser.username}'s avatar" 
                         style="width: 32px; height: 32px; border-radius: 50%; object-fit: cover;"
                         onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                    <span style="display: none;">${this.currentUser.username.charAt(0).toUpperCase()}</span>
                `;
            } else {
                const initial = this.currentUser.username ? this.currentUser.username.charAt(0).toUpperCase() : 'U';
                avatarMenu.innerHTML = `<span>${initial}</span>`;
            }

            const width = window.innerWidth;
            const username = this.currentUser.username || 'User';
            const displayName = width <= 400
                ? username.substring(0, 8) + (username.length > 8 ? '...' : '')
                : username;

            const profileUrl = window.CineBrainUtils ? window.CineBrainUtils.getProfileURL(this.currentUser.username) : `/users/profile.html?username=${this.currentUser.username}`;

            let menuItems = '';

            if (this.currentUser.is_admin) {
                // Admin user menu
                menuItems = `
                    <li><h6 class="dropdown-header">Admin: ${displayName}</h6></li>
                    <li class="px-3"><span class="badge bg-danger">Administrator</span></li>
                    <li><hr class="dropdown-divider"></li>
                    
                    <li class="dropdown-header-section">Admin Tools</li>
                    <li><a class="dropdown-item dropdown-item-cinebrain" href="/admin/index.html">
                        <i data-feather="shield"></i><span>Admin Dashboard</span>
                    </a></li>
                    <li><a class="dropdown-item dropdown-item-cinebrain" href="/admin/content.html">
                        <i data-feather="film"></i><span>Content Manager</span>
                    </a></li>
                    <li><a class="dropdown-item dropdown-item-cinebrain" href="/admin/Support Dashboard.html">
                        <i data-feather="message-circle"></i><span>Support Center</span>
                        ${this.adminData.pendingTickets > 0 ? `<span class="badge bg-warning ms-auto admin-badge">${this.adminData.pendingTickets}</span>` : ''}
                    </a></li>
                    <li><a class="dropdown-item dropdown-item-cinebrain" href="/admin/reports.html">
                        <i data-feather="file-text"></i><span>Reports</span>
                        ${this.adminData.newReports > 0 ? `<span class="badge bg-info ms-auto admin-badge">${this.adminData.newReports}</span>` : ''}
                    </a></li>
                    <li><a class="dropdown-item dropdown-item-cinebrain" href="/admin/analytics.html">
                        <i data-feather="bar-chart-2"></i><span>Analytics</span>
                    </a></li>
                    
                    <li><hr class="dropdown-divider"></li>
                    <li class="dropdown-header-section">Personal</li>
                    <li><a class="dropdown-item dropdown-item-cinebrain" href="${profileUrl}">
                        <i data-feather="user"></i><span>My Profile</span>
                    </a></li>
                    <li><a class="dropdown-item dropdown-item-cinebrain" href="/user/watchlist.html">
                        <i data-feather="bookmark"></i><span>My Watchlist</span>
                    </a></li>
                    <li><a class="dropdown-item dropdown-item-cinebrain" href="/user/favorites.html">
                        <i data-feather="heart"></i><span>My Favorites</span>
                    </a></li>
                    
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item dropdown-item-cinebrain" href="#" onclick="topbar.toggleAdminMode(); return false;">
                        <i data-feather="toggle-left"></i><span>${this.isAdminMode() ? 'Switch to User Mode' : 'Switch to Admin Mode'}</span>
                    </a></li>
                    
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item dropdown-item-cinebrain text-danger" href="#" onclick="topbar.logout(); return false;">
                        <i data-feather="log-out"></i><span>Sign Out</span>
                    </a></li>`;
            } else {
                // Regular user menu
                menuItems = `
                    <li><h6 class="dropdown-header">Hello, ${displayName}!</h6></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item dropdown-item-cinebrain" href="/user/dashboard.html">
                        <i data-feather="home"></i><span>Dashboard</span>
                    </a></li>
                    <li><a class="dropdown-item dropdown-item-cinebrain" href="${profileUrl}">
                        <i data-feather="user"></i><span>Profile</span>
                    </a></li>
                    <li><a class="dropdown-item dropdown-item-cinebrain" href="/user/favorites.html">
                        <i data-feather="heart"></i><span>Favorites</span>
                    </a></li>
                    <li><a class="dropdown-item dropdown-item-cinebrain" href="/user/settings.html">
                        <i data-feather="settings"></i><span>Settings</span>
                    </a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item dropdown-item-cinebrain" href="#" onclick="topbar.logout(); return false;">
                        <i data-feather="log-out"></i><span>Sign Out</span>
                    </a></li>`;
            }

            dropdown.innerHTML = menuItems;
        } else {
            // Not logged in menu
            dropdown.innerHTML = `
                <li><a class="dropdown-item dropdown-item-cinebrain" href="/auth/login.html">
                    <i data-feather="log-in"></i><span>Login</span>
                </a></li>
                <li><a class="dropdown-item dropdown-item-cinebrain" href="/auth/register.html">
                    <i data-feather="user-plus"></i><span>Register</span>
                </a></li>`;
        }

        // Add some custom styles for admin menu
        if (this.currentUser?.is_admin && !document.getElementById('admin-menu-styles')) {
            const style = document.createElement('style');
            style.id = 'admin-menu-styles';
            style.textContent = `
                .dropdown-header-section {
                    font-size: 11px;
                    text-transform: uppercase;
                    color: #888;
                    padding: 4px 16px;
                    margin-top: 4px;
                    font-weight: 600;
                }
                
                .admin-badge {
                    font-size: 10px;
                    padding: 2px 6px;
                    border-radius: 10px;
                    font-weight: 600;
                }
                
                .dropdown-menu-cinebrain .badge.bg-danger {
                    background: linear-gradient(135deg, #e50914, #991b1b) !important;
                }
                
                .admin-chip {
                    background: linear-gradient(135deg, #e50914, #991b1b) !important;
                    color: white !important;
                    border: none !important;
                }
                
                .admin-chip i {
                    width: 14px;
                    height: 14px;
                }
            `;
            document.head.appendChild(style);
        }

        if (typeof feather !== 'undefined') {
            feather.replace();
        }
    }

    logout() {
        const confirmDialog = document.createElement('div');
        confirmDialog.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.7);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        z-index: 10000;
        display: flex;
        align-items: center;
        justify-content: center;
        animation: fadeIn 0.2s ease;
        padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
    `;

        const dialogBox = document.createElement('div');
        dialogBox.style.cssText = `
        background: var(--bs-dropdown-bg, #1a1a1a);
        border-radius: clamp(16px, 4vw, 24px);
        padding: clamp(20px, 5vw, 32px);
        width: min(90vw, 400px);
        max-width: calc(100vw - 32px);
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        animation: scaleIn 0.2s ease;
        text-align: center;
        position: relative;
        margin: auto;
    `;

        const isAdmin = this.currentUser?.is_admin;

        dialogBox.innerHTML = `
        <div class="dialog-content-wrapper" style="margin-bottom: clamp(16px, 4vw, 24px);">
            <div class="dialog-icon-section">
                <div class="dialog-icon-wrapper" style="
                    width: clamp(48px, 12vw, 64px);
                    height: clamp(48px, 12vw, 64px);
                    margin: 0 auto clamp(12px, 3vw, 20px);
                    background: ${isAdmin ? 'linear-gradient(135deg, #e50914, #991b1b)' : 'linear-gradient(135deg, #113CCF, #1E4FE5)'};
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    position: relative;
                    box-shadow: 0 4px 20px rgba(${isAdmin ? '229, 9, 20' : '17, 60, 207'}, 0.3);
                ">
                    <i data-feather="${isAdmin ? 'shield' : 'log-out'}" class="dialog-icon" style="
                        width: clamp(24px, 6vw, 32px);
                        height: clamp(24px, 6vw, 32px);
                        stroke: white;
                        stroke-width: 2.5;
                    "></i>
                </div>
            </div>
            
            <h3 class="dialog-title" style="
                margin: 0 0 clamp(6px, 1.5vw, 10px) 0;
                color: var(--text-primary, #ffffff);
                font-size: clamp(16px, 4.5vw, 20px);
                font-weight: 600;
                line-height: 1.3;
            ">Sign Out?</h3>
            
            <p class="dialog-text" style="
                margin: 0;
                color: var(--text-secondary, #b3b3b3);
                font-size: clamp(13px, 3.5vw, 15px);
                line-height: 1.5;
                padding: 0 clamp(8px, 2vw, 16px);
            ">
                ${isAdmin ? 'Are you sure you want to sign out of your admin account?' : 'Are you sure you want to sign out of CineBrain?'}
            </p>
        </div>
        
        <div style="
            display: flex;
            gap: clamp(8px, 2vw, 12px);
            justify-content: center;
            flex-wrap: nowrap;
        ">
            <button id="cancelLogout" class="dialog-button" style="
                flex: 1;
                min-width: 0;
                max-width: 160px;
                padding: clamp(10px, 2.5vw, 12px) clamp(16px, 4vw, 24px);
                background: rgba(255, 255, 255, 0.1);
                color: var(--text-primary, #ffffff);
                border: 1px solid rgba(255, 255, 255, 0.2);
                border-radius: clamp(8px, 2vw, 12px);
                cursor: pointer;
                font-weight: 500;
                font-size: clamp(13px, 3.5vw, 15px);
                transition: all 0.2s;
                min-height: clamp(38px, 10vw, 46px);
                display: flex;
                align-items: center;
                justify-content: center;
                white-space: nowrap;
                -webkit-tap-highlight-color: transparent;
            ">Cancel</button>
            
            <button id="confirmLogout" class="dialog-button" style="
                flex: 1;
                min-width: 0;
                max-width: 160px;
                padding: clamp(10px, 2.5vw, 12px) clamp(16px, 4vw, 24px);
                background: ${isAdmin ? 'linear-gradient(135deg, #e50914, #991b1b)' : 'linear-gradient(135deg, #113CCF, #1E4FE5)'};
                color: white;
                border: none;
                border-radius: clamp(8px, 2vw, 12px);
                cursor: pointer;
                font-weight: 500;
                font-size: clamp(13px, 3.5vw, 15px);
                transition: all 0.2s;
                min-height: clamp(38px, 10vw, 46px);
                display: flex;
                align-items: center;
                justify-content: center;
                white-space: nowrap;
                position: relative;
                overflow: hidden;
                -webkit-tap-highlight-color: transparent;
                box-shadow: 0 2px 10px rgba(${isAdmin ? '229, 9, 20' : '17, 60, 207'}, 0.3);
            ">Sign Out</button>
        </div>
    `;

        confirmDialog.appendChild(dialogBox);
        document.body.appendChild(confirmDialog);

        if (!document.getElementById('dialog-animations')) {
            const style = document.createElement('style');
            style.id = 'dialog-animations';
            style.textContent = `
            @keyframes fadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }
            @keyframes scaleIn {
                from { 
                    transform: scale(0.9); 
                    opacity: 0; 
                }
                to { 
                    transform: scale(1); 
                    opacity: 1; 
                }
            }
            @keyframes spin {
                to { transform: rotate(360deg); }
            }
        `;
            document.head.appendChild(style);
        }

        if (typeof feather !== 'undefined') {
            feather.replace();
        }

        document.getElementById('cancelLogout').addEventListener('click', () => {
            confirmDialog.style.animation = 'fadeIn 0.2s ease reverse';
            setTimeout(() => confirmDialog.remove(), 200);
        });

        document.getElementById('confirmLogout').addEventListener('click', function () {
            const viewportWidth = window.innerWidth;
            const loadingText = viewportWidth < 360 ? 'Signing out...' : 'Signing out...';
            const spinnerSize = viewportWidth < 360 ? '14px' : '16px';

            this.innerHTML = `
            <svg style="
                width: ${spinnerSize}; 
                height: ${spinnerSize}; 
                margin-right: 6px;
                animation: spin 1s linear infinite;
            " viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" opacity="0.3"/>
                <path d="M21 12a9 9 0 11-18 0" stroke-linecap="round"/>
            </svg>
            ${loadingText}
        `;
            this.disabled = true;
            this.style.opacity = '0.8';

            if (window.topbar && window.topbar.notificationSystem) {
                window.topbar.notificationSystem.show('Signing out successfully...', 'success', 2000);
            }

            // Clear admin data
            if (window.topbar && window.topbar.adminRefreshInterval) {
                clearInterval(window.topbar.adminRefreshInterval);
            }

            localStorage.removeItem('cinebrain-token');
            localStorage.removeItem('cinebrain-user');
            localStorage.removeItem('cinebrain-role');
            sessionStorage.clear();

            setTimeout(() => {
                window.location.href = '/index.html';
            }, 1000);
        });

        confirmDialog.addEventListener('click', (e) => {
            if (e.target === confirmDialog) {
                confirmDialog.style.animation = 'fadeIn 0.2s ease reverse';
                setTimeout(() => confirmDialog.remove(), 200);
            }
        });

        const handleEscape = (e) => {
            if (e.key === 'Escape') {
                confirmDialog.style.animation = 'fadeIn 0.2s ease reverse';
                setTimeout(() => confirmDialog.remove(), 200);
                document.removeEventListener('keydown', handleEscape);
            }
        };
        document.addEventListener('keydown', handleEscape);
    }

    initMobileSearch() {
        const trigger = document.getElementById('mobileSearchTrigger');
        const overlay = document.getElementById('mobileSearchOverlay');
        const closeBtn = document.getElementById('closeMobileSearch');
        const input = document.getElementById('mobileSearchInput');

        if (trigger) {
            trigger.addEventListener('click', () => {
                overlay?.classList.add('show');
                setTimeout(() => {
                    input?.focus();
                    if (input && !input.value.trim()) {
                        this.showRecentSearches('mobile');
                    }
                }, 300);
            });
        }

        if (closeBtn) {
            closeBtn.addEventListener('click', () => {
                if (overlay) overlay.classList.remove('show');
                if (input) {
                    input.value = '';
                    this.currentSearchQuery = '';
                    this.lastSearchResults = [];
                    this.closeSearchResults('mobile');
                }
            });
        }

        let touchStartX = 0;
        overlay?.addEventListener('touchstart', (e) => {
            touchStartX = e.touches[0].clientX;
        });

        overlay?.addEventListener('touchend', (e) => {
            const touchEndX = e.changedTouches[0].clientX;
            if (touchEndX - touchStartX > 100) {
                overlay.classList.remove('show');
            }
        });
    }

    setupEventListeners() {
        const themeToggle = document.getElementById('themeToggle');
        if (themeToggle) {
            themeToggle.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                this.toggleTheme();
            });
        }

        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowDown' || e.key === 'ArrowUp') {
                this.handleSearchNavigation(e);
            }
        });

        const avatarMenu = document.getElementById('avatarMenu');
        if (avatarMenu) {
            avatarMenu.addEventListener('click', () => {
                setTimeout(() => {
                    const dropdown = document.querySelector('.dropdown-menu-cinebrain.show');
                    if (dropdown) {
                        const rect = dropdown.getBoundingClientRect();
                        if (rect.right > window.innerWidth) {
                            dropdown.style.right = '4px';
                            dropdown.style.left = 'auto';
                        }
                    }
                }, 10);
            });
        }

        window.addEventListener('storage', (e) => {
            if (e.key === 'cinebrain-token') {
                this.currentUser = this.getCurrentUser();
                this.initUserMenu();

                if (this.adminRefreshInterval) {
                    clearInterval(this.adminRefreshInterval);
                }

                if (this.currentUser?.is_admin) {
                    this.initAdminFeatures();
                }
            }
        });

        window.addEventListener('userLoggedIn', () => {
            this.currentUser = this.getCurrentUser();
            this.initUserMenu();

            if (this.currentUser?.is_admin) {
                this.initAdminFeatures();
            }
        });

        window.addEventListener('userLoggedOut', () => {
            this.currentUser = null;
            this.initUserMenu();

            if (this.adminRefreshInterval) {
                clearInterval(this.adminRefreshInterval);
            }
        });

        window.addEventListener('avatarUpdated', (e) => {
            console.log('CineBrain: Avatar updated event received', e.detail);
            this.currentUser = this.getCurrentUser();
            this.updateTopbarAvatar(e.detail.avatar_url);
        });

        // Clean up on page unload
        window.addEventListener('beforeunload', () => {
            if (this.adminRefreshInterval) {
                clearInterval(this.adminRefreshInterval);
            }
        });
    }

    handleSearchNavigation(event) {
        const activeResults = document.querySelector('.search-results.show');
        if (!activeResults) return;

        const items = activeResults.querySelectorAll('.search-result-item:not(.recent-search-item)');
        if (items.length === 0) return;

        event.preventDefault();

        let currentIndex = Array.from(items).findIndex(item => item.classList.contains('active'));

        if (event.key === 'ArrowDown') {
            currentIndex = currentIndex < items.length - 1 ? currentIndex + 1 : 0;
        } else {
            currentIndex = currentIndex > 0 ? currentIndex - 1 : items.length - 1;
        }

        items.forEach(item => item.classList.remove('active'));
        items[currentIndex].classList.add('active');
        items[currentIndex].scrollIntoView({ block: 'nearest', behavior: 'smooth' });
    }
}

window.topbar = new TopbarComponent();

document.addEventListener('DOMContentLoaded', () => {
    const showLogoutMessage = sessionStorage.getItem('show-logout-message');

    if (showLogoutMessage) {
        sessionStorage.removeItem('show-logout-message');

        if (window.topbar && window.topbar.notificationSystem) {
            setTimeout(() => {
                window.topbar.notificationSystem.show('You have been signed out successfully', 'info', 4000);
            }, 500);
        }
    }
});